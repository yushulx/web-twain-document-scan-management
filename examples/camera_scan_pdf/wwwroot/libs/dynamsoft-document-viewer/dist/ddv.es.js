/*! 
* 20240820142737
* Dynamsoft JavaScript Library
* Product: Dynamsoft Document Viewer
* Web Site: https://www.dynamsoft.com
*
* Copyright 2024, Dynamsoft Corporation
* Author: Dynamsoft Support Team
* Version: 2.0.0
*/

import { mapPackageRegister } from 'dynamsoft-core';

function e(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}function i(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(t,i){return t.get(e(t,i))}function n(t,e,s){i(t,e),e.set(t,s);}function o(t,i,s){return t.set(e(t,i),s),s}function r(t,i,s){return s(e(t,i))}function a(t,e){i(t,e),e.add(t);}function l(t,e,i){return (e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===e?String:Number)(t)}(t,"string");return "symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{l(s.next(t));}catch(t){o(t);}}function a(t){try{l(s.throw(t));}catch(t){o(t);}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e);}))).then(r,a);}l((s=s.apply(t,e||[])).next());}))}function d(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)}function c(t,e,i,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===s?n.call(t,i):n?n.value=i:e.set(t,i),i}var u,p,g,f,m,y,v,x,w,b,C,S,P,A,T,k,D,E,I,R,M,B,L,U,O,_,N,W,F,H,V,z,j,$,G,X,Y,J,q,Z,Q,K,tt,et,it,st,nt,ot,rt,at,lt,ht,dt,ct,ut,pt,gt,ft,mt,yt,vt,xt,wt,bt,Ct,St,Pt,At,Tt,kt,Dt,Et,It,Rt,Mt,Bt,Lt,Ut,Ot,_t,Nt,Wt,Ft,Ht,Vt,zt,jt,$t,Gt,Xt,Yt,Jt,qt,Zt,Qt,Kt,te,ee,ie,se,ne,oe,re,ae,le,he,de,ce,ue,pe,ge,fe,me,ye,ve,xe,we,be,Ce,Se,Pe,Ae,Te,ke,De,Ee,Ie,Re,Me,Be,Le,Ue,Oe,_e,Ne,We,Fe,He,Ve,ze,je,$e,Ge,Xe,Ye,Je,qe,Ze,Qe,Ke,ti,ei,ii,si,ni,oi,ri,ai,li,hi;"function"==typeof SuppressedError&&SuppressedError,function(t){t.logInfo="logInfo",t.logDebug="logDebug",t.logAll="logAll",t.imgIO="imgIO",t.core="imgCore",t.imgProc="imgProc",t.pdfR="pdfReader",t.pdfW="pdfWriter",t.crypto="crypto",t.binaryBlobType="application/octet-stream",t.wasmExtension=".wasm";}(u||(u={})),function(t){t.core="ddv-core",t.reader="ddv-reader",t.detector="ddv-detector",t.loader="ddv-loader";}(p||(p={})),function(t){t.pending="pending",t.ready="ready",t.failed="failed",t.destroyed="destroyed",t.init="init";}(g||(g={})),function(t){t.PARAMETER_TYPE_ERROR="Parameter Type not Supported = ",t.TIMEOUT="Timeout no Response = ",t.FILE_STREAM_ERROR="File Stream Error = ",t.WASM_EXCEPTION_ERROR="An WASM exception occurred.";}(f||(f={})),function(t){t[t.LONG_KEY=0]="LONG_KEY",t[t.DLS_KEY=1]="DLS_KEY";}(m||(m={})),function(t){t[t.wasmSucceed=0]="wasmSucceed",t[t.wasmBase=-4e3]="wasmBase",t[t.wasmException=-4001]="wasmException",t[t.wasmNoModule=-4002]="wasmNoModule",t[t.wasmJsBase=-4100]="wasmJsBase",t[t.wasmJsObjectNotInit=-4101]="wasmJsObjectNotInit",t[t.wasmJsObjectTerminated=-4102]="wasmJsObjectTerminated",t[t.wasmJsObjectInitFailed=-4103]="wasmJsObjectInitFailed",t[t.wasmJsNotLoaded=-4104]="wasmJsNotLoaded",t[t.wasmJsInvalidJson=-4105]="wasmJsInvalidJson",t[t.wasmJsWorkerRunException=-4106]="wasmJsWorkerRunException",t[t.wasmJsWorkerRunFailed=-4107]="wasmJsWorkerRunFailed",t[t.wasmJsReadFileFailed=-4108]="wasmJsReadFileFailed",t[t.wasmJsCoreTaskException=-4109]="wasmJsCoreTaskException",t[t.wasmJsProcTaskException=-4110]="wasmJsProcTaskException",t[t.wasmJsSavePdfFailed=-4111]="wasmJsSavePdfFailed",t[t.wasmJsSaveTiffFailed=-4112]="wasmJsSaveTiffFailed";}(y||(y={})),function(t){t[t.IT_DIB=-1]="IT_DIB",t[t.IT_RGBA=-2]="IT_RGBA",t[t.IT_BGRA=-3]="IT_BGRA",t[t.IT_BMP=0]="IT_BMP",t[t.IT_JPG=1]="IT_JPG",t[t.IT_PNG=3]="IT_PNG",t[t.IT_ALL=5]="IT_ALL";}(v||(v={})),function(t){t[t.RT_AUTO=-1]="RT_AUTO",t[t.RT_BINARY=1]="RT_BINARY",t[t.RT_BASE64=2]="RT_BASE64";}(x||(x={})),function(t){t[t.SF_DEF=0]="SF_DEF",t[t.SF_ENABLE=1]="SF_ENABLE",t[t.SF_DISABLE=2]="SF_DISABLE";}(w||(w={})),function(t){t.imgIOVer="2.0.0",t.coreVer="2.0.0",t.imgProcVer="2.0.0",t.pdfRVer="2.0.0",t.pdfWVer="2.0.0",t.cryptoVer="2.0.0";}(J||(J={}));class di{static setLogFunc(t,e,i){c(this,b,t,"f",C),c(this,b,e,"f",S),c(this,b,i,"f",P);}static get level(){return d(this,b,"f",C)}static get func(){return d(this,b,"f",S)}static get context(){return d(this,b,"f",P)}static logAll(t){this.log(u.logAll,t);}static logD(t){this.log(u.logDebug,t);}static log(t,e){d(this,b,"f",S)&&d(this,b,"f",C)===t&&d(this,b,"f",S).call(this,e,d(this,b,"f",P));}}b=di,C={value:""},S={value:void 0},P={value:null};class ci{static unload(){c(this,A,"","f",T),c(this,A,"","f",D),c(this,A,null,"f",E),c(this,A,{name:u.imgIO,workerName:p.core,autoLoad:!1,ver:J.imgIOVer,prefixName:ci.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:d(ci,A,"f",W)},"f",z),c(this,A,{name:u.crypto,workerName:p.core,autoLoad:!1,ver:J.cryptoVer,prefixName:ci.CryptoPrefixName,dependencyModules:[u.imgIO],fetchOptions:d(ci,A,"f",W)},"f",j),c(this,A,{name:u.pdfR,workerName:p.reader,autoLoad:!1,ver:J.pdfRVer,prefixName:ci.PdfReaderPrefixName,dependencyModules:[u.imgIO,u.core],fetchOptions:d(ci,A,"f",W)},"f",$),c(this,A,{name:u.core,workerName:p.core,autoLoad:!1,ver:J.coreVer,prefixName:ci.ImagecorePrefixName,dependencyModules:[u.imgIO],fetchOptions:d(ci,A,"f",W)},"f",G),c(this,A,{name:u.imgProc,workerName:p.core,autoLoad:!1,ver:J.imgProcVer,prefixName:ci.ImageProcPrefixName,dependencyModules:[u.imgIO,u.core],useSimd:ci.UseSimd},"f",X),di.setLogFunc("",void 0,null);}static get UseSimd(){return d(this,A,"f",R)}static set UseSimd(t){c(this,A,t,"f",R);}static get License(){return d(this,A,"f",T)}static set License(t){c(this,A,t,"f",T);}static get LicMode(){return d(this,A,"f",k)}static set LicMode(t){c(this,A,t,"f",k),d(this,A,"m",B).call(this);}static get UUID(){return d(this,A,"f",D)}static set UUID(t){c(this,A,t,"f",D);}static get NavInfo(){return d(this,A,"f",E)}static set NavInfo(t){c(this,A,t,"f",E);}static get Mobile(){return d(this,A,"f",I)}static set Mobile(t){c(this,A,t,"f",I);}static get DefHeapSize(){return d(this,A,"f",L)}static set DefHeapSize(t){c(this,A,t,"f",L);}static get MaxHeapSize(){return d(this,A,"f",U)}static get HeapConfig(){return d(this,A,"m",_).call(this),Object.assign({},d(this,A,"f",O))}static getWorkerHeap(t){return void 0!==d(this,A,"f",O)[t]?d(this,A,"f",O)[t]:{maxHeapSize:d(this,A,"f",U),initHeapSize:d(this,A,"f",L)}}static UpdateHeapConfig(t,e,i){d(this,A,"m",_).call(this),e&&void 0!==d(this,A,"f",O)[t]&&(d(this,A,"f",O)[t].maxHeapSize=e),i&&void 0!==d(this,A,"f",O)[t]&&(d(this,A,"f",O)[t].initHeapSize=i);}static get ImageIOWorkerJS(){return "ddv-imageio.worker.js?v="+J.imgIOVer}static get PdfReaderWorkerJS(){return "dynamsoft.pdfReader_wasm-"+J.pdfRVer+".js"}static get ImageIOPrefixName(){return "ddv-imageio"}static get ImagecorePrefixName(){return "ddv-imagecore"}static get ImageProcPrefixName(){return "ddv-imageproc"}static get PdfReaderPrefixName(){return "ddv-pdfreader"}static get CryptoPrefixName(){return "ddv-crypto"}static get ImageIOResource(){return d(this,A,"f",F)}static set ImageIOResource(t){c(this,A,d(this,A,"m",N).call(this,t),"f",F),d(this,A,"m",V).call(this,d(this,A,"f",F),d(this,A,"f",z)),d(this,A,"m",V).call(this,d(this,A,"f",F),d(this,A,"f",j)),d(this,A,"m",V).call(this,d(this,A,"f",F),d(this,A,"f",G)),d(this,A,"m",V).call(this,d(this,A,"f",F),d(this,A,"f",X));}static get PdfReaderResource(){return d(this,A,"f",H)}static set PdfReaderResource(t){t.useFastCompEdition=!1,c(this,A,d(this,A,"m",N).call(this,t),"f",H),d(this,A,"m",V).call(this,d(this,A,"f",H),d(this,A,"f",$)),this.PdfReaderModule.singleInstance=!0;}static get ImageIOModule(){return d(this,A,"f",z)}static get CryptoModule(){return d(this,A,"f",j)}static get PdfReaderModule(){return d(this,A,"f",$)}static get ImagecoreModule(){return d(this,A,"f",G)}static get ImageReadereModule(){const t=Object.assign({},d(this,A,"f",G));return t.workerName=p.reader,t}static get ImageProcModule(){return d(this,A,"f",X)}static get DetectorModule(){return c(this,A,Object.assign({},d(this,A,"f",X)),"f",Y),d(this,A,"f",Y).workerName=p.detector,d(this,A,"f",Y)}static get PdfWriterModule(){const t=Object.assign({},d(this,A,"f",$));return t.workerName=p.core,t}static setLogFunc(t,e,i){di.setLogFunc(t,e,i);}}A=ci,M=function(t){this.LicMode==m.DLS_KEY&&t.dependencyModules&&-1!=t.dependencyModules.indexOf(u.imgIO)&&-1==t.dependencyModules.indexOf(u.crypto)&&t.dependencyModules.push(u.crypto);},B=function(){d(this,A,"m",M).call(this,d(this,A,"f",G)),d(this,A,"m",M).call(this,d(this,A,"f",X)),d(this,A,"m",M).call(this,d(this,A,"f",$));},_=function(){0===Object.keys(d(this,A,"f",O)).length&&(d(this,A,"f",O)[p.core]={},d(this,A,"f",O)[p.core].maxHeapSize=d(this,A,"f",U),d(this,A,"f",O)[p.core].initHeapSize=d(this,A,"f",L),d(this,A,"f",O)[p.reader]={},d(this,A,"f",O)[p.reader].maxHeapSize=d(this,A,"f",U),d(this,A,"f",O)[p.reader].initHeapSize=d(this,A,"f",L),d(this,A,"f",O)[p.detector]={},d(this,A,"f",O)[p.detector].maxHeapSize=d(this,A,"f",U),d(this,A,"f",O)[p.detector].initHeapSize=d(this,A,"f",L));},N=function(t){var e,i,s;let n={crossScript:!1,resourceDir:t.resourceDir,workerScript:t.workerScript,useFastCompEdition:null!==(e=t.useFastCompEdition)&&void 0!==e&&e,useSimd:null!==(i=t.useSimd)&&void 0!==i?i:d(this,A,"f",R),fetchOptions:null!==(s=t.fetchOptions)&&void 0!==s?s:d(this,A,"f",W)};return n.workerScript=t.resourceDir+t.workerScript,n.workerScript.startsWith("http://")||n.workerScript.startsWith("https://")?(n.resourceDir=t.resourceDir,n.workerScript.startsWith(location.origin)||(n.crossScript=!0)):t.resourceDir.startsWith("/")?null!=location.origin&&(n.resourceDir=location.origin+t.resourceDir):null!=location.href&&(n.resourceDir=location.href.substring(0,location.href.lastIndexOf("/")+1)+t.resourceDir),n.resourceDir.endsWith("/")||(n.resourceDir+="/"),t.useFastCompEdition&&(n.resourceDir+="fastcomp/",n.workerScript=n.resourceDir+t.workerScript),n},V=function(t,e){e.resourceDir=t.resourceDir,e.crossScript=t.crossScript,e.name===u.imgProc?e.useSimd=t.useSimd:e.useSimd=!1,e.script=t.workerScript,e.fetchOptions=t.fetchOptions;},T={value:""},k={value:m.LONG_KEY},D={value:""},E={value:null},I={value:!1},R={value:!1},L={value:32},U={value:200},O={value:Object.create(null)},W={value:{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}},F={value:{resourceDir:"",workerScript:ci.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:d(ci,A,"f",W)}},H={value:{resourceDir:"",workerScript:ci.ImageIOWorkerJS,useFastCompEdition:!1,useSimd:!1,crossScript:!1,fetchOptions:d(ci,A,"f",W)}},z={value:{name:u.imgIO,workerName:p.core,autoLoad:!1,ver:J.imgIOVer,prefixName:ci.ImageIOPrefixName,dependencyModules:[],useSimd:!1,fetchOptions:d(ci,A,"f",W)}},j={value:{name:u.crypto,workerName:p.core,autoLoad:!1,ver:J.cryptoVer,prefixName:ci.CryptoPrefixName,dependencyModules:[u.imgIO],fetchOptions:d(ci,A,"f",W)}},$={value:{name:u.pdfR,workerName:p.reader,autoLoad:!1,ver:J.pdfRVer,prefixName:ci.PdfReaderPrefixName,dependencyModules:[u.imgIO,u.core],fetchOptions:d(ci,A,"f",W)}},G={value:{name:u.core,workerName:p.core,autoLoad:!1,ver:J.coreVer,prefixName:ci.ImagecorePrefixName,dependencyModules:[u.imgIO],fetchOptions:d(ci,A,"f",W)}},X={value:{name:u.imgProc,workerName:p.core,autoLoad:!1,ver:J.imgProcVer,prefixName:ci.ImageProcPrefixName,dependencyModules:[u.imgIO,u.core],useSimd:ci.UseSimd}},Y={value:void 0};class ui{static read(t){return new Promise((function(e,i){let s=Object.prototype.toString.call(t);if("[object String]"===s){if(0===t.indexOf("blob:")||t.indexOf(".jpg")>0||t.indexOf(".jpeg")>0||t.indexOf(".png")>0||t.indexOf(".bmp")>0||t.indexOf(".dib")>0||t.indexOf(".pdf")>0||t.indexOf(".tiff")>0||t.indexOf(".tif")>0)return fetch(t,{mode:"cors"}).then((function(t){return t.arrayBuffer()})).then((function(t){return e(t)})).catch((function(t){return Promise.reject(t)}));i("Error url: Can not read the file URL");}else if("[object Blob]"===s||"[object FileList]"===s||"[object File]"===s){let n=t;"[object FileList]"!==s&&"[object File]"!==s||(n=t[0]?t[0]:t),d(ui,q,"m",Z).call(ui,n,e,i);}else "[object ArrayBuffer]"===s||"[object Uint8ClampedArray]"===s?e(t):i("Not support source type: "+s);}))}}q=ui,Z=function(t,e,i){let s,n,o=0;try{s=new ArrayBuffer(t.size),n=new Uint8Array(s);}catch(t){i(t);}!function r(){const a=new FileReader;a.onload=function(a){var l;if(null===(l=null==a?void 0:a.target)||void 0===l?void 0:l.result){const i=a.target.result;n.set(new Uint8Array(i),o),o+=i.byteLength,o<t.size?r():e(s);}else i(a);},a.onerror=function(t){i(t);},a.onabort=function(t){i(t);};const l=Math.min(o+1048576,t.size),h=t.slice(o,l);a.readAsArrayBuffer(h);}();};class pi{static fetchRetry(t,e,i,s){let n=e.retries,o=e.retryDelay;return new Promise((function(r,a){const l=function(h){return fetch(t,e).then((function(t){r(t);})).catch((function(t){h<n?function(t,e){i&&i(e,s),setTimeout((function(){l(++t);}),o);}(h,t):a(t);}))};return l(0)}))}}class gi{constructor(t,e,i,s,n,o){Q.add(this),K.set(this,void 0),tt.set(this,void 0),et.set(this,void 0),it.set(this,void 0),st.set(this,void 0),nt.set(this,void 0),ot.set(this,void 0),rt.set(this,void 0),at.set(this,void 0),lt.set(this,void 0),ht.set(this,void 0),dt.set(this,void 0),ct.set(this,void 0),ut.set(this,0),pt.set(this,{}),gt.set(this,null),c(this,K,t,"f"),c(this,at,s,"f"),c(this,ct,i,"f"),c(this,et,[],"f"),c(this,it,!1,"f"),c(this,st,!1,"f"),c(this,ut,e,"f"),c(this,gt,Object.create(null),"f"),d(this,pt,"f").modulesInfo=[],c(this,ht,Object.create(null),"f"),c(this,rt,null,"f"),c(this,lt,0,"f"),c(this,dt,0,"f"),c(this,tt,d(this,Q,"m",mt).call(this,d(this,K,"f")),"f"),d(this,tt,"f").on("message",d(this,Q,"m",vt),this),d(this,tt,"f").on("error",d(this,Q,"m",yt),this),d(this,tt,"f").on("exit",(function(e,i,s){let n="Worker #terminated Unexpectedly\n";n+=" exitCode: `"+e+"`\n",n+=" signalCode: `"+i+"`\n",n+=" #script: `"+t+"`\n",d(s,Q,"m",yt).call(s,new Error(n),s);}),this);}get WorkerScript(){return d(this,at,"f")}get id(){return d(this,ut,"f")}get Module(){return d(this,pt,"f")}get Instances(){return d(this,gt,"f")}get WorkerName(){return d(this,ct,"f")}execTask(t,e,i){i||((i={}).promise=new Promise((function(t,e){i.resolve=t,i.reject=e;})));let s=c(this,dt,+d(this,dt,"f")+1,"f");d(this,ht,"f")[s]={id:s,insId:e.insId,resolver:i,cost:e.cost},delete e.cost;let n={id:s,func:t,params:e};return di.logD("["+e.insId+"] "+t+" send"),d(this,st,"f")?i.reject(new Error("Worker is #terminated")):d(this,it,"f")?i.reject(new Error("Worker is #terminating")):d(this,tt,"f").wasmReady||d(this,tt,"f").ready&&"loadWasm"===t?d(this,tt,"f").send(n):d(this,et,"f").push(n),i.promise}get memSize(){return d(this,lt,"f")}get busy(){return this.howManyTasks>0}get howManyTasks(){return Object.keys(d(this,ht,"f")).length}get alive(){return !d(this,it,"f")&&!d(this,st,"f")}terminate(t,e){if(di.logD("["+this.id+"] worker terminate "+t),t&&d(this,Q,"m",wt).call(this,"Worker has been #terminated"),"function"==typeof e&&c(this,rt,e,"f"),this.busy)c(this,it,!0,"f");else {if(d(this,tt,"f")){if("function"!=typeof d(this,tt,"f").terminate)throw new Error("Failed to terminate worker");di.logD("["+this.id+"] will be terminated"),d(this,tt,"f").terminate(),c(this,tt,null,"f");}c(this,it,!1,"f"),c(this,st,!0,"f"),d(this,rt,"f")&&d(this,rt,"f").call(this,this);}}hasInstance(t){if(t){const e=d(this,gt,"f")[t];if(e)return 0!=Object.keys(e).length}else {const t=Object.keys(d(this,gt,"f"));for(const e of t)if(0!=Object.keys(d(this,gt,"f")[e]).length)return !0}return !1}exceedMaxMemory(){const t=1024*ci.getWorkerHeap(this.WorkerName).maxHeapSize*1024;return !!(d(this,lt,"f")&&d(this,lt,"f")>t&&0!=t)&&(di.logD("[w-"+this.id+"] current memSize="+d(this,lt,"f")+", max="+t),!0)}shouldBeFreed(){return !(!this.exceedMaxMemory()||this.hasInstance(void 0)||(di.logD("[w-"+this.id+"] try to terminate the worker"),this.terminate(),0))}}K=new WeakMap,tt=new WeakMap,et=new WeakMap,it=new WeakMap,st=new WeakMap,nt=new WeakMap,ot=new WeakMap,rt=new WeakMap,at=new WeakMap,lt=new WeakMap,ht=new WeakMap,dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,pt=new WeakMap,gt=new WeakMap,Q=new WeakSet,ft=function(t){let e=new Error(""),i=Object.keys(t);for(let s=0;s<i.length;s++)e[i[s]]=t[i[s]];return e},mt=function(t){if("function"!=typeof Worker&&"object"!=typeof Worker)throw new Error("Web Workers not supported");let e=new Worker(t,{name:this.WorkerName});return e.on=function(t,e,i){this.addEventListener(t,(function(s){"exit"===t?e(s.data,"",i):e(s.data,i);}));},e.send=function(t){if(null!=t&&null!=t.params&&null!=t.params.input){let e=Object.prototype.toString.call(t.params.input);if("[object Array]"===Object.prototype.toString.call(t.params.input)){if(e=Object.prototype.toString.call(t.params.input[0]),"[object ArrayBuffer]"===e||"[object Uint8ClampedArray]"===e||"[object Uint8Array]"===e)return void this.postMessage(t,[null!=t.params.input[0].buffer?t.params.input[0].buffer:t.params.input[0]])}else if("[object ArrayBuffer]"===e||"[object Uint8ClampedArray]"===e||"[object Uint8Array]"===e)return void this.postMessage(t,[null!=t.params.input.buffer?t.params.input.buffer:t.params.input])}this.postMessage(t);},e},yt=function(t,e){c(e,st,!0,"f"),di.logD("[js]["+e.id+"] worker error "+JSON.stringify(t)),d(e,it,"f")&&d(e,rt,"f")&&d(e,rt,"f").call(e,e),c(e,it,!1,"f"),d(e,Q,"m",wt).call(e);},vt=function(t,e){let i=t.id,s=d(e,ht,"f")[i];if(t&&t.cost&&s&&s.cost){const e=s.cost;e.exec=t.cost;const i=Date.now();e.total=i-e.ctime,e.msgQueue=t.ctime-e.time;const n=i-t.time;delete e.time,delete e.ctime,t.cost=e,t.cost.receive=n,delete t.ctime,delete t.time;}if(di.logD(t.log?t.log:t),"string"==typeof t&&"ready"===t)d(e,tt,"f").ready=!0,setTimeout((()=>{d(e,Q,"m",xt).call(e);}),0);else if(!t.log){if("object"==typeof t){let i=t.result;"object"==typeof i?(null!=i.errorCode&&(i.code=i.errorCode,delete i.errorCode),null!=i.errorMessage&&(i.message=i.errorMessage,delete i.errorMessage)):"string"==typeof i&&(i=i.replace('"errorCode"','"code"'),i=i.replace("'errorCode'","'code'"),i=i.replace('"errorMessage"','"message"'),i=i.replace("'errorMessage'","'message'"),t.result=i),null!=t.memSize&&c(e,lt,t.memSize,"f");}if(void 0!==s){const n=s.insId;delete d(e,ht,"f")[i],di.logD("["+n+"] "+t.func+" received"),!0===d(e,it,"f")&&e.terminate(),"loadWasm"===t.func&&null!=t.result&&(d(e,tt,"f").wasmReady=!0,setTimeout((()=>{d(e,Q,"m",xt).call(e);}),0)),t.error?s.resolver.reject(d(e,Q,"m",ft).call(e,t.error)):t.result&&s.resolver.resolve(t.result);}}},xt=function(){this.alive&&(d(this,et,"f").forEach(d(this,tt,"f").send.bind(d(this,tt,"f"))),c(this,et,[],"f"));},wt=function(t){for(let e in d(this,ht,"f"))void 0!==d(this,ht,"f")[e]&&d(this,ht,"f")[e].resolver.reject(new Error(t));c(this,ht,Object.create(null),"f");};class fi{constructor(){bt.add(this),Pt.set(this,[]),At.set(this,4),Tt.set(this,60),kt.set(this,!1),Dt.set(this,0),It.set(this,!1);}static get Instance(){return d(this,Ct,"f",St)||c(this,Ct,new fi,"f",St),d(this,Ct,"f",St)}get Terminated(){return d(this,kt,"f")}getModuleLoadedError(t){for(let e of d(fi,Ct,"f",Et))if(e.name==t)return e.error}getModuleStatus(t){for(let e of d(fi,Ct,"f",Et))if(e.name==t)return e.status;return ""}addModules(t,e){let i=!1;if(d(fi,Ct,"f",Et).forEach((function(e,s,n){e.name==t.name&&(e.ver==t.ver?i=!0:n.splice(s,1));})),!i){let i=t;i.status=e||"",i.wasmModule=null,d(fi,Ct,"f",Et).push(i);}}loadModule(t,e){return h(this,void 0,void 0,(function*(){null==e&&(e=0!=d(this,bt,"m",Nt).call(this,t).length),this.addModules(t);for(let e of t.dependencyModules)e===u.imgIO?(this.addModules(ci.ImageIOModule,g.pending),ci.LicMode===m.DLS_KEY&&t.name!=u.crypto&&this.addModules(ci.CryptoModule,g.pending)):e===u.core&&this.addModules(ci.ImagecoreModule,g.pending);let i,s;for(let n of d(fi,Ct,"f",Et))if(n.name===t.name){if(n.status===g.pending)return !1;if(n.wasmModule){if(e)return !0;i=n.wasmModule,s=n.wasmBinary;break}break}let n=null;if(i)n=t,n.wasmModule=i,n.wasmBinary=s,n.status=g.pending;else if(n=t,""===n.status)n.status=g.pending,n.wasmModule=null;else {if(n.status===g.pending)return !1;e||(n.error={code:0,message:""},n.status=g.pending);}return d(this,bt,"m",Rt).call(this,n)}))}get busy(){d(this,bt,"m",Vt).call(this);let t=d(this,Pt,"f");for(let e of t)if(e.busy)return !0;return !1}getWorker(t,e){return h(this,void 0,void 0,(function*(){if(d(this,bt,"m",Wt).call(this,t.name))return d(this,bt,"m",Ht).call(this),{worker:null,workers:0};let i=d(this,bt,"m",Nt).call(this,t,!0);return 0!=i.length?{worker:d(this,bt,"m",zt).call(this,i,e,t),workers:i.length}:(yield this.loadModule(t,!1),{worker:null,workers:0})}))}removeInstanceInWorker(t,e,i,s){if(d(this,bt,"m",jt).call(this,e,t.name,i),s&&e&&e.shouldBeFreed()){let t=d(this,Pt,"f").indexOf(e);-1!==t&&d(this,Pt,"f").splice(t,1);}}terminate(t){c(fi,Ct,null,"f",St),di.logD("worker pool terminate "+t),c(this,kt,!0,"f");let e=[],i=d(this,Pt,"f").slice();return c(this,Pt,[],"f"),i.forEach((function(i){let s={};s.promise=new Promise((function(t,e){s.resolve=t,s.reject=e;})),e.push(s.promise),i.terminate(t,(function(t){s.resolve(t);}));})),Promise.all(e)}static unload(){c(this,Ct,new Array,"f",Et);}terminateWorker(t){d(this,Pt,"f").splice(0,d(this,Pt,"f").length,...d(this,Pt,"f").filter((e=>e.WorkerName!==t||(e.terminate(!0),!1))));}getMemoryUsed(){let t=d(this,Pt,"f"),e=[],i=0;for(let s of t)s&&null!=s.memSize&&(e[i]={},e[i].size=s.memSize,e[i].limit=1024*ci.getWorkerHeap(s.WorkerName).maxHeapSize*1024,e[i].name=s.WorkerName,e[i].id=s.id,i+=1);return e}}Ct=fi,Pt=new WeakMap,At=new WeakMap,Tt=new WeakMap,kt=new WeakMap,Dt=new WeakMap,It=new WeakMap,bt=new WeakSet,Rt=function(t){return h(this,void 0,void 0,(function*(){let e=this,i=yield d(this,bt,"m",Ot).call(this,t);if(i){let s={id:0,func:"loadWasm",params:{insId:0,priority:0,module:{modulesInfo:[]},fetchOptions:t.fetchOptions}};if(s.params.resourceDir=t.resourceDir,s.params.initMemory=ci.getWorkerHeap(t.workerName).initHeapSize,s.params.module){for(let e of d(fi,Ct,"f",Et))for(let i of t.dependencyModules)i==e.name&&s.params.module.modulesInfo.push(e);s.params.module.modulesInfo.push(t);}yield d(this,bt,"m",Bt).call(this,i,s),c(e,At,d(e,bt,"m",Ut).call(e),"f"),t.status===g.pending&&(t.status="");}else t.status="",t.wasmModule=null;}))},Mt=function(t,e,i,s){for(let n of d(fi,Ct,"f",Et))if(n.name===t){n.status=e,n.wasmModule=i.wasmModule,n.wasmBinary=i.wasmBinary,n.error=s;break}},Bt=function(t,e,i){return h(this,void 0,void 0,(function*(){let s=this;try{const i=yield t.execTask(e.func,e.params);let n=!1;return void 0===i.code||i.modules?n=d(s,bt,"m",Lt).call(s,i,t):di.logD(i),n}catch(s){return di.logD(s),!1}finally{i&&i();}}))},Lt=function(t,e){if(di.logD("handleWasmLoad:"),di.logD(t),d(this,kt,"f"))return e.terminate(),!1;if(("object"!=typeof t||null==t.modules)&&"object"==typeof t)return !1;let i=!1;for(const s of t.modules)t.code?(d(this,bt,"m",Mt).call(this,s.name,g.failed,null,{code:t.code,message:t.message}),e.Module.modulesInfo[s.name]=!1):(d(this,bt,"m",Mt).call(this,s.name,g.ready,s.wasmResource,void 0),e.Module.modulesInfo[s.name]=!0,i=!0);return i},Ut=function(){let t=2;return "hardwareConcurrency"in self.navigator&&(t=self.navigator.hardwareConcurrency),Math.max(Math.min(d(this,At,"f"),Math.max(d(this,At,"f"),t/2)),1)},Ot=function(t){return h(this,void 0,void 0,(function*(){d(this,bt,"m",Vt).call(this);let e=d(this,Pt,"f");for(let i of e)if(i.WorkerName===t.workerName)return i.busy?null:i;return d(this,bt,"m",_t).call(this,t)}))},_t=function(t){var e;return h(this,void 0,void 0,(function*(){let i=this,s=d(i,Pt,"f");if(s.length<d(i,At,"f")&&!d(i,It,"f")){c(i,It,!0,"f");let n=t.script;t.crossScript&&(n=yield pi.fetchRetry(t.script,t.fetchOptions,di.func,i).then((t=>t.blob())).then((t=>URL.createObjectURL(t))).catch((t=>(di.logD("get new worker fetch failed: "),di.logD(t),c(i,It,!1,"f"),null))));let o=new gi(n,c(e=i,Dt,+d(e,Dt,"f")+1,"f"),t.workerName,t.script,di.func,di.context);return s.push(o),c(i,It,!1,"f"),di.logAll(s),di.logD("[wl-"+d(i,Pt,"f").length+"] got new worker w-"+o.id+"("+o.WorkerName+") succeed!"),o}return null}))},Nt=function(t,e){d(this,bt,"m",Vt).call(this);let i=d(this,Pt,"f");di.logAll(i);let s=[];for(let n of i)if(n.Module.modulesInfo[t.name]){let i=!0;if(t.dependencyModules.forEach((t=>{n.Module.modulesInfo[t]||(i=!1);})),!i)continue;if(e&&n.WorkerName!==t.workerName)continue;s.push(n);}return di.logAll("[wl-"+i.length+"] got workers for module "+t.name),di.logAll(s),s},Wt=function(t){for(let e of d(fi,Ct,"f",Et))if(e.name===t&&e.status===g.pending)return !0;return !1},Ft=function(){return h(this,void 0,void 0,(function*(){this.terminate(!0);for(let t of d(fi,Ct,"f",Et))yield d(this,bt,"m",Rt).call(this,t);}))},Ht=function(){d(this,bt,"m",Vt).call(this),0==d(this,Pt,"f").length&&0!=d(fi,Ct,"f",Et).length&&(di.logD("no worker ready, reinit"),d(this,bt,"m",Ft).call(this));},Vt=function(){d(this,Pt,"f").splice(0,d(this,Pt,"f").length,...d(this,Pt,"f").filter((function(t){return t.alive})));},zt=function(t,e,i){di.logAll("[wl-"+d(this,Pt,"f").length+"] getWorkerByIntanceId"),di.logAll(t);let s,n=9007199254740991;for(let o of t){if(i.singleInstance&&o.hasInstance(i.name))continue;const t=o.Instances[i.name];if(!t||null!=t[e]){s=o;break}{let t=o.howManyTasks;t<n&&(s=o,n=t);}}if(s){if(s.shouldBeFreed())return null;const n=s.Instances[i.name];if(n)n[e]="";else {const t=Object.create(null);t[e]="",s.Instances[i.name]=t;}return di.logAll(t),di.logD("[wl-"+t.length+"]["+e+"] got worker w-"+s.id),s}return di.logAll("#getWorkerByIntanceId: no suitable worker"),null},jt=function(t,e,i){let s=d(this,Pt,"f");di.logAll("removeInstanceInWorkerInner"),di.logAll(s);for(let n of s)if(n===t){const o=n.Instances[e];if(o){null!=o[i]?(delete o[i],di.logAll(s),di.logD("[w-"+n.id+"] removeInstanceInWorkerInner "+i+" in "+t.id+" succeed!")):di.logD("[w-"+n.id+"] not found instance "+i);break}}},St={value:null},Et={value:new Array};class mi{constructor(t,e){var i,s,n,o;$t.add(this),Yt.set(this,void 0),this._outputType=v.IT_JPG,this._inputType=v.IT_ALL,this._jpegQuality=80,Jt.set(this,null!==(i=ci.License)&&void 0!==i?i:""),qt.set(this,[]),Zt.set(this,null),Qt.set(this,0),Kt.set(this,c(o=mi,Gt,+d(o,Gt,"f",Xt)+1,"f",Xt)),te.set(this,null),ee.set(this,JSON.parse(JSON.stringify(ci.NavInfo))),ie.set(this,ci.Mobile),se.set(this,location.origin),ne.set(this,""),oe.set(this,g.init),re.set(this,!1),ae.set(this,null!==(s=ci.LicMode)&&void 0!==s?s:m.LONG_KEY),le.set(this,null!==(n=ci.UUID)&&void 0!==n?n:""),he.set(this,0),de.set(this,!1),ce.set(this,!1),this._handleBooleanResult=function(t,e){return !0},c(this,Yt,t,"f"),c(this,Jt,null!=e?e:ci.License,"f");}_prepareModule(t){}get workerId(){return d(this,Zt,"f")&&d(this,Zt,"f").alive?d(this,Zt,"f").id:0}get id(){return d(this,Kt,"f")}hasTask(){return d(this,qt,"f").length>0}_canTerminateWork(){return !1}_makeSureWorkerMemoryNotExceed(){return !(d(this,Zt,"f")&&d(this,Zt,"f").alive&&this._canTerminateWork()&&d(this,Zt,"f").exceedMaxMemory()&&(di.logD(`[${this.id}] try to termiate worker [${d(this,Zt,"f").id}]`),d(this,Zt,"f").terminate(!0),c(this,Zt,null,"f"),c(this,oe,g.init,"f"),1))}_workerChanged(t){}_handleBasicResult(t,e){return delete t.code,delete t.message,t}_handleImageData(t,e){var i,s,n;if("object"==typeof t.imageData)if(null!=t.imageCount&&t.imageCount>1)for(let s=0;s<t.imageCount;s++)t.imageData[s]=d(i=e.context,$t,"m",ge).call(i,t.imageData[s],t.blobType,e.params.returnBlob);else t.imageData=d(s=e.context,$t,"m",ge).call(s,t.imageData,t.blobType,e.params.returnBlob);return "object"==typeof t.pdfData&&(t.pdfData=d(n=e.context,$t,"m",ge).call(n,t.pdfData,t.blobType,e.params.returnBlob)),t}_handleResult(t,e){var i,s;let n=d(s=e.context,$t,"m",fe).call(s,t);if(void 0===n.code||!n.code&&"Successful."===n.message)n=e.handleResult(n,e),setTimeout((()=>{var t;d(t=e.context,$t,"m",pe).call(t);}),0),(0, e.resolve)(n);else {let t={code:n.code,message:n.code===y.wasmException?f.WASM_EXCEPTION_ERROR+"("+(null===(i=e.params)||void 0===i?void 0:i.moduleName)+":"+e.func+":"+n.message+")":n.message};e.context.terminated?e.resolve(t):e.reject(t);}}_execTask(t){let e=this,i=d(e,Zt,"f");if(di.logAll(t),i)try{if(t.params.cost){const e=t.params.cost.time;t.params.cost.time=Date.now(),t.params.cost.taskQueue=t.params.cost.time-e;}i.execTask(t.func,t.params).then((function(i){e._handleResult(d(e,$t,"m",fe).call(e,i),t);})).catch((function(i){di.logD(i),setTimeout((()=>{d(e,$t,"m",pe).call(e);}),0);let s=i;"object"==typeof i&&null!=i.message&&(s=i.message);let n={code:y.wasmJsWorkerRunFailed,message:s};d(e,re,"f")?t.resolve(n):t.reject(n);}));}catch(i){setTimeout((()=>{d(e,$t,"m",pe).call(e);}),0),di.logD(i);let s={code:y.wasmJsWorkerRunException,message:i.message,stack:i.stack};d(e,re,"f")?t.resolve(s):t.reject(s);}}_cancelAllTasks(t,e){for(let i of d(this,qt,"f"))if(void 0!==i){let s={code:t,message:e};d(this,re,"f")?i.resolve(s):i.reject(s);}c(this,qt,[],"f");}_createTask(t,e,i){let s={moduleName:d(this,Yt,"f").name,insId:d(this,Kt,"f")},n={id:c(this,Qt,+d(this,Qt,"f")+1,"f"),func:t,params:s};return n.promise=new Promise((function(t,e){n.resolve=t,n.reject=e;})),n.func=t,n.context=this,n.handleResult=void 0!==i&&i?i:this._handleBasicResult,n.params.input=void 0!==e&&e?e:"",n.params.returnType=x.RT_AUTO,n.params.returnBlob=!0,n.params.logLevel=di.level,n.params.cost={},n.params.cost.ctime=Date.now(),n.params.cost.time=n.params.cost.ctime,n}_addTask(t,e){if(t.params.cost){const e=t.params.cost.time;t.params.cost.time=Date.now(),t.params.cost.create=t.params.cost.time-e;}return d(this,oe,"f")===g.destroyed?t.reject({code:y.wasmJsObjectNotInit,message:d(this,re,"f")?"object has been disposed":"object not init"}):d(this,oe,"f")===g.failed?t.reject({code:y.wasmJsObjectInitFailed,message:d(this,ne,"f")}):(e?d(this,qt,"f").unshift(t):d(this,qt,"f").push(t),d(this,$t,"m",pe).call(this)),t.promise}terminate(t){let e=this;d(e,de,"f")?c(e,re,!0,"f"):(c(this,ce,!0,"f"),d(e,$t,"m",ye).call(e).then((function(t){di.logD("["+e.id+"] "+d(e,Yt,"f").name+" destroy return: "),di.logD(t);})).catch((function(t){di.logD(d(e,Yt,"f").name+" destroy failed"),di.logD(t);})).finally((()=>{let i=fi.Instance;i&&i.removeInstanceInWorker(d(e,Yt,"f"),d(e,Zt,"f"),d(e,Kt,"f"),null==t||t),c(e,Zt,null,"f"),c(e,re,!0,"f"),c(e,ce,!1,"f");}))),c(e,oe,"","f");}_readFile(t){return ui.read(t).catch((function(t){let e=t;return "object"!=typeof e&&(e={},e.code=y.wasmJsReadFileFailed,e.message=t),Promise.reject(e)}))}updateLicense(t,e,i){return h(this,void 0,void 0,(function*(){c(this,Jt,t,"f"),c(this,ae,null!=e?e:m.LONG_KEY,"f"),c(this,le,null!=i?i:"","f");let s=this,n=s._createTask("UpdateLicense");return n.params.input=[d(s,Jt,"f"),d(s,ae,"f"),d(s,le,"f")],s._addTask(n),n.promise}))}}Gt=mi,Yt=new WeakMap,Jt=new WeakMap,qt=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,Kt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,se=new WeakMap,ne=new WeakMap,oe=new WeakMap,re=new WeakMap,ae=new WeakMap,le=new WeakMap,he=new WeakMap,de=new WeakMap,ce=new WeakMap,$t=new WeakSet,ue=function t(e){let i=null!=e?e:this;if(d(i,te,"f")&&clearTimeout(d(i,te,"f")),d(i,re,"f")&&di.logD(`[${i.id}"] has been termiated.(getWorker)`),d(i,Zt,"f")&&d(i,Zt,"f").alive)return d(i,Zt,"f");let s=fi.Instance;s?s.getWorker(d(i,Yt,"f"),d(i,Kt,"f")).then((e=>{if(c(i,Zt,e.worker,"f"),d(i,Zt,"f")&&d(i,Zt,"f").alive)d(i,he,"f")!=d(i,Zt,"f").id&&(0!==d(i,he,"f")&&i._workerChanged(d(i,Zt,"f").id),c(i,he,d(i,Zt,"f").id,"f")),d(i,qt,"f").length>0&&setTimeout((()=>{d(i,$t,"m",pe).call(i);}),0);else {let e=s.getModuleLoadedError(d(i,Yt,"f").name);if(null==e?void 0:e.code)return i._cancelAllTasks(y.wasmJsNotLoaded,e.message),d(i,Zt,"f");d(i,qt,"f").length>0&&c(i,te,setTimeout(d(i,$t,"m",t),50,i),"f");}return d(i,Zt,"f")})).catch((t=>d(i,Zt,"f"))):i._cancelAllTasks(y.wasmJsNotLoaded,"wasm env not loaded or unloaded");},pe=function(){if(di.logAll(d(this,qt,"f")),d(this,oe,"f")!=g.init)if(d(this,Zt,"f")&&d(this,Zt,"f").alive){if(d(this,qt,"f").length>0){let t=d(this,qt,"f")[0];d(this,oe,"f")!==g.ready&&"init"!==t.func||(delete d(this,qt,"f")[0],d(this,qt,"f").splice(0,1),this._execTask(t));}}else {if(d(this,Zt,"f")&&!d(this,Zt,"f").alive&&d(this,qt,"f").length>0&&"init"!=d(this,qt,"f")[0].func)return c(this,Zt,null,"f"),void d(this,$t,"m",me).call(this);d(this,qt,"f").length>0&&d(this,Yt,"f").script&&d(this,$t,"m",ue).call(this,this);}else d(this,$t,"m",me).call(this);},ge=function(t,e,i){if(i){let i;return i=null!=e?new Blob([t],{type:e}):new Blob([t]),i}return t},fe=function(t){try{return "string"==typeof t?JSON.parse(t):t}catch(e){return t}},me=function(){let t=this;t._prepareModule(d(this,Yt,"f"));let e=this._createTask("init");e.params.key=d(this,Jt,"f"),e.params.uuid=d(this,le,"f"),e.params.licMode=d(this,ae,"f"),e.params.val={nv:d(this,ee,"f"),mb:d(this,ie,"f"),dm:d(this,se,"f")},e.handleResult=function(t,e){return c(e.context,oe,g.ready,"f"),t},c(this,oe,g.pending,"f"),this._addTask(e,!0),e.promise.then((function(e){di.logD("["+t.id+"] "+d(t,Yt,"f").name+" init return: "),di.logD(e),c(t,de,!1,"f");})).catch((function(e){c(t,oe,g.failed,"f"),c(t,ne,e.message,"f"),di.logD(d(t,Yt,"f").name+" init failed"),di.logD(e),t._cancelAllTasks(y.wasmJsObjectInitFailed,e.message);}));},ye=function(){if(d(this,oe,"f")==g.pending||d(this,oe,"f")==g.ready){let t=this._createTask("destroy",null,this._handleBooleanResult);return this._addTask(t),t.promise}return Promise.resolve(!0)},Xt={value:0};class yi extends mi{constructor(t,e){super(t,e);}_prepareModule(t){let e=fi.Instance;e.addModules(ci.ImageIOModule),ci.LicMode===m.DLS_KEY&&e.addModules(ci.CryptoModule),d(yi,ve,"m",xe).call(yi,ci.ImageIOModule,t),e.addModules(t);}}ve=yi,xe=function(t,e){e.resourceDir=t.resourceDir,e.crossScript=t.crossScript,e.script=t.script,e.useSimd=t.useSimd,e.name===u.imgProc?e.useSimd=ci.UseSimd:e.useSimd=!1,e.fetchOptions=t.fetchOptions;};class vi extends yi{constructor(t){super(ci.ImagecoreModule,t),we.add(this),be.set(this,0);}getImageFormat(t){return h(this,void 0,void 0,(function*(){let e=this,i=e._createTask("GetImageFormat");const s=yield e._readFile(t);return i.params.input=s,e._addTask(i),i.promise}))}readImageInfo(t){return h(this,void 0,void 0,(function*(){let e=this,i=e._createTask("ReadImageInfo");const s=yield e._readFile(t);return i.params.input=s,e._addTask(i),i.promise}))}getMD5(t){return h(this,void 0,void 0,(function*(){let e=this,i=e._createTask("GetMD5");const s=yield e._readFile(t);return i.params.input=s,i.handleResult=function(t,e){return t.MD5},e._addTask(i),i.promise}))}getLicenseInfo(){return h(this,void 0,void 0,(function*(){return this._addTask(this._createTask("GetLicenseInfo"))}))}getAesResult(t){return h(this,void 0,void 0,(function*(){return t=null!=t?t:"",this._addTask(this._createTask("GetAesResult",[t]))}))}saveImage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){return (n=null!=n&&n)?d(this,we,"m",Ce).call(this,t,void 0,void 0,void 0,1,void 0,void 0,e,i,s):d(this,we,"m",Ce).call(this,t,void 0,void 0,void 0,void 0,void 0,void 0,e,i,s)}))}readImage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){e=null!=e?e:this._outputType,i=null!=i?i:this._jpegQuality,s=null!=s&&s,n=null!=n&&n;let o=this,r=o._createTask("ReadImage");const a=yield o._readFile(t);r.params.input=[a,e,i,n],r.params.returnType=s?x.RT_BASE64:x.RT_AUTO,r.params.returnBlob=!s,r.handleResult=o._handleImageData,o._addTask(r);const l=yield r.promise;if(l.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete l.srcBuffer;}return l}))}openTiff(t,e){return h(this,void 0,void 0,(function*(){let i=this,s=i._createTask("LoadTiff");e=null!=e&&e;const n=yield i._readFile(t);s.params.input=[n,e],i._addTask(s);const o=yield s.promise;if(o.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete o.srcBuffer;}return o}))}readTiff(t,e,i,s){t=null!=t?t:0,e=null!=e?e:this._outputType,i=null!=i&&i,s=null!=s&&s;let n=this._createTask("ReadTiffPage");return n.params.input=[t,e,s],n.params.returnType=i?x.RT_BASE64:x.RT_AUTO,n.params.returnBlob=!i,n.handleResult=this._handleImageData,this._addTask(n)}readTiffInfos(t){let e=this._createTask("GetTiffPageInfos");return e.params.input=[t],this._addTask(e)}closeTiff(){return this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))}createTiff(){return this._addTask(this._createTask("NewTiff",null,this._handleBooleanResult))}appendImage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){e=null!=e?e:this._inputType,i=null!=i?i:d(this,be,"f"),s=null!=s?s:this._jpegQuality,n=null!=n&&n;let o=this,r=o._createTask("AppendImageToTiff");const a=yield o._readFile(t);return r.params.input=[a,e,i,s,n],r.handleResult=o._handleBooleanResult,o._addTask(r),r.promise}))}addTag(t,e,i){return i=null!=i&&i,this._addTask(this._createTask("AddTagToNextPage",[t,e,i],this._handleBooleanResult))}getTiff(t){let e=this._createTask("GetTiffStream");return e.handleResult=this._handleImageData,e.params.returnType=null!=t?t:x.RT_AUTO,e.params.returnBlob=t!=x.RT_AUTO,this._addTask(e)}getMemoryUsed(){return this._addTask(this._createTask("getMemoryUsed",null,(function(t,e){return t.memoryUsed})))}getMultiPartFile(t,e){return this._addTask(this._createTask("ds_get_file",[t,e],(function(t,e){return t})))}}be=new WeakMap,we=new WeakSet,Ce=function(t,e,i,s,n,o,r,a,l,d){return h(this,void 0,void 0,(function*(){let h=this;e=null!=e?e:this._inputType,i=null!=i?i:0,s=null!=s?s:0,n=null!=n?n:24,o=null!=o?o:96,r=null!=r?r:96,a=null!=a?a:this._outputType,l=null!=l?l:this._jpegQuality,d=null!=d?d:x.RT_AUTO;let c=h._createTask("SaveImage");const u=yield h._readFile(t);return c.params.input=[u,e,i,s,n,o,r,a,l],c.params.returnType=d,c.params.returnBlob=d!=x.RT_BASE64,c.handleResult=h._handleImageData,h._addTask(c),c.promise}))};class xi extends yi{constructor(t){super(ci.ImageReadereModule,t),Se.add(this),Pe.set(this,0),Ae.set(this,!1),Te.set(this,null),ke.set(this,void 0),De.set(this,0),Ee.set(this,void 0),Ie.set(this,void 0);}workerChanged(t){c(this,Ae,!1,"f"),t&&(di.logD("["+this.id+"] worker changed to "+t),c(this,De,t,"f"));}setExternalWorkerChanged(t,e){c(this,Ee,t,"f"),c(this,Ie,e,"f");}_workerChanged(t){this.workerChanged(t),d(this,Ee,"f")&&d(this,Ee,"f").call(this,d(this,Ie,"f"),this,t);}_canTerminateWork(){return !0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(c(this,Ae,!1,"f"),d(this,Ee,"f")&&d(this,Ee,"f").call(this,d(this,Ie,"f"),this));}getImageFormat(t){return h(this,void 0,void 0,(function*(){let e=this,i=e._createTask("GetImageFormat");const s=yield e._readFile(t.fileSource);return i.params.input=s,e._addTask(i),i.promise}))}readImageInfo(t){return h(this,void 0,void 0,(function*(){let e=this,i=e._createTask("ReadImageInfo");const s=yield e._readFile(t.fileSource);return i.params.input=s,e._addTask(i),i.promise}))}readImage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){e=null!=e?e:this._outputType,i=null!=i?i:this._jpegQuality,s=null!=s&&s,n=null!=n&&n;let o=this,r=o._createTask("ReadImage");const a=yield o._readFile(t.fileSource);r.params.input=[a,e,i,n],r.params.returnType=s?x.RT_BASE64:x.RT_AUTO,r.params.returnBlob=!s,r.handleResult=o._handleImageData,o._addTask(r);const l=yield r.promise;if(l.srcBuffer){let e=Object.prototype.toString.call(t.fileSource);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete l.srcBuffer;}return l}))}openTiff(t,e){return h(this,void 0,void 0,(function*(){e=null!=e&&e;let i,s=this,n=s._createTask("LoadTiff");if(t!=d(this,Te,"f")){const e=yield s._readFile(t);t instanceof Blob?c(s,Te,t,"f"):c(s,Te,new Blob([e]),"f");}i||(i=yield s._readFile(d(s,Te,"f"))),n.params.input=[i,e],s._addTask(n);const o=yield n.promise;if(c(s,Ae,!0,"f"),o.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete o.srcBuffer;}return c(s,ke,{pageCount:o.pageCount},"f"),o}))}readTiffPage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){yield d(this,Se,"m",Re).call(this,t.fileSource),e=null!=e?e:0,i=null!=i?i:this._outputType,s=null!=s&&s,n=null!=n&&n;let o=this._createTask("ReadTiffPage");return o.params.input=[e,i,n],o.params.returnType=s?x.RT_BASE64:x.RT_AUTO,o.params.returnBlob=!s,o.handleResult=this._handleImageData,this._addTask(o)}))}getTiffInfo(t,e){return h(this,void 0,void 0,(function*(){return yield d(this,Se,"m",Re).call(this,t.fileSource),d(this,ke,"f")}))}getTiffPageInfos(t,e){return h(this,void 0,void 0,(function*(){yield d(this,Se,"m",Re).call(this,t.fileSource);let i=this._createTask("GetTiffPageInfos");return i.params.input=[e],this._addTask(i)}))}}Pe=new WeakMap,Ae=new WeakMap,Te=new WeakMap,ke=new WeakMap,De=new WeakMap,Ee=new WeakMap,Ie=new WeakMap,Se=new WeakSet,Re=function(t){return h(this,void 0,void 0,(function*(){if(this.makeSureWorkerMemoryNotExceed(),d(this,Ae,"f")){if(d(this,Te,"f")===t)return void di.logD("["+this.id+"] already opened in "+this.workerId);yield d(this,Se,"m",Me).call(this);}di.logD("["+this.id+"] reopen in worker "+this.workerId),yield this.openTiff(t,!1);}))},Me=function(){if(c(this,Te,null,"f"),d(this,Ae,"f"))return c(this,Ae,!1,"f"),this._addTask(this._createTask("EndReadTiff",null,this._handleBooleanResult))};class wi{static decode(t){const e={encodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",decodeChars:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1]};function i(t){let e,i,s,n,o,r,a,l=[],h=t.length;for(e=0;e<h;e++)n=t.charCodeAt(e),n>>7&255?6==(n>>5&255)?(o=t.charCodeAt(++e),i=(31&n)<<6,s=63&o,a=i|s,l.push(String.fromCharCode(a))):14==(n>>4&255)&&(o=t.charCodeAt(++e),r=t.charCodeAt(++e),i=n<<4|o>>2&15,s=(3&o)<<6|63&r,a=(255&i)<<8|s,l.push(String.fromCharCode(a))):l.push(t.charAt(e));return l.join("")}return function(t){let s,n,o,r,a=[],l=0,h=t.length;for(;l<h;){do{s=e.decodeChars[255&t.charCodeAt(l++)];}while(l<h&&-1==s);if(-1==s)break;do{n=e.decodeChars[255&t.charCodeAt(l++)];}while(l<h&&-1==n);if(-1==n)break;a.push(String.fromCharCode(s<<2|(48&n)>>4));do{if(o=255&t.charCodeAt(l++),61==o)return i(a.join(""));o=e.decodeChars[o];}while(l<h&&-1==o);if(-1==o)break;a.push(String.fromCharCode((15&n)<<4|(60&o)>>2));do{if(r=255&t.charCodeAt(l++),61==r)return i(a.join(""));r=e.decodeChars[r];}while(l<h&&-1==r);if(-1==r)break;a.push(String.fromCharCode((3&o)<<6|r));}return i(a.join(""))}(t)}}!function(t){t[t.render=1]="render",t[t.extractImageOnly=2]="extractImageOnly",t[t.auto=3]="auto",t[t.renderWithAnnot=4]="renderWithAnnot";}(Ze||(Ze={}));class bi extends mi{constructor(t){super(ci.PdfReaderModule,t),Be.add(this),Oe.set(this,void 0),_e.set(this,void 0),We.set(this,0),Fe.set(this,200),He.set(this,3),Ve.set(this,!1),ze.set(this,void 0),je.set(this,null),$e.set(this,""),this._outputType=v.IT_ALL;}static get fonts(){return d(this,Le,"f",Ue)}static addPdfFont(t,e){return h(this,void 0,void 0,(function*(){return d(this,Le,"m",Ne).call(this,t,e)}))}static getPdfFonts(){return this.fonts?Object.keys(this.fonts):[]}static removeFont(){c(this,Le,Object.create(null),"f",Ue);}workerChanged(t){c(this,Ve,!1,"f"),t&&(di.logD("["+this.id+"] worker changed to "+t),c(this,We,t,"f"));}setExternalWorkerChanged(t,e){c(this,Oe,t,"f"),c(this,_e,e,"f");}_workerChanged(t){this.workerChanged(t),d(this,Oe,"f")&&d(this,Oe,"f").call(this,d(this,_e,"f"),this,t);}_canTerminateWork(){return !0}makeSureWorkerMemoryNotExceed(){this._makeSureWorkerMemoryNotExceed()||(c(this,Ve,!1,"f"),d(this,Oe,"f")&&d(this,Oe,"f").call(this,d(this,_e,"f"),this));}getPdfInfo(t){return h(this,void 0,void 0,(function*(){return yield d(this,Be,"m",Ge).call(this,t),d(this,ze,"f")}))}readPage(t,e,i,s,n,o,r,a){return h(this,void 0,void 0,(function*(){return this.readPageEx(t,e,{convertMode:s,renderOptions:{resolution:i}},n,o,r,a)}))}readPageEx(t,e,i,s,n,o,r){return h(this,void 0,void 0,(function*(){yield d(this,Be,"m",Ge).call(this,t),e=null!=e?e:0,s=null!=s?s:this._outputType,o=null!=o&&o,n=null!=n&&n,r=null!=r&&r;let a=i?JSON.stringify(i):"{}",l=this._createTask("ReadPdfPageEx");return l.params.input=[e,a,s,n,r],l.params.returnType=o?x.RT_BASE64:x.RT_AUTO,l.params.returnBlob=!o,l.handleResult=this._handleImageData,this._addTask(l)}))}readPageImageInfos(t,e,i,s){return h(this,void 0,void 0,(function*(){yield d(this,Be,"m",Ge).call(this,t),s=null!=s?s:this._outputType;let n=i?JSON.stringify(i):"{}",o=this._createTask("ReadPageImageInfos");return o.params.input=[e,n,s],this._addTask(o)}))}readPageAnnot(t,e){return h(this,void 0,void 0,(function*(){yield d(this,Be,"m",Ge).call(this,t),e=null!=e?e:0;let i=this._createTask("GetPageAnnot",[e]);return this._addTask(i)}))}findText(t,e,i,s){return h(this,void 0,void 0,(function*(){return yield d(this,Be,"m",Ge).call(this,t),s=null!=s?s:0,this._addTask(this._createTask("SearchText",[e,i,s]))}))}getPageInfos(t,e){return h(this,void 0,void 0,(function*(){return yield d(this,Be,"m",Ge).call(this,t),this._addTask(this._createTask("GetPdfPageInfos",[e]))}))}}Le=bi,Oe=new WeakMap,_e=new WeakMap,We=new WeakMap,Fe=new WeakMap,He=new WeakMap,Ve=new WeakMap,ze=new WeakMap,je=new WeakMap,$e=new WeakMap,Be=new WeakSet,Ne=function(t,e){return h(this,void 0,void 0,(function*(){if("string"==typeof t&&0!==t.length||Promise.reject("The 'name' should be a valid string"),void 0===d(this,Le,"f",Ue)[t])if(e instanceof Blob)d(this,Le,"f",Ue)[t]=e;else {const i=yield ui.read(e);d(this,Le,"f",Ue)[t]=new Blob([i]);}}))},Ge=function(t){var e,i;return h(this,void 0,void 0,(function*(){if(this.makeSureWorkerMemoryNotExceed(),d(this,Ve,"f")){if(d(this,je,"f")===t.fileSource)return void di.logD("["+this.id+"] already opened in "+this.workerId);yield d(this,Be,"m",qe).call(this);}di.logD("["+this.id+"] reopen in worker "+this.workerId),yield d(this,Be,"m",Je).call(this,null!==(e=t.fileSource)&&void 0!==e?e:d(this,je,"f"),null!==(i=t.password)&&void 0!==i?i:d(this,$e,"f"));}))},Xe=function(){return h(this,void 0,void 0,(function*(){if(0===d(this,We,"f")||d(this,We,"f")!==this.workerId){di.logD("["+this.id+"] load font in worker "+this.workerId);const t=bi.fonts,e=Object.keys(t);for(let i of e){const e=t[i],s=yield ui.read(e);s&&(yield d(this,Be,"m",Ye).call(this,i,s));}}}))},Ye=function(t,e){return h(this,void 0,void 0,(function*(){return this._addTask(this._createTask("AddSystemFont",[t,e]))}))},Je=function(t,e){return h(this,void 0,void 0,(function*(){yield d(this,Be,"m",Xe).call(this),e=null!=e?e:"";let i,s=this,n=s._createTask("LoadPdf");if(t!==d(s,je,"f")||e!==d(s,$e,"f")){const n=yield s._readFile(t);t instanceof Blob?c(s,je,t,"f"):c(s,je,new Blob([n]),"f"),i=n,c(s,$e,e,"f");}else e=d(s,$e,"f");return i||(i=yield s._readFile(d(s,je,"f"))),n.params.input=[i,e],n.handleResult=function(e,i){if(e.srcBuffer){let i=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=i&&"[object Uint8ClampedArray]"!=i&&delete e.srcBuffer;}let n=wi.decode(e.infoBase64);try{let t;try{n.replace(new RegExp("\\\\","gi"),"\\\\"),t=JSON.parse(n);}catch(e){t=n;}let i={PdfCount:e.pageCount,PdfInfo:t,isTextBased:e.isTextBased};return e.srcBuffer&&(i.srcBuffer=e.srcBuffer,delete e.srcBuffer),c(s,Ve,!0,"f"),c(s,ze,i,"f"),i}catch(e){i.reject({code:y.wasmJsInvalidJson,message:e.message,stack:e.stack});}},s._addTask(n)}))},qe=function(){return h(this,void 0,void 0,(function*(){if(c(this,je,null,"f"),c(this,$e,"","f"),d(this,Ve,"f"))return c(this,Ve,!1,"f"),this._addTask(this._createTask("UnloadDocument",null,this._handleBooleanResult))}))},Ue={value:Object.create(null)};const Ci=["readPdfPage","readTiffPage","readImage"];class Si{constructor(t){this.items=[],t&&(this.items=t);}push(t){this.items.push(t);}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}add(t){let e;-1!==Ci.indexOf(t.api)&&this.push(t);for(let i of this.items)i.api===t.api&&i.params[0]===t.params[0]&&i.params[1]===t.params[1]&&(e=i);e?(e.resolves=[...e.resolves,...t.resolves],e.rejects=[...e.rejects,...t.rejects]):this.push(t);}remove(t){-1!==Ci.indexOf(t.api)&&this.items.forEach(((e,i)=>{e.api===t.api&&e.params[0]===t.params[0]&&e.params[1]===t.params[1]&&this.items.splice(i,1).forEach((t=>{null==t||t.resolves.forEach((t=>{t(null);}));}));}));}}class Pi{static unload(){if(c(this,Qe,[],"f",Ke),c(this,Qe,new Si,"f",ti),c(this,Qe,!1,"f",si),bi.removeFont(),d(this,Qe,"f",ei)){di.logD("pdfReader destroy");const t=d(this,Qe,"f",ei);c(this,Qe,null,"f",ei),t.terminate();}if(d(this,Qe,"f",ii)){di.logD("imageReader destroy");const t=d(this,Qe,"f",ii);c(this,Qe,null,"f",ii),t.terminate();}}static updateLicense(t,e,i){return h(this,void 0,void 0,(function*(){let s=[];return d(this,Qe,"f",ei)&&s.push(d(this,Qe,"f",ei).updateLicense(t,e,i)),d(this,Qe,"f",ii)&&s.push(d(this,Qe,"f",ii).updateLicense(t,e,i)),Promise.all(s)}))}static add(t){return h(this,void 0,void 0,(function*(){d(this,Qe,"f",Ke).push(t),d(this,Qe,"f",ei)||(c(this,Qe,new bi,"f",ei),d(this,Qe,"f",ei).setExternalWorkerChanged(d(Pi,Qe,"m",ri),this),this.initPdfReaderFunctionMap()),d(this,Qe,"f",ii)||(c(this,Qe,new xi,"f",ii),d(this,Qe,"f",ii).setExternalWorkerChanged(d(Pi,Qe,"m",ri),this),this.initImageReaderFunctionMap());}))}static addFont(t,e){return h(this,void 0,void 0,(function*(){bi.addPdfFont(t,e);}))}static getFonts(){return bi.getPdfFonts()}static delete(t){const e=d(this,Qe,"f",Ke).indexOf(t);if(e>=0&&(d(this,Qe,"f",Ke).splice(e,1),0===d(this,Qe,"f",Ke).length&&!d(this,Qe,"f",si))){if(d(this,Qe,"f",ei)){di.logD("pdfReader destroy");const t=d(this,Qe,"f",ei);c(this,Qe,null,"f",ei),t.terminate();}if(d(this,Qe,"f",ii)){di.logD("imageReader destroy");const t=d(this,Qe,"f",ii);c(this,Qe,null,"f",ii),t.terminate();}}}static createTask(t,e){const i={api:t,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const t of e)i.params.push(t);const s=new Promise((function(t,e){i.resolves.push(t),i.rejects.push(e);}));return i.promise.push(s),d(this,Qe,"m",ai).call(this,i),s}static cancelTask(t,e){if(-1!==Ci.indexOf(t)){const i={api:t,params:[],promise:[],resolves:[],rejects:[],retry:0};for(const t of e)i.params.push(t);d(this,Qe,"f",ti).remove(i);}}static initPdfReaderFunctionMap(){var t,e,i,s,n,o;d(this,Qe,"f",ni).findPdfText=null===(t=d(this,Qe,"f",ei))||void 0===t?void 0:t.findText,d(this,Qe,"f",ni).getPdfPageInfos=null===(e=d(this,Qe,"f",ei))||void 0===e?void 0:e.getPageInfos,d(this,Qe,"f",ni).getPdfInfo=null===(i=d(this,Qe,"f",ei))||void 0===i?void 0:i.getPdfInfo,d(this,Qe,"f",ni).readPdfPageAnnot=null===(s=d(this,Qe,"f",ei))||void 0===s?void 0:s.readPageAnnot,d(this,Qe,"f",ni).readPdfPage=null===(n=d(this,Qe,"f",ei))||void 0===n?void 0:n.readPageEx,d(this,Qe,"f",ni).readPdfPageImageInfos=null===(o=d(this,Qe,"f",ei))||void 0===o?void 0:o.readPageImageInfos;}static initImageReaderFunctionMap(){var t,e,i,s,n,o;d(this,Qe,"f",oi).readImage=null===(t=d(this,Qe,"f",ii))||void 0===t?void 0:t.readImage,d(this,Qe,"f",oi).getImageFormat=null===(e=d(this,Qe,"f",ii))||void 0===e?void 0:e.getImageFormat,d(this,Qe,"f",oi).readImageInfo=null===(i=d(this,Qe,"f",ii))||void 0===i?void 0:i.readImageInfo,d(this,Qe,"f",oi).getTiffInfo=null===(s=d(this,Qe,"f",ii))||void 0===s?void 0:s.getTiffInfo,d(this,Qe,"f",oi).readTiffPage=null===(n=d(this,Qe,"f",ii))||void 0===n?void 0:n.readTiffPage,d(this,Qe,"f",oi).getTiffPageInfos=null===(o=d(this,Qe,"f",ii))||void 0===o?void 0:o.getTiffPageInfos;}}Qe=Pi,ri=function(t,e,i){let s=null!=t?t:this;d(s,Qe,"f",ei)&&d(s,Qe,"f",ei)!==e&&d(s,Qe,"f",ei).workerChanged(i),d(s,Qe,"f",ii)&&d(s,Qe,"f",ii)!==e&&d(s,Qe,"f",ii).workerChanged(i);},ai=function(t){d(this,Qe,"f",ti).add(t),d(this,Qe,"f",si)||(c(this,Qe,!0,"f",si),d(this,Qe,"m",hi).call(this));},li=function(){try{d(this,Qe,"f",ii)&&d(this,Qe,"f",ii).makeSureWorkerMemoryNotExceed(),d(this,Qe,"f",ei)&&d(this,Qe,"f",ei).makeSureWorkerMemoryNotExceed();}catch(t){}},hi=function(){return h(this,void 0,void 0,(function*(){do{if(d(this,Qe,"f",ti).isEmpty()||!d(this,Qe,"f",ei)||!d(this,Qe,"f",ii))break;const t=d(this,Qe,"f",ti).pop();if(t)try{let e,i=d(this,Qe,"f",ni)[t.api];i?(e=yield d(this,Qe,"f",ni)[t.api].apply(d(this,Qe,"f",ei),t.params),d(this,Qe,"f",ei).makeSureWorkerMemoryNotExceed()):(i=d(this,Qe,"f",oi)[t.api],i&&(e=yield d(this,Qe,"f",oi)[t.api].apply(d(this,Qe,"f",ii),t.params),d(this,Qe,"f",ii).makeSureWorkerMemoryNotExceed())),null==t||t.resolves.forEach((t=>{t(e);}));}catch(e){di.logD(e),t.retry<1?(t.retry+=1,d(this,Qe,"m",li).call(this),d(this,Qe,"f",ti).push(t)):null==t||t.rejects.forEach((t=>{t(e);}));}}while(!d(this,Qe,"f",ti).isEmpty());c(this,Qe,!1,"f",si);}))},Ke={value:[]},ti={value:new Si},ei={value:void 0},ii={value:void 0},si={value:!1},ni={value:Object.create(null)},oi={value:Object.create(null)};class Ai{constructor(){Pi.add(this);}destroy(){Pi.delete(this);}readImage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){return Pi.createTask("readImage",[t,e,i,s,n])}))}getImageFormat(t){return h(this,void 0,void 0,(function*(){return Pi.createTask("getImageFormat",[t])}))}readImageInfo(t){return h(this,void 0,void 0,(function*(){return Pi.createTask("readImageInfo",[t])}))}cancelReadImage(t,e){return Pi.cancelTask("readImage",[t,e])}getTiffInfo(t){return h(this,void 0,void 0,(function*(){return Pi.createTask("getTiffInfo",[t,!1])}))}readTiffPage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){return Pi.createTask("readTiffPage",[t,e,i,s,n])}))}cancelReadTiffPage(t,e){return Pi.cancelTask("readTiffPage",[t,e])}getTiffPageInfos(t,e){return h(this,void 0,void 0,(function*(){return Pi.createTask("getTiffPageInfos",[t,e])}))}}var Ti,ki,Di,Ei,Ii,Ri,Mi,Bi,Li,Ui,Oi,_i,Ni,Wi,Fi,Hi,Vi,zi,ji,$i;!function(t){t[t.NearestNeighbour=1]="NearestNeighbour",t[t.Bilinear=2]="Bilinear",t[t.Bicublic=3]="Bicublic",t[t.BestQuality=5]="BestQuality";}(Di||(Di={}));class Gi extends yi{constructor(t){super(ci.ImageProcModule,t),Ti.add(this);}initImage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){e=null!=e&&e,i=null!=i?i:0,s=null!=s?s:0,n=null!=n&&n;let o=this,r=o._createTask("InitImageObject");if(r.params.input=[t,i,s],e||n)e?r.params.input.push(v.IT_RGBA):r.params.input.push(v.IT_BGRA),o._addTask(r);else {const e=yield o._readFile(t);r.params.input[0]=e,r.params.input.push(v.IT_ALL),o._addTask(r);}const a=yield r.promise;if(a.srcBuffer){let e=Object.prototype.toString.call(t);"[object ArrayBuffer]"!=e&&"[object Uint8ClampedArray]"!=e&&delete a.srcBuffer;}return a}))}restore(){return this._addTask(this._createTask("BackToOriginal",null,this._handleBooleanResult))}filter(t,e,i){var s,n,o,r,a,l,h,c,u,p;let g=this;e=null!=e?e:{},i=null!=i?i:{};let f=g._createTask("Filter");if(f.params.input=[],f.params.input.push(t),"toBW"===t)f.params.input.push(JSON.stringify(d(g,Ti,"m",ki).call(g,e)));else if("toGray"===t)f.params.input.push(JSON.stringify(d(g,Ti,"m",ki).call(g,e)));else if("removeShadow"===t)f.params.input.push(JSON.stringify(d(g,Ti,"m",ki).call(g,e)));else if("enhance"===t)f.params.input.push(JSON.stringify(d(g,Ti,"m",ki).call(g,e)));else if("invert"===t)f.params.input.push(JSON.stringify(d(g,Ti,"m",ki).call(g,e)));else if("brightnessAndContrast"===t){let t=null!==(s=e.brightness)&&void 0!==s?s:0,i=null!==(n=e.contrast)&&void 0!==n?n:0;f.params.input.push(t),f.params.input.push(i);}let m=null!==(o=i.returnType)&&void 0!==o?o:v.IT_JPG,y=null!==(r=i.jpegQuality)&&void 0!==r?r:this._jpegQuality,x=null!==(a=i.bRGBA)&&void 0!==a&&a,w=null!==(l=i.bitDepth)&&void 0!==l?l:0,b=null!==(h=i.xdpi)&&void 0!==h?h:0,C=null!==(c=i.ydpi)&&void 0!==c?c:0,S=null===(u=i.returnBlob)||void 0===u||u;m=x&&null==m?v.IT_JPG:null!=m?m:v.IT_ALL;let P=null!==(p=i.is1BitTo8Bit)&&void 0!==p&&p;return f.params.input.push([m,w,b,C,!1,y,!1,P]),f.params.returnBlob=S,f.handleResult=this._handleImageData,g._addTask(f),f.promise}rotate(t,e,i,s){return t=null!=t?t:0,i=null!=i&&i,s=null!=s?s:Di.Bicublic,e=null!=e?e:"FFFFFF",(t<0||t>360)&&(t%=360)<0&&(t+=360),this._addTask(this._createTask("RotateEx",[t,i,s,e],this._handleBooleanResult))}flip(t){t=null!=t?t:1;let e=this._createTask("");return e.handleResult=this._handleBooleanResult,1===t?e.func="Flip":-1===t&&(e.func="Mirror"),this._addTask(e),e.promise}erase(t,e,i,s,n){let o=this,r=o._createTask("Erase");return r.handleResult=this._handleBooleanResult,r.params.input=[t,e,i,s,JSON.stringify(d(o,Ti,"m",ki).call(o,n))],o._addTask(r),r.promise}crop(t,e,i,s){return this._addTask(this._createTask("Crop",[t,e,i,s],this._handleBooleanResult))}resize(t,e,i){return i=null!=i?i:Di.BestQuality,this._addTask(this._createTask("ChangeImageSize",[t,e,i],this._handleBooleanResult))}toGrayscaleLevel(t){(t=null!=t?t:1)<1&&(t=1),t>3&&(t=3);let e={};return 2===t?(e.clean=!0,e.sigma=3,e.scaleLimit=720,e.alpha=1.05):3===t&&(e.clean=!0,e.sigma=5,e.scaleLimit=1080,e.alpha=1.05),this.toGrayscale(e)}toGrayscale(t){return this._addTask(this._createTask("ConvertToGrayScale",JSON.stringify(d(this,Ti,"m",ki).call(this,t)),this._handleBooleanResult))}toBinaryLevel(t,e){(e=null!=e?e:1)<1&&(e=1),e>3&&(e=3);let i={};return null!=t&&(t?i.method="adaptiveThreshold":(i.method="threshold",2===e?(i.clean=!0,i.sigma=3,i.scaleLimit=720,i.alpha=1.05):3===e&&(i.clean=!0,i.sigma=5,i.scaleLimit=1080,i.alpha=1.05))),this.toBinary(i)}toBinary(t){return this._addTask(this._createTask("ConvertToBW",JSON.stringify(d(this,Ti,"m",ki).call(this,t)),this._handleBooleanResult))}invert(){return this._addTask(this._createTask("Invert",null,this._handleBooleanResult))}setImageWidth(t,e){return this._addTask(this._createTask("SetImageWidth",[t,JSON.stringify(d(this,Ti,"m",ki).call(this,e))],this._handleBooleanResult))}setImageHeight(t,e){return this._addTask(this._createTask("SetImageHeight",[t,JSON.stringify(d(this,Ti,"m",ki).call(this,e))],this._handleBooleanResult))}setDPI(t,e,i,s,n,o){return n=null!=n&&n,o=null!=o?o:Di.Bilinear,this._addTask(this._createTask("SetDPI",[t,e,i,s,n,o],this._handleBooleanResult))}getImage(t,e,i,s,n,o,r,a,l){t=null!=t?t:this._jpegQuality,e=null==e||e,s=null!=s?s:0,n=null!=n?n:0,o=null!=o?o:0,r=null==r||r,a=(i=null!=i&&i)&&null==a?v.IT_JPG:null!=a?a:v.IT_ALL,l=null!=l&&l;let h=this._createTask("GetCurrentImage");return h.params.input=[a,s,n,o,!1,t,e,l],h.params.returnBlob=r,h.handleResult=this._handleImageData,this._addTask(h)}getSkewAngle(t){return this._addTask(this._createTask("GetSkewAngle",[JSON.stringify(d(this,Ti,"m",ki).call(this,t))],(function(t,e){return t.skewAngle})))}freeReservedData(){return this._addTask(this._createTask("FreeReservedData",null,this._handleBooleanResult))}detectDocument(t,e,i,s,n){return t=null!=t?t:Di.Bilinear,e=null!=e?e:75,i=null!=i?i:100,s=null!=s?s:0,n=null!=n?n:"",this._addTask(this._createTask("DocumentDetect",[t,e/100,i,s/255,n,"1"]))}perspective(t,e,i,s,n,o,r,a){return this._addTask(this._createTask("Perspective",[t,e,i,s,n,o,r,a],this._handleBooleanResult))}changeBrightness(t,e){return t=null!=t?t:0,0!=(e=null!=e?e:1)&&1!=e&&(e=0),1===e?this._addTask(this._createTask("ChangeBrightnessAndContrast",[t,0],this._handleBooleanResult)):this._addTask(this._createTask("ChangeBrightness",[Math.floor(t/1e3*255)],this._handleBooleanResult))}changeContrast(t,e){return t=null!=t?t:0,0!=(e=null!=e?e:1)&&1!=e&&(e=0),1===e?this._addTask(this._createTask("ChangeBrightnessAndContrast",[0,t],this._handleBooleanResult)):this._addTask(this._createTask("ChangeContrast",[1+t/1e3],this._handleBooleanResult))}changeBrightnessAndContrast(t,e){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("ChangeBrightnessAndContrast",[t,e],this._handleBooleanResult))}removeShadowLevel(t,e){e=null!=e?e:1.05,(t=null!=t?t:1)<1&&(t=1),t>3&&(t=3);let i={};return 1===t&&(i.sigma=3,i.scaleLimit=720,i.alpha=e),2===t?(i.sigma=5,i.scaleLimit=1080,i.alpha=e):3===t&&(i.sigma=10,i.scaleLimit=0,i.alpha=e),this.removeShadow(i)}removeShadow(t){return this._addTask(this._createTask("ShadowRemovel",[JSON.stringify(d(this,Ti,"m",ki).call(this,t))],this._handleBooleanResult))}enhanceAndSharpenImage(){return this._addTask(this._createTask("EnhanceAndSharpen",[""],this._handleBooleanResult))}brighten(){return this._addTask(this._createTask("Brighten",[""],this._handleBooleanResult))}getBlurryScore(){return this._addTask(this._createTask("GetBlurScore",[""],(function(t,e){return t.blurryScore})))}drawQuadrangle(t,e,i,s,n,o,r,a,l){return this._addTask(this._createTask("DrawQuadrangle",[t,e,i,s,n,o,r,a,JSON.stringify(d(this,Ti,"m",ki).call(this,l))],this._handleBooleanResult))}getImageInfo(){return this._addTask(this._createTask("GetImageInfo",[]))}}Ti=new WeakSet,ki=function(t){let e={};if(null!=t&&"object"==typeof t)for(let i in t)e[i]=t[i];return e};class Xi{constructor(){Pi.add(this);}destroy(){Pi.delete(this);}static addPdfFont(t,e){return h(this,void 0,void 0,(function*(){return Pi.addFont(t,e)}))}static getPdfFonts(){return Pi.getFonts()}getPdfInfo(t){return h(this,void 0,void 0,(function*(){return Pi.createTask("getPdfInfo",[t])}))}readPage(t,e,i,s,n,o,r,a){return h(this,void 0,void 0,(function*(){return this.readPageEx(t,e,{convertMode:s,renderOptions:{resolution:i}},n,o,r,a)}))}readPageEx(t,e,i,s,n,o,r){return h(this,void 0,void 0,(function*(){return Pi.createTask("readPdfPage",[t,e,i,s,n,o,r])}))}cancelReadPage(t,e){return Pi.cancelTask("readPdfPage",[t,e])}readPageImageInfos(t,e,i,s,n,o,r){return h(this,void 0,void 0,(function*(){return Pi.createTask("readPdfPageImageInfos",[t,e,i,s,n,o,r])}))}readPageAnnot(t,e){return h(this,void 0,void 0,(function*(){return Pi.createTask("readPdfPageAnnot",[t,e])}))}findText(t,e,i,s){return h(this,void 0,void 0,(function*(){return Pi.createTask("findPdfText",[t,e,i,s])}))}getPageInfos(t,e){return h(this,void 0,void 0,(function*(){return Pi.createTask("getPdfPageInfos",[t,e])}))}}!function(t){t[t.auto=0]="auto",t[t.store=1]="store";}(Bi||(Bi={}));class Yi extends yi{constructor(t){super(ci.PdfWriterModule,t),Ei.add(this);}initPdfSetting(t){return h(this,void 0,void 0,(function*(){let e=this,i=e._createTask("CreateDocument");return i.params.input=[JSON.stringify(d(e,Ei,"m",Mi).call(e,t))],i.handleResult=this._handleBooleanResult,e._addTask(i)}))}appendPage(t,e){return h(this,void 0,void 0,(function*(){let i=this,s=i._createTask("InsertImagePage");e=null!=e&&e;const n=yield i._readFile(t);return s.params.input=[n,-1,e],s.handleResult=i._handleBooleanResult,i._addTask(s),s.promise}))}insertPage(t,e,i){return h(this,void 0,void 0,(function*(){let s=this,n=s._createTask("InsertImagePage");i=null!=i&&i;const o=yield s._readFile(t);return n.params.input=[o,e,i],n.handleResult=s._handleBooleanResult,s._addTask(n),n.promise}))}writePdf(t){return h(this,void 0,void 0,(function*(){let e=this._createTask("GetCurrentPdf");return e.params.returnType=null!=t?t:x.RT_AUTO,e.params.returnBlob=t!=x.RT_AUTO,e.handleResult=this._handleImageData,this._addTask(e)}))}insertBlankPage(t,e,i){return h(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:595,i=null!=i?i:842,this._addTask(this._createTask("InsertBlankPage",[t,e,i]))}))}deletePage(t){return h(this,void 0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("DeletePdfPage",[t],this._handleBooleanResult))}))}pageSetRotation(t,e){return h(this,void 0,void 0,(function*(){t=null!=t?t:0,0!=(e=((e=null!=e?e:0)%360+360)%360)&&90!==e&&180!==e&&270!==e&&(e=0);let i=this._createTask("SetPageRotation");return i.params.input=[t,e],i.handleResult=this._handleBooleanResult,this._addTask(i)}))}pageSetCropBox(t,e,i,s,n){return h(this,void 0,void 0,(function*(){t=null!=t?t:0,e=null!=e?e:0,i=null!=i?i:0,(s=null!=s?s:e)<e&&(s=e),(n=null!=n?n:i)<i&&(n=i);let o=this._createTask("SetPageCropBox");return o.params.input=[t,e,i,s,n],o.handleResult=this._handleBooleanResult,this._addTask(o)}))}pageSetMediaBox(t,e,i,s,n){return h(this,void 0,void 0,(function*(){t=null!=t?t:0,e=null!=e?e:0,i=null!=i?i:0,(s=null!=s?s:e)<e&&(s=e),(n=null!=n?n:i)<i&&(n=i);let o=this._createTask("SetPageMediaBox");return o.params.input=[t,e,i,s,n],o.handleResult=this._handleBooleanResult,this._addTask(o)}))}pageAddImage(t,e,i,s,n){return h(this,void 0,void 0,(function*(){let o=this,r=o._createTask("PageAddImage"),a=JSON.stringify(d(o,Ei,"m",Mi).call(o,i));const l=yield o._readFile(t);return r.params.input=[l,e,a,s,n],r.handleResult=o._handleBooleanResult,o._addTask(r),r.promise}))}pageAddText(t,e){return h(this,void 0,void 0,(function*(){yield d(this,Ei,"m",Ii).call(this);let i=JSON.stringify(e);return this._addTask(this._createTask("PageAddText",[t,i],this._handleBooleanResult))}))}pageAddPath(t,e){return h(this,void 0,void 0,(function*(){let i=JSON.stringify(e);return this._addTask(this._createTask("PageAddPath",[t,i],this._handleBooleanResult))}))}pageClearObjects(t){return h(this,void 0,void 0,(function*(){return t=null!=t?t:0,this._addTask(this._createTask("PageClearObjects",[t],this._handleBooleanResult))}))}pageSetAnnot(t,e){return h(this,void 0,void 0,(function*(){let i;return t=null!=t?t:0,Array.isArray(e)?(i="[",e.forEach(((t,e)=>{e>0&&(i+=","),i+=JSON.stringify(t);})),i+="]"):i=JSON.stringify(e),yield d(this,Ei,"m",Ii).call(this),this._addTask(this._createTask("SetPageAnnot",[t,i],this._handleBooleanResult))}))}getFontFromTextObject(t){return t.fontName?t.fontName:""}getFontFromAnnot(t){let e=[];t&&t.normalAppearance&&t.normalAppearance.objs&&t.normalAppearance.objs.forEach((t=>{if("text"===t.type){const i=t,s=this.getFontFromTextObject(i);s&&e.push(s);}}));const i=new Set(e);return e=[...i],e}getFontFromAnnots(t){let e=[];Array.isArray(t)?t.forEach((t=>{const i=this.getFontFromAnnot(t);e=e.concat(i);})):e=this.getFontFromAnnot(t);const i=new Set(e);return e=[...i],e}pageAddAnnot(t,e){return h(this,void 0,void 0,(function*(){let i;return t=null!=t?t:0,Array.isArray(e)?(i="[",e.forEach(((t,e)=>{e>0&&(i+=","),i+=JSON.stringify(t);})),i+="]"):i=JSON.stringify(e),yield d(this,Ei,"m",Ii).call(this),this._addTask(this._createTask("PageAddAnnot",[t,i],this._handleBooleanResult))}))}pageDeleteAnnot(t,e){return h(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("DeletePageAnnot",[t,e],this._handleBooleanResult))}))}pageDeleteAnnotByTypes(t,e){return h(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:"",this._addTask(this._createTask("DeletePageAnnotByTypes",[t,e],this._handleBooleanResult))}))}pageDeleteAnnotByNames(t,e){return h(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:"",this._addTask(this._createTask("DeletePageAnnotByNames",[t,e],this._handleBooleanResult))}))}mergePdf(t,e,i,s,n){return h(this,void 0,void 0,(function*(){s=null!=s?s:-1,i=null!=i?i:[],e=null!=e?e:"",n=null!=n&&n;let o=this,r=o._createTask("MergePdfPages");const a=yield o._readFile(t);return r.params.input=[a,s,e,i,n],r.handleResult=o._handleBooleanResult,o._addTask(r),r.promise}))}pageFlatten(t,e){return h(this,void 0,void 0,(function*(){return t=null!=t?t:0,e=null!=e?e:0,this._addTask(this._createTask("PageFlatten",[t,e],this._handleBooleanResult))}))}GetFontInfo(t){return h(this,void 0,void 0,(function*(){const e=yield this._readFile(t);return this._addTask(this._createTask("GetFontInfo",[e]))}))}IfFontsExist(t){return h(this,void 0,void 0,(function*(){let e=JSON.stringify(t);return yield d(this,Ei,"m",Ii).call(this),this._addTask(this._createTask("IfFontsExist",[e]))}))}}Ei=new WeakSet,Ii=function(){return h(this,void 0,void 0,(function*(){di.logD("["+this.id+"] load font in worker "+this.workerId);const t=bi.fonts,e=Object.keys(bi.fonts);for(let i of e){const e=t[i],s=yield ui.read(e);s&&(yield d(this,Ei,"m",Ri).call(this,i,s));}}))},Ri=function(t,e){return h(this,void 0,void 0,(function*(){return this._addTask(this._createTask("LoadFont",[e,t]))}))},Mi=function(t){let e={};if(null!=t&&"object"==typeof t)for(let i in t)e[i]=t[i];return e},function(t){t.Text="Text",t.Link="Link",t.FreeText="FreeText",t.Line="Line",t.Square="Square",t.Circle="Circle",t.Polygon="Polygon",t.PolyLine="PolyLine",t.Hignlight="Highlight",t.Underline="Underline",t.Squiggly="Squiggly",t.StrikeOut="StrikeOut",t.Stamp="Stamp",t.Caret="Caret",t.Ink="Ink",t.Popup="Popup";}(Li||(Li={})),function(t){t.None="none",t.Invisible="invisible",t.Hidden="hidden",t.Print="print",t.NoZoom="nozoom",t.NoRotate="norotate",t.NoView="noview",t.ReadOnly="readonly",t.Locked="locked",t.ToggleNoView="togglenoview",t.LockedContents="lockedcontents";}(Ui||(Ui={})),function(t){t.Solid="S",t.Dashed="D",t.Beveled="B",t.Insert="I",t.Underline="U";}(Oi||(Oi={})),function(t){t.NoEffect="S",t.Cloudy="C";}(_i||(_i={})),function(t){t.Comment="Comment",t.Key="Key",t.Note="Note",t.Help="Help",t.NewParagraph="NewParagraph",t.Paragraph="Paragraph",t.Insert="Insert";}(Ni||(Ni={})),function(t){t.Marked="Marked",t.Review="Review";}(Wi||(Wi={})),function(t){t.Accepted="Accepted",t.Rejected="Rejected",t.Cancelled="Cancelled",t.Completed="Completed",t.None="None";}(Fi||(Fi={})),function(t){t.None="None",t.Square="Square",t.Circle="Circle",t.Diamond="Diamond",t.OpenArrow="OpenArrow",t.ClosedArrow="ClosedArrow",t.Butt="Butt",t.ROpenArrow="ROpenArrow",t.RClosedArrow="RClosedArrow",t.Slash="Slash";}(Hi||(Hi={})),function(t){t[t.LeftJustified=0]="LeftJustified",t[t.Centered=1]="Centered",t[t.RightJustified=2]="RightJustified";}(Vi||(Vi={})),function(t){t.FreeText="FreeText",t.FreeTextCallout="FreeTextCallout",t.FreeTextTypeWriter="FreeTextTypeWriter";}(zi||(zi={})),function(t){t.LineArrow="LineArrow",t.LineDimension="LineDimension";}(ji||(ji={})),function(t){t.Approved="Approved",t.Experimental="Experimental",t.NotApproved="NotApproved",t.Asls="Asls",t.Expired="Expired",t.NotForPublicRelease="NotForPublicRelease",t.Confidential="Confidential",t.Final="Final",t.Sold="Sold",t.Departmental="Departmental",t.ForComment="ForComment",t.TopSecret="TopSecret",t.Draft="Draft",t.ForPublicRelease="ForPublicRelease";}($i||($i={}));const Ji="undefined"==typeof self,qi=Ji?{}:self;let Zi,Qi,Ki,ts,es;"undefined"!=typeof navigator&&(Zi=navigator,Qi=Zi.userAgent,Ki=Zi.platform,ts=Zi.mediaDevices),function(){if(!Ji){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Zi.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Ki,search:"Win"},Mac:{str:Ki},Linux:{str:Ki}};let i="unknownBrowser",s=0,n="unknownOS";for(let e in t){const n=t[e]||{};let o=n.str||Qi,r=n.search||e,a=n.verStr||Qi,l=n.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){s=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let s=i.str||Qi,o=i.search||t;if(-1!=s.indexOf(o)){n=t;break}}"Linux"==n&&-1!=Qi.indexOf("Windows NT")&&(n="HarmonyOS"),es={browser:i,version:s,OS:n};}Ji&&(es={browser:"ssr",version:0,OS:"ssr"});}(),ts&&ts.getUserMedia;const is="Chrome"===es.browser&&es.version>66||"Safari"===es.browser&&es.version>13||"OPR"===es.browser&&es.version>43||"Edge"===es.browser&&es.version>15,ss="\\s*([+-]?\\d+)\\s*",ns="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",os="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",rs=/^#([0-9a-f]{3,8})$/,as=new RegExp(`^rgb\\(${ss},${ss},${ss}\\)$`),ls=new RegExp(`^rgb\\(${os},${os},${os}\\)$`),hs=new RegExp(`^rgba\\(${ss},${ss},${ss},${ns}\\)$`),ds=new RegExp(`^rgba\\(${os},${os},${os},${ns}\\)$`),cs=new RegExp(`^hsl\\(${ns},${os},${os}\\)$`),us=new RegExp(`^hsla\\(${ns},${os},${os},${ns}\\)$`),ps={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};let gs=class{constructor(t,e,i,s){l(this,"r",void 0),l(this,"g",void 0),l(this,"b",void 0),l(this,"opacity",void 0),this.r=t,this.g=e,this.b=i,this.opacity=s;}};function fs(t){return new gs(t>>16&255,t>>8&255,255&t,1)}function ms(t,e,i,s){return s<=0&&(t=NaN,e=NaN,i=NaN),new gs(t,e,i,s)}function ys(t,e,i,s){return s<=0?(t=NaN,e=NaN,i=NaN):i<=0||i>=1?(t=NaN,e=NaN):e<=0&&(t=NaN),{h:t,s:e,l:i,opacity:s}}function vs(t,e,i){return t<60?(e+(i-e)*t)/60*255:t<180?255*i:t<240?(e+(i-e)*(240-t))/60*255:255*e}function xs(t){const e=t.h<0?t.h%360+360:t.h%360,i=Number.isNaN(e)||Number.isNaN(t.s)?0:t.s,{l:s}=t,n=s+(s<.5?s:1-s)*i,o=2*s-n;return new gs(vs(e>=240?e-240:e+120,o,n),vs(e,o,n),vs(e<120?e+240:e-120,o,n),t.opacity)}const ws=t=>{let e,i;if(t=`${t}`.trim().toLowerCase(),rs.exec(t))switch(e=rs.exec(t),i=e[1].length,e=parseInt(e[1],16),i){case 6:return fs(e);case 3:return new gs(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1);case 8:return ms(e>>24&255,e>>16&255,e>>8&255,(255&e)/255);case 4:return ms(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255);default:return null}return as.exec(t)?(e=as.exec(t),new gs(e[1],e[2],e[3],1)):ls.exec(t)?(e=ls.exec(t),new gs(255*e[1]/100,255*e[2]/100,255*e[3]/100,1)):hs.exec(t)?(e=hs.exec(t),ms(e[1],e[2],e[3],e[4])):ds.exec(t)?(e=ds.exec(t),ms(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4])):cs.exec(t)?(e=cs.exec(t),xs(ys(e[1],e[2]/100,e[3]/100,1))):us.exec(t)?(e=us.exec(t),xs(ys(e[1],e[2]/100,e[3]/100,e[4]))):ps.hasOwnProperty(t)?fs(ps[t]):"transparent"===t?new gs(NaN,NaN,NaN,0):null},bs=t=>t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`)),Cs=t=>Object.prototype.toString.call(t),Ss=t=>Array.isArray?Array.isArray(t):"[object Array]"===Cs(t),Ps=t=>null!==t&&"[object Object]"===Cs(t),As=t=>{let e=null;return Ss(t)&&(e||(e=[]),t.forEach((t=>{e.push(As(t));}))),Ps(t)&&(e||(e={}),Object.keys(t).forEach((i=>{e[i]=As(t[i]);}))),e||t},Ts=t=>void 0===t,ks=(t,e)=>{var i;t=null!==(i=t)&&void 0!==i?i:"yyyy-MM-dd hh:mm:ss";const s=Ts(e)?new Date:new Date(e),n={"M+":(s.getMonth()+1).toString(),"d+":s.getDate().toString(),"h+":s.getHours().toString(),"m+":s.getMinutes().toString(),"s+":s.getSeconds().toString(),"q+":Math.floor((s.getMonth()+3)/3).toString(),S:s.getMilliseconds().toString()};return /(y+)/.test(t)&&(t=t.replace(RegExp.$1,`${s.getFullYear()}`.substring(4-RegExp.$1.length))),Object.keys(n).forEach((e=>{new RegExp(`(${e})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[e]:`00${n[e]}`.substring(`${n[e]}`.length)));})),t},Ds=t=>"[object ArrayBuffer]"===Cs(t),Es=t=>"[object Blob]"===Cs(t),Is=t=>"[object Boolean]"===Cs(t),Rs=t=>"function"==typeof t,Ms=()=>"ontouchstart"in document.documentElement,Bs=t=>"number"==typeof t&&!Number.isNaN(t),Ls=t=>"string"==typeof t,Us=(t,e,i)=>Math.min(Math.max(t,e),i);let Os=0;const _s=()=>(Os+=1,`${(new Date).getTime().toString(36)}${Os.toString(36)}`),Ns=t=>{const e=window.URL||window.webkitURL;let i="string";return Ls(t)?i="string":Es(t)?(i="blob",t=e.createObjectURL(t)):(Ds(t)||Ss(t))&&(i="blob",t=e.createObjectURL(new Blob([t]))),{type:i,data:t}};function Ws(t){return "object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName}let Fs=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";l(this,"prefix",void 0),l(this,"postfix",void 0),l(this,"isDestroyed",!1),l(this,"uid",_s()),l(this,"cacheEvents",void 0),l(this,"events",void 0),l(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=t,this.postfix=e;}static create(e,i){return new t(e,i)}save(){this.isCached=!0;}restore(){this.isCached=!1,this.cacheEvents.forEach((t=>{let{eventName:e,param:i}=t;this.emit(e,...i);})),this.cacheEvents.length=0;}destroy(){if(!this.isDestroyed){for(const t in this.events)if(Object.prototype.hasOwnProperty.call(this.events,t)){const e=this.events[t];e&&e.slice().forEach((t=>{let{name:e,fn:i,context:s,once:n}=t;this.off(e,i,s,n);}));}this.events={},this.isDestroyed=!0;}}on(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{events:n}=this,o={name:t=this.format(t),uid:_s(),context:i,once:s,fn:e};return n[t]||(n[t]=[]),n[t].indexOf(o)<0&&n[t].push(o),o}once(t,e,i){return this.on(t,e,i,!0)}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];if(this.isCached)return this.cacheEvents.push({eventName:t,param:i}),!0;const{events:n}=this,o=n[t=this.format(t)];return !(!o||!o.length||(o.slice().forEach((t=>{let{fn:e,context:s}=t;e.call(s||null,...i);})),o.slice().forEach((e=>{let{fn:i,context:s,once:n}=e;n&&this.off(t,i,s,n);})),0))}off(t,e,i,s){const{events:n}=this,o=n[t=this.format(t)];if(!o)return !1;if(!arguments.length)return o.length=0,!0;for(let t=o.length-1;t>=0;t--){const n=o[t];e&&n.fn!==e||i&&n.context!==i||s&&n.once!==s||o.splice(t,1);}return !0}removeAllEventListeners(t){if(t){t=this.format(t);const e=this.cacheEvents.findIndex((e=>e.eventName===t));e>-1&&this.cacheEvents.splice(e,1),this.events[t]&&delete this.events[t];}else this.cacheEvents=[],this.events={};}getAllEvents(){return this.events}format(t){return `${this.prefix||""}${t}${this.postfix||""}`}};const Hs="default";let Vs=class t{constructor(){l(this,"emitter",new Fs);}static create(){return new t}on(t){this.emitter.on(Hs,t);}emit(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.emitter.emit(Hs,...e);}off(t){this.emitter.off(Hs,t);}};function zs(){return new Vs}let js=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;l(this,"x",void 0),l(this,"y",void 0),l(this,"z",void 0),this.x=t,this.y=e,this.z=i;}static fromPoint(e){return new t(e.x,e.y,e.z)}static fromTwoPoint(e,i){var s,n,o,r,a,l;return new t((null!==(s=i.x)&&void 0!==s?s:0)-(null!==(n=e.x)&&void 0!==n?n:0),(null!==(o=i.y)&&void 0!==o?o:0)-(null!==(r=e.y)&&void 0!==r?r:0),(null!==(a=i.z)&&void 0!==a?a:0)-(null!==(l=e.z)&&void 0!==l?l:0))}static fromValue(e,i,s){return new t(e,i,s)}setFromVector(t){var e;this.x=t.x,this.y=t.y,this.z=null!==(e=t.z)&&void 0!==e?e:0;}clone(){return new t(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(t){var e;return this.x*t.x+this.y*t.y+this.z*(null!==(e=t.z)&&void 0!==e?e:0)}projectionTo(t){const e=Math.hypot(t.x,t.y,t.z);return this.dot(t)/e}angle(t){const e=this.norm()*Math.hypot(t.x,t.y,t.z),i=e&&this.dot(t)/e;return Math.acos(Us(i,-1,1))}equals(t){var e;return this.x===t.x&&this.y===t.y&&this.z===(null!==(e=t.z)&&void 0!==e?e:0)}distance(t){var e;return Math.hypot(this.x-t.x,this.y-t.y,this.z-(null!==(e=t.z)&&void 0!==e?e:0))}lerp(e){var i;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:n,y:o,z:r}=this;return new t(n+s*(e.x-n),o+s*(e.y-o),r+s*((null!==(i=e.z)&&void 0!==i?i:0)-r))}normalize(){const t=this,e=t.norm();return t.x/=e,t.y/=e,t.z/=e,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(t){const e=this;return {x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x}}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}};function $s(t,e){return js.fromTwoPoint(t,e)}let Gs=class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;l(this,"x",void 0),l(this,"y",void 0),l(this,"z",void 0),this.x=t,this.y=e,this.z=i;}static fromPoint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new t(e.x,e.y,e.z)}matrixTransform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:e,y:i,z:s}=this,{m11:n,m21:o,m31:r,m41:a,m12:l,m22:h,m32:d,m42:c,m13:u,m23:p,m33:g,m43:f,m14:m,m24:y,m34:v,m44:x}=t,w=m*e+y*i+v*s+x;return Xs({x:(n*e+o*i+r*s+a)/w,y:(l*e+h*i+d*s+c)/w,z:(u*e+p*i+g*s+f)/w})}setFromPoint(t){return this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this}clone(){return Xs(this)}equals(t){const{x:e=0,y:i=0,z:s=0}=t,n=this;return n.x===e&&n.y===i&&n.z===s}distanceTo(t){const{x:e=0,y:i=0,z:s=0}=t,n=this;return Math.hypot(n.x-e,n.y-i,n.z-s)}lerpTo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:i=0,y:s=0,z:n=0}=t,o=this;return Xs({x:o.x+e*(i-o.x),y:o.y+e*(s-o.y),z:o.z+e*(n-o.z)})}footPointInSegment(t,e){const i=$s(t,this),s=$s(t,e),n=s.norm(),o=Xs(t);if(0===n)return o;const r=i.projectionTo(s)/n;return o.lerpTo(e,r)}perpendicularToSegment(t,e){const i=this.footPointInSegment(t,e);return this.distanceTo(i)}};function Xs(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Bs(t)?new Gs(t,e,i):new Gs(t.x,t.y,t.z)}let Ys=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;l(this,"x",void 0),l(this,"y",void 0),l(this,"z",void 0),l(this,"w",void 0),this.x=t,this.y=e,this.z=i,this.w=s;}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1;}normalize(){const t=this.norm();this.x/=t,this.y/=t,this.z/=t,this.w/=t;}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}};function Js(t,e){return ((t.x-e.x)**2+(t.y-e.y)**2)**.5}class qs{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;l(this,"x",0),l(this,"y",0),l(this,"left",0),l(this,"top",0),l(this,"right",0),l(this,"bottom",0),l(this,"width",0),l(this,"height",0),this.update(t,e,i,s);}update(t,e,i,s){this.x=t,this.y=e,this.left=t,this.top=e,this.right=t+i,this.bottom=e+s,this.width=i,this.height=s;}toJSON(){}}const Zs=new class{constructor(){l(this,"tasks",[]);}createTimer(t,e){const i=_s();return this.tasks.push({uid:i,callback:t,time:e}),this.executeTimer(i),i}executeTimer(t){const e=this.tasks.find((e=>e.uid===t));if(!e)return;const i=()=>{e.callback(),null!==e.timer&&(e.timer=setTimeout(i,e.time));};e.timer=setTimeout(i,e.time);}clearTimer(t){const e=this.tasks.findIndex((e=>e.uid===t));e>-1&&(clearTimeout(this.tasks[e].timer),this.tasks[e].timer=null,this.tasks.splice(e,1));}};function Qs(t,e,i,s){if(function(t,e,i,s){return Math.min(t[0],e[0])<=Math.max(i[0],s[0])&&Math.min(i[0],s[0])<=Math.max(t[0],e[0])&&Math.min(t[1],e[1])<=Math.max(i[1],s[1])&&Math.min(i[1],s[1])<=Math.max(t[1],e[1])}(t,e,i,s)&&function(t,e,i,s){let n=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),o=t[0]*(s[1]-e[1])+e[0]*(t[1]-s[1])+s[0]*(e[1]-t[1]);return !((n^o)>=0&&0!==n&&0!==o||(n=i[0]*(t[1]-s[1])+s[0]*(i[1]-t[1])+t[0]*(s[1]-i[1]),o=i[0]*(e[1]-s[1])+s[0]*(i[1]-e[1])+e[0]*(s[1]-i[1]),(n^o)>=0&&0!==n&&0!==o))}(t,e,i,s)){let n=(s[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-s[1]),o=(t[1]-i[1])*(e[0]-t[0])*(s[0]-i[0])+i[0]*(s[1]-i[1])*(e[0]-t[0])-t[0]*(e[1]-t[1])*(s[0]-i[0]);if(0===n||0===o){const n=Ks(t,e),o=Ks(i,s),r=n[0],a=n[1],l=o[0],h=o[1];if(a[0]===l[0]&&a[1]===l[1])return a;if(r[0]===h[0]&&r[1]===h[1])return r;if(tn(a,o)&&tn(l,n))return [l,a];if(tn(r,o)&&tn(h,n))return [r,h];if(tn(r,o)&&tn(a,o))return [r,a];if(tn(l,o)&&tn(h,o))return [l,h]}const r=o/n;return n=(t[0]-e[0])*(s[1]-i[1])-(e[1]-t[1])*(i[0]-s[0]),o=e[1]*(t[0]-e[0])*(s[1]-i[1])+(s[0]-e[0])*(s[1]-i[1])*(t[1]-e[1])-s[1]*(i[0]-s[0])*(e[1]-t[1]),[r,o/n]}return !1}function Ks(t,e){return t[0]===e[0]?t[1]<e[1]?[t,e]:[e,t]:t[0]<e[0]?[t,e]:[e,t]}function tn(t,e){return e[0][0]===e[1][0]?t[1]>=e[0][1]&&t[1]<=e[1][1]:t[0]>=e[0][0]&&t[0]<=e[1][0]}function en(t){const e=[];let i=null;const s=t.slice(0,8).concat(t[0],t[1]);for(let t=0;t<4;t++){const n=s[2*(t+1)+1]-s[2*t+1],o=s[2*(t+1)]-s[2*t];i=0===n&&0===o?0:n/o,e.push(i);}return e}function sn(t){const[e,i,s,n,o,r,a,l]=t,h=(a-e)*(n-i)-(l-i)*(s-e),d=(e-s)*(r-n)-(i-n)*(o-s),c=(s-o)*(l-r)-(n-r)*(a-o),u=(o-a)*(i-l)-(r-l)*(e-a);if(h*d*c*u<0)return !1;const p=t.slice().concat(t.slice(0,2)),g=en(t);if(g.length)for(let t=0;t<2;t++)if(g[t]!==g[t+2]&&Qs(p.slice(2*t,2*(t+1)),p.slice(2*(t+1),2*(t+2)),p.slice(2*(t+2),2*(t+3)),p.slice(2*(t+3),2*(t+4))))return !1;return h*d*c*u>0}function nn(t,e){return ((t.x-e.x)**2+(t.y-e.y)**2)**.5}function on(t){const{type:e,value:i}=t;return "hex"===e?`#${i}`:"literal"===e?i:"rgb"===e?`rgb(${i.join(",")})`:`rgba(${i.join(",")})`}const rn=function(){const t={linearGradient:/^(linear\-gradient)/i,repeatingLinearGradient:/^(repeating\-linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,repeatingRadialGradient:/^(repeating\-radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/};let e="";function i(t){throw new Error(`${e}: ${t}`)}function s(){return n("linear-gradient",t.linearGradient,r)||n("repeating-linear-gradient",t.repeatingLinearGradient,r)||n("radial-gradient",t.radialGradient,a)||n("repeating-radial-gradient",t.repeatingRadialGradient,a)||n("conic-gradient",t.conicGradient,a)}function n(e,s,n){return o(s,(s=>{const o=n();return o&&(v(t.comma)||i("Missing comma before color stops")),{type:e,orientation:o,colorStops:u(p)}}))}function o(e,s){const n=v(e);if(n){v(t.startCall)||i("Missing (");const e=s(n);return v(t.endCall)||i("Missing )"),e}}function r(){return y("directional",t.sideOrCorner,1)||y("angular",t.angleValue,1)}function a(){let i,s,n=l();return n&&(i=[],i.push(n),s=e,v(t.comma)&&(n=l(),n?i.push(n):e=s)),i}function l(){let t=function(){const t=y("shape",/^(circle)/i,0);return t&&(t.style=m()||h()),t}()||function(){const t=y("shape",/^(ellipse)/i,0);return t&&(t.style=f()||h()),t}();if(t)t.at=d();else {const e=h();if(e){t=e;const i=d();i&&(t.at=i);}else {const e=c();e&&(t={type:"default-radial",at:e});}}return t}function h(){return y("extent-keyword",t.extentKeywords,1)}function d(){if(y("position",/^at/,0)){const t=c();return t||i("Missing positioning value"),t}}function c(){const t={x:f(),y:f()};if(t.x||t.y)return {type:"position",value:t}}function u(e){let s=e();const n=[];if(s)for(n.push(s);v(t.comma);)s=e(),s?n.push(s):i("One extra comma");return n}function p(){const e=y("hex",t.hexColor,1)||o(t.rgbaColor,(()=>({type:"rgba",value:u(g)})))||o(t.rgbColor,(()=>({type:"rgb",value:u(g)})))||y("literal",t.literalColor,0);return e||i("Expected color definition"),e.length=f(),e}function g(){return v(t.number)[1]}function f(){return y("%",t.percentageValue,1)||y("position-keyword",t.positionKeywords,1)||m()}function m(){return y("px",t.pixelValue,1)||y("em",t.emValue,1)}function y(t,e,i){const s=v(e);if(s)return {type:t,value:s[i]}}function v(t){const i=/^[\n\r\t\s]+/.exec(e);i&&x(i[0].length);const s=t.exec(e);return s&&x(s[0].length),s}function x(t){e=e.substring(t);}return function(t){return e=t,function(){const t=u(s);return e.length>0&&i("Invalid input not EOF"),t}()}}();const an=(t,e,i)=>{try{void 0===e?i.appendChild(t):i.insertBefore(t,e);}catch(t){}},ln=()=>{const t=window;if(t){if(t.devicePixelRatio)return t.devicePixelRatio;if(t.screen.deviceXDPI&&t.screen.logicalXDPI)return t.screen.deviceXDPI/t.screen.logicalXDPI}return 1};function hn(t){let e="0px",i="",s="solid";if(!Ts(t)&&""!==t){const n=document.createElement("div");n.style.border=t;const{borderWidth:o,borderColor:r,borderStyle:a}=n.style;"initial"!==o&&""!==o&&(e=o),"initial"!==r&&""!==r&&(i=r),"initial"!==a&&""!==a&&(s=a);}return {borderWidth:e,borderColor:i,borderStyle:s}}const dn=t=>{const{pointerType:e}=t;return "touch"===e||"pen"===e||void 0===e},cn=function(t,e){const i=t.indexOf(e);return !(i<0||(t.splice(i,1),0))},un=function(t,e,i){if(Bs(i)){let s=[],n=[];if(e.includes(i)){const t=e.length;if(t>1){const o=e.indexOf(i);0===o?n=e.slice(1):o===t-1?s=e.slice(0,-1):(s=e.slice(0,o),n=e.slice(o+1));}}else s=e;const o=t[i],r=s.map((e=>t[e])),a=n.map((e=>t[e]));r.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1);})),a.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1);}));const l=t.indexOf(o);t.splice(l+1,0,...a),t.splice(l,0,...r);}else e.map((e=>t[e])).forEach((e=>{const i=t.indexOf(e);t.splice(i,1),t.push(e);}));return !0},pn=function(t,e,i){if(e===i)return !0;const s=t[e];return t[e]=t[i],t[i]=s,!0},gn=function(t,e){const i=e.length;return !(t.length!==i||!i||(e.every(((t,e)=>t===e))||e.map((e=>t[e])).forEach(((e,i)=>{t[i]=e;})),0))};function fn(t){return null==t}const mn=(t,e)=>t in e,yn=(t,e)=>{const i=[];for(;t;){const s=t.match(e);if(!s)break;i.push(s),t=t.substring(s.index+s[0].length);}return i};function vn(t,e){return Object.keys(t).forEach((i=>{Ts(e[i])?e[i]=t[i]:Ps(t[i])?vn(t[i],e[i]):e[i]=t[i];})),e}class xn{static read(t){return new Promise(((e,i)=>{const s=Object.prototype.toString.call(t);if("[object String]"===s){if(0===t.indexOf("blob:")||t.indexOf(".jpg")>0||t.indexOf(".jpeg")>0||t.indexOf(".png")>0||t.indexOf(".bmp")>0||t.indexOf(".dib")>0||t.indexOf(".pdf")>0||t.indexOf(".tiff")>0||t.indexOf(".tif")>0)return fetch(t,{mode:"cors"}).then((t=>t.arrayBuffer())).then((t=>e(t))).catch((t=>Promise.reject(t)));i("Error url: Can not read the file URL");}else if("[object Blob]"===s||"[object FileList]"===s||"[object File]"===s){let n=t;"[object FileList]"!==s&&"[object File]"!==s||(n=t[0]?t[0]:t),wn.call(xn,n,e,i);}else "[object ArrayBuffer]"===s||"[object Uint8ClampedArray]"===s?e(t):i(`Not support source type: ${s}`);}))}}function wn(t,e,i){let s,n,o=0;try{s=new ArrayBuffer(t.size),n=new Uint8Array(s);}catch(t){i(t);}!function r(){const a=new FileReader;a.onload=function(a){var l;if(null!=a&&null!==(l=a.target)&&void 0!==l&&l.result){const i=a.target.result;n.set(new Uint8Array(i),o),o+=i.byteLength,o<t.size?r():e(s);}else i(a);},a.onerror=function(t){i(t);},a.onabort=function(t){i(t);};const l=Math.min(o+1048576,t.size),h=t.slice(o,l);a.readAsArrayBuffer(h);}();}async function bn(t){let e;if(t instanceof ArrayBuffer)t.byteLength>12&&(e=new Uint8Array(t.slice(0,12)));else if(t instanceof Blob&&t.size>12){const i=t.slice(0,12),s=await xn.read(i);e=new Uint8Array(s);}if(e){if(function(t){return 37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]}(e))return "application/pdf";if(function(t){return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]}(e))return "image/png";if(function(t){return 255===t[0]&&216===t[1]}(e))return "image/jpeg";if(function(t){return 66===t[0]&&77===t[1]}(e))return "image/bmp";if(function(t){return 73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3]}(e))return "image/tiff";if(function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&12===t[3]&&106===t[4]&&80===t[5]&&32===t[6]&&32===t[7]||255===t[0]&&79===t[1]&&255===t[2]&&81===t[3]}(e))return "image/jp2";if(function(t){return 82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]}(e))return null;if(t instanceof Blob&&("application/pdf"===t.type||"image/bmp"===t.type||"image/jp2"===t.type||"image/jpeg"===t.type||"image/png"===t.type||"image/tiff"===t.type||"image/rgba"===t.type))return t.type}return t instanceof Blob&&"application/ddv-blank-image"===t.type?t.type:null}function Cn(t,e,i){return e===i?t:Bs(t)?t/e*i:Ss(t)?t.map((t=>Ss(t)?[t[0]/e*i,t[1]/e*i]:t/e*i)):(t={...t},Object.keys(t).forEach((s=>{t[s]=t[s]/e*i;})),t)}function Sn(t,e){return t.every(((t,i)=>{let[s,n]=t;const[o,r]=e[i];return s===o&&n===r}))}function Pn(t,e){return Number.parseFloat(t.toFixed(e))}class An{constructor(){l(this,"disposed",!1),l(this,"toDispose",new Set);}get isDisposed(){return this.disposed}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this.disposed||this.toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this.toDispose.delete(t),t.dispose();}}dispose(){this.disposed||(this.disposed=!0,this.clear());}clear(){try{for(const t of this.toDispose)if(t)try{t.dispose();}catch(t){throw new Error("can not dispose an object")}}finally{this.toDispose.clear();}}}class Tn{constructor(){l(this,"store",new An);}dispose(){this.store.dispose();}register(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this.store.add(t)}}class kn{static create(t){return new kn(t)}constructor(t){l(this,"isDisposed",!1),l(this,"listeners",void 0),l(this,"options",void 0),this.options=t,this.listeners=[];}dispose(){this.isDisposed||(this.isDisposed=!0,this.listeners&&(this.listeners=null));}on(t,e,i){var s,n,o,r;if(this.isDisposed)return {dispose:()=>{}};const a={uid:_s(),callback:t,context:e};this.listeners.length?this.listeners.push(a):(null!==(s=this.options)&&void 0!==s&&null!==(n=s.beforeAddFirstListener)&&void 0!==n&&n.call(s,this),this.listeners.push(a),null===(o=this.options)||void 0===o||null===(r=o.afterAddFirstListener)||void 0===r||r.call(o,this));const l={dispose:()=>{this.remove(a);}};return i instanceof An?i.add(l):Array.isArray(i)?i.push(l):i instanceof Tn&&i.register(l),l}remove(t){var e,i,s,n;if(null!==(e=this.options)&&void 0!==e&&null!==(i=e.beforeRemoveListener)&&void 0!==i&&i.call(e,this),!this.listeners)return;if(1===this.listeners.length)return this.listeners=[],void(null===(s=this.options)||void 0===s||null===(n=s.afterRemoveLastListener)||void 0===n||n.call(s,this));const o=this.listeners.indexOf(t);if(o<0)throw new Error("Attempted to dispose unknown listener.");this.listeners.splice(o,1);}off(t){if(this.isDisposed||!this.listeners)return;const e=this.listeners.findIndex((e=>e.callback===t));e>-1&&this.listeners.splice(e,1);}emit(t){this.listeners&&this.listeners.length&&this.listeners.slice().forEach((e=>{try{e.context?e.callback.call(e.context,t):e.callback(t);}catch(e){}}));}}function Dn(t,e,i){return {on:(s,n)=>{const o=new kn({beforeAddFirstListener:()=>{t.addEventListener(e,s,n);},afterRemoveLastListener:()=>{t.removeEventListener(e,s);}});i.register(o.on((()=>{}))),i.register(o);}}}function En(t){const e=t.register(new kn);return {on:(i,s)=>e.on(i,t,s),emit:t=>{e.emit(t);}}}var In,Rn;!function(t){t.core="ddv-core",t.reader="ddv-reader",t.detector="ddv-detector",t.loader="ddv-loader";}(Rn||(Rn={}));class Mn{static get isApple(){return e(Mn,this,jn)._}static get version(){return ci.CryptoModule.ver}static enableDebugOutput(t,i){if(t){const t=t=>{var s,n,o;let r=As(t);r.srcBuffer&&(r.srcBuffer=e(Mn,this,Bn).call(this,r.srcBuffer)),null!==(s=r.result)&&void 0!==s&&s.srcBuffer&&(r.result.srcBuffer=e(Mn,this,Bn).call(this,r.result.srcBuffer)),null!==(n=r.result)&&void 0!==n&&n.imageData&&(r.result.imageData=e(Mn,this,Bn).call(this,r.result.imageData)),null!==(o=r.result)&&void 0!==o&&o.pdfData&&(r.result.pdfData=e(Mn,this,Bn).call(this,r.result.pdfData)),r.imageData&&(r.imageData=e(Mn,this,Bn).call(this,r.imageData)),i&&(Ls(r)&&(r=`[${Date.now()}]${r}`),i(r));};ci.setLogFunc("logDebug",t);}else ci.setLogFunc("",void 0);}static getMemoryUsed(){return fi.Instance.getMemoryUsed()}static get heapConfig(){return ci.HeapConfig}static updateHeapConfig(t,i,s){ci.UpdateHeapConfig(t,i,s),e(Mn,this,Gn)._[t]||(e(Mn,this,Gn)._[t]={}),i&&(e(Mn,this,Gn)._[t].maxHeapSize=i),s&&(e(Mn,this,Gn)._[t].initHeapSize=s);}static async getLicenseInfo(t,i,s){this.Init(t,i,s),i&&await fi.Instance.loadModule(ci.CryptoModule),await fi.Instance.loadModule(ci.ImageIOModule),await Pi.updateLicense(e(Mn,this,On)._,e(Mn,this,_n)._,e(Mn,this,Nn)._);const n=new vi(e(Mn,this,On)._);try{return await n.getLicenseInfo()}finally{n.terminate();}}static Init(t,i,s){var n;On._=e(Mn,this,null!=t?t:e(Mn,this,On)._),void 0!==i&&(_n._=e(Mn,this,i?1:0)),Nn._=e(Mn,this,null!=s?s:e(Mn,this,Nn)._);const o={bMac:"Mac"===es.OS,biPhone:"iPhone"===es.OS,biPad:"iPad"===es.OS};jn._=e(Mn,this,o.bMac||o.biPhone||o.biPad),ci.NavInfo=o,ci.License=e(Mn,this,On)._,ci.UUID=e(Mn,this,Nn)._,ci.LicMode=e(Mn,this,_n)._,e(Mn,this,Un).call(this),ci.UpdateHeapConfig(Rn.detector,null!==(n=e(Mn,this,Ln).call(this,Rn.detector))&&void 0!==n?n:100);}static async isResourceDirValid(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;e(Mn,this,Un).call(this);let s=0;for(;s<t;){try{const t=ci.PdfReaderModule;if(e(Mn,this,$n)._===t.script)return !0;const i={...t.fetchOptions};i.method="HEAD";if((await fetch(t.script,i)).ok)return $n._=e(Mn,this,t.script),!0}catch(t){}await new Promise((t=>setTimeout(t,i))),s+=1;}return !1}static async loadPdfReader(t,i,s){return this.Init(t,i,s),e(Mn,this,Vn)._||(await fi.Instance.loadModule(ci.ImageProcModule),Vn._=e(Mn,this,fi.Instance.loadModule(ci.PdfReaderModule)),await e(Mn,this,Vn)._),e(Mn,this,Vn)._}static async loadMain(t,i,s){return this.Init(t,i,s),e(Mn,this,zn)._||(zn._=e(Mn,this,fi.Instance.loadModule(ci.ImagecoreModule)),await e(Mn,this,zn)._,fi.Instance.loadModule(ci.ImageProcModule)),e(Mn,this,zn)._}static async load(t,e,i){fi.Instance.terminate(!0),this.Init(t,e,i),await this.loadMain(t,e,i);}static async preloadModule(t){let i;const s={...ci.PdfReaderModule},n={...ci.ImageProcModule};switch(t){case"core":if(e(Mn,this,zn)._){i=e(Mn,this,zn)._;break}zn._=e(Mn,this,fi.Instance.loadModule(ci.ImagecoreModule)),i=e(Mn,this,zn)._,await e(Mn,this,zn)._;break;case"pdf":case"proc":if(e(Mn,this,Vn)._){i=e(Mn,this,Vn)._;break}n.workerName=Rn.loader,Vn._=e(Mn,this,fi.Instance.loadModule(n)),i=e(Mn,this,Vn)._,await e(Mn,this,Vn)._,s.workerName=Rn.loader,Vn._=e(Mn,this,fi.Instance.loadModule(s)),i=e(Mn,this,Vn)._,await e(Mn,this,Vn)._,fi.Instance.terminateWorker(s.workerName);}return i}static unloadMainWorker(){zn._=e(Mn,this,void 0),fi.Instance.terminateWorker(ci.ImageIOModule.workerName);}static unloadPdfReaderWorker(){Vn._=e(Mn,this,void 0),fi.Instance.terminateWorker(ci.PdfReaderModule.workerName);}static unloadDocumentDetectorWorker(){fi.Instance.terminateWorker(ci.DetectorModule.workerName);}static async unloadWorker(){zn._=e(Mn,this,void 0),Vn._=e(Mn,this,void 0),await fi.Instance.terminate(!0);}static async unload(){fi.unload(),ci.unload(),Pi.unload(),zn._=e(Mn,this,void 0),Vn._=e(Mn,this,void 0);try{await fi.Instance.terminate(!0);}catch(t){}}static getUseSimd(){if(this.enableSimd){var t;const e=navigator;if(null!==(t=e.userAgentData)&&void 0!==t&&t.brands)for(const{brand:t,version:i}of e.userAgentData.brands)if(t&&("Chromium"===t||"Google Chrome"===t)&&i&&parseInt(i,10)>=94)return !0}return !1}static getPdfFonts(){return Xi.getPdfFonts()}static async getPdfInfo(t,e){let i;try{i=new Xi;const s=await i.getPdfInfo({fileSource:t,password:e});return i.destroy(),s}catch(t){return null}finally{i&&i.destroy();}}}function Bn(t){return t instanceof ArrayBuffer?{type:"ArrayBuffer",length:t.byteLength}:t instanceof Uint8ClampedArray?{type:"Uint8ClampedArray",length:t.byteLength}:{type:Object.prototype.toString.call(t)}}function Ln(t){return void 0!==e(In,this,Gn)._[t]?e(In,this,Gn)._[t].maxHeapSize:null}function Un(){this.enableSimd?ci.UseSimd=this.getUseSimd():ci.UseSimd=!1;const t={resourceDir:this.resourceDir,workerScript:"",useFastCompEdition:!1,useSimd:ci.UseSimd,fetchOptions:this.fetchOptions};t.workerScript=ci.ImageIOWorkerJS,ci.ImageIOResource=t;const e={...t};e.workerScript=ci.ImageIOWorkerJS,ci.PdfReaderResource=e;}In=Mn,l(Mn,"resourceDir","");var On={_:""},_n={_:m.LONG_KEY},Nn={_:""};l(Mn,"fetchOptions",{mode:"cors",credentials:"same-origin",retries:3,retryDelay:500}),l(Mn,"enableSimd",!0);var Wn,Fn,Hn,Vn={_:void 0},zn={_:void 0},jn={_:!1},$n={_:void 0},Gn={_:Object.create(null)};class Xn{constructor(){l(this,"processor",void 0),this.processor=new Gi;}async initImage(t){return this.processor.initImage(t.source,t.isRGBA,t.width,t.height,t.isBGRA)}async getImage(t){return await this.processor.getImage(t.jpegQuality,t.ifDeleteObject,t.isRGBA,t.bitDepth,t.xDpi,t.yDpi,t.returnBlob,t.returnType,Mn.isApple)}async getImageInfo(){return await this.processor.getImageInfo()}async freeReservedData(){this.processor.freeReservedData();}async toBinaryLevel(t,e){return this.processor.toBinaryLevel(t,e)}async toGrayscale(t){return this.processor.toGrayscale(t)}async removeShadowLevel(t,e){return this.processor.removeShadowLevel(t,e)}async brighten(){return this.processor.brighten()}async invert(){return this.processor.invert()}async changeBrightnessAndContrast(t,e){return this.processor.changeBrightnessAndContrast(t,e)}async perspective(t){return this.processor.perspective(t[0][0],t[0][1],t[1][0],t[1][1],t[2][0],t[2][1],t[3][0],t[3][1])}async getSkewAngle(t){return this.processor.getSkewAngle(t)}async rotate(t){return this.processor.rotate(t.angle,t.fillColor,t.keepSize,t.mode)}async flip(){return this.processor.flip()}async resize(t,e,i){return this.processor.resize(t,e,i)}async resizeWidth(t,e){return this.processor.setImageWidth(t,e)}async resizeHeight(t,e){return this.processor.setImageHeight(t,e)}async crop(t){return this.processor.crop(t.left,t.top,t.left+t.width,t.top+t.height)}async erase(t,e){return this.processor.erase(t.left,t.top,t.left+t.width,t.top+t.height,e)}async setDpi(t){return this.processor.setDPI(t.rawResolutionX,t.rawResolutionY,t.resolutionX,t.resolutionY,t.resample,t.mode)}async drawQuadrangle(t){return this.processor.drawQuadrangle(t.location[0][0],t.location[0][1],t.location[1][0],t.location[1][1],t.location[2][0],t.location[2][1],t.location[3][0],t.location[3][1],t)}async filter(t,e,i){return this.processor.filter(t,e,i)}async setImageWidth(t,e){return this.processor.setImageWidth(t,e)}async setImageHeight(t,e){return this.processor.setImageHeight(t,e)}terminate(t){return this.processor.terminate(t)}}class Yn{constructor(){l(this,"reader",void 0),this.reader=new Ai;}async readImage(t){return await this.reader.readImage(t.source,t.outputType,t.jpegQuality,t.returnBase64,Mn.isApple)}async readImageInfo(t){return await this.reader.readImageInfo(t)}cancelReadImage(t,e){this.reader.cancelReadImage(t,e);}async readTiffPage(t){return await this.reader.readTiffPage(t.source,t.index,t.outputType,t.returnBase64,Mn.isApple)}async readTiffPageInfo(t,e){const{imageInfos:i}=await this.reader.getTiffPageInfos(t,e);return i}async getTiffPageCount(t){return (await this.reader.getTiffInfo(t)).pageCount}cancelReadTiffPage(t,e){this.reader.cancelReadTiffPage(t,e);}destroy(){var t;null===(t=this.reader)||void 0===t||t.destroy(),this.reader=void 0;}}!function(t){t[t.RGBA=1]="RGBA",t[t.BGRA=2]="BGRA",t[t.JPEG=3]="JPEG",t[t.PNG=4]="PNG";}(Wn||(Wn={})),function(t){t[t.IT_DIB=-1]="IT_DIB",t[t.IT_RGBA=-2]="IT_RGBA",t[t.IT_BGRA=-3]="IT_BGRA",t[t.IT_BMP=0]="IT_BMP",t[t.IT_JPG=1]="IT_JPG",t[t.IT_PNG=3]="IT_PNG",t[t.IT_ALL=5]="IT_ALL";}(Fn||(Fn={})),function(t){t[t.RT_AUTO=-1]="RT_AUTO",t[t.RT_BINARY=1]="RT_BINARY",t[t.RT_BASE64=2]="RT_BASE64";}(Hn||(Hn={}));class Jn{constructor(){l(this,"writer",void 0),this.writer=new vi;}terminate(){var t;null===(t=this.writer)||void 0===t||t.terminate(),this.writer=void 0;}createTiff(){return this.writer.createTiff()}addTiffTag(t,e,i){return this.writer.addTag(t,e,i)}async appendImage(t,e){var i;e=null!==(i=e)&&void 0!==i?i:{};return await this.writer.appendImage(t,e.inputType,e.tiffFormat,e.jpegQuality,e.is1Bit)}async getTiff(){return (await this.writer.getTiff(Hn.RT_BINARY)).imageData}async saveImage(t,e){var i;e=null!==(i=e)&&void 0!==i?i:{};return (await this.writer.saveImage(t,e.outputType,e.jpegQuality,e.returnType)).imageData}}class qn{constructor(){l(this,"reader",void 0),this.reader=new Xi;}initFonts(t){var e;const i=null==t||null===(e=t.renderOptions)||void 0===e?void 0:e.fonts;if(i)for(const t of i)t.name&&t.data&&qn.addPdfFont(t.name,t.data);}static addPdfFont(t,e){Xi.addPdfFont(t,e);}async readPageImageInfos(t){await this.initFonts(t.readOptions);const{imageInfos:e}=await this.reader.readPageImageInfos(t.source,t.indices,t.readOptions,t.outputType,t.isInfoOnly,t.returnBase64,Mn.isApple);return e}async readPage(t){await this.initFonts(t.readOptions);return await this.reader.readPageEx(t.source,t.index,t.readOptions,t.outputType,t.isInfoOnly,t.returnBase64,Mn.isApple)}cancelReadPage(t,e){this.reader.cancelReadPage(t,e);}async getPdfPageCount(t,e){await this.initFonts(e);return (await this.reader.getPdfInfo(t)).PdfCount}async readAnnotations(t,e){const{annot:{annots:i}}=await this.reader.readPageAnnot(t,e);return i}destroy(){this.reader.destroy(),this.reader=null;}}class Zn{constructor(){l(this,"writer",void 0),this.writer=new Yi;}terminate(){var t;null===(t=this.writer)||void 0===t||t.terminate(),this.writer=null;}async initPdfSetting(t){return this.writer.initPdfSetting(t)}async insertBlankPage(t,e,i){return this.writer.insertBlankPage(t,e,i)}async appendPage(t,e){return this.writer.appendPage(t,e)}async addImageToPages(t,e,i,s,n){return this.writer.pageAddImage(t,e,i,s,n)}async mergeRawPdfPages(t,e,i){return this.writer.mergePdf(t,e,i)}async setPageRotation(t,e){return this.writer.pageSetRotation(t,e)}async clearPageObjects(t){return this.writer.pageClearObjects(t)}async setPageCropBox(t,e,i,s,n){return this.writer.pageSetCropBox(t,e,i,s,n)}async setPageMediaBox(t,e,i,s,n){return this.writer.pageSetMediaBox(t,e,i,s,n)}async setPageAnnotations(t,e){return this.writer.pageSetAnnot(t,e)}async addAnnotationsToPage(t,e){return this.writer.pageAddAnnot(t,e)}async deletePageAnnotationsByTypes(t,e){return this.writer.pageDeleteAnnotByTypes(t,e)}async deletePageAnnotations(t){return this.writer.pageDeleteAnnot(t)}async flattenPage(t,e){return this.writer.pageFlatten(t,e)}async getPdf(t){return (await this.writer.writePdf(t)).pdfData}async getFontInfo(t){return await this.writer.GetFontInfo(t)}async ifFontsExist(t){return (await this.writer.IfFontsExist(t)).fontsExist}}class Qn{constructor(t){l(this,"items",[]),t&&(this.items=t);}push(t){this.items.push(t);}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0===this.items.length}size(){return this.items.length}remove(t){"filter"===t.api&&this.items.forEach(((e,i)=>{if(e.api===t.api&&e.params[0]===t.params[0]&&e.params[1]===t.params[1]&&e.params[2]===t.params[2]){this.items.splice(i,1).forEach((t=>{null==t||t.resolve(null);}));}}));}}const Kn={[Wn.BGRA]:Fn.IT_BGRA,[Wn.RGBA]:Fn.IT_RGBA,[Wn.PNG]:Fn.IT_PNG,[Wn.JPEG]:Fn.IT_JPG},to={[Fn.IT_BGRA]:Wn.BGRA,[Fn.IT_RGBA]:Wn.RGBA,[Fn.IT_PNG]:Wn.PNG,[Fn.IT_JPG]:Wn.JPEG},eo={displayResolution:96,dataResolution:72,pdfResolution:72,enableResolution:!0,autoReleaseImg:Ms(),autoReleaseBlob:!0};class io{constructor(){l(this,"db",void 0),this.db=new Map;}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}getSaverConstructor(t){return this.db.get(t)}setSaverConstructor(t,e){this.db.set(t,e);}deleteSaverConstructor(t){this.db.delete(t);}clear(){this.db.clear();}}const so=new io,no=new io;const oo=new class{constructor(t,e){l(this,"saverConstructorRepo",void 0),l(this,"customSaverConstructorRepo",void 0),this.saverConstructorRepo=t,this.customSaverConstructorRepo=e;}execute(t){let e=this.customSaverConstructorRepo.getSaverConstructor(t);e||(e=this.saverConstructorRepo.getSaverConstructor(t));return new e}}(so,no),ro=new class{constructor(t){l(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=t;}execute(t){let{mime:e,saverConstructor:i}=t;this.saverConstructorRepo.setSaverConstructor(e,i);}}(so),ao=new class{constructor(t){l(this,"saverConstructorRepo",void 0),this.saverConstructorRepo=t;}execute(t){this.saverConstructorRepo.deleteSaverConstructor(t);}}(so);var lo,ho,co,uo;!function(t){t.TIFF_AUTO="tiff/auto",t.TIFF_FAX3="tiff/fax3",t.TIFF_FAX4="tiff/fax4",t.TIFF_LZW="tiff/lzw",t.TIFF_JPEG="tiff/jpeg";}(lo||(lo={})),function(t){t.PDF_AUTO="pdf/auto",t.PDF_FAX4="pdf/fax4",t.PDF_LZW="pdf/lzw",t.PDF_JPEG="pdf/jpeg",t.PDF_JP2000="pdf/jp2000",t.PDF_JBIG2="pdf/jbig2";}(ho||(ho={})),function(t){t.PAGE_DEFAULT="page/default",t.PAGE_A4="page/a4",t.PAGE_A4_REVERSE="page/a4reverse",t.PAGE_A3="page/a3",t.PAGE_A3_REVERSE="page/a3reverse",t.PAGE_LETTER="page/letter",t.PAGE_LETTER_REVERSE="page/letterreverse",t.PAGE_LEGAL="page/legal",t.PAGE_LEGAL_REVERSE="page/legalreverse";}(co||(co={})),function(t){t.PRINT="print",t.MODIFY_CONTENTS="modify_contents",t.COPY_CONTENTS="copy_contents",t.EXTRACT_CONTENTS="extract_contents",t.MODIFY_ANNOTATIONS="modify_annotations",t.FILL_IN="fill_in",t.ASSEMBLY="assembly",t.DEGRADED_PRINT="degraded_print";}(uo||(uo={})),new Map([[uo.PRINT,2052],[uo.MODIFY_CONTENTS,8],[uo.COPY_CONTENTS,16],[uo.MODIFY_ANNOTATIONS,32],[uo.FILL_IN,256],[uo.EXTRACT_CONTENTS,512],[uo.ASSEMBLY,1024],[uo.DEGRADED_PRINT,4]]);const po=new Map([[co.PAGE_DEFAULT,0],[co.PAGE_A4,2],[co.PAGE_A4_REVERSE,3],[co.PAGE_A3,4],[co.PAGE_A3_REVERSE,5],[co.PAGE_LETTER,6],[co.PAGE_LETTER_REVERSE,7],[co.PAGE_LEGAL,8],[co.PAGE_LEGAL_REVERSE,9]]),go=new Map([[ho.PDF_AUTO,0],[ho.PDF_FAX4,2],[ho.PDF_LZW,3],[ho.PDF_JPEG,5],[ho.PDF_JP2000,6],[ho.PDF_JBIG2,7]]),fo=new Map([[lo.TIFF_AUTO,0],[lo.TIFF_FAX3,1],[lo.TIFF_FAX4,2],[lo.TIFF_LZW,3],[lo.TIFF_JPEG,5]]);var mo=new WeakMap,yo=new WeakMap,vo=new WeakMap;class xo{constructor(){n(this,mo,void 0),n(this,yo,void 0),n(this,vo,void 0),o(mo,this,new Zn),o(yo,this,new Map);}destroy(){var t;null===(t=s(mo,this))||void 0===t||t.terminate(),o(mo,this,void 0);}convertPageSize(t,e){let i=0,s=0,n=0,o=0,r=0,a=0,l=0,h=0;const{pdfResolution:d,displayResolution:c}=eo;switch(t){case co.PAGE_A4:n=210/25.4*d,o=297/25.4*d,l=n,a=o;break;case co.PAGE_A4_REVERSE:n=297/25.4*d,o=210/25.4*d,l=n,a=o;break;case co.PAGE_A3:n=297/25.4*d,o=420/25.4*d,l=n,a=o;break;case co.PAGE_A3_REVERSE:n=420/25.4*d,o=297/25.4*d,l=n,a=o;break;case co.PAGE_LETTER:n=8.5*d,o=11*d,l=n,a=o;break;case co.PAGE_LETTER_REVERSE:n=11*d,o=8.5*d,l=n,a=o;break;case co.PAGE_LEGAL:n=8.5*d,o=14*d,l=n,a=o;break;case co.PAGE_LEGAL_REVERSE:n=14*d,o=8.5*d,l=n,a=o;break;default:i=e.mediaBox.left/c*d,s=e.mediaBox.top/c*d,n=e.mediaBox.width/c*d,o=e.mediaBox.height/c*d,r=e.cropBox.left/c*d,a=2*s+o-e.cropBox.top/c*d,l=r+e.cropBox.width/c*d,h=a-e.cropBox.height/c*d;}return {left:i,top:s,width:n,height:o,cropLeft:r,cropTop:a,cropRight:l,cropBottom:h}}convertPdfSettings(t){const e={};return e.author=null==t?void 0:t.author,e.compression=null!=t&&t.compression?go.get(t.compression):void 0,e.creationDate=null==t?void 0:t.creationDate,e.creator=null==t?void 0:t.creator,e.keyWords=null==t?void 0:t.keyWords,e.modifiedDate=null==t?void 0:t.modifiedDate,e.pageType=null!=t&&t.pageType?po.get(t.pageType):void 0,e.producer=null==t?void 0:t.producer,e.quality=null==t?void 0:t.quality,e.subject=null==t?void 0:t.subject,e.title=null==t?void 0:t.title,e.version=null==t?void 0:t.version,null!=t&&t.password&&(e.encryptOptions={},e.encryptOptions.enabled=!0,e.encryptOptions.userPassword=t.password),e}async init(t){o(vo,this,t||{});const e=this.convertPdfSettings(t);await s(mo,this).initPdfSetting(e);}async appendImagePage(t,e){const{mediaBox:i}=e,n=this.convertPageSize(s(vo,this).pageType,e);let o=await s(mo,this).insertBlankPage(-1,n.left+n.width,n.top+n.height);const{pageIndex:r}=o;await s(mo,this).setPageMediaBox(r,n.left,n.top,n.left+n.width,n.top+n.height),e.rotation&&await s(mo,this).setPageRotation(r,e.rotation);const{displayResolution:a,pdfResolution:l}=eo;let h=n.width,d=n.height,c=0,u=0;if(s(vo,this).pageType&&s(vo,this).pageType!==co.PAGE_DEFAULT){const t={width:i.width/a*l,height:i.height/a*l},e=n.width/t.width,o=n.height/t.height;if(e<o){const i=t.height*e;u=(n.height-i)/2,h=n.width,d=i;}else {const e=t.width*o;c=(n.width-e)/2,h=e,d=n.height;}s(yo,this).set(r,[h/t.width,0,0,d/t.height,c,u]);}c+=n.left,u+=n.top;let p=e.width,g=e.height,f=t;if(s(vo,this).imageScaleFactor){let i=Math.floor(e.width*s(vo,this).imageScaleFactor+.5),n=Math.floor(e.height*s(vo,this).imageScaleFactor+.5);if(i<1&&(i=1),n<1&&(n=1),i!==p&&n!==g){const e=new Xn;await e.initImage({source:t}),await e.resize(i,n);f=(await e.getImage({})).imageData,p=i,g=n,await e.freeReservedData();}}return o=await s(mo,this).addImageToPages(f,[r],{type:"image",imageWidth:h,imageHeight:d,position:[c,u]},p,g),await s(mo,this).setPageCropBox(r,n.cropLeft,n.cropBottom,n.cropRight,n.cropTop),o}async appendRawPdfPages(t,e,i){await s(mo,this).mergeRawPdfPages(t,e,i);}async changePageImage(t,e,i){const n=this.convertPageSize(co.PAGE_DEFAULT,i);await s(mo,this).clearPageObjects(t);return await s(mo,this).addImageToPages(e,[t],{type:"image",imageWidth:n.width,imageHeight:n.height,position:[n.left,n.top]},i.width,i.height)}async setPageInfo(t){for(const[e,i]of t){const t=this.convertPageSize(co.PAGE_DEFAULT,i),{rotation:n}=i;await s(mo,this).setPageCropBox(e,t.cropLeft,t.cropBottom,t.cropRight,t.cropTop),await s(mo,this).setPageRotation(e,(n%360+360)%360);}}async setPageRotation(t){for(const[e,i]of t){const t=(i%360+360)%360;await s(mo,this).setPageRotation(e,t);}}async getPdf(t){return s(mo,this).getPdf(t)}updateAnnotPoint(t,e){return [t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}fixAnnotationPosition(t,e){s(yo,this).has(t)&&e.forEach((e=>{const i=this.updateAnnotPoint([e.rect[0],e.rect[1]],s(yo,this).get(t)),n=this.updateAnnotPoint([e.rect[2],e.rect[3]],s(yo,this).get(t));e.rect=[i[0],i[1],n[0],n[1]],"Highlight"!==e.type&&"StrikeOut"!==e.type&&"Underline"!==e.type&&"Squiggly"!==e.type||e.quadPoints.forEach((e=>{const i=this.updateAnnotPoint([e[0],e[1]],s(yo,this).get(t)),n=this.updateAnnotPoint([e[2],e[3]],s(yo,this).get(t)),o=this.updateAnnotPoint([e[4],e[5]],s(yo,this).get(t)),r=this.updateAnnotPoint([e[6],e[7]],s(yo,this).get(t));e=[i[0],i[1],n[0],n[1],o[0],o[1],r[0],r[1]];}));}));}async removePageAnnotations(t){await s(mo,this).deletePageAnnotationsByTypes(t,"");}async setPageAnnotations(t,e,i){let n;return e&&e.length>0&&this.fixAnnotationPosition(t,e),i?e&&e.length>0&&(n=await s(mo,this).addAnnotationsToPage(t,e)):n=await s(mo,this).setPageAnnotations(t,e),n}async flattenPage(t){return await s(mo,this).flattenPage(t)}async getFontInfo(t){return await s(mo,this).getFontInfo(t)}async ifFontsExist(t){return await s(mo,this).ifFontsExist(t)}}class wo{constructor(){l(this,"imageWriter",void 0),this.imageWriter=new Jn;}destroy(){var t;null===(t=this.imageWriter)||void 0===t||t.terminate(),this.imageWriter=void 0;}async save(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.imageWriter.saveImage(t,{outputType:e.outputType,jpegQuality:e.jpegQuality,returnType:e.returnType})}}class bo{constructor(){l(this,"imageWriter",void 0),l(this,"tiffCompression",void 0),l(this,"tiffQuality",void 0),this.imageWriter=new Jn,this.tiffCompression=fo.get(lo.TIFF_AUTO);}destroy(){var t;null===(t=this.imageWriter)||void 0===t||t.terminate(),this.imageWriter=void 0;}async init(t){if(await this.imageWriter.createTiff(),t&&(this.tiffQuality=t.quality,t.compression&&(this.tiffCompression=fo.get(t.compression)),t.customTag))for(let e=0;e<t.customTag.length;e++)await this.imageWriter.addTiffTag(t.customTag[e].id,t.customTag[e].content,t.customTag[e].contentIsBase64);}async appendPage(t){await this.imageWriter.appendImage(t,{inputType:void 0,tiffFormat:this.tiffCompression,jpegQuality:this.tiffQuality});}async getTiff(){return this.imageWriter.getTiff()}}class Co{constructor(t){l(this,"uid",void 0),this.uid=t||_s();}equals(t){return null!=t&&void 0!==t&&(this===t||!!function(t){return t instanceof Co}(t)&&this.uid===t.uid)}}class So extends Co{}let Po=class{constructor(t){l(this,"type",void 0),l(this,"uid",void 0),this.type=t,this.uid=_s();}};class Ao{constructor(t){l(this,"bubbles",!0),l(this,"cancelBubble",!0),l(this,"cancelable",!1),l(this,"composed",!1),l(this,"currentTarget",void 0),l(this,"defaultPrevented",!1),l(this,"eventPhase",Ao.prototype.NONE),l(this,"isTrusted",void 0),l(this,"returnValue",void 0),l(this,"srcElement",void 0),l(this,"target",void 0),l(this,"timeStamp",void 0),l(this,"type",void 0),l(this,"detail",void 0),l(this,"view",void 0),l(this,"which",void 0),l(this,"path",void 0),l(this,"immediatePropagationStopped",!1),l(this,"propagationStopped",!1),l(this,"nativeEvent",void 0),l(this,"originalEvent",void 0),l(this,"eventService",void 0),l(this,"NONE",0),l(this,"CAPTURING_PHASE",1),l(this,"AT_TARGET",2),l(this,"BUBBLING_PHASE",3),this.eventService=t;}initUIEvent(t,e,i,s,n){}composedPath(){const{path:t,eventService:e,target:i}=this;return !e||t&&t[this.path.length-1]===i||(this.path=i?e.getPropagationPath(i):[]),this.path}bindEvents(t,e,i){}preventDefault(){const{nativeEvent:t}=this;t instanceof Event&&t.cancelable&&t.preventDefault(),this.defaultPrevented=!0;}stopImmediatePropagation(){this.immediatePropagationStopped=!0;}stopPropagation(){this.propagationStopped=!0;}}function To(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which;}class ko extends Ao{constructor(t,e){super(null),this.type=t,this.detail=e;}}class Do{constructor(){l(this,"pubsub",Fs.create());}addEventListener(t,e,i){let s,n=Is(i)&&i;Ps(i)&&(n=i.capture,s=i.once),t=n?`${t}:capture`:t,e=Rs(e)?e:e.handleEvent,this.pubsub.on(t,e,this,s);}dispatchEvent(t){const e=this.ownerDocument||this.document;var i;e&&(t.eventService=(null===(i=e.defaultView)||void 0===i?void 0:i.eventService)||null,t.defaultPrevented=!1,t.path=[],t.target=this,Io(t));return !t.defaultPrevented}removeEventListener(t,e,i){let s=Is(i)&&i;Ps(i)&&(s=i.capture),t=s?`${t}:capture`:t,e=Rs(e)?e:e.handleEvent,this.pubsub.off(t,e);}removeAllEventListeners(){this.pubsub.removeAllEventListeners();}getAllEvents(){return this.pubsub.getAllEvents()}}function Eo(t,e){const i=t.currentTarget.getAllEvents()[e]||[];for(let e=0,s=i.length;e<s;e++){if(t.immediatePropagationStopped)return;const{context:s,fn:n}=i[e];n.call(s,t);}}function Io(t,e){var i;if(e=null!==(i=e)&&void 0!==i?i:t.type,t.propagationStopped=!1,t.immediatePropagationStopped=!1,!t.target)return;const s=t.composedPath(),n=s.length;t.eventPhase=t.CAPTURING_PHASE;for(let i=0;i<n-1;i++){t.currentTarget=s[i];if(Eo(t,`${e}:capture`),Ro(t))return}if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,Eo(t,e),!Ro(t)){t.eventPhase=t.BUBBLING_PHASE;for(let i=n-2;i>=0;i--)if(t.currentTarget=s[i],Eo(t,e),Ro(t))return}}function Ro(t){return t.propagationStopped||t.immediatePropagationStopped}const Mo=t=>t/180*Math.PI,Bo=t=>t/Math.PI*180;class Lo{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;l(this,"x",void 0),l(this,"y",void 0),l(this,"z",void 0),l(this,"w",void 0),this.x=t,this.y=e,this.z=i,this.w=s;}static fromQuat(t){return (new Lo).setFromQuat(t)}static fromEuler(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Mo(t)/2,e=Mo(e)/2,i=Mo(i)/2;const s=Math.sin(t),n=Math.cos(t),o=Math.sin(e),r=Math.cos(e),a=Math.sin(i),l=Math.cos(i),h=new Lo;return h.setFromQuat({x:s*r*l-n*o*a,y:n*o*l+s*r*a,z:n*r*a-s*o*l,w:n*r*l+s*o*a}),h}clone(){const t=new Lo;return t.setFromQuat(this),t}setFromQuat(t){var e,i,s,n;const o=this;return o.x=null!==(e=t.x)&&void 0!==e?e:0,o.y=null!==(i=t.y)&&void 0!==i?i:0,o.z=null!==(s=t.z)&&void 0!==s?s:0,o.w=null!==(n=t.w)&&void 0!==n?n:1,this}toEuler(){const{x:t,y:e,z:i,w:s}=this,n=.4990234375,o=this.w*this.y-this.x*this.z;if(o<-n||o>n){const t=Math.sign(o);return {z:-2*t*Math.atan2(this.x,this.w),y:t*(Math.PI/2),x:0}}return {x:Bo(Math.atan2(2*(e*i+s*t),s*s-t*t-e*e+i*i)),y:Bo(Math.asin(-2*(t*i-s*e))),z:Bo(Math.atan2(2*(t*e+s*i),s*s+t*t-e*e-i*i))}}invert(){const{x:t,y:e,z:i,w:s}=this,n=t*t+e*e+i*i+s*s,o=n?1/n:0;return this.x=-t*o,this.y=-e*o,this.z=-i*o,this.w=s*o,this}multiply(t){const{x:e,y:i,z:s,w:n}=this,{x:o,y:r,z:a,w:l}=t;return this.x=e*l+n*o+i*a-s*r,this.y=i*l+n*r+s*o-e*a,this.z=s*l+n*a+e*r-i*o,this.w=n*l-e*o-i*r-s*a,this}normalize(){const{x:t,y:e,z:i,w:s}=this,n=t*t+e*e+i*i+s*s;return this.x/=n,this.y/=n,this.z/=n,this.w/=n,this}}function Uo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Bs(t)?new Lo(t,e,i,s):Lo.fromQuat(t)}function Oo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Lo.fromEuler(t,e,i)}class _o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;l(this,"x",void 0),l(this,"y",void 0),l(this,"z",void 0),this.x=t,this.y=e,this.z=i;}static fromPoint(t){return new _o(t.x,t.y,t.z)}static fromTwoPoint(t,e){var i,s,n,o,r,a;return new _o((null!==(i=e.x)&&void 0!==i?i:0)-(null!==(s=t.x)&&void 0!==s?s:0),(null!==(n=e.y)&&void 0!==n?n:0)-(null!==(o=t.y)&&void 0!==o?o:0),(null!==(r=e.z)&&void 0!==r?r:0)-(null!==(a=t.z)&&void 0!==a?a:0))}static fromValue(t,e,i){return new _o(t,e,i)}setFromVector(t){var e;this.x=t.x,this.y=t.y,this.z=null!==(e=t.z)&&void 0!==e?e:0;}clone(){return new _o(this.x,this.y,this.z)}norm(){return Math.hypot(this.x,this.y,this.z)}dot(t){var e;return this.x*t.x+this.y*t.y+this.z*(null!==(e=t.z)&&void 0!==e?e:0)}projectionTo(t){const e=Math.hypot(t.x,t.y,t.z);return this.dot(t)/e}angle(t){const e=this.norm()*Math.hypot(t.x,t.y,t.z),i=e&&this.dot(t)/e;return Math.acos(Us(i,-1,1))}equals(t){var e;return this.x===t.x&&this.y===t.y&&this.z===(null!==(e=t.z)&&void 0!==e?e:0)}distance(t){var e;return Math.hypot(this.x-t.x,this.y-t.y,this.z-(null!==(e=t.z)&&void 0!==e?e:0))}lerp(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:s,y:n,z:o}=this;return new _o(s+i*(t.x-s),n+i*(t.y-n),o+i*((null!==(e=t.z)&&void 0!==e?e:0)-o))}normalize(){const t=this,e=t.norm();return t.x/=e,t.y/=e,t.z/=e,this}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}cross(t){const e=this;return {x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x}}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}}function No(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Bs(t)?_o.fromValue(t,e,i):_o.fromPoint(t)}function Wo(t,e){return _o.fromTwoPoint(t,e)}class Fo{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;l(this,"x",void 0),l(this,"y",void 0),l(this,"z",void 0),this.x=t,this.y=e,this.z=i;}static fromPoint(t){return new Fo(t.x,t.y,t.z)}matrixTransform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{x:e,y:i,z:s}=this,{m11:n,m21:o,m31:r,m41:a,m12:l,m22:h,m32:d,m42:c,m13:u,m23:p,m33:g,m43:f,m14:m,m24:y,m34:v,m44:x}=t,w=m*e+y*i+v*s+x;return Ho({x:(n*e+o*i+r*s+a)/w,y:(l*e+h*i+d*s+c)/w,z:(u*e+p*i+g*s+f)/w})}setFromPoint(t){return this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this}clone(){return Ho(this)}equals(t){const{x:e=0,y:i=0,z:s=0}=t,n=this;return n.x===e&&n.y===i&&n.z===s}distanceTo(t){const{x:e=0,y:i=0,z:s=0}=t,n=this;return Math.hypot(n.x-e,n.y-i,n.z-s)}lerpTo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const{x:i=0,y:s=0,z:n=0}=t,o=this;return Ho({x:o.x+e*(i-o.x),y:o.y+e*(s-o.y),z:o.z+e*(n-o.z)})}footPointInSegment(t,e){const i=Wo(t,this),s=Wo(t,e),n=s.norm(),o=Ho(t);if(0===n)return o;const r=i.projectionTo(s)/n;return o.lerpTo(e,r)}perpendicularToSegment(t,e){const i=this.footPointInSegment(t,e);return this.distanceTo(i)}}function Ho(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Bs(t)?new Fo(t,e,i):new Fo(t.x,t.y,t.z)}const Vo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class zo{constructor(t){if(l(this,"a",1),l(this,"b",0),l(this,"c",0),l(this,"d",1),l(this,"e",0),l(this,"f",0),l(this,"m11",1),l(this,"m12",0),l(this,"m13",0),l(this,"m14",0),l(this,"m21",0),l(this,"m22",1),l(this,"m23",0),l(this,"m24",0),l(this,"m31",0),l(this,"m32",0),l(this,"m33",1),l(this,"m34",0),l(this,"m41",0),l(this,"m42",0),l(this,"m43",0),l(this,"m44",1),l(this,"is2D",void 0),t||(t=Vo),Ls(t));else {if(!Ss(t))throw new Error("Matrix4 error.");Xo(t,this);}}static fromQuat(t){const{x:e,y:i,z:s,w:n}=t,o=new zo;return o.m11=1-2*(i*i+s*s),o.m12=2*(e*i+s*n),o.m13=2*(e*s-i*n),o.m21=2*(e*i-s*n),o.m22=1-2*(e*e+s*s),o.m23=2*(i*s+e*n),o.m31=2*(e*s+i*n),o.m32=2*(i*s-e*n),o.m33=1-2*(e*e+i*i),o.setFromMatrix(o),o}static fromMatrix(t){const e=new zo;return e.setFromMatrix(t),e.is2D=!!t.is2D,e}static fromFloat32Array(t){const e=new zo;return Xo(t,e),e}static fromFloat64Array(t){const e=new zo;return Xo(t,e),e}get isIdentity(){const t=this.toArray();for(let e=0;e<16;e++)if(t[e]!==Vo[e])return !1;return !0}translate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.clone().translateSelf(t,e,i)}scale(t,e,i,s,n,o){var r,a,l,h,d;return null!==(r=t)&&void 0!==r||(t=1),null!==(a=e)&&void 0!==a||(e=1),null!==(l=s)&&void 0!==l||(s=0),null!==(h=n)&&void 0!==h||(n=0),null!==(d=o)&&void 0!==d||(o=0),Ts(e)&&(e=t),this.clone().scaleSelf(t,e,i,s,n,o)}scale3d(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().scale3dSelf(t,e,i,s)}rotate(t,e,i){var s;return null!==(s=t)&&void 0!==s||(t=0),this.clone().rotateSelf(t,e,i)}rotateFromVector(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().rotateFromVectorSelf(t,e)}rotateAxisAngle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().rotateAxisAngleSelf(t,e,i,s)}skewX(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewXSelf(t)}skewY(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewYSelf(t)}multiply(t){return this.clone().multiplySelf(t)}flipX(){return this.clone().multiplySelf(new zo([-1,0,0,1,0,0]))}flipY(){return this.clone().multiplySelf(new zo([1,0,0,-1,0,0]))}inverse(){return this.clone().invertSelf()}transformPoint(t){return Ho(t).matrixTransform(this)}toFloat32Array(){const t=this.toArray();return new Float32Array(t)}toFloat64Array(){const t=this.toArray();return new Float64Array(t)}toJSON(){}multiplySelf(){const t=Yo(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(t),this}preMultiplySelf(){const t=Yo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(t),this}translateSelf(){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const e=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s={m11:1,m21:0,m31:0,m41:t,m12:0,m22:1,m32:0,m42:e,m13:0,m23:0,m33:1,m43:i,m14:0,m24:0,m34:0,m44:1};return s}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t);return this.multiplySelf(e),t&&(this.is2D=!1),this}scaleSelf(t,e,i,s,n,o){var r,a,l,h,d;null!==(r=t)&&void 0!==r||(t=1),null!==(a=e)&&void 0!==a||(e=1),null!==(l=s)&&void 0!==l||(s=0),null!==(h=n)&&void 0!==h||(n=0),null!==(d=o)&&void 0!==d||(o=0),(s||n||o)&&this.translateSelf(s,n,o),Ts(e)&&(e=t);const c=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const s={m11:t,m21:0,m31:0,m41:0,m12:0,m22:e,m32:0,m42:0,m13:0,m23:0,m33:i,m43:0,m14:0,m24:0,m34:0,m44:1};return s}(t,e,i);return this.multiplySelf(c),this.translateSelf(-s,-n,-o),1!==i&&(this.is2D=!1),this}scale3dSelf(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.scaleSelf(t,t,t,e,i,s)}rotateSelf(t,e,i){var s,n,o;null!==(s=t)&&void 0!==s||(t=0),Ts(e)&&Ts(i)&&(i=t,t=0,e=0),null!==(n=e)&&void 0!==n||(e=0),null!==(o=i)&&void 0!==o||(i=0),0===t&&0===e||(this.is2D=!1);const r=Jo(i,[0,0,1]),a=Jo(e,[0,1,0]),l=Jo(t,[1,0,0]);return this.multiplySelf(r),this.multiplySelf(a),this.multiplySelf(l),this}rotateFromVectorSelf(){const t=No(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),e=No(1,0),i=Jo(t.angle(e),[0,0,1]);return this.multiplySelf(i),this}rotateAxisAngleSelf(){const t=Jo(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0]);return this.multiplySelf(t),this}skewXSelf(){const t=qo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return this.multiplySelf(t),this}skewYSelf(){const t=qo(0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0);return this.multiplySelf(t),this}invertSelf(){const t=function(t){if(t[0].length!==t.length)throw new Error;const e=$o(t),i=function(t){if(t[0].length!==t.length)throw new Error("Not square matrix.");const e=t.length,i=new Array(e).fill(0).map((t=>new Array(e).fill(0)));for(let s=0;s<e;s++)for(let n=0;n<e;n++)i[s][n]=Go(t,s,n);return function(t){const e=new Array(t.length).fill(0).map((e=>new Array(t[0].length).fill(0)));for(let i=0;i<e.length;i++)for(let s=0;s<e[0].length;s++)e[i][s]=t[s][i];return e}(i)}(t);for(let t=0;t<i.length;t++)for(let s=0;s<i.length;s++)i[t][s]/=e;return i}(this.toTwoDimensionalArray());return this.setFromTwoDimensionalArray(t),this}setMatrixValue(t){return new zo}setFromMatrix(t){const e=this;e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m21=t.m21,e.m22=t.m22,e.m23=t.m23,e.m24=t.m24,e.m31=t.m31,e.m32=t.m32,e.m33=t.m33,e.m34=t.m34,e.m41=t.m41,e.m42=t.m42,e.m43=t.m43,e.m44=t.m44,e.a=t.m11,e.b=t.m12,e.c=t.m21,e.d=t.m22,e.e=t.m41,e.f=t.m42,!1===t.is2D&&(e.is2D=!1);}setFromTwoDimensionalArray(t){const[[e,i,s,n],[o,r,a,l],[h,d,c,u],[p,g,f,m]]=t;this.setFromMatrix({m11:e,m21:i,m31:s,m41:n,m12:o,m22:r,m32:a,m42:l,m13:h,m23:d,m33:c,m43:u,m14:p,m24:g,m34:f,m44:m});}clone(){return zo.fromMatrix(this)}determinant(){return $o(this.toTwoDimensionalArray())}toTwoDimensionalArray(){const t=this;return [[t.m11,t.m21,t.m31,t.m41],[t.m12,t.m22,t.m32,t.m42],[t.m13,t.m23,t.m33,t.m43],[t.m14,t.m24,t.m34,t.m44]]}toArray(){const t=this;return [t.m11,t.m12,t.m13,t.m14,t.m21,t.m22,t.m23,t.m24,t.m31,t.m32,t.m33,t.m34,t.m41,t.m42,t.m43,t.m44]}decompose(){if(0===this.m44)return {};let t=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Bs(t)?new Ys(t,e,i,s):new Ys(t.x,t.y,t.z,t.w)}(0,0,0,1);const e=Uo(0,0,0,1),i=No(0,0,0),s=No(0,0,0),n=No(0,0,0),o=this;o.normalize();const r=o.clone();if(r.m14=0,r.m24=0,r.m34=0,r.m44=1,0===r.determinant())return !1;if(0!==o.m14||0!==o.m24||0!==o.m34){const e={x:o.m14,y:o.m24,z:o.m34,w:o.m44};t=r.invertSelf().transposeSelf().multiplyVector(e);}else t.x=0,t.y=0,t.z=0,t.w=1;n.x=o.m41,n.y=o.m42,n.z=o.m43;const a=[No(o.m11,o.m12,o.m13),No(o.m21,o.m22,o.m23),No(o.m31,o.m32,o.m33)];i.x=a[0].norm(),a[0].normalize(),s.x=a[0].dot(a[1]),a[1]=No(jo(a[1],a[0],1,-s.x)),i.y=a[1].norm(),a[1].normalize(),s.x/=i.y,s.y=a[0].dot(a[2]),a[2]=No(jo(a[2],a[0],1,-s.y)),s.z=a[1].dot(a[2]),a[2]=No(jo(a[2],a[1],1,-s.z)),i.z=a[2].norm(),a[2].normalize(),s.y/=i.z,s.z/=i.z;const l=a[1].cross(a[2]);let h;if(a[0].dot(l)<0&&(i.negate(),a[0].negate(),a[1].negate(),a[2].negate()),e.x=.5*Math.max(1+a[0].x-a[1].y-a[2].z,0)**.5,e.y=.5*Math.max(1-a[0].x+a[1].y-a[2].z,0)**.5,e.z=.5*Math.max(1-a[0].x-a[1].y+a[2].z,0)**.5,e.w=.5*Math.max(1+a[0].x+a[1].y+a[2].z,0)**.5,a[2].y>a[1].z&&(e.x*=-1),a[0].z>a[2].x&&(e.y*=-1),a[1].x>a[0].y&&(e.z*=-1),e.x<.001&&e.x>=0&&e.y<.001&&e.y>=0){const t=Math.atan2(a[0].y,a[0].x);h={x:0,y:0,z:Number(Bo(t).toFixed(3))};}else h=e.toEuler();return {rotation:h,scale:i,translation:n,skew:s,quaternion:e,perspective:t}}multiplyVector(t){const e=this,{x:i,y:s,z:n,w:o}=t;return {x:e.m11*i+e.m21*s+e.m31*n+e.m41*o,y:e.m12*i+e.m22*s+e.m32*n+e.m42*o,z:e.m13*i+e.m23*s+e.m33*n+e.m43*o,w:e.m14*i+e.m24*s+e.m34*n+e.m44*o}}transpose(){const t=this.clone();return t.transposeSelf(),t}transposeSelf(){const{m11:t,m21:e,m31:i,m41:s,m12:n,m22:o,m32:r,m42:a,m13:l,m23:h,m33:d,m43:c,m14:u,m24:p,m34:g,m44:f}=this;return this.setFromMatrix({m11:t,m21:n,m31:l,m41:u,m12:e,m22:o,m32:h,m42:p,m13:i,m23:r,m33:d,m43:g,m14:s,m24:a,m34:c,m44:f}),this}normalize(){const t=this,e=t.m44;t.m11/=e,t.m12/=e,t.m13/=e,t.m14/=e,t.m21/=e,t.m22/=e,t.m23/=e,t.m24/=e,t.m31/=e,t.m32/=e,t.m33/=e,t.m34/=e,t.m41/=e,t.m42/=e,t.m43/=e,t.m44/=e;}getTranslation(){return No(this.m41,this.m42,this.m43)}getRotation(){const t=this,e=.5*(t.m11+t.m22+t.m33+1)**.5;return Uo(.25*(t.m23-t.m32)/e,.25*(t.m31-t.m13)/e,.25*(t.m12-t.m21)/e,e)}getScaling(){const t=this;return No(Math.hypot(t.m11,t.m12,t.m13),Math.hypot(t.m21,t.m22,t.m23),Math.hypot(t.m31,t.m32,t.m33))}toEuler(){const t=this.getRotation().toEuler();return No(t.x,t.y,t.z)}}function jo(t,e,i,s){return {x:i*t.x+s*e.x,y:i*t.y+s*e.y,z:i*t.z+s*e.z}}function $o(t){if(t.length!==t[0].length)throw new Error;const e=t.length;let i=0;if(e>3)for(let s=0;s<e;s++)i+=t[0][s]*Go(t,0,s);else 3===e?i=t[0][0]*t[1][1]*t[2][2]+t[0][1]*t[1][2]*t[2][0]+t[0][2]*t[1][0]*t[2][1]-t[0][2]*t[1][1]*t[2][0]-t[0][1]*t[1][0]*t[2][2]-t[0][0]*t[1][2]*t[2][1]:2===e?i=t[0][0]*t[1][1]-t[0][1]*t[1][0]:1===e&&([[i]]=t);return i}function Go(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=t.length,n=new Array(s-1).fill(0).map((t=>new Array(s-1).fill(0)));for(let o=0;o<s-1;o++)for(let r=0;r<s-1;r++){const s=o<e?o:o+1,a=r<i?r:r+1;n[o][r]=t[s][a];}return (-1)**(e+i)*$o(n)}function Xo(t,e){const[i,s,n,o,r,a,l,h,d,c,u,p,g,f,m,y]=t;if(6===t.length)e.m11=i,e.m12=s,e.m21=n,e.m22=o,e.m41=r,e.m42=a,e.m13=0,e.m14=0,e.m23=0,e.m24=0,e.m31=0,e.m32=0,e.m34=0,e.m33=1,e.m44=1,e.is2D=!0;else {if(16!==t.length)throw new Error;e.m11=i,e.m12=s,e.m13=n,e.m14=o,e.m21=r,e.m22=a,e.m23=l,e.m24=h,e.m31=d,e.m32=c,e.m33=u,e.m34=p,e.m41=g,e.m42=f,e.m43=m,e.m44=y,e.is2D=!1;}}function Yo(t,e){const i={},{m11:s,m21:n,m31:o,m41:r,m12:a,m22:l,m32:h,m42:d,m13:c,m23:u,m33:p,m43:g,m14:f,m24:m,m34:y,m44:v}=t,{m11:x,m21:w,m31:b,m41:C,m12:S,m22:P,m32:A,m42:T,m13:k,m23:D,m33:E,m43:I,m14:R,m24:M,m34:B,m44:L}=e;return i.m11=s*x+n*S+o*k+r*R,i.m21=s*w+n*P+o*D+r*M,i.m31=s*b+n*A+o*E+r*B,i.m41=s*C+n*T+o*I+r*L,i.m12=a*x+l*S+h*k+d*R,i.m22=a*w+l*P+h*D+d*M,i.m32=a*b+l*A+h*E+d*B,i.m42=a*C+l*T+h*I+d*L,i.m13=c*x+u*S+p*k+g*R,i.m23=c*w+u*P+p*D+g*M,i.m33=c*b+u*A+p*E+g*B,i.m43=c*C+u*T+p*I+g*L,i.m14=f*x+m*S+y*k+v*R,i.m24=f*w+m*P+y*D+v*M,i.m34=f*b+m*A+y*E+v*B,i.m44=f*C+m*T+y*I+v*L,i}function Jo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1];t=Mo(t);const i=Math.sin(t/2)*Math.cos(t/2),s=Math.sin(t/2)**2,[n,o,r]=e;return {m11:1-2*(o**2+r**2)*s,m21:2*(n*o*s-r*i),m31:2*(n*r*s+o*i),m41:0,m12:2*(n*o*s+r*i),m22:1-2*(n**2+o**2)*s,m32:2*(o*r*s-n*i),m42:0,m13:2*(n*r*s-o*i),m23:2*(o*r*s+n*i),m33:1-2*(n**2+o**2)*s,m43:0,m14:0,m24:0,m34:0,m44:1}}function qo(t,e){const i=new zo;return t&&(i.m21=Math.tan(Mo(t))),e&&(i.m12=Math.tan(Mo(e))),i}class Zo{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;l(this,"x",void 0),l(this,"y",void 0),l(this,"z",void 0),l(this,"w",void 0),this.x=t,this.y=e,this.z=i,this.w=s;}negate(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1;}normalize(){const t=this.norm();this.x/=t,this.y/=t,this.z/=t,this.w/=t;}norm(){return Math.hypot(this.x,this.y,this.z,this.w)}}function Qo(t,e,i){const s=t.x-e.x,n=t.y-e.y;let o=(i.x-t.x)*s+(i.y-t.y)*n;o/=s*s+n*n;return new Fo(t.x+o*s,t.y+o*n)}function Ko(t,e,i,s){let n=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),o=t[0]*(s[1]-e[1])+e[0]*(t[1]-s[1])+s[0]*(e[1]-t[1]);return !((n^o)>=0&&0!==n&&0!==o)&&(n=i[0]*(t[1]-s[1])+s[0]*(i[1]-t[1])+t[0]*(s[1]-i[1]),o=i[0]*(e[1]-s[1])+s[0]*(i[1]-e[1])+e[0]*(s[1]-i[1]),!((n^o)>=0&&0!==n&&0!==o))}const tr=new class{recursiveUpdateHierarchy(t){const{transform:e,childNodes:i}=t;e.frozen||(e.frozen=!0,(e.localDirty||e.worldDirty)&&this.updateHierarchy(t),i.forEach((t=>{this.recursiveUpdateHierarchy(t);})));}querySelector(t,e){return t.startsWith("#")?e.find((e=>e.id===t.substring(1))):null}querySelectorAll(t,e){return []}append(t,e,i){t.parentNode&&this.remove(t),t.parentNode=e;const{childNodes:s,sortable:n}=e;void 0!==i?s.splice(i,0,t):s.push(t),n&&(n.dirty=!0);const{transform:o}=t;o&&this.dirtyWorld(t,o),o.frozen&&this.unfreezeParentToRoot(t);}remove(t){const{parentNode:e}=t;let i=!0;if(!e)return i=!1,i;const{sortable:s}=e;s&&(s.dirty=!0);const{childNodes:n}=e,o=n.indexOf(t);o>-1?(i=!0,n.splice(o,1)):i=!1;const{transform:r}=t;return r&&this.dirtyWorld(t,r),t.parentNode=null,i}isChildExist(t){const{parentNode:e}=t;if(!e)return !1;const{childNodes:i}=e;return !(i.indexOf(t)<0)}setOrigin(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Bs(e)&&(e=_o.fromValue(e,i));const{transform:s}=t;s.origin.equals(e)||(s.origin.setFromVector(e),this.dirtyLocal(t,s));}getOrigin(t){return t.transform.origin}setPosition(t,e){const{transform:i}=t,s=_o.fromValue(e.x,e.y,e.z||0),n=this.getPosition(t);if(s.equals(n))return;let o=this.getWorldTransform(t);const r=this.getPosition(t),a=s.x-r.x,l=s.y-r.y,h=s.z-r.z;if(i.position=s,t.hasParentTransform()){o=(new zo).translateSelf(a,l,h).multiply(o);const{worldTransform:e}=t.parentNode.transform,n=this.getWorldTransform(t);n.m41=s.x,n.m42=s.y,n.m43=s.z;const r=e.inverse().multiply(o),d=this.getOrigin(t),c=r.getScaling(),u=this.createScaleMatrix(c.x,c.y,c.z),p=zo.fromMatrix(u).inverse(),g=r.translate(d.x,d.y,d.z).multiply(p),f=g.getRotation(),m=zo.fromQuat(f).inverse(),y=g.multiply(m).getTranslation();y.x-=d.x,y.y-=d.y,y.z-=d.z,i.localPosition.setFromVector(y);}else i.localPosition=s;this.dirtyLocal(t,i);}setLocalPosition(t,e){const{transform:i}=t,s=_o.fromValue(e.x,e.y,e.z||0);s.equals(i.localPosition)||(i.localPosition=s,this.dirtyLocal(t,i));}getPosition(t){const e=this.getWorldTransform(t),{transform:i}=t,s=e.getTranslation();return i.position.setFromVector(s),t.transform.position}getLocalPosition(t){return t.transform.localPosition}translate(t,e){if(e.equals(new _o))return;const i=this.getPosition(t),s=this.getWorldTransform(t),n=s.getScaling(),o=this.createScaleMatrix(n.x,n.y,n.z),r=s.multiply(zo.fromMatrix(o).inverse()).getRotation(),a=zo.fromQuat(r).transformPoint(e);180===t.getAngle()&&(a.x=-a.x,a.y=-a.y),i.add(a),this.setPosition(t,i);}translateLocal(t,e){const{transform:i}=t;if(e.equals(new _o))return;e.multiply(i.localScale);const s=zo.fromQuat(i.localRotation).transformPoint(e);i.localPosition.add(s),this.dirtyLocal(t,i);}scaleLocal(t,e){const{transform:i}=t;i.localScale.multiply(e),this.dirtyLocal(t,i);}setLocalScale(t,e){const{transform:i}=t,s=_o.fromValue(e.x,e.y,e.z||i.localScale.z);s.equals(i.localScale)||(i.localScale=s,this.dirtyLocal(t,i));}getScale(t){const{transform:e}=t,i=this.getWorldTransform(t).getScaling();return e.scale.setFromVector(i),e.scale}getLocalScale(t){return t.transform.localScale}getRotation(t){const{transform:e}=t,i=this.getWorldTransform(t),s=i.getScaling(),n=this.createScaleMatrix(s.x,s.y,s.z),o=i.multiply(zo.fromMatrix(n).inverse()).getRotation();return e.rotation.setFromQuat(o),e.rotation}getLocalRotation(t){return t.transform.localRotation}rotate(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{transform:n}=t;if(Bs(e)&&(e=No(e,i,s)),t.hasParentTransform()){const i=Oo(e.x,e.y,e.z),s=this.getRotation(t),o=this.getRotation(t.parentNode).clone().invert().multiply(i).multiply(s).normalize();n.localRotation.setFromQuat(o),this.dirtyLocal(t,n);}else this.rotateLocal(t,e);}rotateLocal(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Bs(e)&&(e=No(e,i,s));const{transform:n}=t,o=Oo(e.x,e.y,e.z);n.localRotation.multiply(o),this.dirtyLocal(t,n);}setAngle(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Bs(e)&&(e=No(e,i,s));const{transform:n}=t;if(t.hasParentTransform()){const i=Oo(e.x,e.y,e.z);n.localRotation.setFromQuat(i);const s=this.getRotation(t.parentNode);s.invert(),n.localRotation.setFromQuat(s.multiply(n.localRotation)),this.dirtyLocal(t,n);}else this.setLocalAngle(t,e);}setLocalAngle(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Bs(e)&&(e=No(e,i,s));const{transform:n}=t,o=Oo(e.x,e.y,e.z);n.localRotation.setFromQuat(o),this.dirtyLocal(t,n);}setRotation(t,e){const{transform:i}=t;if(t.hasParentTransform()){let s=this.getRotation(t.parentNode);s=s.clone().invert().multiply(e).normalize(),i.localRotation.setFromQuat(s),this.dirtyLocal(t,i);}else this.setLocalRotation(t,e);}setLocalRotation(t,e){const{transform:i}=t;i.localRotation.setFromQuat(e),this.dirtyLocal(t,i);}getAngle(t){const e=this.getWorldTransform(t);return Lo.fromQuat(e.decompose().quaternion).toEuler()}getLocalAngle(t){return this.getLocalRotation(t).toEuler()}setLocalTransform(t,e){const i=this.getOrigin(t),{quaternion:s,rotation:n,scale:o}=e.decompose(),r=this.createScaleMatrix(o.x,o.y,o.z),a=zo.fromMatrix(r).inverse(),l=e.translate(i.x,i.y,i.z).multiply(a).getTranslation();l.x-=i.x,l.y-=i.y,l.z-=i.z,this.setLocalPosition(t,l),this.setLocalAngle(t,n.x,n.y,n.z),this.setLocalScale(t,o);}createScaleMatrix(){return {m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1}}resetLocalTransform(t){this.setLocalScale(t,new _o(1,1,1)),this.setLocalPosition(t,new _o(0,0,0)),this.setLocalAngle(t,0);}getWorldTransform(t){const{transform:e}=t;if(!e.worldDirty&&!e.localDirty)return e.worldTransform;const{parentNode:i}=t;return i&&i.transform&&this.getWorldTransform(i),this.updateHierarchy(t),e.worldTransform}getLocalTransform(t){const{transform:e}=t;return e.localDirty&&e.updateLocalTransform(),e.localTransform}getBounds(t,e){const{renderable:i,childNodes:s}=t;if(e&&!i.renderBoundsDirty&&i)return i.renderBounds;if(!e&&!i.boundsDirty&&i.bounds)return i.bounds;let n=this.getTransformedGeometryBounds(t,e);s.forEach((t=>{const i=this.getBounds(t,e);i&&(n?n.addBounds(i):n=Na.fromBounds(i));}));const{clipPath:o}=t.style;if(o){const e=this.getTransformedGeometryBounds(o,!0);let i=null;e&&(i=Na.create(),i.setFromTransformedBounds(this.getWorldTransform(t),e)),n?i&&(n=i.intersection(n)):n=i;}return e?(i.renderBoundsDirty=!1,n&&(i.renderBounds=n)):(i.boundsDirty=!1,n&&(i.bounds=n)),n||Na.create()}getLocalBounds(t){const{parentNode:e}=t;if(e){let i=new zo;if(e.transform){i=this.getWorldTransform(e).inverse();}const s=this.getBounds(t);if(!Na.isEmpty(s)){const t=Na.create();return t.setFromTransformedBounds(i,s),t}}return this.getBounds(t)}getGeometryBounds(t,e){const{geometry:i}=t;return (e?i.renderBounds:i.contentBounds)||Na.create()}getBoundingClientRect(t){var e;let i;const s=this.getGeometryBounds(t);Na.isEmpty(s)||(i=Na.create(),i.setFromTransformedBounds(this.getWorldTransform(t),s));const n=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView.getContextService().getBoundingClientRect();return i?{x:i.minX+((null==n?void 0:n.left)||0),y:i.minY+((null==n?void 0:n.top)||0),width:i.maxX-i.minX,height:i.maxY-i.minY}:{x:(null==n?void 0:n.left)||0,y:(null==n?void 0:n.top)||0,width:0,height:0}}updateHierarchy(t){const{transform:e}=t;if(e.localDirty&&e.updateLocalTransform(),e.worldDirty){var i;let s=null==t||null===(i=t.parentNode)||void 0===i?void 0:i.transform;t.parentNode&&s||(s=new nr),e.updateWorldTransform(s);}}getTransformedGeometryBounds(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.getGeometryBounds(t,e);if(!Na.isEmpty(i)){const e=Na.create();return this.getWorldTransform(t),e.setFromTransformedBounds(this.getWorldTransform(t),i),e}return null}dirtyLocal(t,e){e.localDirty||(e.localDirty=!0,e.worldDirty||this.dirtyWorld(t,e));}dirtyWorld(t,e){e.worldDirty||this.unfreezeParentToRoot(t),this.recursiveDirtyWorld(t,e),function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t;for(;i;){const{renderable:t}=i;t&&(t.boundsDirty=!0,t.renderBoundsDirty=!0),i=i.parentNode;}const s=new ko("bounds-changed",{affectChildren:e});t.dispatchEvent(s);}(t,!0);}recursiveDirtyWorld(t,e){if(e.worldDirty)return;e.worldDirty=!0,e.frozen=!1,t.childNodes.forEach((t=>{const{transform:e}=t;e.worldDirty||this.recursiveDirtyWorld(t,e);}));const{renderable:i}=t;i&&(i.boundsDirty=!0,i.renderBoundsDirty=!0);const s=new Qa("DOMAttrModified",t,null,null,"modelMatrix",Qa.MODIFICATION,null,null);t.dispatchEvent(s);}unfreezeParentToRoot(t){let e=t;for(;e;){const{transform:t}=e;t&&(t.frozen=!1),e=e.parentNode;}}};class er{constructor(){l(this,"contentBounds",void 0),l(this,"renderBounds",void 0);}}class ir{constructor(){l(this,"boundsDirty",!0),l(this,"bounds",void 0),l(this,"renderBoundsDirty",!0),l(this,"renderBounds",void 0);}isRenderable(){return this.boundsDirty||this.renderBoundsDirty}toRenderable(){this.boundsDirty=!0,this.renderBoundsDirty=!0;}}class sr{constructor(){l(this,"renderOrder",0),l(this,"lastSortedIndex",void 0),l(this,"sorted",void 0),l(this,"dirty",!1);}}let nr=class{constructor(){l(this,"frozen",!0),l(this,"worldDirty",!1),l(this,"localDirty",!1),l(this,"localRotation",Uo(0,0,0,1)),l(this,"rotation",Uo(0,0,0,1)),l(this,"localScale",No(1,1,1)),l(this,"scale",No(1,1,1)),l(this,"localPosition",No(0,0,0)),l(this,"position",No(0,0,0)),l(this,"localSkew",No(0,0,0)),l(this,"skew",No(0,0,0)),l(this,"origin",No(0,0,0)),l(this,"worldTransform",new zo),l(this,"localTransform",new zo);}updateLocalTransform(){const{origin:t,localScale:e,localPosition:i,localRotation:s,localSkew:n}=this,o=new zo;o.translateSelf(t.x,t.y,t.z);const r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Bs(t)?new Zo(t,e,i,s):new Zo(t.x,t.y,t.z,t.w)}(0,0,0,1),a=this.compose(r,i,s,n,e);o.multiplySelf(a),o.translateSelf(-t.x,-t.y,-t.z),this.localTransform.setFromMatrix(o),this.localDirty=!1;}updateWorldTransform(t){const e=t.worldTransform.clone();e.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(e),this.worldDirty=!1;}compose(t,e,i,s,n){const o=new zo;o.m14=t.x,o.m24=t.y,o.m34=t.z,o.m44=t.w,o.translateSelf(e.x,e.y,e.z);const r=zo.fromQuat(i);o.multiplySelf(r);const a=new zo;return s.z&&(a.m32=s.z,o.multiplySelf(a)),s.y&&(a.m32=0,a.m31=s.y,o.multiplySelf(a)),s.x&&(a.m31=0,a.m21=s.x,o.multiplySelf(a)),o.scaleSelf(n.x,n.y,n.z),o}};function or(t,e){if(Number.isNaN(e))return {unit:"px",value:0};if(fn(e))return {unit:"px",value:0};if(Bs(e))return {unit:"px",value:e};if(e=e.trim().toLowerCase(),Number.isFinite(Number(e))&&"px".search(t)>=0)return {unit:"px",value:Number(e)};const i=[];e=e.replace(t,(t=>(i.push(t),`U${t}`)));const s=`U(${t.source})`;return i.map((t=>({unit:t,value:Number(e.replace(new RegExp(`U${t}`,"g"),"").replace(new RegExp(s,"g"),"*0"))})))[0]}const rr=t=>or(/px|pt/g,t),ar=t=>or(/px|%|em/g,t),lr=t=>or(/deg|rad|grad|turn/g,t);class hr{constructor(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];l(this,"r",void 0),l(this,"g",void 0),l(this,"b",void 0),l(this,"alpha",void 0),l(this,"isNone",void 0),l(this,"formatted",""),this.r=t,this.g=e,this.b=i,this.alpha=s,this.isNone=n,this.formatted=`rgba(${t}, ${e}, ${i}, ${s})`;}clone(){return new hr(this.r,this.g,this.b,this.alpha)}}class dr{constructor(t,e){l(this,"type",void 0),l(this,"value",void 0),this.type=t,this.value=e;}clone(){return new dr(this.type,this.value)}}const cr={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},ur=t=>{let e;return e="angular"===t.type?Number(t.value):cr[t.value]||0,{value:e,unit:"deg"}},pr=t=>{if(t.includes("linear")||t.includes("radial")){return rn(t).map((t=>{let{type:e,orientation:i,colorStops:s}=t;!function(t){var e;const{length:i}=t;var s;t[i-1].length=null!==(e=t[i-1].length)&&void 0!==e?e:{type:"%",value:"100"},i>1&&(t[0].length=null!==(s=t[0].length)&&void 0!==s?s:{type:"%",value:"0"});let n=0,o=Number(t[0].length.value);for(let e=1;e<i;e++){var r;const i=null===(r=t[e].length)||void 0===r?void 0:r.value;if(!fn(i)&&!fn(o)){for(let s=1;s<e-n;s++)t[n+s].length={type:"%",value:`${o+(Number(i)-o)*s/(e-n)}`};n=e,o=Number(i);}}}(s);const n=s.map((t=>({offset:{value:t.length.value,unit:"%"},color:on(t)})));if("linear-gradient"===e)return new dr(1,{angle:i?ur(i):{value:0,unit:"deg"},steps:n});if("radial-gradient"===e){i||(i=[{type:"shape",value:"circle"}]);const t=i[0];if("shape"===(null==t?void 0:t.type)&&"circle"===(null==t?void 0:t.value)){const{cx:i,cy:s}=(t=>{let e=50,i=50,s="%",n="%";if("position"===(null==t?void 0:t.type)){const{x:o,y:r}=t.value;"position-keyword"===(null==o?void 0:o.type)&&("left"===o.value?e=0:"center"===o.value?e=50:"right"===o.value?e=100:"top"===o.value?i=0:"bottom"===o.value&&(i=100)),"position-keyword"===(null==r?void 0:r.type)&&("left"===r.value?e=0:"center"===r.value?i=50:"right"===r.value?e=100:"top"===r.value?i=0:"bottom"===r.value&&(i=100)),"px"!==(null==o?void 0:o.type)&&"%"!==(null==o?void 0:o.type)&&"em"!==(null==o?void 0:o.type)||(s=null==o?void 0:o.type,e=Number(o.value)),"px"!==(null==r?void 0:r.type)&&"%"!==(null==r?void 0:r.type)&&"em"!==(null==r?void 0:r.type)||(n=null==r?void 0:r.type,i=Number(r.value));}return {cx:{value:e,unit:s},cy:{value:i,unit:n}}})(null==t?void 0:t.at);let o;if(null!=t&&t.style){const{type:i,value:s}=t.style;o="extent-keyword"===i?s:{value:s,unit:e};}return new dr(2,{cx:i,cy:s,size:o,steps:n})}}}))}};function gr(t){const e=t.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(e[3]||"1"),s=Math.floor(i*parseInt(e[0],10)+255*(1-i)),n=Math.floor(i*parseInt(e[1],10)+255*(1-i)),o=Math.floor(i*parseInt(e[2],10)+255*(1-i));return `#${`0${s.toString(16)}`.slice(-2)}${`0${n.toString(16)}`.slice(-2)}${`0${o.toString(16)}`.slice(-2)}`}function fr(t){return /^hsla?\(.+\)$/i.test(t)}function mr(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(fn(t))return null;if("currentColor"===t&&(t="black"),"transparent"===t)return new hr(0,0,0,0);const e=pr(t);if(e)return e;if(fr){const e=document.createElement("div");e.style.color=t,t=e.style.color;}const i=ws(t),s=[0,0,0,0];return null!==i&&(s[0]=parseInt(i.r,10)||0,s[1]=parseInt(i.g,10)||0,s[2]=parseInt(i.b,10)||0,s[3]=parseFloat(i.opacity)),new hr(...s)}function yr(t){let e=null;Ss(t)&&(e=t),Ls(t)&&(e=t.split(" "));for(let t=0;t<3;t++)e[t]?e[t]=rr(e[t]).value:e[t]=0;const i=mr(e[3]);return e[3]=i?i.formatted:"black",e.slice(0,4)}function vr(t){const e=[];return Ls(t)?t.split(" ").forEach((t=>{const i=rr(t);i&&e.push(i.value);})):e.push(...t),1===e.length?[e[0],e[0]]:e}const xr=t=>{let e=t;if(Ls(t)){const i=ar(t);"%"===i.unit&&(e=i.value/100),"px"===i.unit&&(e=i.value);}return e>1&&(e=1),e},wr={visibility:"visible",x:0,y:0,zIndex:0,anchor:[0,0],lineDash:[0,0],opacity:1,fillOpacity:1,borderOpacity:1,miterLimit:10,lineDashOffset:0,lineJoin:"miter",lineCap:"butt",borderColor:"black",renderBlendMode:"normal"},br={color:"rgb(0,0,0)",fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",fontSize:20};function Cr(t){const e=[];return t.forEach((t=>{e.push({...br,...t,fontSize:rr(t.fontSize||br.fontSize)});})),e}function Sr(t,e,i,s){const{x:n=0,y:o=0}=i.parsedStyle,{x:r,y:a}=i.getLocalPosition();i.boundsDirty=!0,"x"===s&&n===r||"y"===s&&o===a||i.setLocalPosition(n,o);}function Pr(t,e,i){if(!(i instanceof Sa||i instanceof Pa||i instanceof va))return;if(t===e)return;i.pathDirty=!0,i.boundsDirty=!0,i.getPath();const{x:s,y:n}=i.getBoundingRect();i.updatePosition(s,n),i.updateOrigin();}function Ar(t,e,i){i instanceof Ta&&t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.setTextFont(),i.calculateTextPosition(),i.calculateLineWarp(),i.calculateCharPosition(),i.updateOrigin());}function Tr(t,e,i){!(i instanceof Aa)||i instanceof Ra||i instanceof ya||t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath(),i.updateOrigin());}function kr(t,e,i){(i instanceof ga||i instanceof fa||i instanceof ma)&&t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath());}function Dr(t,e,i){if(!(i instanceof Ea||i instanceof Pa))return;if(t===e)return;i.pathDirty=!0,i.boundsDirty=!0,i.getPath();const{x:s,y:n}=i.getBoundingRect();i.updatePosition(s,n),i.updateOrigin();}function Er(t,e,i){t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath());}function Ir(t,e,i){i instanceof Da&&t!==e&&(i.pathDirty=!0,i.boundsDirty=!0,i.getPath());}function Rr(t,e,i,s){i instanceof Ma&&t!==e&&(i.setLimitWidth(i.parsedStyle.width.value),i.pathDirty=!0,i.boundsDirty=!0,("freeTextWriter"!==i.textType||"freeTextWriter"===i.textType&&["width","textContents"].includes(s))&&i.calculateContentLines(),i.getPath(),null!=i&&i.isEditMode||i.updateOrigin());}function Mr(t,e,i,s,n){const o=n||[],r=t[e],a=t[i];let l=0,h=1;for(let s=e+1;s<i;s++){const e=Qo(r,a,t[s]),i=(d=e,c=t[s],((d.x-c.x)**2+(d.y-c.y)**2)**.5);i>l&&(l=i,h=s);}var d,c;return l>=s?(Mr(t,e,h,s,o),Mr(t,h,i,s,o)):(!o.length&&r&&o.push(r),o.push(a)),o}function Br(t,e,i,s,n,o){const r=function(t,e,i,s,n,o){const r=function(t,e,i){const s=Math.cos(t),n=Math.sin(t);return function(t,o){return {x:s*(t-e)+n*(o-i),y:-n*(t-e)+s*(o-i)}}}((p=n-t,g=o-e,Math.atan2(g,p)),(t+n)/2,(e+o)/2),a=r(t,e),l=r(i,s),h=r(n,o),d=Math.abs(a.x),[c,u]=[l.y/2,0].sort(((t,e)=>t-e));var p,g;let f,m;l.x>=a.x&&l.x<=h.y?[f,m]=[a.x,h.x]:l.x>0?[f,m]=[a.x,.5*(l.x+d*d/l.x)]:[f,m]=[.5*(l.x+d*d/l.x),h.x];return function(t,e,i){const s=r(t,e);return !(s.x<f-i||s.x>m+i)&&!(s.y<c-i||s.y>u+i)}}(t,e,i,s,n,o),{getDistance:a}=function(t,e,i,s,n,o){const r=[i-t,s-e],a=[t-2*i+n,e-2*s+o],l=[2*r[0],2*r[1]],h=1/Ur(a,a),d=h*Ur(r,a),c=d*d,u=Ur(r,r),p=3**.5,g=0===Ur(a,a)?function(t){return 0===u?0:Lr(-Ur(r,t)/2/u,0,1)}:function(t){const e=h*(2*u+Ur(t,a))/3,i=h*Ur(t,r),s=e-c,n=d*(2*c-3*e)+i;let o=n*n+4*(s*s*s);if(o>=0){o=Math.sqrt(o);const t=(o-n)/2,e=(-o-n)/2;return Lr(Math.sign(t)*Math.abs(t)**(1/3)+Math.sign(e)*Math.abs(e)**(1/3)-d,0,1)}const l=Math.sqrt(-s),g=Math.acos(n/(s*l*2))/3,f=Math.cos(g),m=Math.sin(g)*p;return [Lr((f+f)*l-d,0,1),Lr((-m-f)*l-d,0,1)]};return {getDistance(i,s){const n=[t-i,e-s],o=g(n);if("number"==typeof o)return Math.sqrt(Or((l[0]+a[0]*o)*o+n[0],(l[1]+a[1]*o)*o+n[1]));const[r,h]=o;return Math.sqrt(Math.min(Or(n[0]+(l[0]+a[0]*r)*r,n[1]+(l[1]+a[1]*r)*r),Or(n[0]+(l[0]+a[0]*h)*h,n[1]+(l[1]+a[1]*h)*h)))}}}(t,e,i,s,n,o);return {isHit:function(t,e){return function(t,e,i){return !!r(t,e,i)&&a(t,e)<=i}(t[0],t[1],e)}}}function Lr(t,e,i){return Math.min(Math.max(t,e),i)}function Ur(t,e){return t[0]*e[0]+t[1]*e[1]}function Or(t,e){return t*t+e*e}function _r(t,e,i,s,n){const{PI:o,cos:r,sin:a,min:l,max:h,tan:d}=Math;n-s>2*o&&(n=s+2*o);let c=h(o/12,(n-s)/12);const u=[];for(u.push({x:t+i*r(s),y:e+i*a(s)});s<n;){const o=t+i*r(s),h=e+i*a(s),p=l(n,s+c);c=l(n-s,c);const g=t+i*r(p),f=e+i*a(p),m=i*d(c/3),y={x:o-(h-e)/i*m,y:h+(o-t)/i*m},v={x:g+(f-e)/i*m,y:f-(g-t)/i*m},x={x:g,y:f};u.push(y,v,x),s+=c;}return u}function Nr(t,e,i,s){const n=t-i,o=t+i,r=e-s,a=e+s,l=.551915024494,h=l*i,d=l*s,c=[];return c.push({x:o,y:e}),c.push({x:o,y:e+d},{x:t+h,y:a},{x:t,y:a}),c.push({x:t-h,y:a},{x:n,y:e+d},{x:n,y:e}),c.push({x:n,y:e-d},{x:t-h,y:r},{x:t,y:r}),c.push({x:t+h,y:r},{x:o,y:e-d},{x:o,y:e}),c}function Wr(t,e){return {type:t,data:e}}function Fr(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t.length;if(i<=1)return [];const s=[],[n]=t;s.push(Wr("moveTo",[n]));for(let e=0;e+3<i;e+=3){const i=t[e+1],n=t[e+2],o=t[e+3];s.push(Wr("bezierCurveTo",[i,n,o]));}return e&&t.length>2&&s.push(Wr("lineTo",[n])),s}function Hr(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function Vr(t,e){const i=t.length;if(i<=1)return [];if(2===i)return [{index:0,ops:[Wr("moveTo",[t[0]])]},{index:1,ops:[Wr("lineTo",[t[1]])]}];let s=i-e;i<=e&&(s=0);const n=[];let o=[],r={index:s,ops:[]};if(n.push(r),i<=e){const e=Wr("moveTo",[t[0]]);r.ops.push(e),o=[...t];}else o=t.slice(-e);const a=function(t,e,i){const s=[];for(let n=1;n<t.length-1;n++){const o=180*Ca(wa(t[n-1],t[n]),wa(t[n],t[n+1]))/Math.PI;o>=e&&o<=i&&s.push(n);}return s}(o,45,135),l=[];for(let e=0;e<o.length;e++)if(a.includes(e)){const i=t[e-1],n=t[e+1],r=Hr(t[e],i),a=Hr(t[e],n);let h,d;r>6&&(h=Yr(i,t[e],.2),l.push({val:h})),l.push({index:e+s,val:o[e]}),a>6&&(d=Yr(n,t[e],.2),l.push({val:d}));}else l.push({index:e+s,val:o[e]});for(let t=0;t<l.length;t++){var h,d,c,u,p,g;const e=l[t],i=l[t].val,o=null!==(h=null===(d=l[t-1])||void 0===d?void 0:d.val)&&void 0!==h?h:i,a=null!==(c=null===(u=l[t+1])||void 0===u?void 0:u.val)&&void 0!==c?c:i,f=zr(o,i,a,null!==(p=null===(g=l[t+2])||void 0===g?void 0:g.val)&&void 0!==p?p:a);void 0!==e.index&&(e.index!==s&&(r={index:void 0,ops:[]},n.push(r)),r.index=e.index),r.ops.push(f);}return n}function zr(t,e,i,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;const o=Hr(e,i);let r={x:e.x+(i.x-t.x)/n,y:e.y+(i.y-t.y)/n},a={x:i.x-(s.x-e.x)/n,y:i.y-(s.y-e.y)/n};const l=Hr(r,e),h=Hr(a,i);l>o&&(r=Yr(r,e,o)),h>o&&(a=Yr(a,i,o));return Wr("bezierCurveTo",[r,a,i])}function jr(t,e,i){const s=(t.x+e.x)/2,n=(t.y+e.y)/2,o=(e.x+i.x)/2,r=(e.y+i.y)/2;return Wr("bezierCurveTo",[{x:s+2*(e.x-s)/3,y:n+2*(e.y-n)/3},{x:o+2*(e.x-o)/3,y:r+2*(e.y-r)/3},e])}function $r(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[];let[s]=t;i.push(Wr("moveTo",[s]));for(let e=1;e<t.length;e++)s=t[e],i.push(Wr("lineTo",[s]));return e&&t.length>2&&([s]=t,i.push(Wr("lineTo",[s]))),i}function Gr(t,e){const{data:i,type:s}=e,[n,o,r]=i;switch(s){case"moveTo":t.moveTo(n.x,n.y);break;case"lineTo":t.lineTo(n.x,n.y);break;case"bezierCurveTo":t.bezierCurveTo(n.x,n.y,o.x,o.y,r.x,r.y);break;case"quadraticCurveTo":t.quadraticCurveTo(n.x,n.y,o.x,o.y);}}function Xr(t){let{x:e,y:i}=t[0],s=e,n=i;for(let o=1;o<t.length;o++){const{x:r,y:a}=t[o];e=Math.min(e,r),s=Math.max(s,r),i=Math.min(i,a),n=Math.max(n,a);}return {left:e,top:i,right:s,bottom:n,width:s-e,height:n-i}}function Yr(t,e,i){const s=e.x-t.x,n=e.y-t.y,o=Math.abs(s)/Math.abs(n);let r=Math.sqrt(i*i/(o*o+1)),a=r*o;return 0===s&&(a=0,r=Math.sqrt(i)),0===n&&(r=0,a=Math.sqrt(i)),{x:e.x-(s>=0?a:-a),y:e.y-(n>=0?r:-r)}}function Jr(t){if(t.length<1)return [];const e=[];let i=[];for(let s=0;s<t.length;s++){const n=t[s];if(0===n.step)s>0&&e.push({step:i,close:t[s-1].close}),i=[],i.push(Wr("moveTo",[{x:n.x,y:n.y}]));else if(1===n.step)i.push(Wr("lineTo",[{x:n.x,y:n.y}]));else if(2===n.step&&s+2<t.length&&2===t[s+1].step&&2===t[s+2].step){const e=t[s+1],o=t[s+2];i.push(Wr("bezierCurveTo",[n,e,o])),s+=2;}}return e.push({step:i,close:t[t.length-1].close}),e}function qr(t){return 180*t/Math.PI}function Zr(t){return t<0?t%360+360:t%360}function Qr(t,e,i,s){return t/(i*i)+e/(s*s)}function Kr(t,e,i,s){let n=0,o=0,r=0,a=0;const l=[t,e],h=Xr(l),d=function(t,e,i,s){let n=s/2,o=s/2;const r=e.y-t.y,a=e.x-t.x;if(0===r||0===a)return [a,r];const l=-1/((e.y-t.y)/(e.x-t.x)),h=Math.atan(l);return "square"===i?(n=Math.sqrt(2)*s/2,o=Math.sqrt(2)*s/2):"round"===i?(n=s/2,o=s/2):(n=Math.abs(Math.cos(h)*s)/2,o=Math.abs(Math.sin(h)*s)/2),[n,o]}(l[0],l[1],s,i||0);return 0===d[1]?(n=h.left,o=h.top-i/2,r=h.width,a=h.height+i,"square"!==s&&"round"!==s||(n-=i/2,r+=i)):0===d[0]?(n=h.left-i/2,o=h.top,r=h.width+i,a=h.height,"square"!==s&&"round"!==s||(o-=i/2,a+=i)):(n=h.left-d[0],o=h.top-d[1],r=h.width+2*d[0],a=h.height+2*d[1]),{x:n,y:o,width:r,height:a}}function ta(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function ea(t,e,i,s){const{x:n,y:o}=t,{x:r,y:a}=e,{x:l,y:h}=s,d=Math.min(n,r),c=Math.max(n,r),u=Math.min(o,a),p=Math.max(o,a),g=i/2;return l>=d-g&&l<=c+g&&h>=u-g&&h<=p+g&&function(t,e,i,s,n,o){const r=[i-t,s-e];if(new _o(r[0],r[1]).equals({x:0,y:0}))return Math.sqrt((n-t)*(n-t)+(o-e)*(o-e));const a=[-r[1],r[0]],l=new _o(a[0],a[1]);l.normalize();const h=[n-t,o-e],d=new _o(h[0],h[1]);return Math.abs(d.dot(l))}(n,o,r,a,l,h)<=i/2}function ia(t,e,i,s,n){const o=t.length;if(o<2)return !1;for(let n=0;n<o-1;n++)if(ea(t[n],t[n+1],e,{x:i,y:s}))return !0;if(n){if(ea(t[0],t[o-1],e,{x:i,y:s}))return !0}return !1}function sa(t,e,i,s,n,o){return n>=t&&n<=t+i&&o>=e&&o<=e+s}function na(t,e,i,s,n,o){const r=o;let a=s.x,l=s.y,h=n.x,d=n.y;0===e&&(a=n.x,l=n.y,h=s.x,d=s.y);let c=Math.PI/2;const u=h-a>=0?1:-1,p=d-l>=0?1:-1;a!==h&&(c=Math.atan(Math.abs(d-l)/Math.abs(h-a)));const g=Math.cos(c),f=Math.sin(c),m=i?1:-1,y={x:h+7.8*m*r*g*u-4.5*r*f*u,y:d+7.8*m*r*f*p+4.5*r*g*p,step:0,close:!1},v={x:h,y:d,step:1,close:!1};i&&(v.x=h+r*m*g*u,v.y=d+r*m*f*p);const x={x:h+7.8*m*r*g*u+4.5*r*f*u,y:d+7.8*m*r*f*p-4.5*r*g*p,step:1,close:!1};t.push(y,v,x);}function oa(t,e,i,s,n,o){const r=o;let a=s.x,l=s.y,h=n.x,d=n.y;0===e&&(a=n.x,l=n.y,h=s.x,d=s.y);let c=Math.PI/2;const u=h-a>=0?1:-1,p=d-l>=0?1:-1;a!==h&&(c=Math.atan(Math.abs(d-l)/Math.abs(h-a)));const g=Math.cos(c),f=Math.sin(c),m=i?1:-1,y={x:h+7.8*m*r*g*u-4.5*r*f*u,y:d+7.8*m*r*f*p+4.5*r*g*p,step:0,close:!1},v={x:h,y:d,step:1,close:!1};i&&(v.x=h+r*m*g*u,v.y=d+r*m*f*p);const x={x:h+7.8*m*r*g*u+4.5*r*f*u,y:d+7.8*m*r*f*p-4.5*r*g*p,step:1,close:!0};t.push(y,v,x);}function ra(t,e,i,s,n){const o=n;let r=i.x,a=i.y,l=s.x,h=s.y;0===e&&(r=s.x,a=s.y,l=i.x,h=i.y);let d=Math.PI/2;const c=l-r>=0?1:-1,u=h-a>=0?1:-1;r!==l&&(d=Math.atan(Math.abs(h-a)/Math.abs(l-r)));const p=Math.cos(d),g=Math.sin(d),f={x:l-3*o*g*c,y:h+3*o*p*u,step:0,close:!1},m={x:l+3*o*g*c,y:h-3*o*p*u,step:1,close:!1};t.push(f,m);}function aa(t,e,i,s,n){const o=n;let r=i.x,a=i.y,l=s.x,h=s.y;0===e&&(r=s.x,a=s.y,l=i.x,h=i.y);let d=Math.PI/2;const c=l-r>=0?1:-1,u=h-a>=0?1:-1,p=h>=a&&l>=r||h<=a&&l<=r?-1:1;r!==l&&(d=Math.atan(Math.abs(h-a)/Math.abs(l-r)));const g=Math.cos(d),f=Math.sin(d),m=4.5*Math.sqrt(3)*o,y={x:l+4.5*o*g*c-m*f*c*p,y:h+4.5*o*f*u+m*g*u*p,step:0,close:!1},v={x:l-4.5*o*g*c+m*f*c*p,y:h-4.5*o*f*u-m*g*u*p,step:1,close:!1};t.push(y,v);}function la(t,e,i,s,n){const o=n;let{x:r,y:a}=s;0===e&&(r=i.x,a=i.y);const l={x:r-3*o,y:a-3*o,step:0,close:!1},h={x:r+3*o,y:a-3*o,step:1,close:!1},d={x:r+3*o,y:a+3*o,step:1,close:!1},c={x:r-3*o,y:a+3*o,step:1,close:!0};t.push(l,h,d,c);}function ha(t,e,i,s,n){const o=n;let{x:r,y:a}=s;0===e&&(r=i.x,a=i.y);const l={x:r-3*o,y:a,step:0,close:!1},h={x:r,y:a-3*o,step:1,close:!1},d={x:r+3*o,y:a,step:1,close:!1},c={x:r,y:a+3*o,step:1,close:!0};t.push(l,h,d,c);}function da(t,e,i,s,n){const o=n;let{x:r,y:a}=s;0===e&&(r=i.x,a=i.y);const l=3*o-0*o,h=Nr(r,a,l,l);h.forEach(((e,i)=>{const s=0===i?0:2,n=i===h.length-1,o={x:e.x,y:e.y,step:s,close:n};t.push(o);}));}class ca{constructor(t){l(this,"lineAlign",void 0),l(this,"owner",void 0),this.owner=t,this.reset();}reset(){this.lineAlign=.5;}get x(){return this.owner.getAttribute("x")}set x(t){this.owner.setAttribute("x",t);}get y(){return this.owner.getAttribute("y")}set y(t){this.owner.setAttribute("y",t);}get r(){return this.owner.getAttribute("r")}set r(t){this.owner.setAttribute("r",t);}get width(){return this.owner.getAttribute("width")}set width(t){this.owner.setAttribute("width",t);}get height(){return this.owner.getAttribute("height")}set height(t){this.owner.setAttribute("height",t);}get points(){return this.owner.getAttribute("points")}set points(t){this.owner.setAttribute("points",t);}get origin(){return this.owner.getAttribute("origin")}set origin(t){this.owner.setAttribute("origin",t);}get anchor(){return this.owner.getAttribute("anchor")}set anchor(t){this.owner.setAttribute("anchor",t);}get visibility(){return this.owner.getAttribute("visibility")}set visibility(t){this.owner.setAttribute("visibility",t);}get zIndex(){return this.owner.getAttribute("zIndex")}set zIndex(t){this.owner.setAttribute("zIndex",t);}get borderWidth(){return this.owner.getAttribute("borderWidth")}set borderWidth(t){this.owner.setAttribute("borderWidth",t);}get borderColor(){return this.owner.getAttribute("borderColor")}set borderColor(t){this.owner.setAttribute("borderColor",t);}get opacity(){return this.owner.getAttribute("opacity")}set opacity(t){this.owner.setAttribute("opacity",t);}get fillOpacity(){return this.owner.getAttribute("fillOpacity")}set fillOpacity(t){this.owner.setAttribute("fillOpacity",t);}get borderOpacity(){return this.owner.getAttribute("borderOpacity")}set borderOpacity(t){this.owner.setAttribute("borderOpacity",t);}get background(){return this.owner.getAttribute("background")}set background(t){this.owner.setAttribute("background",t);}get clipPath(){return this.owner.getAttribute("clipPath")}set clipPath(t){this.owner.setAttribute("clipPath",t);}get cursor(){return this.owner.getAttribute("cursor")}set cursor(t){this.owner.setAttribute("cursor",t);}get hitArea(){return this.owner.getAttribute("hitArea")}set hitArea(t){this.owner.setAttribute("hitArea",t);}get pointerEvents(){return this.owner.getAttribute("pointerEvents")}set pointerEvents(t){this.owner.setAttribute("pointerEvents",t);}get miterLimit(){return this.owner.getAttribute("miterLimit")}set miterLimit(t){this.owner.setAttribute("miterLimit",t);}get roundedRadius(){return this.owner.getAttribute("roundedRadius")}set roundedRadius(t){this.owner.setAttribute("roundedRadius",t);}get lineCap(){return this.owner.getAttribute("lineCap")}set lineCap(t){this.owner.setAttribute("lineCap",t);}get lineJoin(){return this.owner.getAttribute("lineJoin")}set lineJoin(t){this.owner.setAttribute("lineJoin",t);}get lineDash(){return this.owner.getAttribute("lineDash")}set lineDash(t){this.owner.setAttribute("lineDash",t);}get lineDashOffset(){return this.owner.getAttribute("lineDashOffset")}set lineDashOffset(t){this.owner.setAttribute("lineDashOffset",t);}get shadow(){return this.owner.getAttribute("shadow")}set shadow(t){this.owner.setAttribute("shadow",t);}get shadowOffsetX(){return this.owner.getAttribute("shadowOffsetX")}set shadowOffsetX(t){this.owner.setAttribute("shadowOffsetX",t);}get shadowOffsetY(){return this.owner.getAttribute("shadowOffsetY")}set shadowOffsetY(t){this.owner.setAttribute("shadowOffsetY",t);}get shadowBlur(){return this.owner.getAttribute("shadowBlur")}set shadowBlur(t){this.owner.setAttribute("shadowBlur",t);}get shadowColor(){return this.owner.getAttribute("shadowColor")}set shadowColor(t){this.owner.setAttribute("shadowColor",t);}get startAngle(){return this.owner.getAttribute("startAngle")}set startAngle(t){this.owner.setAttribute("startAngle",t);}get endAngle(){return this.owner.getAttribute("endAngle")}set endAngle(t){this.owner.setAttribute("endAngle",t);}get rx(){return this.owner.getAttribute("rx")}set rx(t){this.owner.setAttribute("rx",t);}get ry(){return this.owner.getAttribute("ry")}set ry(t){this.owner.setAttribute("ry",t);}get img(){return this.owner.getAttribute("img")}set img(t){this.owner.setAttribute("img",t);}get src(){return this.owner.getAttribute("src")}set src(t){this.owner.setAttribute("src",t);}get text(){return this.owner.getAttribute("text")}set text(t){this.owner.setAttribute("text",t);}get wordWarp(){return this.owner.getAttribute("wordWarp")}set wordWarp(t){this.owner.setAttribute("wordWarp",t);}get wordBreak(){return this.owner.getAttribute("wordBreak")}set wordBreak(t){this.owner.setAttribute("wordBreak",t);}get textMaxWidth(){return this.owner.getAttribute("textMaxWidth")}set textMaxWidth(t){this.owner.setAttribute("textMaxWidth",t);}get letterSpacing(){return this.owner.getAttribute("letterSpacing")}set letterSpacing(t){this.owner.setAttribute("letterSpacing",t);}get textBaseLine(){return this.owner.getAttribute("textBaseLine")}set textBaseLine(t){this.owner.setAttribute("textBaseLine",t);}get textTransform(){return this.owner.getAttribute("textTransform")}set textTransform(t){this.owner.setAttribute("textTransform",t);}get color(){return this.owner.getAttribute("color")}set color(t){this.owner.setAttribute("color",t);}get fontStyle(){return this.owner.getAttribute("fontStyle")}set fontStyle(t){this.owner.setAttribute("fontStyle",t);}get fontVariant(){return this.owner.getAttribute("fontVariant")}set fontVariant(t){this.owner.setAttribute("fontVariant",t);}get fontWeight(){return this.owner.getAttribute("fontWeight")}set fontWeight(t){this.owner.setAttribute("fontWeight",t);}get fontSize(){return this.owner.getAttribute("fontSize")}set fontSize(t){this.owner.setAttribute("fontSize",t);}get lineHeight(){return this.owner.getAttribute("lineHeight")}set lineHeight(t){this.owner.setAttribute("lineHeight",t);}get fontFamily(){return this.owner.getAttribute("fontFamily")}set fontFamily(t){this.owner.setAttribute("fontFamily",t);}get startPoint(){return this.owner.getAttribute("startPoint")}set startPoint(t){this.owner.setAttribute("startPoint",t);}get endPoint(){return this.owner.getAttribute("endPoint")}set endPoint(t){this.owner.setAttribute("endPoint",t);}get lineEnding(){return this.owner.getAttribute("lineEnding")}set lineEnding(t){this.owner.setAttribute("lineEnding",t);}get segments(){return this.owner.getAttribute("segments")}set segments(t){this.owner.setAttribute("segments",t);}get stampPoints(){return this.owner.getAttribute("stampPoints")}set stampPoints(t){this.owner.setAttribute("stampPoints",t);}get imageData(){return this.owner.getAttribute("imageData")}set imageData(t){this.owner.setAttribute("imageData",t);}get iconName(){return this.owner.getAttribute("iconName")}set iconName(t){this.owner.setAttribute("iconName",t);}get textContents(){return this.owner.getAttribute("textContents")}set textContents(t){this.owner.setAttribute("textContents",function(t){const e=[];return t.forEach((t=>{t.content.length&&e.push(t);})),e}(t));}get textAlign(){return this.owner.getAttribute("textAlign")}set textAlign(t){this.owner.setAttribute("textAlign",t);}get renderBlendMode(){return this.owner.getAttribute("renderBlendMode")}set renderBlendMode(t){this.owner.setAttribute("renderBlendMode",t);}}const ua=new class{constructor(){l(this,"parsers",void 0),l(this,"updaters",void 0),this.parsers=new Map,this.updaters=new Map,this.initParser(),this.initUpdater();}getStyleParser(t){return this.parsers.get(t)}getStyleUpdaters(t){return this.updaters.get(t)}initParser(){this.bindHandler(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth","roundedRadius"],rr,void 0),this.bindHandler(["startAngle","endAngle"],lr,void 0),this.bindHandler(["r","rx","ry","width","height","fontSize"],rr,void 0),this.bindHandler(["borderColor","background","shadowColor","color"],mr,void 0),this.bindHandler(["opacity","fillOpacity","borderOpacity"],xr,void 0),this.bindHandler(["lineDash"],vr,void 0),this.bindHandler(["shadow"],yr,void 0),this.bindHandler(["textContents"],Cr,void 0);}initUpdater(){this.bindHandler(["borderWidth"],void 0,Er),this.bindHandler(["x","y"],void 0,Sr),this.bindHandler(["width","height"],void 0,Tr),this.bindHandler(["r","rx","ry","startAngle","endAngle"],void 0,kr),this.bindHandler(["points","segments"],void 0,Pr),this.bindHandler(["startPoint","endPoint","lineEnding"],void 0,Dr),this.bindHandler(["text","textTransform","textBaseLine","x","y","width","wordWarp","lineHeight","fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,Ar),this.bindHandler(["stampPoints"],void 0,Ir),this.bindHandler(["width","height","textContents","textAlign","borderWidth"],void 0,Rr);}bindHandler(t,e,i){for(let s=0;s<t.length;s++)if(e&&this.parsers.set(t[s],e),i){const e=this.updaters.get(t[s])||[];e.push(i),this.updaters.set(t[s],e);}}};class pa extends Do{constructor(t){super(),l(this,"attributes",{}),l(this,"id",void 0),l(this,"pageUid",void 0),l(this,"index",void 0),l(this,"name",void 0),l(this,"renderable",new ir),l(this,"sortable",new sr),l(this,"geometry",new er),l(this,"transform",new nr),l(this,"parsedStyle",{}),l(this,"style",void 0),l(this,"isDestroyed",!1),l(this,"childNodes",[]),l(this,"nodeName",""),l(this,"nodeType",0),l(this,"nodeValue",null),l(this,"ownerDocument",null),l(this,"parentNode",null),l(this,"isConnected",!1),l(this,"textContent",void 0),l(this,"shapeType",void 0),l(this,"config",void 0),l(this,"path",void 0),l(this,"steps",void 0),l(this,"pathDirty",!0),l(this,"boundsDirty",!0),l(this,"bounds",void 0),l(this,"strokePath",void 0),l(this,"strokeSteps",void 0),l(this,"externalMatrices",[]),l(this,"clippable",!1),l(this,"imageData",null),this.config=t,this.id=t.id||t.uid||"",this.name=t.name||"",this.index=t.index,this.nodeName=t.type||"container",this.pageUid=t.pageUid||"",(t.className||t.class)&&(this.className=t.className||t.class),this.style=new ca(this),this.initAttributes(t);}static isNode(t){return !!t.childNodes}set className(t){this.setAttribute("class",t);}get className(){return this.getAttribute("class")||""}get classList(){return this.className.split(" ").filter((t=>""!==t))}get tagName(){return this.nodeName}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}get firstChild(){return this.childNodes.length>0?this.childNodes[0]:null}get lastChild(){const{childNodes:t}=this;return t.length>0?t[t.length-1]:null}get nextSibling(){const{parentNode:t}=this;if(t){const e=t.childNodes.indexOf(this);return t.childNodes[e+1]}return null}get parentElement(){return this.parentNode}get previousSibling(){const{parentNode:t}=this;if(t){const e=t.childNodes.indexOf(this);return t.childNodes[e-1]}return null}getAttribute(t){const e=this.attributes[t];return null==e?null:e}getElementsByName(t){return tr.querySelectorAll(`[name="${t}"]`,this)}getElementsByClassName(t){return tr.querySelectorAll(`.${t}`,this)}getElementsByTagName(t){return tr.querySelectorAll(t,this)}hasAttribute(t){return Object.keys(this.attributes).indexOf(t)>-1}removeAttribute(t){this.setAttribute(t,null),delete this.attributes[t];}appendChild(t,e){tr.append(t,this,e);const i=new ko("child-inserted",{child:t});this.dispatchEvent(i);const s=new Qa("DOMNodeInserted",this,"","","",0,"","");return t.dispatchEvent(s),t}cloneNode(t){return null}insertBefore(t,e){if(e){const i=this.childNodes.indexOf(e);this.appendChild(t,i-1);}else this.appendChild(t);return t}removeChild(t){const e=new Qa("removed",this,"","","",0,"","");t.dispatchEvent(e);const i=new ko("child-removed",{child:t});return this.dispatchEvent(i),tr.remove(t),t}isChildExist(t){return tr.isChildExist(t)}replaceChild(t,e){const i=this.childNodes.indexOf(e);return this.removeChild(e),this.appendChild(t,i),e}destroy(){const t=new ko("destroy",{});this.dispatchEvent(t),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0;}after(){const{parentNode:t}=this;if(t){const n=t.childNodes.indexOf(this);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];i.forEach(((e,i)=>{null==t||t.appendChild(e,n+i+1);}));}}before(){const{parentNode:t}=this;if(t){const n=t.childNodes.indexOf(this);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];i.forEach(((e,i)=>{null==t||t.appendChild(e,n+i);}));}}remove(){this.parentNode&&this.parentNode.removeChild(this);}replaceWith(){this.after(...arguments),this.remove();}append(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((t=>{this.appendChild(t);}));}prepend(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(((t,e)=>{this.appendChild(t,e);}));}querySelector(t){return tr.querySelector(t,this)}querySelectorAll(t){return tr.querySelectorAll(t,this)}find(t){let e=null;return this.recursiveCall((i=>!(i!==this||!t(i))&&(e=i,!0))),e}findAll(t){const e=[];return this.recursiveCall((i=>{i===this&&t(i)&&e.push(i);})),e}contains(t){let e=t;for(;e&&this!==e;)e=e.parentNode;return !!e}getRootNode(t){return this.parentNode?this.parentNode.getRootNode(t):this}hasChildNodes(){return this.childNodes.length>0}isEqualNode(t){return this===t}isSameNode(t){return this.isEqualNode(t)}normalize(){throw new Error("Method to be implemented")}recursiveCall(t){t(this)||this.childNodes.forEach((e=>{e.recursiveCall(t);}));}hasParentTransform(){return !(!this.parentNode||!this.parentNode.transform)}getGeometryBounds(){return tr.getGeometryBounds(this)}getRenderBounds(){return tr.getBounds(this,!0)}getBounds(){return tr.getBounds(this)}getLocalBounds(){return tr.getLocalBounds(this)}getBoundingClientRect(){return tr.getBoundingClientRect(this)}get isVisible(){return "visible"===this.parsedStyle.visibility}get isInteractive(){return "none"!==this.parsedStyle.pointerEvents}get width(){return this.parsedStyle.width.value*Math.abs(this.getScale().x)}get height(){return this.parsedStyle.height.value*Math.abs(this.getScale().y)}initAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const e in t)if(mn(e,t)){if("style"===e)continue;this.attributes[e]=t[e];}for(const e in t.style)mn(e,t.style)&&(this.parseStyleProperty(e,t.style[e]),this.attributes[e]=t.style[e]);this.renderable.toRenderable();}setAttribute(t,e){if(Ts(e))return;const i="x"===t||"y"===t,s=this.attributes[t];(e!==this.attributes[t]||i)&&(this.attributes[t]=e,Object.keys(this.config).includes(t)||(this.parseStyleProperty(t,e),this.updateStyleProperty(t,s,e)));}parseStyleProperty(t,e){const i=ua.getStyleParser(t);this.parsedStyle[t]=i?i(e,this,t):e;}updateStyleProperty(t,e,i){const s=ua.getStyleUpdaters(t);s&&s.forEach((s=>{s(e,i,this,t);}));}toFront(){const{parentNode:t}=this;if(t){const e=Math.max(...t.children.map((t=>t.style.zIndex)));this.style.zIndex=e+1;}return this}toBack(){const{parentNode:t}=this;if(t){const e=Math.min(...t.children.map((t=>t.style.zIndex)));this.style.zIndex=e-1;}return this}setOrigin(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return tr.setOrigin(this,t,e),this}getOrigin(){return tr.getOrigin(this)}setPosition(t){return tr.setPosition(this,t),this}setLocalPosition(t){const e=No(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return tr.setLocalPosition(this,e),this}getPosition(){return tr.getPosition(this)}getLocalPosition(){return tr.getLocalPosition(this)}translate(t){const e=No(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return tr.translate(this,e),this}translateLocal(t){const e=No(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return tr.translateLocal(this,e),this}scale(t,e,i){return this.scaleLocal(t,e,i)}scaleLocal(t,e,i){return Bs(t)&&(t=No(t,e=e||t,i=i||t)),tr.scaleLocal(this,t),this}setLocalScale(t,e,i){return Bs(t)&&(t=No(t,e=e||t,i=i||t)),tr.setLocalScale(this,t),this}getScale(){return tr.getScale(this)}getLocalScale(){return tr.getLocalScale(this)}rotate(t,e,i){return Ts(e)&&Ts(i)?tr.rotate(this,0,0,t):tr.rotate(this,t,e,i),this}rotateLocal(t,e,i){return Ts(e)&&Ts(i)?tr.rotateLocal(this,0,0,t):tr.rotateLocal(this,t,e,i),this}setAngle(t){return tr.setAngle(this,0,0,t),this}setLocalAngle(t){const e=t%360;return 180===Math.abs(e)&&(t-=.001),tr.setLocalAngle(this,0,0,t),this}getAngle(){return tr.getAngle(this).z}getLocalAngle(){return tr.getLocalAngle(this).z}getLocalTransform(){return tr.getLocalTransform(this)}getWorldTransform(){return tr.getWorldTransform(this)}setLocalTransform(t){return tr.setLocalTransform(this,t),this}resetLocalTransform(){tr.resetLocalTransform(this);}getPath(){}getBoundingRect(){return {x:0,y:0,width:0,height:0}}isPointInPath(t){return !1}updateStyle(t){Object.keys(t).forEach((e=>{mn(e,t)&&(this.style[e]=t[e]);}));}updatePosition(t,e){this.style.x=t||0,this.style.y=e||0;}updateOrigin(){const{width:t,height:e}=this.getBoundingRect();this.setOrigin(t/2,e/2);}getBoundingRectObject(){const{x:t,y:e,width:i,height:s}=this.getBoundingRect();return new Aa({style:{x:t,y:e,width:i,height:s,borderWidth:1,background:"transparent"}})}}class ga extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"arc",style:{...wr,r:0,startAngle:0,endAngle:1.5*Math.PI,...t},...e}),l(this,"shapeType","arc");const{x:i,y:s}=this.parsedStyle;this.setLocalPosition(i,s),this.updateOrigin();}normAngle(){const{startAngle:t,endAngle:e}=this.style;let i=lr(t).value,s=lr(e).value;if(i>s){const t=i;i=s,s=t;}if(Math.abs(s-i)>=2*Math.PI-1e-5&&(i=0,s=2*Math.PI),i<-2*Math.PI||s<-2*Math.PI){const t=Math.max(Math.floor(i/(-2*Math.PI)),Math.floor(s/(-2*Math.PI)));i+=2*Math.PI*t,s+=2*Math.PI*t;}if(i>2*Math.PI||s>2*Math.PI){const t=Math.max(Math.floor(i/(2*Math.PI)),Math.floor(s/(2*Math.PI)));i-=2*Math.PI*t,s-=2*Math.PI*t;}this.parsedStyle.startAngle=lr(i),this.parsedStyle.endAngle=lr(s);}updateOrigin(){const{width:t,height:e,x:i,y:s}=this.getBoundingRect(),n=i-this.style.x+t/2,o=s-this.style.y+e/2;this.setOrigin(n,o);}getPath(){if(!this.pathDirty)return this.path;this.normAngle();const{r:t,borderWidth:e,startAngle:i,endAngle:s}=this.parsedStyle,n=.5*((null==e?void 0:e.value)||0),o=i.value,r=s.value;return this.path=_r(0,0,t.value-n,o,r),this.steps=Fr(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,r:i,startAngle:s,endAngle:n,borderWidth:o}=this.parsedStyle,r=i.value,a=s.value,l=n.value;null==o||o.value;if(s===n)return {x:t-r-0,y:e-r-0,width:2*r+0,height:2*r+0};const{sin:h,cos:d,PI:c}=Math,u=[t+r*d(a),t+r*d(l)],p=[e+r*h(a),e+r*h(l)];return a<0&&l>0&&u.push(t+r),(a<.5*c&&l>.5*c||a<-1.5*c&&l>-1.5*c)&&p.push(e+r),(a<c&&l>c||a<-c&&l>-c)&&u.push(t-r),(a<1.5*c&&l>1.5*c||a<-.5*c&&l>-.5*c)&&p.push(e-r),u.sort(((t,e)=>t-e)),p.sort(((t,e)=>t-e)),this.boundsDirty=!1,this.bounds={x:u[0]-0,y:p[0]-0,width:u[u.length-1]-u[0]+0,height:p[p.length-1]-p[0]+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{x:i,y:s,r:n,startAngle:o,endAngle:r,background:a,borderWidth:l}=this.parsedStyle,h=Zr(qr(o.value)),d=Zr(qr(r.value)),c=Zr(qr(o.value+r.value)/2),u=Ls(this.style.background)&&""!==this.style.background,p=l&&l.value,g=u?0:e,f=(l.value+g||0)/2,m=n.value-f,y=new Fo(i+m*Math.cos(h*Math.PI/180),s+m*Math.sin(h*Math.PI/180)),v=new Fo(i+m*Math.cos(d*Math.PI/180),s+m*Math.sin(d*Math.PI/180)),x=new Fo(i+m*Math.cos(c*Math.PI/180),s+m*Math.sin(c*Math.PI/180)),w=new Fo(t.x,t.y),b=w.distanceTo({x:i,y:s}),C=Ko([y.x,y.y],[x.x,x.y],[w.x,w.y],[i,s]),S=Ko([v.x,v.y],[x.x,x.y],[w.x,w.y],[i,s]),P=Ko([y.x,y.y],[v.x,v.y],[w.x,w.y],[i,s]);if(b>m+f)return !1;const A=ea(y,v,2*f,t);if(d-h<180&&d-h>0||d-h<-180){if(a&&P||A)return !0;if(!a&&p&&b>=m-f&&b<=m+f&&P)return !0}else if(180===Math.abs(d-h)){if(a){if(C||S)return !0;if(function(t,e,i,s){const{x:n,y:o}=t,{x:r,y:a}=e,{x:l,y:h}=i,{x:d,y:c}=s;return !(((d-n)*(a-o)-(c-o)*(r-n))*((l-n)*(a-o)-(h-o)*(r-n))<=0||((d-l)*(a-h)-(c-h)*(r-l))*((n-l)*(a-h)-(o-h)*(r-l))<=0||((d-n)*(h-o)-(c-o)*(l-n))*((r-n)*(h-o)-(a-o)*(l-n))<=0)}(y,x,v,t))return !0}if(!a&&p&&b>=m-f&&b<=m+f&&(C||S))return !0}else {if(a){if(C||S)return !0;if(!P)return !0}if(!a&&p&&b>=m-f&&b<=m+f&&(C||S))return !0}return !!A}}class fa extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"circle",style:{...wr,r:0,anchor:[.5,.5],...t},...e}),l(this,"shapeType","circle");const{x:i,y:s}=this.parsedStyle;this.setLocalPosition(i,s),this.updateOrigin();}updateOrigin(){this.setOrigin(0,0);}getPath(){if(!this.pathDirty)return this.path;const{r:t,borderWidth:e}=this.parsedStyle;let i=.5*((null==e?void 0:e.value)||0);return t.value===i&&(i=0),this.path=_r(0,0,t.value-i,0,2*Math.PI),this.steps=Fr(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,r:i}=this.parsedStyle,s=i.value;return this.boundsDirty=!1,this.bounds={x:t-s-0,y:e-s-0,width:2*s+0,height:2*s+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{x:i,y:s,r:n,background:o,borderWidth:r}=this.parsedStyle,a=Ls(this.style.background)&&""!==this.style.background,l=r&&r.value,h=a?0:e,d=(r.value+h||0)/2,c=n.value-d,u=new Fo(t.x,t.y).distanceTo({x:i,y:s});return o&&l?u<=c+d:o?u<=c:!!l&&(u>=c-d&&u<=c+d)}}let ma=class extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"ellipse",style:{...wr,rx:"",ry:"",borderWidth:0,anchor:[.5,.5],...t},...e}),l(this,"shapeType","ellipse");const{x:i,y:s}=this.parsedStyle;this.setLocalPosition(i,s),this.updateOrigin();}updateOrigin(){this.setOrigin(0,0);}getPath(){if(!this.pathDirty)return this.path;const{rx:t,ry:e,borderWidth:i}=this.parsedStyle,s=.5*i.value;return this.path=Nr(0,0,t.value-s,e.value-s),this.steps=Fr(this.path),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,rx:i,ry:s}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t-i.value-0,y:e-s.value-0,width:2*i.value+0,height:2*s.value+0},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{x:i,y:s,rx:n,ry:o,borderWidth:r}=this.parsedStyle,a=Ls(this.style.background)&&""!==this.style.background,l=r&&r.value,h=a?0:e,d=(r.value||0)/2,c=n.value-d,u=o.value-d,p=(t.x-i)*(t.x-i),g=(t.y-s)*(t.y-s);return a&&l?Qr(p,g,c+d,u+d)<=1:a?Qr(p,g,c,u)<=1:!!l&&(Qr(p,g,c-d-h/2,u-d-h/2)>=1&&Qr(p,g,c+d+h/2,u+d+h/2)<=1)}},ya=class extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"image",style:{...wr,width:0,height:0,img:"",...t},...e}),l(this,"shapeType","image"),l(this,"meteData",void 0),this.meteData=(null==e?void 0:e.metadata)||null;const{x:i,y:s}=this.parsedStyle;this.setLocalPosition(i,s),this.updateOrigin();}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:s}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:s.value},this.bounds}isPointInPath(t){return this.getBoundingRectObject().isPointInPath(t)}},va=class extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"ink",style:{...wr,segments:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4,...t},...e}),l(this,"shapeType","ink"),l(this,"inkPaths",[]),l(this,"inkSteps",[]),l(this,"inkRenderPaths",[]),l(this,"inkOriginalRenderPath",void 0),l(this,"inkRenderSteps",[]),l(this,"initialRect",void 0),l(this,"useDouglasPeucker",!0),l(this,"douglasPeuckerPoints",[]),l(this,"partDirty",!1),l(this,"optimizedOpSteps",[]),l(this,"positionDirty",!1),this.getPath(),this.initialRect=this.getBoundingRect(),this.updatePosition(this.initialRect.x,this.initialRect.y),this.setOrigin(this.initialRect.width,this.initialRect.height);}addSegment(){const{segments:t}=this.style;t[t.length-1].length&&this.style.segments.push([]);}addPoint(t){const e=[...this.style.segments],i=this.style.segments.length,s=e[i-1],n=s[s.length-1];if((null==n?void 0:n.x)!==t.x||(null==n?void 0:n.y)!==t.y){this.partDirty=!0;const s=this.getBoundingRect(),n=this.parsedStyle.borderWidth.value/2;(t.x<s.x+n||t.y<s.y+n)&&(this.positionDirty=!0),e[i-1].push(t),this.style.segments=e;const o=this.getBoundingRect();(t.x<o.x||t.y<o.y||t.x>o.x+o.width||t.y>o.y+o.height)&&(this.boundsDirty=!0);}}getPath(){if(!this.pathDirty&&!this.partDirty)return this.path;const{segments:t}=this.parsedStyle;if(this.partDirty){const e=t.length;if(e>1)for(let i=0;i<e-1;i++){const e=t[i];if(!this.optimizedOpSteps[i]){let t=[...e];1===t.length?t=this.offsetPoints(e[0],.1):(t=Mr(t,0,t.length-1,1),t.length<=3&&t.push({...t[t.length-1]}));const s=Vr(t,t.length).map((t=>t.ops)).flat(2);this.optimizedOpSteps[i]=s;}if(this.positionDirty||!this.inkRenderSteps[i]){const t=this.getRenderStep(this.optimizedOpSteps[i]);this.inkRenderSteps[i]=t;}}let i=t[e-1];1===i.length?i=this.offsetPoints(i[0],.1):i.length<=3&&i.push(i[i.length-1]),i=this.getRenderPath(i);const s=function(t){const e=t.length;if(e<=1)return [];if(2===e)return [Wr("moveTo",[t[0]]),Wr("lineTo",[t[1]])];const i=[Wr("moveTo",[t[0]])];for(let s=0;s<e-1;s++){const e=t[s-1]||t[s],n=t[s],o=t[s+1]||t[s];i.push(jr(e,n,o));}return i}(i);this.inkRenderSteps[e-1]=s;}else this.pathDirty&&(this.reset(),t.forEach(((t,e)=>{if(0===t.length)return;let i=[...t];1===t.length?i=this.offsetPoints(t[0],.1):(i=Mr(i,0,i.length-1,1),i.length<=3&&i.push({...i[i.length-1]})),this.inkPaths[e]=i;const s=Vr(i,i.length);this.inkSteps[e]=s.map((t=>t.ops)).flat(2);const n=this.getRenderPath(i),o=Vr(n,n.length).map((t=>t.ops)).flat(2);this.inkRenderSteps[e]=o;})));return this.pathDirty=!1,this.partDirty=!1,this.positionDirty=!1,this.path}offsetPoints(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;const{x:i,y:s}=t;return [{x:i-e,y:s-e},{x:i+e,y:s-e},{x:i+e,y:s+e},{x:i-e,y:s+e}]}getRenderStep(t){return t.map((t=>({...t,data:this.getRenderPath(t.data)})))}getInkOriginalRenderPath(){if(!this.pathDirty&&this.inkOriginalRenderPath)return;const{segments:t}=this.parsedStyle,e=[];for(let i=0;i<t.length;i++){const s=this.getRenderPath(t[i]);e.push(s);}this.inkOriginalRenderPath=e;}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),s=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||s.push({x:t.x-e,y:t.y-i});})),s}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t}=this.parsedStyle,e=[],i=[];this.parsedStyle.segments.forEach((t=>{t.forEach((t=>{t&&(e.push(t.x),i.push(t.y));}));}));const{min:s,max:n}=xa(e),{min:o,max:r}=xa(i),a=t.value/2;return this.boundsDirty=!1,this.bounds={x:s-a,y:o-a,width:n-s+2*a,height:r-o+2*a},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{borderWidth:i}=this.parsedStyle;for(let s=0;s<this.inkSteps.length;s++){const n=this.inkSteps[s];for(let s=1;s<n.length;s+=2){const o=n[s-1].data[0],r=n[s].data[0],a=n[s].data[1];if(Br(o.x,o.y,r.x,r.y,a.x,a.y).isHit([t.x,t.y],i.value+e))return !0}}return !1}reset(){this.inkPaths=[],this.inkSteps=[],this.inkRenderPaths=[],this.inkRenderSteps=[];}};function xa(t){if(0===t.length)return {min:void 0,max:void 0};let e=t[0],i=t[0];for(let s=1;s<t.length;s++)t[s]<e&&(e=t[s]),t[s]>i&&(i=t[s]);return {min:e,max:i}}function wa(t,e){return {x:e.x-t.x,y:e.y-t.y}}function ba(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function Ca(t,e){const i=function(t,e){return t.x*e.x+t.y*e.y}(t,e),s=ba(t),n=ba(e);return Math.acos(i/(s*n))}let Sa=class extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"polygon",style:{...wr,points:[{x:0,y:0},{x:10,y:10}],miterLimit:4,borderWidth:2,...t},...e}),l(this,"shapeType","polygon"),l(this,"renderPath",void 0),0===this.parsedStyle.points.length&&(this.style.points=[{x:0,y:0},{x:10,y:10}]);const{x:i,y:s,width:n,height:o}=this.getBoundingRect();this.updatePosition(i,s),this.setOrigin(n/2,o/2);}addPoint(t){const e=[...this.style.points];e.push(t),this.style.points=e;}updatePoints(){const{renderPath:t}=this,e=this.getLocalPosition(),i=[];t.forEach((t=>{i.push({x:t.x+e.x,y:t.y+e.y});})),this.style.points=i;}getPath(){if(!this.pathDirty)return this.path;const{x:t,y:e}=this.getBoundingRect();return this.path=this.parsedStyle.points,this.renderPath=this.parsedStyle.points.map((i=>({x:i.x-t,y:i.y-e}))),this.steps=$r(this.renderPath,!0),this.pathDirty=!1,this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,points:e,lineCap:i}=this.parsedStyle;if(2===e.length)return this.boundsDirty=!1,this.bounds=Kr(e[0],e[1],t.value,i),this.bounds;const s=Xr(e),n=t.value/2||0;return this.boundsDirty=!1,this.bounds={x:s.left-n,y:s.top-n,width:s.width+2*n,height:s.height+2*n},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{borderWidth:i,points:s}=this.parsedStyle,n=Ls(this.style.background)&&""!==this.style.background,o=n?0:e;let r=!1;return i&&i.value&&(r=ia(s,i.value+o,t.x,t.y,!0)),!r&&n&&(r=function(t,e,i){let s=!1;const n=t.length;if(n<=2)return !1;for(let l=0;l<n;l++){const h=t[l],d=t[(l+1)%n];if(r=d,((a={x:e,y:i}).x-(o=h).x)*(r.y-o.y)==(r.x-o.x)*(a.y-o.y)&&Math.min(o.x,r.x)<=a.x&&a.x<=Math.max(o.x,r.x)&&Math.min(o.y,r.y)<=a.y&&a.y<=Math.max(o.y,r.y))return !0;ta(h.y-i)>0!=ta(d.y-i)>0&&ta(e-(i-h.y)*(h.x-d.x)/(h.y-d.y)-h.x)<0&&(s=!s);}var o,r,a;return s}(s,t.x,t.y)),r}},Pa=class extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"polyline",style:{...wr,points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:4,...t},...e}),l(this,"shapeType","polyline"),l(this,"renderPath",void 0),this.getPath();const{x:i,y:s}=this.getBoundingRect();this.updatePosition(i,s),this.updateOrigin();}initPath(){const {points:t,lineEnding:e}=this.parsedStyle,s=[];if(t.forEach(((t,e)=>{0===e?s.push({x:t.x,y:t.y,step:0,close:!1}):s.push({x:t.x,y:t.y,step:1,close:!1});})),e&&s.length>1)for(let t=0;t<e.length;t++)switch(e[t]){case"OpenArrow":this.addOpenArrow(s,t,!1);break;case"ROpenArrow":this.addOpenArrow(s,t,!0);break;case"ClosedArrow":this.addCloseArrow(s,t,!1);break;case"RClosedArrow":this.addCloseArrow(s,t,!0);break;case"Butt":this.addButt(s,t);break;case"Slash":this.addSlash(s,t);break;case"Square":this.addSquare(s,t);break;case"Diamond":this.addDiamond(s,t);break;case"Circle":this.addCircle(s,t);}return s}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),s=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||s.push({x:t.x-e,y:t.y-i,step:t.step,close:t.close});})),s}addPoint(t){const e=[...this.style.points];e.push(t),this.style.points=e;}updatePoints(){const{length:t}=this.parsedStyle.points,e=this.getLocalPosition(),i=[];this.renderPath.slice(0,t).forEach((t=>{i.push({x:t.x+e.x,y:t.y+e.y});})),this.style.points=i;}updatePoint(){const t=this.getLocalPosition(),e=this.parsedStyle.points.length,i=[];for(let s=0;s<e;s++)i.push({x:this.renderPath[s].x+t.x,y:this.renderPath[s].y+t.y});this.updateStyle({points:i});}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=Jr(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,lineCap:e}=this.parsedStyle;if(2===this.path.length)return this.boundsDirty=!1,this.bounds=Kr(this.path[0],this.path[1],t.value,e),this.bounds;const i=Xr(this.path),s=t.value/2;return this.boundsDirty=!1,this.bounds={x:i.left-s,y:i.top-s,width:i.width+2*s,height:i.height+2*s},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{borderWidth:i,points:s}=this.parsedStyle;return ia(s,i.value+e,t.x,t.y,!1)}isLineArrow(){const{lineEnding:t}=this.parsedStyle;return !!t&&("None"!==t[0]||"None"!==t[1])}addOpenArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:s,borderWidth:n}=this.parsedStyle,{length:o}=s;let r=s[o-2],a=s[o-1];0===e&&(r={...s[0]},a={...s[1]}),na(t,e,i,r,a,n.value);}addCloseArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{points:s,borderWidth:n}=this.parsedStyle,{length:o}=s;let r=s[o-2],a=s[o-1];0===e&&(r={...s[0]},a={...s[1]}),oa(t,e,i,r,a,n.value);}addCircle(t,e){const{points:i,borderWidth:s}=this.parsedStyle,{length:n}=i;da(t,e,i[0],i[n-1],s.value);}addDiamond(t,e){const{points:i,borderWidth:s}=this.parsedStyle,{length:n}=i;ha(t,e,i[0],i[n-1],s.value);}addSquare(t,e){const{points:i,borderWidth:s}=this.parsedStyle,{length:n}=i;la(t,e,i[0],i[n-1],s.value);}addSlash(t,e){const{points:i,borderWidth:s}=this.parsedStyle,{length:n}=i;let o=i[n-2],r=i[n-1];0===e&&(o={...i[0]},r={...i[1]}),aa(t,e,o,r,s.value);}addButt(t,e){const{points:i,borderWidth:s}=this.parsedStyle,{length:n}=i;let o=i[n-2],r=i[n-1];0===e&&(o={...i[0]},r={...i[1]}),ra(t,e,o,r,s.value);}},Aa=class extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"rect",style:{...wr,width:0,height:0,...t},...e}),l(this,"shapeType","rect");const{x:i,y:s}=this.parsedStyle;this.setLocalPosition(i,s),this.updateOrigin();}getPath(){if(!this.pathDirty)return this.path;const{width:t,height:e,borderWidth:i}=this.parsedStyle,s=(null==i?void 0:i.value)||0,n=s,o=s,r=t.value-2*s,a=e.value-2*s;return this.path=[{x:n,y:o},{x:n+r,y:o},{x:n+r,y:o+a},{x:n,y:o+a}],this.steps=$r(this.path),this.pathDirty=!1,this.path}getStrokePath(){const{width:t,height:e,borderWidth:i}=this.parsedStyle,s=.5*((null==i?void 0:i.value)||0),n=s,o=s,r=t.value-2*s,a=e.value-2*s;this.strokePath=[{x:n,y:o},{x:n+r,y:o},{x:n+r,y:o+a},{x:n,y:o+a}],this.strokeSteps=$r(this.strokePath);}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:s}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:s.value},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:i,y:s,borderWidth:n,width:o,height:r}=this.parsedStyle,a=Ls(this.style.background)&&""!==this.style.background,l=n&&n.value,h=e/2;return a?sa(i,s,o.value,r.value,t.x,t.y):!!l&&function(t,e,i,s,n,o,r){return sa(t,e,i,n,o,r)||sa(t,e,n,s,o,r)||sa(t,e+s-n,i,n,o,r)||sa(t+i-n,e,n,s,o,r)}(i-h,s-h,o.value+e,r.value+e,n.value+e,t.x,t.y)}},Ta=class extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"text",style:{...wr,text:"",width:300,wordWarp:!0,wordBreak:!0,textAlign:"left",textBaseLine:"top",textTransform:"none",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontFamily:"Microsoft YaHei",color:"white",fontSize:12,lineHeight:1,letterSpacing:0,...t},...e}),l(this,"shapeType","text"),l(this,"font",void 0),l(this,"lines",[]),l(this,"chars",[]),l(this,"underlines",[]),l(this,"strikeouts",[]),l(this,"textX",void 0),l(this,"textY",void 0),l(this,"rowWidth",void 0),l(this,"realWidth",void 0),l(this,"totalHeight",void 0),this.setTextFont(),this.calculateTextPosition(),this.calculateLineWarp(),this.calculateCharPosition();const{x:i,y:s}=this.parsedStyle;this.setLocalPosition(i,s),this.updateOrigin();}setTextFont(){const{fontStyle:t,fontVariant:e,fontWeight:i,fontFamily:s,fontSize:n}=this.parsedStyle;this.font=`${t} ${e} ${i} ${n.value}${n.unit} ${s}`;}updateOrigin(){if(!this.chars[0])return;const{width:t,height:e}=this.getBoundingRect(),i=this.chars[0].height/10||0,s=this.chars[0].height/2||0;let n=0;switch(this.parsedStyle.textBaseLine){case"top":n=e/2-i;break;case"hanging":n=e/2;break;case"middle":n=-i+s*(this.lines.length-1);break;case"ideographic":n=1.5*-i+s*(this.lines.length-2);break;case"bottom":n=-i+s*(this.lines.length-2);break;default:n=i+s*(this.lines.length-2);}this.setOrigin(t/2-i,n);}calculateTextPosition(){const{x:t,y:e,width:i,letterSpacing:s,borderWidth:n}=this.parsedStyle,o=((null==n?void 0:n.value)||0)/2;this.textX=t+o+s.value,this.textY=e+o+s.value,this.rowWidth=i.value-2*o-2*s.value;}calculateLineWarp(){this.totalHeight=0,this.realWidth=0;const{textX:t,rowWidth:e,parsedStyle:i}=this,{lineHeight:s,wordWarp:n,fontSize:o,borderWidth:r}=i,a=document.createElement("canvas").getContext("2d");a.font=this.font;const l=Math.max(o.value,s),h=this.transformText(this.parsedStyle.text);h.length||(this.lines=[],this.totalHeight=0);let d=0;if(h.length){const i=[];let{textY:s}=this,o="";for(let r=0;r<h.length;r++){const c=h.charAt(r);if("\n"!==c&&"\r"!==c){if(o+=c,a.measureText(o).width>=e&&n){if(o=o.substring(0,o.length-1),""===o){o=c;continue}d+=o.length;const e=a.measureText(o).width;e>this.realWidth&&(this.realWidth=a.measureText(o).width),i.push({text:o,x:t,y:s,lineWidth:e,length:o.length,sum:d}),o=c,s+=l,this.totalHeight+=l;}}else {const e=a.measureText(o).width;e>this.realWidth&&(this.realWidth=a.measureText(o).width),o+=c,d+=o.length,i.push({text:o,x:t,y:s,lineWidth:e,length:o.length,sum:d}),o="",s+=l,this.totalHeight+=l;}}if(""!==o){d+=o.length;const e=a.measureText(o).width;e>this.realWidth&&(this.realWidth=a.measureText(o).width),i.push({text:o,x:t,y:s,lineWidth:e,length:o.length,sum:d});}this.totalHeight+=l,this.lines=i;}1===this.lines.length&&(this.realWidth=a.measureText(this.lines[0].text).width),r&&r.value&&(this.realWidth+=r.value);}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,textBaseLine:i,fontSize:s,lineHeight:n}=this.parsedStyle,o=s.value>n?s.value:n,r=ka(i,e,o),a=o/10;return this.boundsDirty=!1,this.bounds={x:t-a,y:r-a,width:this.realWidth+2*a,height:this.totalHeight},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getBoundingRectObject().isPointInPath(t,e)}calculateCharPosition(){this.chars=[];const{lines:t}=this,{fontSize:e,textBaseLine:i}=this.parsedStyle,s=document.createElement("canvas").getContext("2d"),n=e.value;s.font=this.font;let o=0;t.forEach(((t,e)=>{let r=t.x;for(let a=0;a<t.text.length;a++){const l=t.text.charAt(a);let{width:h}=s.measureText(l);"\n"!==l&&"\r"!==l||(h=.1),this.chars.push({char:l,index:o+a+1,charIndex:a+1,lineIndex:e,x:r,y:ka(i,t.y,n),width:h,height:n}),r+=s.measureText(l).width,a===t.text.length-1&&(o+=t.text.length);}}));}getCharByPosition(t,e){const i={x:t,y:e};for(let t=0;t<this.chars.length;t++){if(this.getCharBoundingRect(t).isPointInPath(i))return this.chars[t]}return null}getCharBoundingRect(t){const{x:e,y:i,width:s,height:n}=this.chars[t];return new Aa({style:{x:e,y:i-n/10,width:s,height:n,borderWidth:1,background:"transparent"}})}transformText(t){const{textTransform:e}=this.parsedStyle;switch(e){case"capitalize":t=t[0].toUpperCase()+t.substring(1);break;case"uppercase":t.toLowerCase();break;case"lowercase":t.toUpperCase();}return t}getRelativeYAxis(t){const{height:e}=this.chars[0];return t-this.getTextBaseLineOffset(e)}getTextBaseLineOffset(t){const{textBaseLine:e}=this.parsedStyle,i=t/10;let s;switch(e){case"top":s=i;break;case"hanging":s=0;break;case"middle":s=t/2+i;break;case"ideographic":s=t+1*i;break;case"bottom":s=t+.5*i;break;default:s=t-1.5*i;}return s}};function ka(t,e,i){let s;const n=i/10;switch(t){case"top":s=e-.5*n;break;case"hanging":s=e+.5*n;break;case"middle":s=e-i/2-.5*n;break;case"ideographic":s=e-i-.5*n;break;case"bottom":s=e-i;break;default:s=e+2*n-i;}return s}class Da extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"stampPath",style:{...wr,stampPoints:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4,...t},...e}),l(this,"shapeType","stampPath"),l(this,"renderPath",void 0),this.getPath();}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),s=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||s.push({x:t.x-e,y:t.y-i,step:t.step});})),s}getPath(){return this.pathDirty?(this.path=this.parsedStyle.stampPoints,this.renderPath=this.getRenderPath(this.path),this.steps=function(t){if(t.length<1)return [];const e=[];for(let i=0;i<t.length;i++){const s=t[i];if(0===s.step)e.push(Wr("lineTo",[s]));else if(1===s.step){if(i+2<t.length&&1===t[i+1].step&&1===t[i+2].step){const n=t[i+1],o=t[i+2];e.push(Wr("bezierCurveTo",[s,n,o])),i+=2;}}else 2===s.step&&e.push(Wr("moveTo",[s]));}return e}(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,stampPoints:e,lineCap:i}=this.parsedStyle;if(2===e.length)return this.boundsDirty=!1,this.bounds=Kr(e[0],e[1],t.value,i),this.bounds;const s=Xr(e),n=t.value/2;return this.boundsDirty=!1,this.bounds={x:s.left-n,y:s.top-n,width:s.width+2*n,height:s.height+2*n},this.bounds}}let Ea=class extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"line",style:{...wr,startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:["None","None"],borderWidth:2,...t},...e}),l(this,"shapeType","line"),l(this,"renderPath",void 0),this.getPath();const{x:i,y:s}=this.getBoundingRect();this.updatePosition(i,s),this.updateOrigin();}initPath(){const{startPoint:t,endPoint:e,lineEnding:i}=this.parsedStyle,s=[{...t,step:0,close:!1},{...e,step:1,close:!1}];if(i)for(let t=0;t<i.length;t++)switch(i[t]){case"OpenArrow":this.addOpenArrow(s,t,!1);break;case"ROpenArrow":this.addOpenArrow(s,t,!0);break;case"ClosedArrow":this.addCloseArrow(s,t,!1);break;case"RClosedArrow":this.addCloseArrow(s,t,!0);break;case"Butt":this.addButt(s,t);break;case"Slash":this.addSlash(s,t);break;case"Square":this.addSquare(s,t);break;case"Diamond":this.addDiamond(s,t);break;case"Circle":this.addCircle(s,t);}return s}getRenderPath(t){const{x:e,y:i}=this.getBoundingRect(),s=[];return t.forEach((t=>{!t||Number.isNaN(t.x)||Number.isNaN(t.y)||s.push({x:t.x-e,y:t.y-i,step:t.step,close:t.close});})),s}updatePoints(){const t=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+t.x,y:this.renderPath[0].y+t.y},endPoint:{x:this.renderPath[1].x+t.x,y:this.renderPath[1].y+t.y}});}getPath(){return this.pathDirty?(this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=Jr(this.renderPath),this.pathDirty=!1,this.path):this.path}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{borderWidth:t,lineCap:e}=this.parsedStyle,i=Xr(this.path);if(2===this.path.length)return this.boundsDirty=!1,this.bounds=Kr(this.path[0],this.path[1],t.value,e),this.bounds;const s=t.value/2||0;return this.boundsDirty=!1,this.bounds={x:i.left-s,y:i.top-s,width:i.width+2*s,height:i.height+2*s},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.getBoundingRectObject().isPointInPath(t,e))return !1;const{startPoint:i,endPoint:s,borderWidth:n}=this.parsedStyle;return ea(i,s,n.value+e,t)}isLineArrow(){const{lineEnding:t}=this.parsedStyle;return !!t&&("None"!==t[0]||"None"!==t[1])}addCircle(t,e){const{startPoint:i,endPoint:s,borderWidth:n}=this.parsedStyle;da(t,e,i,s,n.value);}addDiamond(t,e){const{startPoint:i,endPoint:s,borderWidth:n}=this.parsedStyle;ha(t,e,i,s,n.value);}addSquare(t,e){const{startPoint:i,endPoint:s,borderWidth:n}=this.parsedStyle;la(t,e,i,s,n.value);}addSlash(t,e){const{startPoint:i,endPoint:s,borderWidth:n}=this.parsedStyle;aa(t,e,i,s,n.value);}addButt(t,e){const{startPoint:i,endPoint:s,borderWidth:n}=this.parsedStyle;ra(t,e,i,s,n.value);}addOpenArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:s,endPoint:n,borderWidth:o}=this.parsedStyle;na(t,e,i,s,n,o.value);}addCloseArrow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{startPoint:s,endPoint:n,borderWidth:o}=this.parsedStyle;oa(t,e,i,s,n,o.value);}},Ia=class extends Aa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"stamp",style:{...t,background:"transparent",borderColor:"transparent"},...e}),l(this,"shapeType","stamp"),l(this,"stampConfig",[]),l(this,"stampItemShapes",[]),l(this,"renderType","stamp"),l(this,"initialWidth",0),l(this,"initialHeight",0),this.stampConfig=t.stampConfig||[];}initStamp(){this.stampConfig&&(this.renderType="stamp",this.initStampItem(),this.initStampStyle());}initStampItem(){if(!Ss(this.stampConfig))return;this.stampItemShapes=[];const{stampConfig:t,stampItemShapes:e}=this,{renderBlendMode:i}=this.parsedStyle;for(let s=0;s<t.length;s++){let n;"path"===t[s].type&&(n=new Da({style:{opacity:this.style.opacity,renderBlendMode:i,...t[s]}})),"text"===t[s].type&&(n=new Ta({style:{opacity:this.style.opacity,renderBlendMode:i,...t[s]}})),"image"===t[s].type&&(n=new ya({style:{opacity:this.style.opacity,renderBlendMode:i,...t[s]}})),n&&e.push(n);}}initStampStyle(){if(!Ss(this.stampConfig))return;const t=[],e=[],{stampItemShapes:i}=this;for(let s=0;s<i.length;s++){const n=i[s];if(!(n instanceof Ta)){const i=n.getBoundingRect();t.push(i.x,i.x+i.width),e.push(i.y,i.y+i.height);}this.appendChild(n);}this.initialWidth=Math.max(...t)-Math.min(...t),this.initialHeight=Math.max(...e)-Math.min(...e),this.updateStyle({x:Math.min(...t),y:Math.min(...e),width:this.initialWidth,height:this.initialHeight});for(let t=0;t<i.length;t++){const e=i[t].getBoundingRect();i[t].setLocalPosition(e.x-this.style.x,e.y-this.style.y);}this.updateOrigin();}isPointInPath(t,e){return super.isPointInPath(t,0)}};class Ra extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"roundedRect",style:{...wr,roundedRadius:0,width:0,height:0,...t},...e}),l(this,"shapeType","roundedRect");const{x:i,y:s}=this.parsedStyle;this.setLocalPosition(i,s),this.updateOrigin();}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,width:i,height:s}=this.parsedStyle;return this.boundsDirty=!1,this.bounds={x:t,y:e,width:i.value,height:s.value},this.bounds}isPointInPath(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{x:i,y:s,width:n,height:o,borderWidth:r}=this.parsedStyle,a=(r.value+e||0)/2;return sa(i-a,s-a,n.value+2*a,o.value+2*a,t.x,t.y)}getCenterPosition(){const{width:t,height:e}=this.parsedStyle,i=new fa({style:{x:t.value/2,y:e.value/2}});this.appendChild(i);const{x:s,y:n}=i.getPosition();return i.destroy(),{x:s,y:n}}}class Ma extends pa{constructor(){let{style:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"freeText",style:{...wr,width:0,height:0,textAlign:"left",...t},...e}),l(this,"shapeType","freeText"),l(this,"lines",void 0),l(this,"textType","textBox"),l(this,"renderClipPath",void 0),l(this,"renderClipStep",void 0),l(this,"totalTextHeight",0),l(this,"limitWidth",1),l(this,"textMaxWidth",0),l(this,"borderOffset",0),l(this,"padding",1),this.textType=t.freeTextType||"textBox",this.setLimitWidth(this.parsedStyle.width.value),this.calculateContentLines();const{x:i,y:s}=this.parsedStyle;this.setLocalPosition(i,s),this.updateOrigin();}getLimitTextWithoutSpace(t,e){const{textContents:i}=this.parsedStyle,s=As(t),n=s.segmentation.length,o=s.segmentation[n-1],r=Ba(" ",i[o.freeContentIndex]),a=o.text.split(" ").length-1;let l;for(let t=0;t<a&&(l=t+1,!(s.width-l*r<e));t++);for(let t=0;t<l;t++)s.word=s.word.slice(0,-1),s.width-=r,o.text=o.text.slice(0,-1),o.width-=r;return s}splitWordSegment(t,e){const i=t,s=[],n=[];let o=e;const r=i.segmentation.length;for(let t=0;t<r;t++){const e=i.segmentation[t];if(!(e.width<o)){if(e.width===o){s.push({...e}),n.push(...i.segmentation.slice(r-t-1));break}{const a=this.parsedStyle.textContents[e.freeContentIndex],l=La(e.text,o,a);2===l.length?(s.push({text:l[0],width:Ba(l[0],a),freeContentIndex:e.freeContentIndex}),n.push({text:l[1],width:Ba(l[1],a),freeContentIndex:e.freeContentIndex})):n.push({...e});const h=r-t-1;h>0&&n.push(...i.segmentation.slice(-h));break}}s.push({...e}),o-=e.width;}const a=t=>{let e="",i=0;return t.forEach((t=>{e+=t.text,i+=t.width;})),{word:e,width:i,segmentation:t}};return 0===s.length?[a(n)]:[a(s),a(n)]}getWordSegmentation(){const{textContents:t}=this.parsedStyle;let e="";const i=[0];t.forEach((t=>{e+=t.content,i.push(e.length);}));const s=e.match(/\S+\s*/g)||[],n=[];let o=0;const r=function(t){const e=/^(?:\r\n|\r|\n)*/,i=t.match(e);if(i){const t=i[0];let e=0;for(const i of t)"\n"!==i&&"\r"!==i||(e+=1);return t.includes("\r\n")&&(e-=1),Array.from({length:e},(()=>"\n"))}return []}(e);if(r.length&&s.unshift(...r)," "===e[0]){const t=e.match(/^ +/)[0];s[0]?s[0]=t+s[0]:s[0]=t;}for(let t=0;t<s.length;t++){const e=s[t].split(/(\r\n|[\r\n])/).filter((t=>""!==t));e.length>2&&(s[t]=e[0]+e[1],s.splice(t+1,0,...e.slice(2)));}return s.forEach((e=>{const s=o+e.length-1,r=[...i.filter((t=>t>o&&t<=s))];if(0===r.length){const s=i.filter((t=>t<=o)).length,r=Ba(e,t[s-1]);n.push({word:e,segmentation:[{text:e,width:r,freeContentIndex:s-1}],width:r});}else {const s=[];let a=0;r.forEach(((n,l)=>{const h=n-(r[l-1]||o),d=r[l-1]-o||0,c=e.substring(d,d+h),u=Ba(c,t[i.indexOf(n)-1]);if(s.push({text:c,width:u,freeContentIndex:i.indexOf(n)-1}),a+=u,l===r.length-1){const o=Ba(e.substring(d+h),t[i.indexOf(n)]);s.push({text:e.substring(d+h),freeContentIndex:i.indexOf(n),width:o}),a+=o;}})),n.push({word:e,width:a,segmentation:s});}o+=e.length;})),n}organizeLine(){if(0===this.lines.length)return;const{y:t}=this.parsedStyle;let e=t+this.borderOffset+this.padding,i=0,s=0;this.lines.forEach(((t,n)=>{s=0,i=Math.max(t.width,i);let o=0,r="";if(0===t.width&&""===t.words[0].text){const e=Ba(" ",t.words[0].style);t.width=e,t.words[0].wordWidth=e,t.words[0].text=" ";}if(t.words.forEach((t=>{r+=t.text,o=Math.max(o,t.wordHeight),t.widthWithoutLf=Oa(t.text)?Ba(t.text,t.style,!0):t.wordWidth,s+=t.widthWithoutLf;})),"textBox"===this.textType&&"justify"===this.style.textAlign&&n!==this.lines.length-1){const e=[],i=/\b\w/g;let n,o=0;for(;null!==(n=i.exec(r));)e.push(n.index);if(e.length>1){const i=(this.limitWidth-s)/(e.length-1),n=t=>{for(let i=0;i<e.length;i++)if(e[i]>t)return i;return e.length};t.words.forEach(((t,e)=>{e>0&&(t.x+=i*(n(o)-1)),o+=t.text.length;})),s=this.limitWidth,t.width=this.limitWidth;}}t.widthWithoutLF=s,t.height=o,t.y=.8*o+e,e+=o,n>0&&(t.y+=.2*this.lines[n-1].height,e+=.2*this.lines[n-1].height);})),this.textMaxWidth=i;}getTextAlignOffset(t){if("freeTextWriter"===this.textType)return 0;const{limitWidth:e}=this,{textAlign:i}=this.parsedStyle,s=t?t.widthWithoutLF:0;let n=0;return "center"===i?n=(e-s)/2:"right"===i&&(n=e-s),n}getPath(){var t;if(!this.pathDirty)return this.path;const{width:e,height:i}=this.getBoundingRect(),s=.5*((null===(t=this.parsedStyle.borderWidth)||void 0===t?void 0:t.value)||0),n=s,o=s,r=e-2*s,a=i-2*s;if(this.path=[{x:n,y:o},{x:n+r,y:o},{x:n+r,y:o+a},{x:n,y:o+a}],this.borderOffset){const t=this.borderOffset/2;this.renderClipPath=[{x:n+t,y:o+t},{x:n+r-t,y:o+t},{x:n+r-t,y:o+a-t},{x:n+t,y:o+a-t}],this.renderClipStep=$r(this.renderClipPath);}return this.steps=$r(this.path),this.pathDirty=!1,this.path}setLimitWidth(t){const{borderWidth:e,borderColor:i}=this.parsedStyle;"textBox"===this.textType&&e.value&&!i.isNone&&(this.borderOffset=e.value,this.padding=e.value),this.limitWidth=t-2*this.borderOffset-2*this.padding;}calculateContentLines(){const{textContents:t,x:e}=this.parsedStyle;if(null==t||!t.length||this.limitWidth<=0)return this.lines=[],void this.calculateTotalHeight();const i=this.getWordSegmentation(),s=[],n=e+this.borderOffset+this.padding;let o=n,r=0,a=[];const l=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;e.segmentation.forEach(((e,s)=>{const n=t[e.freeContentIndex];a.push({text:e.text,originText:i.segmentation[s].text,freeContentIndex:e.freeContentIndex,x:o,wordWidth:e.width,wordHeight:n.fontSize.value,style:n}),o+=e.width,r+=e.width;}));},h=()=>{if(0===a.length)return;const t={words:a,width:r,x:n};s.push(t),o=n,r=0,a=[];},d=(e,i)=>{if(e.width<=i)l(e),Oa(e.word)&&h();else {const s=this.getLimitTextWithoutSpace(e,i);if(s.width<=i)l(s,e);else {const s=this.splitWordSegment(e,i);if(2===s.length){const t=s[1].word;"\r"!==t&&"\n"!==t&&"\r\n"!==t?(l(s[0]),h(),d(s[1],i)):(l(e),h());}else {const s=Ba(e.word[0],t[e.segmentation[0].freeContentIndex]),n=this.splitWordSegment(e,s+.1);l(n[0]),h(),d(n[1],i);}}}};i.forEach((t=>{const e=this.limitWidth-r;if(t.width<=e)l(t),Oa(t.word)&&h();else {const i=this.getLimitTextWithoutSpace(t,e);i.width>e?t.width>this.limitWidth?(h(),d(t,this.limitWidth)):(h(),l(t),Oa(t.word)&&h()):(l(i,t),h());}})),h(),this.lines=s,this.organizeLine(),this.calculateTotalHeight();}calculateTotalHeight(){const{y:t,height:e}=this.parsedStyle,i=this.lines.length;if(i){const s=this.lines[i-1];let n=s.y+.2*s.height+-t+2*this.borderOffset;Oa(s.words[0].text)&&(n+=1.2*s.height),this.totalTextHeight=n>e.value?n:e.value;}else this.totalTextHeight=e.value;}getBoundingRect(){if(!this.boundsDirty)return this.bounds;const{x:t,y:e,height:i}=this.parsedStyle;let s=i.value,n=this.limitWidth+2*this.borderOffset+2*this.padding;return "freeTextWriter"===this.textType?(n=this.textMaxWidth+2*this.borderOffset+2*this.padding,s=this.totalTextHeight):n=this.parsedStyle.width.value,this.boundsDirty=!1,this.bounds={x:t,y:e,width:n,height:s},this.bounds}isPointInPath(t){return this.getBoundingRectObject().isPointInPath(t)}}function Ba(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{fontSize:s,fontStyle:n,fontFamily:o,fontWeight:r}=e,a=document.createElement("canvas").getContext("2d"),l=""===(null==o?void 0:o.trim())?"sans-serif":o;null!=o&&o.includes(" ")?a.font=`${n} ${r} ${s.value}${s.unit} '${l}'`:a.font=`${n} ${r} ${s.value}${s.unit} ${l}`;let h=0;for(let e=0;e<t.length;e++){const s=t.charAt(e);i&&Ua(s)||(h+=a.measureText(s).width);}return h}function La(t,e,i){let s=0;for(let n=0;n<t.length;n++){if(Ba(t.substring(0,n+1),i)>e){s=n;break}}return 0===s?[t]:[t.substring(0,s),t.substring(s)]}function Ua(t){return /^[\r\n]+$/.test(t)}function Oa(t){return t.endsWith("\n")||t.endsWith("\r")||t.endsWith("\r\n")}const _a=1/0;class Na{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_a,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;l(this,"minX",void 0),l(this,"maxX",void 0),l(this,"minY",void 0),l(this,"maxY",void 0),l(this,"rect",void 0),l(this,"updateId",void 0),this.minX=t,this.maxX=e,this.minY=i,this.maxY=s,this.rect=null,this.updateId=-1;}static isEmpty(t){return t.minX===t.maxX&&t.minY===t.maxY}static fromBounds(t){return (new Na).setFromBounds(t)}static create(){return new Na}setFromBounds(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}clear(){return this.minX=_a,this.maxX=-1/0,this.minY=_a,this.maxY=-1/0,this}getRect(t){const{minX:e,minY:i,maxX:s,maxY:n}=this;if(e>s||i>n)return new qs(0,0,0,0);const o=t||new qs;return o.update(e,i,s-e,n-i),o}addPoint(t){return this.addBounds({minX:t.x,maxX:t.x,minY:t.y,maxY:t.y})}addBounds(t){const e=Fa(this,t);return this.setFromBounds(e)}addBoundsMask(t,e){const i=Wa(t,e);if(i.minX<=i.maxX&&i.minY<=i.maxY){const t=Fa(i,this);this.setFromBounds(t);}return this}intersection(t){if(i=t,!((e=this).minX<=i.maxX&&e.maxX>=i.minX&&e.minY<=i.maxY&&e.maxY>=i.minY))return null;var e,i;const s=Wa(this,t);return Na.fromBounds(s)}union(t){const e=Fa(this,t);return Na.fromBounds(e)}addBoundsArea(t,e){const{x:i,y:s,width:n,height:o}=e,r={minX:i,minY:s,maxX:i+n,maxY:s+o};return this.addBoundsMask(t,r)}addFrame(t,e){return this.setFromTransformedBounds(t.worldTransform,e)}setFromTransformedBounds(t,e){for(let i=0;i<2;i++){const s=t.transformPoint({x:i?e.maxX:e.minX,y:i?e.maxY:e.minY});this.addPoint(s);}return this}addQuad(t){for(let e=0;e<4;e++)this.addPoint({x:t[2*e],y:t[2*e+1]});}}function Wa(t,e){return {minX:t.minX>e.minX?t.minX:e.minX,minY:t.minY>e.minY?t.minY:e.minY,maxX:t.maxX<e.maxX?t.maxX:e.maxX,maxY:t.maxY<e.maxY?t.maxY:e.maxY}}function Fa(t,e){return {minX:t.minX<e.minX?t.minX:e.minX,minY:t.minY<e.minY?t.minY:e.minY,maxX:t.maxX>e.maxX?t.maxX:e.maxX,maxY:t.maxY>e.maxY?t.maxY:e.maxY}}class Ha extends pa{constructor(){super({}),l(this,"name","Document"),l(this,"defaultView",void 0),l(this,"documentElement",void 0),l(this,"timeLine",void 0),this.nodeName="document",this.documentElement=new pa({name:"Root",id:"root",style:{visibility:"visible"}}),this.documentElement.ownerDocument=this,this.documentElement.parentNode=this,this.childNodes=[this.documentElement];}get children(){return this.childNodes}get childElementCount(){return this.childNodes.length}get firstElementChild(){return this.firstChild}get lastElementChild(){return this.lastChild}createElement(t,e){const i=this.defaultView.customElements.get(t);return new i(e)}getElementById(t){return null}getElementsByName(t){return this.documentElement.getElementsByTagName(t)}getElementsByTagName(t){return this.documentElement.getElementsByTagName(t)}getElementsByClassName(t){return this.documentElement.getElementsByClassName(t)}append(){return this.documentElement.append(...arguments)}prepend(){return this.documentElement.prepend(...arguments)}querySelector(t){return this.documentElement.querySelector(t)}querySelectorAll(t){return this.documentElement.querySelectorAll(t)}find(t){return this.documentElement.find(t)}findAll(t){return this.documentElement.findAll(t)}appendChild(t){return this.documentElement.appendChild(t)}cloneNode(t){return this.documentElement.cloneNode(t)}insertBefore(t,e){return this.documentElement.insertBefore(t,e)}removeChild(t){return this.documentElement.removeChild(t)}replaceChild(t,e){return this.documentElement.replaceChild(t,e)}destroy(){}}class Va extends Ao{constructor(){super(...arguments),l(this,"altKey",void 0),l(this,"button",void 0),l(this,"buttons",void 0),l(this,"ctrlKey",void 0),l(this,"metaKey",void 0),l(this,"shiftKey",void 0),l(this,"relatedTarget",void 0),l(this,"client",new Fo),l(this,"movement",new Fo),l(this,"offset",new Fo),l(this,"page",new Fo),l(this,"screen",new Fo),l(this,"global",new Fo),l(this,"canvas",new Fo);}initEvent(t,e,i){throw new Error("Method not implemented.")}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.client.x}get y(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.x}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}getModifierState(t){return "getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,n,o,r,a,l,h,d,c,u,p,g){throw this.initUIEvent(t,i,i,s,n),new Error("initMouseEvent() DOM API is deprecated.")}}function za(t,e){e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.relatedTarget=null,e.client.setFromPoint(t.client),e.movement.setFromPoint(t.movement),e.offset.setFromPoint(t.offset),e.page.setFromPoint(t.page),e.screen.setFromPoint(t.screen),e.global.setFromPoint(t.global),e.canvas.setFromPoint(t.canvas);}class ja extends Va{constructor(){super(...arguments),l(this,"deltaMode",void 0),l(this,"deltaX",void 0),l(this,"deltaY",void 0),l(this,"deltaZ",void 0),l(this,"DOM_DELTA_PIXEL",0),l(this,"DOM_DELTA_LINE",1),l(this,"DOM_DELTA_PAGE",2);}}function $a(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;}class Ga extends Va{constructor(t){super(t),l(this,"height",0),l(this,"isPrimary",void 0),l(this,"pointerId",void 0),l(this,"pointerType",void 0),l(this,"pressure",void 0),l(this,"tangentialPressure",void 0),l(this,"tiltX",void 0),l(this,"tiltY",void 0),l(this,"twist",void 0),l(this,"width",0),l(this,"getCoalescedEvents",void 0),l(this,"getPredictedEvents",void 0),this.isPrimary=!1,this.height=0,this.width=0;}}function Xa(t,e){e.isPrimary=t.isPrimary,e.width=t.width,e.height=t.height,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.pointerType=t.pointerType,e.pointerId=t.pointerId,e.pressure=t.pressure,e.twist=t.twist,e.tangentialPressure=t.tangentialPressure;}class Ya{constructor(t,e){l(this,"root",void 0),l(this,"cursor","default"),l(this,"events",void 0),l(this,"trackingData",void 0),l(this,"contextService",void 0),this.root=t,this.contextService=e,this.events={},this.trackingData={},this.on("pointerdown",this.onPointerdown.bind(this)),this.on("pointermove",this.onPointermove.bind(this)),this.on("pointerout",this.onPointerout.bind(this)),this.on("pointerleave",this.onPointerout.bind(this)),this.on("pointerover",this.onPointerover.bind(this)),this.on("pointerup",this.onPointerup.bind(this)),this.on("wheel",this.onWheel.bind(this));}clientToCanvas(t){const e=this.contextService.getBoundingClientRect();return new Fo(t.x-(e.x||0),t.y-(e.y||0))}canvasToClient(t){const e=this.root.defaultView.contextService.getBoundingClientRect();return new Fo(t.x+(e.x||0),t.y+(e.y||0))}getPropagationPath(t){const e=[t];for(;pa.isNode(t)&&t!==this.root;)t=t.parentNode,e.push(t);return e.reverse()}getHitTarget(t,e){const{root:i}=this,{isInteractive:s}=i,n=Za(i,s,new Fo(t,e));return n?n[0]:null}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push({fn:e,order:0}),this.events[t].sort(((t,e)=>t.order-e.order));}emit(t){if(!this.root)return;const e=this.events[t.type]||[];for(let i=0;i<e.length;i++)e[i].fn(t);}onPointerdown(t){if(!(t instanceof Ga))return;const e=this.generatePointerEvent(t);let i;Io(e,"pointerdown"),"touch"===e.pointerType?i="touchstart":Ja(e)&&(i=2===e.button?"rightdown":"mousedown"),Io(e,i);this.getTrackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath();}onPointermove(t){if(!(t instanceof Ga))return;const e=this.generatePointerEvent(t),i=Ja(e),s=this.getTrackingData(t.pointerId),n=qa(s.overTargets);if(n&&n!==e.target){const s="mousemove"===t.type?"mouseout":"pointerout",o=this.generatePointerEvent(t,s,n);Io(o,"pointerout"),i&&Io(o,"mouseout");const r=e.composedPath();if(!r.includes(n)){const e=this.generatePointerEvent(t,"pointerleave",n);for(e.eventPhase=e.AT_TARGET;e.target&&!r.includes(e.target);)e.currentTarget=e.target,Eo(e,e.type),i&&Eo(e,"mouseleave"),e.target=e.target.parentNode;}}if(n!==e.target){const s="mousemove"===t.type?"mouseover":"pointerover",o=this.clonePointerEvent(e,s);Io(o,"pointerover"),i&&Io(o,"mouseover");let r=pa.isNode(n)&&(null==n?void 0:n.parentNode);for(;r&&r!==(pa.isNode(this.root)&&this.root.parentNode)&&r!==e.target;)r=r.parentNode;if(!r||r===this.root.parentNode){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==n&&t.target!==this.root.parentNode;)t.currentTarget=t.target,Eo(t,t.type),i&&Eo(t,"mouseenter"),t.target=t.target.parentNode;}}var o;(Io(e,"pointermove"),"touch"===e.pointerType&&Io(e,"touchmove"),i)&&(Io(e,"mousemove"),this.cursor=null===(o=e.target)||void 0===o?void 0:o.cursor);s.overTargets=e.composedPath();}onPointerup(t){if(!(t instanceof Ga))return;const e=performance.now(),i=this.generatePointerEvent(t);Io(i,"pointerup");const{pointerType:s}=i;let n;"touch"===s?n="touchend":Ja(i)&&(n=2===i.button?"rightup":"mouseup"),Io(i,n);const o=this.getTrackingData(t.pointerId),r=qa(o.pressTargetsByButton[t.button]);let a=r;const l=i.composedPath();if(r&&!l.includes(r)){let e=r;for(;e&&!l.includes(e);)i.currentTarget=e,Eo(i,"pointerupoutside"),"touch"===s?n="touchendoutside":Ja(i)&&(n=2===i.button?"rightupoutside":"mouseupoutside"),Eo(i,n),e=e.parentNode;delete o.pressTargetsByButton[t.button],a=e;}if(a){const r=this.clonePointerEvent(i,"click");r.target=a,r.path=null,o.clicksByButton[t.button]||(o.clicksByButton[t.button]={clickCount:0,target:r.target,timeStamp:e});const l=o.clicksByButton[t.button];l.target===r.target&&e-l.timeStamp<200?l.clickCount+=1:l.clickCount=1,l.target=r.target,l.timeStamp=e,r.detail=l.clickCount,n="mouse"===s?"click":"touch"===s?"tap":"pointertap",Io(r,n);}}onPointerout(t){if(!(t instanceof Ga))return;const e=this.getTrackingData(t.pointerId);if(e.overTargets){const i=Ja(t),s=qa(e.overTargets),n=this.generatePointerEvent(t,"pointerout",s);Io(n),i&&Io(n,"mouseout");const o=this.generatePointerEvent(t,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.root.parentNode;)o.currentTarget=o.target,Eo(o,o.type),i&&Eo(o,"mouseleave"),o.target=o.target.parentNode;e.overTargets=null;}this.cursor=null;}onPointerover(t){if(!(t instanceof Ga))return;const e=this.getTrackingData(t.pointerId),i=this.generatePointerEvent(t),s=Ja(t);var n;(Io(i,"pointerover"),s&&Io(i,"mouseover"),"mouse"===i.pointerType)&&(this.cursor=null===(n=i.target)||void 0===n?void 0:n.cursor);const o=this.clonePointerEvent(i,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.root.parentNode;)o.currentTarget=i.target,Eo(o,o.type),s&&Eo(o,"mouseenter"),o.target=o.target.parentNode;e.overTargets=i.composedPath();}onWheel(t){if(!(t instanceof ja))return;Io(this.generateWheelEvent(t));}generatePointerEvent(t,e,i){const s=new Ga(this);return Xa(t,s),za(t,s),To(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=null!=i?i:this.getHitTarget(s.globalX,s.globalY),s.type=null!=e?e:s.type,s}generateWheelEvent(t){const e=new ja(this);return $a(t,e),za(t,e),To(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.getHitTarget(e.globalX,e.globalY),e}clonePointerEvent(t,e){const i=new Ga(this);return Xa(t,i),za(t,i),To(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=t.target,i.path=t.composedPath().slice(),i}getTrackingData(t){return this.trackingData[t]||(this.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTargets:null}),this.trackingData[t]}}function Ja(t){const{pointerType:e}=t;return "mouse"===e||"pen"===e}function qa(t){if(!t)return null;let e=t[0]||null;for(let i=1,s=t.length;i<s&&t[i].parentNode===e;i++)e=t[i];return e}function Za(t,e,i){if(!t||"visible"!==t.style.visibility)return null;const{hitArea:s}=t.style;if(s){const{x:e,y:n}=t.transform.worldTransform.transformPoint(i);if(!s.contains(e,n))return null}const{clipPath:n}=t.style;if(n&&!n.containPoint(i))return null;if(t.isChildrenInteractive&&t.children){const{children:s}=t;for(let n=s.length-1;n>=0;n--){const o=s[n],r=Za(o,e||o.isInteractive,i);if(r)return (r.length>0||t.isInteractive)&&r.push(t),r}}return e&&t.containPoint(i)?t.isInteractive?[t]:[]:null}l(class{constructor(){l(this,"canvasConfig",void 0),l(this,"contextService",void 0),l(this,"renderingContext",void 0),l(this,"eventService",void 0),l(this,"rootPointerEvent",new Ga(null)),l(this,"rootWheelEvent",new ja(null)),l(this,"autoPreventDefault",!0);}init(t){const{renderingService:e,renderingContext:i,contextService:s,canvasConfig:n}=t;this.eventService=new Ya(i.root.parentNode,s),t.eventService=this.eventService,this.renderingContext=i,this.contextService=s,this.canvasConfig=n,e.hooks.wheel.on(this.onWheel),e.hooks.pointerdown.on(this.onPointerdown),e.hooks.pointermove.on(this.onPointermove),e.hooks.pointerup.on(this.onPointerup),e.hooks.pointerout.on(this.onPointermove),e.hooks.pointerover.on(this.onPointermove);}destroy(){}onWheel(t){const e=this.normalizeWheelEvent(t);this.eventService.emit(e);}onPointerdown(t){if(this.isTouchEvent(t))return;const e=this.normalizeToPointerEvent(t);if(this.autoPreventDefault&&e.isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault();}const i=this.bootstrapEvent(e,this.rootPointerEvent);this.eventService.emit(i),this.setCursor(this.eventService.cursor);}onPointermove(t){if(this.isTouchEvent(t))return;const e=this.normalizeToPointerEvent(t),i=this.bootstrapEvent(e,this.rootPointerEvent);this.eventService.emit(i),this.setCursor(this.eventService.cursor);}onPointerup(t){if(this.isTouchEvent(t))return;const e=this.contextService.getDomElement(),i=t.target===e?"":"outside",s=this.normalizeToPointerEvent(t),n=this.bootstrapEvent(s,this.rootPointerEvent);n.type+=i,this.eventService.emit(n),this.setCursor(this.eventService.cursor);}setCursor(t){this.contextService.setCursor(t||this.canvasConfig.cursor||"default");}normalizeWheelEvent(t){const e=this.rootWheelEvent;e.nativeEvent=t,this.transferMouseData(t,e),$a(t,e);const i=new Fo(t.clientX,t.clientY),{x:s,y:n}=this.eventService.clientToCanvas(i);return e.canvas.x=s,e.canvas.y=n,e.offset.setFromPoint(e.canvas),e.global.setFromPoint(e.canvas),To(t,e),e}normalizeToPointerEvent(t){const e=this.renderingContext.root.ownerDocument.defaultView;if(e.supportTouchEvent&&t instanceof TouchEvent){const e=t;e.isNormalized=!0,e.pointerType="touch";}else if(!MouseEvent||t instanceof MouseEvent&&(!e.supportPointerEvent||!(t instanceof PointerEvent))){const e=t;e.isPrimary=!0,e.width=1,e.height=1,e.tiltX=0,e.tiltY=0,e.pointerType="mouse",e.pointerId=1,e.pressure=.5,e.twist=0,e.tangentialPressure=0,e.isNormalized=!0;}return t}bootstrapEvent(t,e){this.renderingContext.root.ownerDocument.defaultView,e.originalEvent=null,e.nativeEvent=t,Xa(t,e),this.transferMouseData(t,e);const{x:i,y:s}=this.eventService.clientToCanvas(new Fo(t.clientX,t.clientY));return e.canvas.x=i,e.canvas.y=s,e.offset.setFromPoint(e.canvas),e.global.setFromPoint(e.canvas),To(t,e),"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&e.type.replace("mouse","pointer"),e}transferMouseData(t,e){e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey,e.relatedTarget=null,e.client.x=t.clientX,e.client.y=t.clientY,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.screen.x=t.screenX,e.screen.y=t.screenY;}isTouchEvent(t){return this.renderingContext.root.ownerDocument.defaultView.supportTouchEvent&&"touch"===t.pointerType}},"moduleName","Event");class Qa extends Ao{constructor(t,e,i,s,n,o,r,a){super(null),l(this,"relatedNode",void 0),l(this,"prevValue",void 0),l(this,"newValue",void 0),l(this,"attrName",void 0),l(this,"attrChange",void 0),l(this,"prevParsedValue",void 0),l(this,"newParsedValue",void 0),this.type=t,this.relatedNode=e,this.prevValue=i,this.newValue=s,this.attrName=n,this.attrChange=o,this.prevParsedValue=r,this.newParsedValue=a;}}l(Qa,"ADDITION",2),l(Qa,"MODIFICATION",1),l(Qa,"REMOVAL",3);class Ka{constructor(t){l(this,"contextService",void 0),l(this,"renderingPlugins",[]),l(this,"config",{autoRendering:!0}),Object.assign(this.config,t);}use(t){this.renderingPlugins.includes(t)||this.renderingPlugins.push(t);}initPlugins(t){this.renderingPlugins.forEach((e=>{e.init(t);}));}destroyPlugins(){this.renderingPlugins.forEach((t=>{t.destroy();}));}getPlugins(){return this.renderingPlugins}getAnnotationConfig(){return this.config}}class tl{constructor(t){l(this,"hooks",{init:Vs.create(),beginFrame:Vs.create(),beforeRender:Vs.create(),render:Vs.create(),afterRender:Vs.create(),putImageData:Vs.create(),endFrame:Vs.create(),destroy:Vs.create(),pointerdown:Vs.create(),pointerup:Vs.create(),pointermove:Vs.create(),pointerout:Vs.create(),pointerover:Vs.create(),pointerCancel:Vs.create(),wheel:Vs.create()}),l(this,"isInited",!1),l(this,"zIndexCounter",0),l(this,"renderingContext",void 0),this.renderingContext=t;}init(){this.hooks.init.emit(),this.isInited=!0;}destroy(){this.isInited=!1,this.hooks.destroy.emit();}render(){const{root:t}=this.renderingContext;this.zIndexCounter=0,tr.recursiveUpdateHierarchy(t),this.isInited&&(this.renderDisplayObject(t),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear());}renderDisplayObject(t){if(!t.isVisible)return;const{sortable:e}=t;if(e.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),t.imageData)return void this.hooks.putImageData.emit(t);this.hooks.beforeRender.emit(t),this.hooks.render.emit(t),this.hooks.afterRender.emit(t);let i=!1;e.dirty&&(e.sorted=t.childNodes.slice().sort(el),e.dirty=!1,i=!0);const s=e.sorted||t.childNodes;s.length>1&&s.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),s.forEach((t=>{this.renderDisplayObject(t);})),s.sort(((t,e)=>t.index-e.index)),i&&t.recursiveCall((t=>{const e=new ko("renderOrderChanged",{renderOrder:t.sortable.renderOrder});t.dispatchEvent(e);}));}dirty(){this.renderingContext.renderCondition.add(0);}}function el(t,e){const i=Number(t.style.zIndex),s=Number(e.style.zIndex);if(i===s&&t.parentNode){const{childNodes:i=[]}=t.parentNode;return i.indexOf(t)-i.indexOf(e)}return i-s}class il extends Do{constructor(t){super(),l(this,"document",void 0),l(this,"customElements",void 0),l(this,"devicePixelRatio",void 0),l(this,"eventService",void 0),l(this,"renderingService",void 0),l(this,"renderingContext",void 0),l(this,"canvasConfig",void 0),l(this,"renderer",void 0),l(this,"supportTouchEvent",void 0),l(this,"supportPointerEvent",void 0),l(this,"contextService",void 0);const{renderer:e,dpr:i,width:s,height:n,canvas:o,supportPointerEvent:r,supportTouchEvent:a}=t;this.supportPointerEvent=null!=r?r:!!globalThis.PointerEvent,this.supportTouchEvent=null!=a?a:"touchstart"in window;let h=s,d=n,c=i;o&&(c=i||window.devicePixelRatio||1,h=s||o.width/c,d=n||o.height/c),this.canvasConfig={...t,width:h,height:d,dpr:c},this.canvasConfig=t,this.renderer=e,this.document=new Ha,this.document.defaultView=this,this.initRenderingContext(),this.renderingService=new tl(this.renderingContext),this.initRenderer(e);}initRenderingContext(){this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new Set},this.document.documentElement.addEventListener("child-inserted",(t=>{this.mountChildren(t.detail.child);})),this.document.documentElement.addEventListener("child-removed",(t=>{this.unmountChildren(t.detail.child);}));}initRenderer(t){this.renderingService.init(),t.initPlugins(this),this.contextService.init();t.getAnnotationConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall((t=>{const{renderable:e}=t;e&&(e.boundsDirty=!0,e.renderBoundsDirty=!0);})),this.mountChildren(this.document.documentElement);}render(){const t=new ko("beforeRender",{});this.dispatchEvent(t),this.contextService.clearCanvas(),this.renderingService.render();}setDPR(t){this.canvasConfig.dpr=t,this.contextService.setDPR(t);}resize(t,e){this.canvasConfig.width=t,this.canvasConfig.height=e,this.contextService.resize(t,e);}getContextService(){return this.contextService}getEventService(){return this.eventService}appendChild(t,e){return this.document.documentElement.appendChild(t,e)}insertBefore(t,e){return this.document.documentElement.insertBefore(t,e)}removeChild(t){return this.document.documentElement.removeChild(t)}getBoundingClientRect(){return this.contextService.getBoundingClientRect()}mountChildren(t){t.recursiveCall((t=>{if(!t.isConnected){t.isConnected=!0,t.ownerDocument=this.document;const e=new ko("DOMNodeInsertedIntoDocument",{});t.dispatchEvent(e);}}));}unmountChildren(t){const e=[];t.recursiveCall((t=>{t.isConnected&&e.push(t);})),e.reverse().forEach((t=>{t.isConnected=!1;const e=new ko("DOMNodeRemovedFromDocument",{});t.dispatchEvent(e),t!==this.document.documentElement&&(t.ownerDocument=null);}));}}class sl{}class nl extends sl{constructor(){super(...arguments),l(this,"close",!0),l(this,"shape",void 0),l(this,"ctx",void 0);}render(t,e){const{background:i,borderColor:s,visibility:n}=t.parsedStyle;if("hidden"===n)return;const o=!fn(i)&&!i.isNone,r=!fn(s)&&!s.isNone;this.renderPath(t,e),o&&this.renderFill(t,e),this.renderStrokePath(t,e),r&&this.renderStroke(t,e);}renderPath(t,e){t.getPath(),e.beginPath(),t.steps.forEach((t=>{Gr(e,t);})),this.close&&t.steps.length>2&&e.closePath();}renderStrokePath(t,e){Rs(null==t?void 0:t.getStrokePath)&&(t.getStrokePath(),0!==t.strokePath.length&&(e.beginPath(),t.strokeSteps.forEach((t=>{Gr(e,t);})),this.close&&t.strokeSteps.length>2&&e.closePath()));}renderFill(t,e){const{parsedStyle:i}=t,{background:s,opacity:n,fillOpacity:o,renderBlendMode:r}=i;if(e.save(),e.globalAlpha=n*o,"normal"!==r&&(e.globalCompositeOperation=r),Array.isArray(s)){this.setShapeGradientOrigin(t,e);for(let i=0;i<s.length;i++)0===i&&this.setShadow(t,e),e.fillStyle=this.getColor(t,s[i],e),e.fill();}else this.setShadow(t,e),e.fillStyle=s.formatted,e.fill();e.restore();}renderStroke(t,e){const{parsedStyle:i}=t,{borderWidth:s,borderColor:n,opacity:o,lineCap:r,lineJoin:a,miterLimit:l,lineDash:h,lineDashOffset:d,borderOpacity:c,renderBlendMode:u}=i;s&&s.value>0&&(e.save(),fn(s)||(e.lineWidth=s.value),"normal"!==u&&(e.globalCompositeOperation=u),e.miterLimit=l,e.globalAlpha=o*c,e.lineCap=r,e.lineJoin=a,e.setLineDash(h),e.lineDashOffset=d.value,Array.isArray(n)?(this.setShapeGradientOrigin(t,e),n.forEach((i=>{e.strokeStyle=this.getColor(t,i,e),e.stroke();}))):(e.strokeStyle=n.formatted,e.stroke()),e.restore());}setShadow(t,e){const{shadow:i,shadowOffsetX:s,shadowOffsetY:n,shadowBlur:o,shadowColor:r}=t.parsedStyle;(i||r)&&(e.shadowOffsetX=(null==s?void 0:s.value)||i[0],e.shadowOffsetY=(null==n?void 0:n.value)||i[1],e.shadowBlur=(null==o?void 0:o.value)||i[2],e.shadowColor=(null==r?void 0:r.formatted)||i[3]);}getColor(t,e,i){let s;if(1===e.type||2===e.type){const n=t.getBoundingRect(),{width:o,height:r}=n,a=o,l=r;s=function(t,e){const{type:i,steps:s,width:n,height:o,angle:r,cx:a,cy:l,size:h}=t;let d=null;if(1===i){const{x1:t,y1:i,x2:s,y2:a}=function(t,e,i){const s=i*Math.PI/180,n=0+t/2,o=0+e/2,r=Math.abs(t*Math.cos(s))+Math.abs(e*Math.sin(s));return {x1:n-Math.cos(s)*r/2,y1:o-Math.sin(s)*r/2,x2:n+Math.cos(s)*r/2,y2:o+Math.sin(s)*r/2}}(n,o,r.value);d=e.createLinearGradient(t,i,s,a);}else if(2===i){const{x:t,y:i,r:s}=function(t,e,i,s,n){let o=i.value,r=s.value;"%"===i.unit&&(o=i.value/100*t),"%"===s.unit&&(r=s.value/100*e);let a=Math.max(nn({x:0,y:0},{x:o,y:r}),nn({x:0,y:e},{x:o,y:r}),nn({x:t,y:e},{x:o,y:r}),nn({x:t,y:0},{x:o,y:r}));return n&&(Ps(n)?a=n.value:Ls(n)&&("closest-side"===n?a=Math.min(o,t-o,r,e-r):"farthest-side"===n?a=Math.max(o,t-o,r,e-r):"closest-corner"===n&&(a=Math.min(nn({x:0,y:0},{x:o,y:r}),nn({x:0,y:e},{x:o,y:r}),nn({x:t,y:e},{x:o,y:r}),nn({x:t,y:0},{x:o,y:r}))))),{x:o,y:r,r:a}}(n,o,a,l,h);d=e.createRadialGradient(t,i,0,t,i,s);}d&&s.forEach((t=>{let{offset:e,color:i}=t;var s;"%"===e.unit&&(null===(s=d)||void 0===s||s.addColorStop(e.value/100,i.toString()));}));return d}({type:e.type,...e.value,width:a,height:l},i);}return s}setShapeGradientOrigin(t,e){const{type:i}=t.config;switch(i){case"circle":case"arc":{const{r:i}=t.parsedStyle;e.translate(0-i.value,0-i.value);break}case"ellipse":{const{rx:i,ry:s}=t.parsedStyle;e.translate(0-i.value,0-s.value);break}default:e.translate(0,0);}}}class ol extends nl{constructor(){super(),this.close=!1;}}class rl extends nl{}class al extends nl{}class ll extends nl{render(t,e){const{width:i,height:s,img:n,opacity:o,visibility:r}=t.parsedStyle;"hidden"!==r&&(Ls(n)||n&&(e.save(),e.globalAlpha=o,n instanceof ImageData?e.putImageData(n,0,0):(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality&&(e.imageSmoothingQuality="high"),e.drawImage(n,0,0,i.value,s.value)),e.restore()));}}class hl extends nl{constructor(){super(...arguments),l(this,"close",!1);}render(t,e){const{visibility:i}=t.parsedStyle;"hidden"!==i&&(this.renderPath(t,e),this.renderStroke(t,e));}renderPath(t,e){t.getPath(),e.beginPath(),t.inkRenderSteps.forEach((t=>{t.forEach((t=>{Gr(e,t);}));}));}}class dl extends nl{}class cl extends nl{render(t,e){const{background:i,borderColor:s,visibility:n}=t.parsedStyle;if("hidden"===n)return;const o=!fn(i)&&!i.isNone,r=!fn(s)&&!s.isNone;t.getPath();const a=t.steps.length;for(let i=0;i<a;i++){const s=t.steps[i];e.beginPath(),s.step.forEach((t=>{Gr(e,t);})),s.close&&(e.closePath(),o&&this.renderFill(t,e)),r&&this.renderStroke(t,e);}}}class ul extends nl{}class pl extends nl{render(t,e){t&&this.renderText(t,e);}renderText(t,e){var i;const{parsedStyle:s,lines:n}=t,{color:o,borderWidth:r,borderColor:a,textBaseLine:l,opacity:h,textAlign:d,lineDash:c,fillOpacity:u,borderOpacity:p,letterSpacing:g}=s;t.setTextFont(),e.save(),o&&Array.isArray(o)?o.forEach((i=>{e.fillStyle=this.getColor(t,i,e);})):e.fillStyle=o.formatted,a&&Array.isArray(a)?a.forEach((i=>{e.strokeStyle=this.getColor(t,i,e);})):e.strokeStyle=a.formatted,this.setShadow(t,e),e.font=t.font,e.globalAlpha=h,e.lineWidth=null==r?void 0:r.value,e.textAlign=d,e.textBaseline=l,e.letterSpacing=`${g.value}px`,e.setLineDash(c),e.beginPath();const f=(null===(i=n[0])||void 0===i?void 0:i.y)||0;n.forEach((i=>{let{text:s}=i;const n=i.y-f;s=t.transformText(s),o&&this.fillText(e,s,0,n,u),r&&r.value&&r.value>0&&this.strokeText(e,s,0,n,p);})),e.closePath(),e.restore();}fillText(t,e,i,s,n,o){let r;const a=!fn(n)&&1!==n;a&&(r=t.globalAlpha,t.globalAlpha=n*n),t.fillText(e,i,s,o),a&&(t.globalAlpha=r);}strokeText(t,e,i,s,n,o){let r;const a=!fn(n)&&1!==n;a&&(r=t.globalAlpha,t.globalAlpha=n),t.strokeText(e,i,s,o),a&&(t.globalAlpha=r);}}class gl extends nl{constructor(){super(...arguments),l(this,"close",!0);}}class fl extends nl{render(t,e){const{background:i,borderColor:s,visibility:n}=t.parsedStyle;if("hidden"===n)return;const o=!fn(i)&&!i.isNone,r=!fn(s)&&!s.isNone;t.getPath();const a=t.steps.length;for(let i=0;i<a;i++){const s=t.steps[i];e.beginPath(),s.step.forEach((t=>{Gr(e,t);})),s.close&&(e.closePath(),o&&this.renderFill(t,e)),r&&this.renderStroke(t,e);}}}class ml extends nl{render(t,e){const{width:i,height:s,roundedRadius:n,background:o,borderWidth:r,visibility:a}=t.parsedStyle;if("hidden"!==a){for(let t=0;t<4;t++){e.beginPath();const t=n.value;if(0===t)e.rect(0,0,i.value,s.value);else {const{PI:n}=Math;e.arc(t,t,t,n,3*n/2),e.arc(i.value-t,t,t,3*n/2,2*n),e.arc(i.value-t,s.value-t,t,0,n/2),e.arc(t,s.value-t,t,n/2,n);}}e.closePath(),o&&this.renderFill(t,e),r.value>0&&this.renderStroke(t,e);}}}class yl extends nl{render(t,e){t&&"hidden"!==t.parsedStyle.visibility&&(this.renderBox(t,e),e.save(),t.renderClipStep&&(e.beginPath(),t.renderClipStep.forEach((t=>{Gr(e,t);})),e.closePath(),e.clip()),this.renderText(t,e),e.restore());}renderBox(t,e){const{background:i,borderColor:s}=t.parsedStyle,n="textBox"===t.textType&&!fn(i)&&!i.isNone,o="textBox"===t.textType&&!fn(s)&&!s.isNone;this.renderPath(t,e),n&&this.renderFill(t,e),o&&this.renderStroke(t,e);}renderText(t,e){const{parsedStyle:i,lines:s}=t,{opacity:n,y:o,x:r}=i;e.globalAlpha=n,s.forEach((i=>{const s=i.height/30,n=t.getTextAlignOffset(i);i.words.forEach((t=>{const{color:a,fontFamily:l,fontSize:h,fontStyle:d,fontWeight:c,lineThrough:u,underline:p}=t.style;e.fillStyle=a;const g=""===l.trim()?"sans-serif":l;l.includes(" ")?e.font=`${d} ${c} ${h.value}${h.unit} '${g}'`:e.font=`${d} ${c} ${h.value}${h.unit} ${g}`;let f=t.x-r+n;for(let s=0;s<t.text.length;s++){const n=t.text.charAt(s);e.fillText(n,f,i.y-o),f+=e.measureText(n).width;}p&&e.fillRect(t.x-r+n,i.y-o+s,t.widthWithoutLf,s),u&&e.fillRect(t.x-r+n,i.y-t.wordHeight/3-o,t.widthWithoutLf,h.value/30);}));}));}}class vl{constructor(t){l(this,"canvasConfig",void 0),l(this,"container",void 0),l(this,"canvas",void 0),l(this,"dpr",void 0),l(this,"context",void 0),l(this,"shapeRenderers",{}),this.canvasConfig=t;}init(){const{container:t,canvas:e,dpr:i,willReadFrequently:s}=this.canvasConfig;if(e){this.canvas=e;const{parentElement:i}=e;t&&i!==t&&t.appendChild(e),this.container=i,this.canvasConfig.container=i;}else if(t&&(this.container=t,Ls(t)&&(this.container=document.getElementById(t)),this.container)){const t=document.createElement("canvas");this.container.appendChild(t),this.canvas=t;}this.context=this.canvas.getContext("2d",{willReadFrequently:s}),this.dpr=i||ln(),this.resize(this.canvasConfig.width,this.canvasConfig.height);}registerShapeRenderer(t,e){this.shapeRenderers[t]||(this.shapeRenderers[t]=e);}getShapeRenderer(t){return this.shapeRenderers[t]}destroy(){const{canvas:t,container:e}=this;e&&null!=t&&t.parentNode&&e.removeChild(t);}resize(t,e){const{canvas:i,dpr:s}=this;i&&(i.width=t*s,i.height=e*s,this.context.scale(s,s));}getDPR(){return this.dpr}setDPR(t){this.canvasConfig.dpr=t,this.dpr=t;}getContext(){return this.context}getDomElement(){return this.canvas}getCanvas(){return this.canvas}setCursor(t){var e;null!=this&&null!==(e=this.container)&&void 0!==e&&e.style&&(this.container.style.cursor=t);}getBoundingClientRect(){var t;return null===(t=this.canvas)||void 0===t?void 0:t.getBoundingClientRect()}clearCanvas(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr));}}class xl{constructor(){l(this,"restoreStack",[]);}init(t){const{hooks:e}=t.renderingService;e.endFrame.on((()=>{const{contextService:e}=t,i=e.getContext();this.restoreStack.forEach((()=>{i.restore();})),this.restoreStack=[];})),e.render.on((e=>{this.renderDisplayObject(e,t);})),e.putImageData.on((e=>{if(e.imageData){const{x:i,y:s}=e.getPosition(),n=t.contextService.getContext(),o=t.contextService.getDPR();n.putImageData(e.imageData,Math.floor(i*o+.5),Math.floor(s*o+.5));}}));}renderDisplayObject(t,e){if(!t.isVisible)return;const{contextService:i}=e,s=i.getContext();let n=this.restoreStack[this.restoreStack.length-1];for(;n&&t.parentNode!==n;)s.restore(),this.restoreStack.pop(),n=this.restoreStack[this.restoreStack.length-1];s.save(),this.applyTransform(s,t);const{clipPath:o}=t.style;o&&(s.save(),this.applyTransform(s,o),s.restore(),s.clip()),this.useAnchor(s,t);const r=i.getShapeRenderer(t.shapeType);r&&(r.render(t,s),t.clippable&&s.clip()),this.restoreStack.push(t);}applyTransform(t,e){e.externalMatrices.length&&e.externalMatrices.slice().reverse().forEach((e=>{const{a:i,b:s,c:n,d:o,e:r,f:a}=e;t.transform(i,s,n,o,r,a);}));const i=e.getLocalTransform(),{a:s,b:n,c:o,d:r,e:a,f:l}=i;t.transform(s,n,o,r,a,l);}applyAttributes(t,e,i){}useAnchor(t,e){const{anchor:i}=e.parsedStyle||{};if(!i||0===i[0]&&0===i[1])return;const s=e.getGeometryBounds().getRect();t.translate(-(i&&i[0]||0)*s.width,-(i&&i[1]||0)*s.height);}destroy(){}}l(xl,"moduleName",void 0);class wl{init(t){const e=new vl(t.canvasConfig);t.contextService=e;[{name:"arc",renderer:new ol},{name:"circle",renderer:new rl},{name:"ellipse",renderer:new al},{name:"line",renderer:new fl},{name:"image",renderer:new ll},{name:"ink",renderer:new hl},{name:"polygon",renderer:new dl},{name:"polyline",renderer:new cl},{name:"rect",renderer:new ul},{name:"stampPath",renderer:new gl},{name:"text",renderer:new pl},{name:"roundedRect",renderer:new ml},{name:"freeText",renderer:new yl}].forEach((t=>{let{name:i,renderer:s}=t;e.registerShapeRenderer(i,s);}));}destroy(){}}class bl extends Ka{constructor(t){super(t),this.use(new wl),this.use(new xl);}}function Cl(t,e,i){const s=e.x-t.x,n=e.y-t.y,o=i.x-t.x,r=s*(i.y-t.y)-n*o,a=Js(t,e),l=Js(t,i);let h=(a**2+l**2-Js(e,i)**2)/(2*a*l);h<-1&&(h=-1),h>1&&(h=1);let d=180*Math.acos(h)/Math.PI;return d=Math.round(100*d)/100,r<0?-d:d}function Sl(t,e,i){const s=$s(e,t);return $s(e,i).angle(s)>Math.PI/2?-1:1}function Pl(t,e){return (e=t.getWorldTransform().inverse().transformPoint(e)).x+=t.parsedStyle.x,e.y+=t.parsedStyle.y,e}function Al(t){if(!t)return !1;const{shapeType:e}=t;return "annotationRect"===e||"annotationFreeText"===e&&"textBox"===t.textType||"annotationStamp"===e&&"image"===t.renderType}function Tl(t){return !!t&&("annotationPolyline"===t.shapeType||"annotationPolygon"===t.shapeType||"annotationLine"===t.shapeType)}function kl(t){return !!t&&("annotationFreeText"===t.shapeType||"annotationTextBox"===t.shapeType)}function Dl(t,e){const i=window.TouchEvent&&e instanceof TouchEvent?e.targetTouches[0]:e,s=t.getBoundingClientRect();return {offsetX:i.pageX-window.scrollX-s.left,offsetY:i.pageY-window.scrollY-s.top}}function El(t){let e,i;if(t.controls){const{width:s,height:n}=t.controls.getLength();e=s,i=n;}else {const{x:s,y:n}=t.getScale(),{width:o,height:r}=t.getBoundingRect();e=o*s,i=r*n;}return {width:e,height:i}}function Il(t){return /^[\r\n]+$/.test(t)}function Rl(t,e,i){return t.slice(0,e)+t.slice(i+1)}function Ml(t,e){const{textContents:i}=t.style,s=[];return i.forEach((t=>{s.push({...t,...e});})),s}function Bl(t,e){const{textContents:i}=t.style,{textSelection:s}=t.textEditEventHandler;if(!s.length)return i;const[n,o]=s,r=n.freeContentIndex,a=o.freeContentIndex,l=i.slice(0,r),h=i.slice(r,a+1),d=i.slice(a+1),c=[];if(n.freeContentIndex===o.freeContentIndex){const{content:t}=h[0],i=t.slice(0,n.indexInFreeContent),s=t.slice(n.indexInFreeContent,o.indexInFreeContent+1),r=t.slice(o.indexInFreeContent+1);i&&c.push({...h[0],content:i}),s&&c.push({...h[0],...e,content:s}),r&&c.push({...h[0],content:r});}else for(let t=0;t<h.length;t++){const i=h[t];0===t?(c.push({...i,content:i.content.slice(0,n.indexInFreeContent)}),c.push({...i,...e,content:i.content.slice(n.indexInFreeContent)})):t===h.length-1?(c.push({...i,...e,content:i.content.slice(0,o.indexInFreeContent+1)}),c.push({...i,content:i.content.slice(o.indexInFreeContent+1)})):c.push({...i,...e});}return [...l,...c,...d]}function Ll(t){if(!t)return !1;let e=t,i="visible"===e.parsedStyle.visibility;for(;e;)e.parsedStyle.visibility&&"hidden"===e.parsedStyle.visibility&&(i=!1),e=e.parentNode;return i}var Ul;!function(t){t.REJECTED="SBRejected",t.ACCEPTED="SHAccepted",t.INITIAL_HERE="SHInitialHere",t.SIGN_HERE="SHSignHere",t.WITNESS="SHWitness",t.APPROVED="SBApproved",t.NOT_APPROVED="SBNotApproved",t.DRAFT="SBDraft",t.FINAL="SBFinal",t.COMPLETED="SBCompleted",t.CONFIDENTIAL="SBConfidential",t.VOID="SBVoid";}(Ul||(Ul={}));const Ol={border:"1px solid #59626A",background:"transparent",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},_l={content:"Insert text here...",fontSize:32,color:"red",lineThrough:!1,underline:!1,fontFamily:"Times New Roman",fontStyle:"normal",fontWeight:"normal"},Nl={opacity:1,background:"",borderColor:"red",borderWidth:4,lineDash:[0,0],lineEnding:["None","None"],stampIcon:Ul.DRAFT,imageData:null,textAlign:"left",textContent:{..._l}},Wl={enableControl:!0,useDefaultControls:!0,enableEdit:!0,enableMove:!0,enableRotate:!0},Fl={showOnTopWhenSelected:!1,enableContinuousDrawing:!1,inkCreateDelay:3e3,controlsStyle:Ol,defaultStyleConfig:{},eraserStyle:{background:"rgba(0,0,0)",borderColor:"rgba(0,0,0)",opacity:.3,borderWidth:8},selectionStyle:{background:"transparent",borderWidth:2,borderColor:"#59626A",lineDash:[5,5]}};class Hl{constructor(t){l(this,"shape",void 0),l(this,"startTime",void 0),l(this,"startPoint",void 0),l(this,"lastPoint",void 0),l(this,"limitPosition",void 0),l(this,"limitAngle",void 0),l(this,"unLimitPosition",void 0),l(this,"unLimitScale",void 0),l(this,"unLimitStyle",void 0),l(this,"limitArea",void 0),this.shape=t;}setLimitArea(t){this.limitArea=t;}updateShapeByLimitArea(){const{shapeType:t}=this.shape,{left:e,right:i,top:s,bottom:n}=this.isOutOfLimitArea(1,1),o=e||i||s||n,r=Al(this.shape)||"annotationEllipse"===t;o?(r?this.shape.updateStyle(this.unLimitStyle||{}):this.shape.setLocalScale(this.unLimitScale||this.shape.getLocalScale()),this.shape.setLocalPosition(this.unLimitPosition||this.shape.getLocalPosition())):(r&&(this.unLimitStyle={width:this.shape.style.width,height:this.shape.style.height,rx:this.shape.style.rx,ry:this.shape.style.ry}),this.unLimitPosition=this.shape.getLocalPosition().clone(),this.unLimitScale=this.shape.getLocalScale().clone());}getShapeOriginPosition(){const{x:t,y:e,width:i,height:s}=this.shape.getBoundingRect(),n=new fa({style:{x:t-this.shape.style.x+i/2,y:e-this.shape.style.y+s/2}});this.shape.appendChild(n);const{x:o,y:r}=n.getPosition();return n.destroy(),{x:o,y:r}}getShapeVertexPosition(){const{x:t,y:e,width:i,height:s}=this.shape.getBoundingRect(),n=[];for(let o=0;o<4;o++){let r=t-this.shape.style.x,a=e-this.shape.style.y;switch(o){case 1:r+=i;break;case 2:r+=i,a+=s;break;case 3:a+=s;}const l=new fa({style:{x:r,y:a}});this.shape.appendChild(l);const{x:h,y:d}=l.getPosition();n.push({x:h,y:d}),l.destroy();}return n}isOutOfLimitArea(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.limitArea)return {left:!1,right:!1,top:!1,bottom:!1};const{x:i,y:s,width:n,height:o}=this.limitArea;let r=!1,a=!1,l=!1,h=!1;const d=this.getShapeVertexPosition();for(let c=0;c<4;c++){const{x:u,y:p}=d[c];r=u<i-t||r,a=u>i+n+t||a,l=p<s-e||l,h=p>s+o+e||h;}return {left:r,right:a,top:l,bottom:h}}getLimitPosition(){if(!this.limitArea)return null;const t=this.getShapeVertexPosition(),{x:e,y:i}=t[0],{x:s,y:n,width:o,height:r}=this.limitArea,a=t[1].x-e,l=t[2].x-e,h=t[3].x-e,d=t[1].y-i,c=t[2].y-i,u=t[3].y-i;let p=s-Math.min(a,l,h),g=s+o-Math.max(a,l,h),f=n-Math.min(d,c,u),m=n+r-Math.max(d,c,u);if(a>=0&&l>=0&&h>=0?p=s:a<=0&&l<=0&&h<=0&&(g=s+o),d>=0&&c>=0&&u>=0?f=n:d<=0&&c<=0&&u<=0&&(m=n+r),(y=this.shape)&&("annotationEllipse"===y.shapeType||"annotationCircle"===y.shapeType)){const{x:t,y:s}=this.getShapeOriginPosition(),n=t-e,o=s-i;p+=n,g+=n,f+=o,m+=o;}var y;return {minPosX:p,maxPosX:g,minPosY:f,maxPosY:m}}getLimitRotateAngle(){if(!this.limitArea)return [];const t=function(t,e){const i=t,[s,n,o,r]=i,{x:a,y:l,width:h,height:d}=e,c=a+h,u=l+d,p=(s.x+n.x+o.x+r.x)/4,g=(s.y+n.y+o.y+r.y)/4,f=Math.sqrt((p-s.x)**2+(g-s.y)**2),m=p-f,y=p+f,v=g-f,x=g+f;if(m>a&&v>l&&y<c&&x<u)return [];const w=t=>{const e=f*f-(t-p)**2;return [{x:t,y:g-Math.sqrt(e)},{x:t,y:g+Math.sqrt(e)}]},b=t=>{const e=f*f-(t-g)**2;return [{x:p-Math.sqrt(e),y:t},{x:p+Math.sqrt(e),y:t}]},C=(e,i)=>{const s=[];return e.forEach((e=>{t.forEach((t=>{let n=Cl({x:p,y:g},t,e);0===n&&(n=p>t.x?g>t.y?-0:0:g>t.y?0:-0,"top"!==i&&"bottom"!==i||(n=-n)),s.push(n);}));})),s},S=[];if(m<a){const t=w(a);S.push(...C(t,"left"));}if(v<l){const t=b(l);S.push(...C(t,"top"));}if(y>c){const t=w(c);S.push(...C(t,"right"));}if(x>u){const t=b(u);S.push(...C(t,"bottom"));}return S}(this.getShapeVertexPosition(),this.limitArea);if(0===t.length)return [];let e=0;if(t.forEach((t=>{0===t&&e++;})),e>=2)return [0,0];const{maxNegative:i,minPositive:s}=function(t){let e=-1/0,i=1/0;for(let s=0;s<t.length;s++)t[s]<0&&t[s]>e||Object.is(t[s],-0)?e=t[s]:(t[s]>0&&t[s]<i||Object.is(t[s],0))&&(i=t[s]);return e===-1/0&&(e=0),i===1/0&&(i=0),{maxNegative:e,minPositive:i}}(t);return [i,s]}moveShape(t){const{shape:e,startPoint:i}=this,{lastWorldPosition:s,controlsFlags:n}=e.context;if(!n.enableMove)return;if(new Fo(t.x,t.y).distanceTo(i)<0)return;const o=t.x-i.x,r=t.y-i.y;let a=s.x+o,l=s.y+r;const{left:h,right:d,top:c,bottom:u}=this.isOutOfLimitArea(1,1),p=h||d||c||u;if(this.limitPosition&&!p){const{minPosX:t,maxPosX:e,minPosY:i,maxPosY:s}=this.limitPosition;a<t&&(a=t),a>e&&(a=e),l<i&&(l=i),l>s&&(l=s);}this.shape.setPosition({x:a,y:l});}moveVertex(t){const{shape:e}=this,{context:i,shapeType:s}=e,{hitControlPoint:n,lastLocalScale:o,lastControlsWidth:r,lastControlsHeight:a,keepAspectRatio:l,lastHitControlPoint:h,lastShareAxisYPoint:d,lastShareAxisXPoint:c,lastLocalTransform:u}=i,p=Qo(h,c,t).distanceTo(c)||1;if(Sl(h,c,t)<0)return;let g=p-r,f=p/r;const m=Qo(h,d,t).distanceTo(d)||1;if(Sl(h,d,t)<0)return;let y=m-a,v=m/a;l&&(f>=v?(v=f,y=v*a-a):(f=v,g=f*r-r));const{left:x,right:w,top:b,bottom:C}=this.isOutOfLimitArea(1,1),S=x||w||b||C,P="annotationEllipse"===s;Al(e)?this.moveRectVertex(n,g,y):P?this.moveEllipseVertex(n,g,y):(n<2&&(y=-y),0!==n&&3!==n||(g=-g),e.setLocalTransform(u),e.translate(g/2,y/2),e.setLocalScale(f*o.x,v*o.y,1)),S||0===e.getAngle()||this.updateShapeByLimitArea(),e.context.updateControls();}moveEllipseVertex(t,e,i){const{shape:s}=this,{x:n,y:o}=s.getScale(),{lastShapeWidth:r,lastShapeHeight:a,lastLocalTransform:l}=this.shape.context,h=(r+e/Math.abs(n))/2,d=(a+i/Math.abs(o))/2;s.style.rx=h<1?1:h,s.style.ry=d<1?1:d,t<2&&(i=-i),0!==t&&3!==t||(e=-e),this.shape.setLocalTransform(l),this.shape.translate(e/2,i/2);}moveRectVertex(t,e,i){const{shape:s}=this,{x:n,y:o}=s.getScale(),{lastShapeWidth:r,lastShapeHeight:a,lastLocalTransform:l,lastWorldPosition:h}=this.shape.context,d=t,c=r+e/Math.abs(n),u=a+i/Math.abs(o);if(s.style.width=c<1?1:c,s.style.height=u<1?1:u,2===d)s.setPosition({x:h.x,y:h.y});else switch(s.setLocalTransform(l),d){case 1:s.translate(0,-i);break;case 3:s.translate(-e,0);break;default:s.translate(-e,-i);}}moveMidpoints(t){const{shape:e}=this,{context:i,shapeType:s}=e,{lastLocalScale:n,lastControlsWidth:o,lastControlsHeight:r,lastLocalTransform:a,lastHitControlPoint:l,lastShareAxisPoint:h,hitControlPoint:d}=i,c=d-4,u=Qo(l,h,t).distanceTo(h);if(Sl(l,h,t)<0)return;const p="annotationEllipse"===s,g=u/o*n.x,f=u/r*n.y,m=(1===c?1:-1)*(u-o),y=(2===c?1:-1)*(u-r),{left:v,right:x,top:w,bottom:b}=this.isOutOfLimitArea(1,1),C=v||x||w||b;Al(e)?this.moveRectMidPoint(c,m,y):p?this.moveEllipseMidPoint(c,m,y):c%2?(this.shape.setLocalTransform(a),this.shape.translate(m/2,0),this.shape.setLocalScale(g,n.y,1)):(this.shape.setLocalTransform(a),this.shape.translate(0,y/2),this.shape.setLocalScale(n.x,f,1)),C||0===e.getAngle()||this.updateShapeByLimitArea(),this.shape.context.updateControls();}moveRectMidPoint(t,e,i){const{shape:s}=this,{x:n,y:o}=s.getScale(),{lastShapeHeight:r,lastWorldPosition:a,lastLocalTransform:l,lastShapeWidth:h}=s.context;if(t%2){const i=(1===t?e:-e)/Math.abs(n)+h;s.style.width=i<1?1:i,1===t?this.shape.setPosition({x:a.x,y:a.y}):(this.shape.setLocalTransform(l),this.shape.translate(e,0));}else {const e=(2===t?i:-i)/Math.abs(o)+r;s.style.height=e<1?1:e,2===t?this.shape.setPosition({x:a.x,y:a.y}):(this.shape.setLocalTransform(l),this.shape.translate(0,i));}}moveEllipseMidPoint(t,e,i){const{shape:s}=this,{x:n,y:o}=s.getScale(),{lastShapeHeight:r,lastLocalTransform:a,lastShapeWidth:l}=s.context;if(t%2){const i=(1===t?e:-e)/Math.abs(n)+l;s.style.rx=i<2?1:i/2,this.shape.setLocalTransform(a),this.shape.translate(e/2,0);}else {const e=(2===t?i:-i)/Math.abs(o)+r;s.style.ry=e<2?1:e/2,this.shape.setLocalTransform(a),this.shape.translate(0,i/2);}}moveRotationPoint(t){const{startPoint:e,shape:i}=this,{lastOriginWorldPosition:s,lastLocalTransform:n}=i.context,o=Cl(s,e,t);this.shape.setLocalTransform(n),this.shape.rotateLocal(o);}isHit(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{shape:i}=this,{context:s,parsedStyle:n}=i;if("hidden"===n.visibility||!s.controlsFlags.enableControl)return -1;if(s.isGrouped)return s.unHitShape(),-1;let{controls:o}=i,r=!0;o||(r=!1,s.initControls(),s.renderControls(),o=i.controls);let a=o.checkHitArea(t.x,t.y);return Tl(i)&&!i.context.controlsFlags.useDefaultControls&&(8===a?a=-1:a>0&&(a=9),-1!==i.pointEventsHandler.isHitPoint(t)&&(a=0)),a<0?(e&&(s.unHitShape(),r||i.context.destroyControls()),-1):a}startHandler(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.isHit(t);if(-1===i&&!e)return;-1===i&&e&&(i=9);const{shape:s}=this,{context:n,controls:o}=s;if(n.isStart=!0,this.lastPoint={...t},this.startPoint={...t},this.startTime=(new Date).getTime(),Tl(s)&&(s.pointEventsHandler.enableEditMode(),s.pointEventsHandler.editStartHandler(t)),kl(s)&&s.textEditEventHandler.editStartHandler(t),this.limitPosition=this.getLimitPosition(),n.controlsFlags.useDefaultControls){n.hitShape(),n.hitControlPoint=i;const{ctrlWidth:e,ctrlHeight:s}=n.parsedControlsStyle,r=e/2,a=s/2;if(i<4){const e=o.controlPoints.slice(0,4),s=e[i].getPosition().x+r,l=e[i].getPosition().y+a;n.lastHitControlPoint={...t},n.lastHitControlPointCenter={x:s,y:l},n.lastShareAxisYPoint={x:e[3-i].getPosition().x+r+t.x-s,y:e[3-i].getPosition().y+a+t.y-l},n.lastShareAxisXPoint={x:e[i%2?i-1:i+1].getPosition().x+r+t.x-s,y:e[i%2?i-1:i+1].getPosition().y+a+t.y-l};}else if(i<8){const e=o.controlPoints.slice(4,8),s=e[i-4].getPosition().x+r,l=e[i-4].getPosition().y+a;n.lastHitControlPoint={...t},n.lastHitControlPointCenter={x:s,y:l},n.lastShareAxisPoint={x:e[(i-2)%4].getPosition().x+r+t.x-s,y:e[(i-2)%4].getPosition().y+a+t.y-l};}}else n.isHit=!0,n.hitControlPoint=9,n.lastWorldPosition=s.getPosition(),n.lastControlsWorldPosition=s.controls.getPosition();}moveHandler(t,e){const{shape:i,lastPoint:s}=this,{context:n,controls:o}=i,{isHit:r,isStart:a,hitControlPoint:l}=n,h=Tl(i),d=kl(i);r&&a&&o&&(s.x=t.x,s.y=t.y,h&&-1!==i.pointEventsHandler.hitIndex?i.pointEventsHandler.editMoveHandler(t):d&&i.textEditEventHandler.editMode?i.textEditEventHandler.editMoveHandler(t):l<4?(n.keepAspectRatio=e,this.moveVertex(t)):l<8?this.moveMidpoints(t):l<9?this.moveRotationPoint(t):(this.moveShape(t),h&&i.pointEventsHandler.updateLineControls()));}endHandler(t){const{shape:e,startPoint:i,lastPoint:s}=this,{context:n}=e,{isStart:o,isHit:r}=e.context;if(!o||!r)return;const a=(new Date).getTime()-this.startTime,l=s.x-i.x,h=s.y-i.y,d=a<=200&&(l**2+h**2)**.5<2,c=Tl(e),u=kl(e);if(c&&e.pointEventsHandler.editEndHandler(),u&&e.textEditEventHandler.editEndHandler(),!n.isActive&&d&&(n.isActive=!0),t){if(u&&e.textEditEventHandler.editMode)return void(n.hitControlPoint=-1);const i=[];if(8===n.hitControlPoint)i.push("rotated");else {const{lastControlsWorldPosition:t,lastControlsWidth:s,lastControlsHeight:o,lastWorldPosition:r}=n,{width:a,height:l}=e.controls.getLength(),h=e.controls.getPosition(),d=e.getPosition(),u=e instanceof Gl?t:r,p=e instanceof Gl?h:d;p.x.toFixed(1)===u.x.toFixed(1)&&p.y.toFixed(1)===u.y.toFixed(1)||i.push("moved");const g=c&&-1!==e.pointEventsHandler.hitIndex,f=!(!s||!o)&&(a.toFixed(3)!==s.toFixed(3)||l.toFixed(3)!==o.toFixed(3));e instanceof th||!g&&!f||i.push("resized");}const s=[...new Set(i)];s.length&&t.emitModifyAnnotation(s,[e]);}n.isHit=!1,n.keepAspectRatio=!1;}}class Vl extends pa{constructor(t,e){super({type:"annotationGroup",style:{visibility:"visible"}}),l(this,"shapeType","annotationControls"),l(this,"container",void 0),l(this,"borders",void 0),l(this,"rotationPoint",void 0),l(this,"controlPoints",void 0),l(this,"rotationBorder",void 0),l(this,"rotationPointOffset",30),l(this,"vertexes",[]),l(this,"midpoints",[]),this.container=t;for(const t in e)mn(t,e)&&(this[t]=e[t]);this.updateControlPoints(this.vertexes),this.initBorders(),this.initControls();}get isVisible(){return "hidden"!==this.parsedStyle.visibility&&Ll(null==this?void 0:this.container)}initBorders(){const{borderColor:t,borderWidth:e,lineDash:i,background:s}=this.container.context.parsedControlsStyle,{width:n}=this.container.getBoundingRect(),o=e/2;this.borders=new Sa({style:{points:this.vertexes,borderWidth:e,background:s,borderColor:t,lineDash:i}}),this.borders.setLocalPosition(-o,-o),this.rotationBorder=new Sa({style:{points:[this.midpoints[0],this.rotationPoint],borderWidth:e,borderColor:t,lineDash:i}});const r=Math.abs(this.midpoints[0].y-this.rotationPoint.y);this.rotationBorder.setLocalPosition(n/2-o,-r),this.appendChild(this.borders),this.appendChild(this.rotationBorder);}initControls(){const{vertexes:t,midpoints:e,rotationPoint:i}=this,{ctrlBorderColor:s,ctrlBorderWidth:n,ctrlLineDash:o,ctrlBackground:r,ctrlWidth:a,ctrlHeight:l,ctrlBorderRadius:h}=this.container.context.parsedControlsStyle,{x:d,y:c}=this.container.getBoundingRect(),u=[...t,...e,i],p={background:r,borderColor:s,borderWidth:n,lineDash:o,width:a,height:l,roundedRadius:h};u.forEach((t=>{const e=new Ra({style:{x:t.x,y:t.y,...p}});e.setLocalPosition(t.x-rr(a).value/2-d,t.y-rr(l).value/2-c),this.controlPoints||(this.controlPoints=[]),this.controlPoints.push(e),this.appendChild(e);}));}calculateMidpoints(t){const e=[];for(let i=0,s=t.length;i<s;i++){const n=new Fo((t[i].x+t[(i+1)%s].x)/2,(t[i].y+t[(i+1)%s].y)/2);e.push(n);}return e}calculateRotationPoint(t){const e=t[0].distanceTo(t[2]),i=this.rotationPointOffset/e+1;return t[2].lerpTo(t[0],i)}update(t){const{midpoints:e,rotationPoint:i,container:s}=this,{ctrlWidth:n,ctrlHeight:o,borderWidth:r}=this.container.context.parsedControlsStyle,a=[...t,...e,i],{x:l,y:h,width:d,height:c}=s.getBoundingRect(),u=r/2;this.controlPoints.forEach(((t,e)=>{const{x:i,y:s}=a[e];t.updateStyle({x:i,y:s}),t.setLocalPosition(i-n/2-l,s-o/2-h);})),this.borders.updateStyle({points:t}),this.borders.setLocalPosition(d<0?d:-u,c<0?c:-u);const p=Math.min(e[0].x,i.x),g=Math.min(e[0].y,i.y);this.rotationBorder.updateStyle({points:[e[0],i]}),this.rotationBorder.setLocalPosition(p-l-u,g-h);}updateOrigin(){const t=this.controlPoints[4].parsedStyle.x-this.controlPoints[0].parsedStyle.x,e=this.controlPoints[7].parsedStyle.y-this.controlPoints[0].parsedStyle.y;this.setOrigin(t,e);}updateControlPoints(t){this.vertexes=t,this.midpoints=this.calculateMidpoints(this.vertexes),this.rotationPoint=this.calculateRotationPoint(this.midpoints);}getLength(){const t=this.midpoints[2].y-this.midpoints[0].y;return {width:this.midpoints[1].x-this.midpoints[3].x,height:t}}setVisible(t){this.style.visibility=t;}setBoxVisible(t){this.borders.style.visibility=t;}setRotationPointVisible(t){this.rotationBorder.style.visibility=t,this.controlPoints[8].style.visibility=t;}setControlPointVisible(t){this.controlPoints.forEach(((e,i)=>{i<8&&(e.style.visibility=t);}));}checkHitArea(t,e){const i=this.getWorldTransform().inverse().transformPoint({x:t,y:e}),{x:s,y:n}=this.controlPoints[0].parsedStyle,o={x:i.x+s,y:i.y+n},{ctrlWidth:r,ctrlHeight:a}=this.container.context.parsedControlsStyle;i.x+=s+r/2,i.y+=n+a/2;const l=Ms()?10:0;let h=-1;for(let t=0;t<this.controlPoints.length;t++){const e=this.controlPoints[t];if("visible"===e.style.visibility&&e.isPointInPath({x:i.x,y:i.y},l)){h=t;break}}return h>-1?h:this.borders.isPointInPath(o)?9:-1}destroy(){this.parentNode&&(this.parentNode.removeChild(this),this.container.controls=null);}}class zl{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(this,"shape",void 0),l(this,"referencePoint",void 0),l(this,"controlsStyle",void 0),l(this,"controlsFlags",void 0),l(this,"parsedControlsStyle",void 0),l(this,"keepAspectRatio",!1),l(this,"isInGroup",!1),l(this,"isGrouped",!1),l(this,"isActive",!1),l(this,"isStart",!1),l(this,"isHit",!1),l(this,"hitControlPoint",-1),l(this,"lastHitControlPoint",void 0),l(this,"lastHitControlPointCenter",void 0),l(this,"lastLocalTransform",void 0),l(this,"lastWorldPosition",void 0),l(this,"lastLocalScale",void 0),l(this,"lastOriginWorldPosition",void 0),l(this,"lastControlsWorldPosition",void 0),l(this,"lastControlsWidth",void 0),l(this,"lastControlsHeight",void 0),l(this,"lastShareAxisPoint",void 0),l(this,"lastShareAxisXPoint",void 0),l(this,"lastShareAxisYPoint",void 0),l(this,"lastShapeWidth",void 0),l(this,"lastShapeHeight",void 0),this.shape=t,this.controlsStyle={...Ol,...e},this.controlsFlags={...Wl},this.parseControlsStyle();}initReferenceBox(){if(this.referencePoint)return void this.updateReferenceBox();const{x:t,y:e}=this.shape.getBoundingRect(),i=t-this.shape.style.x,s=e-this.shape.style.y,n=new fa({style:{x:i,y:s,r:0}});this.shape.appendChild(n),this.referencePoint=n;}updateReferenceBox(){if(!this.referencePoint)return;const{x:t,y:e}=this.shape.getBoundingRect(),i=t-this.shape.style.x,s=e-this.shape.style.y;this.referencePoint.updateStyle({x:i,y:s});}getControlVertexes(){const{shape:t}=this,{x:e,y:i,width:s,height:n}=t.getBoundingRect();return [new Fo(e,i),new Fo(e+s,i),new Fo(e+s,i+n),new Fo(e,i+n)]}getScaledControlVertexes(){const{shape:t}=this,{x:e,y:i}=t.getScale(),{x:s,y:n,width:o,height:r}=t.getBoundingRect(),a=o*Math.abs(e)||1,l=r*Math.abs(i)||1;return [new Fo(s,n),new Fo(s+a,n),new Fo(s+a,n+l),new Fo(s,n+l)]}showControls(){this.initReferenceBox();const{shape:t,referencePoint:e}=this,{x:i,y:s}=e.getPosition(),n=t.getAngle(),o=i,r=s;t.controls.setAngle(n),t.controls.setPosition({x:o,y:r});}parseControlsStyle(){if(!this.controlsStyle)return;this.parsedControlsStyle={};const{background:t,border:e,ctrlWidth:i,ctrlHeight:s,ctrlBackground:n,ctrlBorderRadius:o,ctrlBorder:r}=this.controlsStyle,a=e||Ol.border,{borderColor:l,borderStyle:h,borderWidth:d}=hn(a),c=rr(d).value,u=r||Ol.ctrlBorder,{borderColor:p,borderStyle:g,borderWidth:f}=hn(u),m=rr(f).value,y=rr(i).value,v=ar(o),x="%"===v.unit?v.value/100*y:o||Ol.ctrlBorderRadius;this.parsedControlsStyle={background:t||Ol.background,ctrlBackground:n||Ol.ctrlBackground,ctrlBorderRadius:x,borderColor:l,borderWidth:c,lineDash:"solid"===h?[0,0]:[2*c,c],ctrlWidth:y,ctrlHeight:rr(s).value,ctrlBorderColor:p,ctrlBorderWidth:m,ctrlLineDash:"solid"===g?[0,0]:[2*m,m]};}updateControlsFlags(t){const{enableEdit:e,enableRotate:i,enableControl:s,isVisible:n}=t;this.shape.controls&&(Is(e)&&this.shape.controls.setControlPointVisible(e?"visible":"hidden"),Is(i)&&this.shape.controls.setRotationPointVisible(i?"visible":"hidden"),Is(s)&&!s&&this.destroyControls()),Is(n)&&(this.shape.style.visibility=n?"visible":"hidden"),this.controlsFlags={...this.controlsFlags,...t};}hitShape(){const{shape:t}=this,{shapeType:e,controls:i}=t;this.isHit=!0,this.lastWorldPosition=t.getPosition().clone(),this.lastLocalTransform=t.getLocalTransform().clone(),this.lastLocalScale=t.getLocalScale(),this.lastControlsWorldPosition=i.getPosition().clone(),this.lastControlsWidth=i.getLength().width,this.lastControlsHeight=i.getLength().height;const s=t.getBoundingRect(),n=new fa({style:{x:s.x-t.style.x+s.width/2,y:s.y-t.style.y+s.height/2,r:0}});t.appendChild(n),this.lastOriginWorldPosition=n.getPosition(),n.destroy();"annotationEllipse"===e&&(this.lastShapeWidth=2*t.parsedStyle.rx.value,this.lastShapeHeight=2*t.parsedStyle.ry.value),Al(this.shape)&&(this.lastShapeWidth=t.parsedStyle.width.value,this.lastShapeHeight=t.parsedStyle.height.value);}unHitShape(){const{context:t}=this.shape;t.isStart=!1,t.isHit=!1,t.isActive=!1,t.hitControlPoint=-1,kl(this.shape)&&this.shape.textEditEventHandler.disableEditMode(),Tl(this.shape)&&this.shape.pointEventsHandler.disableEditMode();}initControls(){const{shape:t}=this,e=this.getControlVertexes(),i=new Vl(t,{vertexes:e});t.controls=i,t.getRootNode().appendChild(i),this.updateControlsFlags(this.controlsFlags);}updateControls(){var t,e,i,s;const{shape:n}=this,o=this.getScaledControlVertexes();JSON.stringify(o)!==JSON.stringify(null===(t=n.controls)||void 0===t?void 0:t.vertexes)&&(null===(e=n.controls)||void 0===e||e.updateControlPoints(o),null===(i=n.controls)||void 0===i||i.update(o),null===(s=n.controls)||void 0===s||s.updateOrigin());}renderControls(){const{shape:t,isStart:e,isActive:i,controlsFlags:s,isInGroup:n}=this,{useDefaultControls:o}=s,{controls:r}=t;let a="hidden";r&&(o&&(e||i||n)&&(a="visible"),r&&r.setVisible(a),this.updateControls(),this.showControls());}destroyControls(){var t,e;null===(t=this.referencePoint)||void 0===t||t.destroy(),this.referencePoint=null,null===(e=this.shape.controls)||void 0===e||e.destroy(),this.shape.controls=null;}getTransform(){const{parentNode:t}=this.shape,e=t instanceof th&&this.shape.context.isGrouped;e&&t.delete(this.shape,!1);const i={...this.shape.getLocalPosition()},s=this.shape.getLocalAngle(),n={...this.shape.getLocalScale()};return e&&t.add(this.shape),{angle:s,scale:n,position:i}}setTransform(t){if(t){const{scale:e,angle:i,position:s}=t;s&&this.shape.setLocalPosition(s),Ts(i)||this.shape.setLocalAngle(i),Ts(e)||this.shape.setLocalScale(e);}}getCommonStyleConfig(){const{lineCap:t,lineJoin:e,lineDash:i,background:s,fillOpacity:n,opacity:o,visibility:r,miterLimit:a,borderColor:l,borderWidth:h,borderOpacity:d}=this.shape.attributes;return {lineCap:t,lineJoin:e,lineDash:i,background:s,opacity:o,borderColor:l,borderWidth:h,miterLimit:a}}getRealTimeBoundingBox(){this.shape.boundsDirty=!0;const{x:t,y:e,width:i,height:s}=this.shape.getBoundingRect(),n=[],{useDefaultControls:o,enableRotate:r}=this.shape.context.controlsFlags,a=o&&r?5:4;for(let o=0;o<a;o++){let r=t-this.shape.style.x,a=e-this.shape.style.y;1!==o&&2!==o||(r+=i),2!==o&&3!==o||(a+=s),4===o&&(r+=i/2,a-=30/this.shape.getScale().y);const l=new fa({style:{x:r,y:a,r:0}});this.shape.appendChild(l);const{x:h,y:d}=l.getPosition();n.push({x:h,y:d}),l.destroy();}return Xr(n)}}class jl extends ga{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationArc",...t}),l(this,"shapeType","annotationArc"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.eventHandler=new Hl(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}getAnnotationConfig(){const t=this.context.getTransform(),{position:e}=t,{r:i,startAngle:s,endAngle:n}=this.attributes;return {type:"annotationArc",style:{x:e.x,y:e.y,r:i,startAngle:s,endAngle:n,...this.context.getCommonStyleConfig()},transform:t}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}}class $l extends fa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationCircle",...t}),l(this,"shapeType","annotationCircle"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.eventHandler=new Hl(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const t=this.context.getTransform(),{position:e}=t,{r:i}=this.attributes;return {type:"annotationCircle",style:{x:e.x,y:e.y,r:i,...this.context.getCommonStyleConfig()},transform:t}}}class Gl extends ma{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationEllipse",...t}),l(this,"shapeType","annotationEllipse"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.eventHandler=new Hl(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const t=this.context.getTransform(),{rx:e,ry:i}=this.parsedStyle,{position:s}=t;return {type:"annotationEllipse",style:{x:s.x-e.value,y:s.y-i.value,width:2*e.value,height:2*i.value,...this.context.getCommonStyleConfig()},transform:t}}}class Xl extends ya{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationImage",...t}),l(this,"shapeType","annotationImage"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.eventHandler=new Hl(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const{x:t,y:e,img:i,opacity:s,visibility:n,width:o,height:r}=this.attributes;return {type:"annotationImage",style:{x:t,y:e,width:o,height:r,img:i,opacity:s,visibility:n},meteData:this.meteData,transform:this.context.getTransform()}}}class Yl extends va{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationInk",...t}),l(this,"shapeType","annotationInk"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.eventHandler=new Hl(this),this.context.setTransform(t),this.update();}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}setUseDouglasPeucker(t){t?(this.boundsDirty=!0,this.pathDirty=!0,this.useDouglasPeucker=!0):this.useDouglasPeucker=!1;}getAnnotationConfig(){let t=this.attributes.segments;const e=this.context.getTransform(),i=this.getBoundingRect(),{position:s}=e;(s.x!==i.x||s.y!==i.y)&&(t=[],this.attributes.segments.forEach((e=>{const n=[];e.forEach((t=>{n.push({x:t.x-i.x+s.x,y:t.y-i.y+s.y,z:0});})),t.push(n);})),this.context.isGrouped||(this.style.segments=t));return {type:"annotationInk",style:{segments:t,...this.context.getCommonStyleConfig()},transform:e}}}class Jl extends Aa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationRect",...t}),l(this,"shapeType","annotationRect"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.eventHandler=new Hl(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const t=this.context.getTransform(),{width:e,height:i}=this.attributes,{position:s}=t;return {type:"annotationRect",id:this.id,style:{x:s.x,y:s.y,width:e,height:i,...this.context.getCommonStyleConfig()},transform:t}}getPath(){if(!this.pathDirty)return this.path;const{width:t,height:e,borderWidth:i}=this.parsedStyle,s=.5*((null==i?void 0:i.value)||0),n=s,o=s,r=t.value-2*s,a=e.value-2*s;return this.path=[{x:n,y:o},{x:n+r,y:o},{x:n+r,y:o+a},{x:n,y:o+a}],this.steps=$r(this.path),this.pathDirty=!1,this.path}getStrokePath(){return this.strokePath=[],[]}}class ql extends Ta{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super({type:"annotationText",...t}),l(this,"shapeType","annotationText"),l(this,"controls",void 0),l(this,"eventHandler",void 0),l(this,"context",void 0),l(this,"editMode",!1),l(this,"textCursor",void 0),l(this,"textArea",void 0),l(this,"startSelectText",!1),l(this,"selectRectArray",[]),l(this,"inputChinese",!1),l(this,"curIndex",0),l(this,"startIndex",0),l(this,"endIndex",0),l(this,"lastEndIndex",0),l(this,"renderHooks",void 0),this.init(t.transform,t.selectableStyle),e&&(this.renderHooks=e);}init(t,e){this.context=new zl(this,e),this.eventHandler=new Hl(this),this.context.setTransform(t);}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}getAnnotationConfig(){const{x:t,y:e,color:i,text:s,wordWarp:n,textBaseLine:o,fontStyle:r,fontVariant:a,fontWeight:l,fontFamily:h,fontSize:d,lineHeight:c,textAlign:u}=this.attributes;return {type:"annotationText",style:{x:t,y:e,color:i,text:s,wordWarp:n,textBaseLine:o,fontStyle:r,fontVariant:a,fontWeight:l,fontFamily:h,fontSize:d,lineHeight:c,textAlign:u,...this.context.getCommonStyleConfig()},transform:this.context.getTransform()}}startEditor(t,e){const i=Pl(this,{x:t,y:e});if(t=i.x,e=i.y,this.textArea&&(document.body.removeChild(this.textArea),this.textArea=void 0),!this.getCharByPosition(t,e))return void this.closeEditor();const s=this.getCharByPosition(t,e),n=.9*s.height;let o=0,r=0;t<s.x+s.width/2?(this.curIndex=s.index-1,o=s.x-this.chars[0].x):(this.curIndex=s.index,o=s.x-this.chars[0].x+s.width),r=s.y-this.chars[0].y;const a=this.parsedStyle.fontSize.value/50;if(!this.textCursor){const t=new Ea({style:{startPoint:{x:0,y:0},endPoint:{x:0,y:n},borderWidth:a,borderColor:"black"}});this.appendChild(t),this.textCursor=t;}this.textCursor.setLocalPosition(o,this.getRelativeYAxis(r)),this.openTextarea(t,e);}closeEditor(){this.textCursor&&this.removeChild(this.textCursor),this.textArea&&(this.textArea.removeEventListener("input",(t=>this.textareaInput(t))),this.textArea.removeEventListener("compositionstart",(t=>this.textareaCompositionstart(t))),this.textArea.removeEventListener("compositionend",(t=>this.textareaCompositionend(t))),this.textArea.removeEventListener("keydown",(t=>this.textareaKeydown(t))),document.body.removeChild(this.textArea)),this.clearTextSelection(),this.textCursor=void 0,this.textArea=void 0,this.curIndex=0,this.editMode=!1;}textStartHandler(){0!==this.selectRectArray.length&&this.clearTextSelection(),this.editMode&&(this.startSelectText=!0,this.startIndex=this.curIndex,this.endIndex=this.curIndex);}textMoveHandler(t){if(!this.editMode||!this.startSelectText)return;const{x:e,y:i}=Pl(this,t),s=this.getCharByPosition(e,i);if(this.endIndex=e<s.x+s.width/2?s.index-1:s.index,!s){const{lines:t,chars:s,parsedStyle:n}=this,{textBaseLine:o}=n,{height:r}=s[0],a=r/10;let l=0,h=i;switch(o){case"alphabetic":h=i+r-1.5*a;break;case"middle":h=i+r/2+a;break;case"ideographic":h=i+r+a;break;case"bottom":h=i+r+.5*a;}for(let e=t.length;e>0;e--)if(h>t[e-1].y){l=e-1;break}const d=t[l].sum-t[l].length,c=t[l].sum-1;this.endIndex=d;for(let t=c;t>=d;t--)if(e>this.chars[t].x+this.chars[t].width/2){this.endIndex=t+1;break}}this.endIndex!==this.lastEndIndex&&(this.lastEndIndex=this.endIndex,this.endIndex!==this.startIndex?(this.textCursor&&(this.removeChild(this.textCursor),this.textCursor=void 0),this.createTextSelectionArea(this.startIndex,this.endIndex)):this.clearTextSelection());}textEndHandler(){if(this.editMode){if(this.startSelectText=!1,this.startIndex!==this.endIndex&&this.textArea){var t;const{startIndex:e,endIndex:i}=this,s=Math.min(e,i),n=Math.max(e,i);null===(t=this.textArea)||void 0===t||t.setSelectionRange(s,n);}this.startIndex=0,this.endIndex=0;}}openTextarea(t,e){if(!this.context.isActive)return;const i=document.createElement("input");i.type="text";i.setAttribute("style","position:fixed; opacity:0; width:1; height:1; top:80%; left:80%; z-index:-999; word-break:break-all"),i.value=this.parsedStyle.text,document.body.appendChild(i);const s=this.curIndex;this.textArea=i,i.setSelectionRange(s,s),i.addEventListener("input",(t=>this.textareaInput(t)),!1),i.addEventListener("compositionstart",(t=>this.textareaCompositionstart(t)),!1),i.addEventListener("compositionend",(t=>this.textareaCompositionend(t)),!1),i.addEventListener("keydown",(t=>this.textareaKeydown(t)),!1),i.focus();}moveTextCursor(t,e){if(!this.textCursor)return;if(0===this.chars.length)return void this.destroy();const i=t+e-1;let s,n;i<-1||i===this.chars.length||(-1===i?(s=0,n=0):(s=this.chars[i].x-this.chars[0].x+this.chars[i].width,n=this.chars[i].y-this.chars[0].y),this.curIndex+=e,this.textCursor.setLocalPosition(s,this.getRelativeYAxis(n)));}updateTextCursor(t){if(!this.textCursor)return;if(t<0||t>this.chars.length)return;let e,i;0===t?(e=0,i=0):(e=this.chars[t-1].x-this.chars[0].x+this.chars[t-1].width,i=this.chars[t-1].y-this.chars[0].y),this.curIndex=t,this.textCursor.setLocalPosition(e,this.getRelativeYAxis(i)),setTimeout((()=>{this.textArea.setSelectionRange(this.curIndex,this.curIndex);}),0);}createTextSelectionArea(t,e){this.clearTextSelection();const i=Math.min(t,e),s=Math.max(t,e),n=[[]];let o=this.chars[i].lineIndex;for(let t=i;t<s;t++)o!==this.chars[t].lineIndex&&(n.push([]),o=this.chars[t].lineIndex),n[n.length-1].push(this.chars[t]);const r=this.chars[0].height;for(let t=0;t<n.length;t++){const e=n[t].length,i=n[t][0],s=n[t][e-1],o=i.x-this.lines[i.lineIndex].x,a=i.y-this.chars[0].y,l=s.x-this.lines[s.lineIndex].x-o+s.width,h=new Aa({style:{x:o,y:this.getRelativeYAxis(a)-2,height:r,width:l,background:"rgba(85,160,255,0.6)",borderColor:"transparent"}});this.selectRectArray.push(h),this.renderSelectedRect();}}renderSelectedRect(){if(0!==this.selectRectArray.length)for(let t=0;t<this.selectRectArray.length;t++)this.appendChild(this.selectRectArray[t]);}clearTextSelection(){if(0!==this.selectRectArray.length){for(let t=0;t<this.selectRectArray.length;t++)this.selectRectArray[t].destroy();this.selectRectArray=[];}}textareaInput(t){var e;if(this.inputChinese)return;const{length:i}=this.parsedStyle.text;this.style.text=this.textArea.value,""===this.textArea.value?(this.style.text=" ",this.textArea.value=" ",this.updateTextCursor(0)):this.moveTextCursor(this.curIndex,this.textArea.value.length-i),this.updateOrigin(),null===(e=this.renderHooks)||void 0===e||e.emit();}textareaCompositionstart(t){this.inputChinese=!0;}textareaCompositionend(t){var e;const i=this.textArea.value.length-this.style.text.length;this.inputChinese=!1,this.style.text=this.textArea.value,this.moveTextCursor(this.curIndex,i),this.updateOrigin(),null===(e=this.renderHooks)||void 0===e||e.emit();}textareaKeydown(t){var e;if("ArrowLeft"===t.key&&this.moveTextCursor(this.curIndex,-1),"ArrowRight"===t.key&&this.moveTextCursor(this.curIndex,1),"ArrowUp"===t.key){if(0===this.curIndex)return;if(0===this.chars[this.curIndex-1].lineIndex)this.updateTextCursor(0);else {const{charIndex:t,lineIndex:e}=this.chars[this.curIndex-1];t>this.lines[e-1].length?this.curIndex=this.lines[e-1].sum:this.curIndex=e-1==0?t:this.lines[e-2].sum+t,this.updateTextCursor(this.curIndex);}}if("ArrowDown"===t.key){if(this.curIndex===this.chars.length)return;if(0===this.curIndex)return void this.updateTextCursor(this.lines[0].length+1);if(this.chars[this.curIndex-1].lineIndex===this.lines.length-1)this.updateTextCursor(this.chars.length);else {const{charIndex:t,lineIndex:e}=this.chars[this.curIndex-1];t>this.lines[e+1].length?this.curIndex=this.lines[e+1].sum:this.curIndex=this.lines[e].sum+t,this.updateTextCursor(this.curIndex);}}if("Backspace"===t.key){if(0===this.selectRectArray.length)return;this.clearTextSelection();}null===(e=this.renderHooks)||void 0===e||e.emit();}}class Zl{constructor(t){l(this,"shape",void 0),l(this,"textCursor",void 0),l(this,"textCursorInitCache",void 0),l(this,"inputComposition",!1),l(this,"startChar",void 0),l(this,"startDirection",void 0),l(this,"startPoint",void 0),l(this,"textRects",[]),l(this,"virtualChar",void 0),l(this,"isStart",!1),l(this,"canvas",void 0),l(this,"textClipboard",[]),l(this,"lineChars",void 0),l(this,"flatChars",void 0),l(this,"editMode",void 0),l(this,"textarea",void 0),l(this,"textSelection",[]),this.shape=t,this.calculateCharPosition();}getLineIndexByMoved(t){const{lines:e}=this.shape;let i=0;for(let s=0;s<e.length;s++){const{y:n,height:o}=e[s],r=n-.8*o;t.y>r&&(i=s);}return i}getLineIndexByPosition(t){const{lines:e,limitWidth:i}=this.shape;for(let s=0;s<e.length;s++){const n=e[s],{x:o,y:r,height:a}=n,l=s===e.length-1?1:1.2;if(new Aa({style:{x:o,y:r-.8*a,width:i,height:a*l,borderWidth:1,background:"transparent"}}).isPointInPath(t))return s}return -1}getCharByPosition(t,e){if(-1===e)return null;const{lineChars:i}=this,s=i[e];for(let e=0;e<s.length;e++){const n=s[e],{x:o,y:r,charWidth:a,charHeight:l}=n,h=n.lineIndex===i.length-1?1:1.2;if(new Aa({style:{x:o,y:r-.8*l,width:a,height:l*h,borderWidth:1,background:"transparent"}}).isPointInPath(t))return n}return null}getCharAndDirection(t){const e=this.getLineIndexByPosition(t);let i,s=1;if(-1===e)return i=this.flatChars[this.flatChars.length-1],s=1,{char:i,direction:s};const n="textBox"===this.shape.textType;if(i=this.getCharByPosition(t,e),i){const{x:e,charWidth:n}=i;s=t.x<e+n/2?0:1;}else {const o=this.lineChars[e];i=o[o.length-1],s=1,n&&t.x<o[0].x&&(i=o[0],s=0);}return "\r"!==i.text&&"\n"!==i.text&&"\r\n"!==i.text||(s=0),0===s&&0!==i.indexInLine&&(i=this.lineChars[i.lineIndex][i.indexInLine-1],s=1),{char:i,direction:s}}createCursor(t,e,i,s){if(!this.textCursor){const n=document.createElement("div");return n.className="ddv-annotation-cursor",n.style.left=t-.5+"px",n.style.top=`${e}px`,n.style.transform=`rotate(${i}deg)`,n.style.width="1px",n.style.height=`${s}px`,this.canvas.parentNode.appendChild(n),void(this.textCursor=n)}this.textCursor.style.left=t-.5+"px",this.textCursor.style.top=`${e}px`,this.textCursor.style.height=`${s}px`,this.textCursor.style.transform=`rotate(${i}deg)`,this.textCursor.style.animation="none",this.textCursor.offsetWidth,this.textCursor.style.animation="";}showTextCursor(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=(t,e)=>{const{x:i,y:s,charWidth:n,charHeight:o,lineIndex:r}=t,a=e?i+n:i,l=s-.8*o,h=r>=this.lineChars.length-1?1:1.2;return new Aa({style:{x:a-this.shape.style.x,y:l-this.shape.style.y,borderWidth:"1px",height:o*h}})},n=t=>{this.shape.appendChild(t);const e=this.shape.getScale().y,i=t.getAngle();t.setAngle(0);const{x:s,y:n}=t.getPosition();t.destroy(),this.createCursor(s,n,i,t.parsedStyle.height.value*e);};if(!this.editMode)return void(this.textCursor&&this.hideTextCursor());const{flatChars:o,shape:r}=this;if(!o.length&&this.virtualChar){const{fontSize:t}=this.shape.freeTextContentStyle,e=rr(t).value;if(e!==this.virtualChar.charHeight){const{borderOffset:t,padding:i}=this.shape,{y:s}=this.shape.style;this.virtualChar.charHeight=e,this.virtualChar.y=s+t+i+.8*e;}return n(s(this.virtualChar,1)),void(this.textCursorInitCache={char:{totalIndex:0},isBack:1})}let a=o[t];if(Ts(t)&&(a=o[0],e=0),!o[t])return;"justify"===r.style.textAlign&&"textBox"===r.textType&&" "===a.text&&e&&o[a.totalIndex+1]&&(a=o[a.totalIndex+1],e=0);const l=o[a.totalIndex+1];let h;Il(a.text)&&e&&l&&(a=l,e=0),h=Il(a.text)&&e&&!l?s(this.virtualChar,1):s(a,e),n(h),this.startChar=a,this.startDirection=e,this.textCursorInitCache={char:a,isBack:e},i&&this.shape.hooks.selectTextChars.emit({startChar:a,endChar:a,isBack:!!e,needUpdate:!1});}moveTextCursor(t){const{textSelection:e}=this;let i,s;if(2===e.length){const[n,o]=e;switch(t){case"up":case"left":i=n.totalIndex,s=0;break;default:i=o.totalIndex,s=1;}return this.hideTextSelection(),this.shape.hooks.reRenderText.emit(),void this.showTextCursor(i,s)}const n=this.flatChars,o=n.length,{startChar:r,startDirection:a}=this;if(r){if("left"===t){const t=a?r.totalIndex-1:r.totalIndex-2;i=t>=0?t:0,s=t>=0?1:0;}else if("right"===t){const t=a?r.totalIndex+1:r.totalIndex;i=t>o-1?o-1:t,s=1;}else {const{x:e,charWidth:o,lineIndex:l}=r;if(0===l&&"up"===t)i=0,s=0;else if(l===this.lineChars.length-1&&"down"===t)i=n.length-1,s=1;else {const n=a?e+o:e,r="up"===t?this.lineChars[l-1]:this.lineChars[l+1];i=r[0].totalIndex,s=0,r.forEach((t=>{n>t.x+o/2&&(i=t.totalIndex,s=1);}));}}this.showTextCursor(i,s);}}hideTextCursor(){this.textCursor&&(this.textCursor.remove(),this.textCursor=null);}showTextSelection(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=[],{lines:n,parsedStyle:o,textType:r}=this.shape;if(this.hideTextSelection(),this.textSelection=[t,e],!t||!e)return;const a=["right","justify"].includes(o.textAlign)&&"textBox"===r;if(t.y===e.y){const i=Il(t.text),o=Il(e.text);if(i&&o)return;const r=t.x===e.x?t.charWidth:o?e.x-t.x:e.x-t.x+e.charWidth;s.push({x:t.x,y:t.y,lineIndex:t.lineIndex,width:r,height:n[t.lineIndex].height});}else {const i=this.shape.getTextAlignOffset(n[t.lineIndex]),{x:o,height:r}=n[t.lineIndex],l=a?n[t.lineIndex].widthWithoutLF:n[t.lineIndex].width;if(s.push({x:t.x,y:t.y,lineIndex:t.lineIndex,width:o+l+i-t.x,height:r}),e.lineIndex-t.lineIndex>1)for(let i=t.lineIndex+1;i<e.lineIndex;i++){const{x:t,y:e,height:o}=n[i],r=a?n[i].widthWithoutLF:n[i].width,l=this.shape.getTextAlignOffset(n[i]);s.push({x:t+l,y:e,width:r,height:o,lineIndex:i});}const h=this.shape.getTextAlignOffset(n[e.lineIndex]),{x:d,y:c,height:u}=n[e.lineIndex],p=a&&Il(e.text)?0:e.charWidth;s.push({x:d+h,y:c,width:e.x+p-d-h,height:u,lineIndex:e.lineIndex});}const{x:l,y:h}=this.shape.style;this.hideTextCursor(),s.forEach((t=>{const e=t.lineIndex===this.lineChars.length-1?1:1.2,i=new Aa({style:{x:t.x-l,y:t.y-h-.8*t.height,width:t.width,height:t.height*e,background:"rgba(0, 123, 255, 0.5)"}});this.shape.appendChild(i),this.textRects.push(i);})),this.shape.hooks.selectTextChars.emit({startChar:t,endChar:e,isBack:!0,needUpdate:i});}hideTextSelection(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.textRects.forEach((t=>{t.destroy();})),this.textSelection=[],this.textRects=[],t){const{char:t,isBack:e}=this.textCursorInitCache;this.showTextCursor(t.totalIndex,e);}}addText(t,e,i){if(!i||""===i)return;if(!t){const t={...this.shape.freeTextContentStyle,content:i};return this.shape.context.updateControlsFlags({useDefaultControls:!1}),this.shape.updateStyle({textContents:[t]}),this.shape.hooks.textContentUpdated.emit(),void this.showTextCursor(i.length-1,1)}const s=As(this.shape.style.textContents),{freeContentIndex:n,indexInFreeContent:o}=t,r=s[n],{content:a}=r,l=Ql(this.shape.freeTextContentStyle,r),h=()=>({...this.shape.freeTextContentStyle,content:i});if(e&&o===a.length-1)l?r.content+=i:s.splice(n+1,0,h());else if(e||o)if(l){const t=0===e?o:o+1;r.content=a.slice(0,t)+i+a.slice(t);}else {const t=[],i=a.slice(0,e?o+1:o),l=a.slice(e?o+1:o);i&&t.push({...r,content:i}),t.push(h()),l&&t.push({...r,content:l}),s.splice(n,1,...t);}else if(n){const t=s[n-1];Ql(this.shape.freeTextContentStyle,t)?s[n-1].content+=i:s.splice(n,0,h());}else l?r.content=i+r.content:s.unshift(h());this.shape.updateStyle({textContents:[...s]}),this.shape.hooks.textContentUpdated.emit();const{char:d,isBack:c}=this.textCursorInitCache;c?this.showTextCursor(d.totalIndex+i.length,1):this.showTextCursor(d.totalIndex+i.length-1,1);}deleteText(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=As(this.shape.style.textContents);if(!e.length)return;let i=0;if(2===this.textSelection.length){const[t,s]=this.textSelection;if(t.freeContentIndex===s.freeContentIndex){const i=e[t.freeContentIndex];i.content=Rl(i.content,t.indexInFreeContent,s.indexInFreeContent);}else {const i=e[t.freeContentIndex],n=e[s.freeContentIndex];i.content=i.content.substring(0,t.indexInFreeContent),n.content=n.content.substring(s.indexInFreeContent+1);for(let i=t.freeContentIndex+1;i<s.freeContentIndex;i++)e[i].content="";}i=t.totalIndex-1;}else {const{startChar:t,startDirection:s}=this;if(!t)return;const n=s?t:this.flatChars[t.totalIndex-1];if(!n)return;const{freeContentIndex:o,indexInFreeContent:r}=n,a=e[o];if(!a.color)return;a.content=Rl(a.content,r,r),i=n.totalIndex-1;}this.shape.updateStyle({textContents:[...e]}),t&&this.shape.hooks.textContentUpdated.emit(),this.hideTextSelection(),this.showTextCursor(i,1,!1),this.shape.hooks.reRenderText.emit();}copyText(){if(!this.textSelection.length)return;this.textClipboard=[];const{textContents:t}=this.shape.style,[e,i]=this.textSelection,s=[],n=e.freeContentIndex,o=i.freeContentIndex;if(n===o){const o=t[n],r=o.content.slice(e.indexInFreeContent,i.indexInFreeContent+1);s.push({...o,content:r});}else for(let r=n;r<=o;r++){const a={...t[r]},l=a.content;r===n?a.content=l.slice(e.indexInFreeContent):r===o&&(a.content=l.slice(0,i.indexInFreeContent+1)),s.push({...a});}this.textClipboard=[...s],function(t){let e="";t.forEach((t=>{e+=t.content;}));try{navigator.clipboard.writeText(e);}catch(t){}}(s);}pasteText(){this.textSelection.length&&this.deleteText(!1);const{isBack:t,char:e}=this.textCursorInitCache,{textContents:i}=this.shape.style,s=t?e:this.flatChars[e.totalIndex-1];let n=0,o=(null==s?void 0:s.totalIndex)||-1;if(this.textClipboard.forEach((t=>{n+=t.content.length;})),s)if(this.flatChars.length){const t=i[e.freeContentIndex];if(t.content.length===s.indexInFreeContent+1)i.splice(e.freeContentIndex+1,0,...As(this.textClipboard)),this.shape.updateStyle({textContents:[...i]});else {const{content:n}=t,{indexInFreeContent:o}=s,r=[{...t,content:n.slice(0,o+1)},...As(this.textClipboard),{...t,content:n.slice(o+1)}];i.splice(e.freeContentIndex,1,...r),this.shape.updateStyle({textContents:[...i]});}}else this.shape.updateStyle({textContents:As(this.textClipboard)}),o=-1;else i.unshift(...As(this.textClipboard)),this.shape.updateStyle({textContents:i});this.showTextCursor(o+n,1),this.shape.hooks.textContentUpdated.emit();}selectAllText(){if(!this.flatChars.length)return;const t=this.flatChars[0],e=this.flatChars[this.flatChars.length-1];this.showTextSelection(t,e),this.shape.hooks.reRenderText.emit();}updateTextSelection(){if(!this.textSelection.length)return;const[t,e]=this.textSelection,i=this.flatChars[t.totalIndex],s=this.flatChars[e.totalIndex];this.showTextSelection(i,s,!0),this.shape.hooks.reRenderText.emit();}calculateCharPosition(){const{lines:t}=this.shape,e=[];let i=0,s=0,n=0,o=0;t.forEach(((t,r)=>{const a=t.height,l=[],h=this.shape.getTextAlignOffset(t),d=(t,e,n,h,d)=>{const c={text:t,x:e,y:n,charWidth:h,charHeight:a,freeContentIndex:d,lineIndex:r,indexInLine:s,indexInFreeContent:i,totalIndex:o};l.push(c);};s=0,t.words.forEach((e=>{const{wordWidth:r,freeContentIndex:a,x:l,text:c}=e;if(a!==n&&(i=0,n=a),1===e.text.length)d(c,l+h,t.y,r,a),o+=1,s+=1,i+=1;else {let n=e.x+h;for(let r=0;r<c.length;r++){const l=c.charAt(r),h=Ba(l,e.style);d(l,n,t.y,h,a),n+=h,o+=1,i+=1,s+=1;}e.text.length!==e.originText.length&&(i+=e.originText.length-e.text.length);}})),e.push(l);}));const r=this.shape.getTextAlignOffset();if(this.flatChars=e.flat(),this.lineChars=e,this.virtualChar=null,!t.length){const{x:t,y:e,textAlign:i}=this.shape.parsedStyle,{borderOffset:s,padding:n}=this.shape,{fontSize:o}=this.shape.freeTextContentStyle,a=rr(o).value,l="right"===i?t+n+r:t+s+n+r;return void(this.virtualChar={x:l,y:e+s+n+.8*a,charWidth:1,charHeight:a,lineIndex:0})}const a=this.flatChars[this.flatChars.length-1];Il(a.text)&&(this.virtualChar={x:this.shape.lines[0].x+r,y:a.y+1.2*this.shape.lines[a.lineIndex].height,charWidth:1,charHeight:a.charHeight,lineIndex:a.lineIndex+1});}updateCursor(){if(!this.textCursor||!this.textCursorInitCache)return;const{char:t,isBack:e}=this.textCursorInitCache;this.showTextCursor(t.totalIndex,e);}enableEditMode(t,e){"freeTextWriter"===this.shape.textType&&(this.shape.pathDirty=!0,this.shape.boundsDirty=!0,this.shape.calculateContentLines(),this.shape.hooks.reRenderText.emit()),this.calculateCharPosition(),this.editMode=!0,this.canvas=e;let i=!1;if("textBox"===this.shape.textType){const{totalTextHeight:t}=this.shape,{height:e}=this.shape.parsedStyle;t!==e.value&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0);}if(this.flatChars.length){const e=Pl(this.shape,t),i=this.getCharAndDirection(e),{char:s,direction:n}=i;this.startChar=s,this.startDirection=n,this.showTextCursor(s.totalIndex,n);}else this.showTextCursor(void 0,void 0),"freeTextWriter"===this.shape.textType&&(i=!0);this.shape.context.updateControlsFlags({useDefaultControls:i,enableMove:!1}),this.shape.hooks.enableTextEditMode.emit(),this.openTextarea(t);}disableEditMode(){if(this.editMode){if(this.textClipboard=[],this.editMode=!1,this.hideTextCursor(),this.hideTextSelection(),this.shape.lastIsBack=null,this.shape.lastSelectedEndChar=null,this.shape.context.updateControlsFlags({useDefaultControls:!0,enableMove:!0}),this.textarea&&this.textarea.blur(),"textBox"===this.shape.textType){const{totalTextHeight:t}=this.shape,{height:e}=this.shape.parsedStyle;t!==e.value&&(this.shape.boundsDirty=!0,this.shape.pathDirty=!0,this.shape.updateOrigin(),this.shape.hooks.reRenderText.emit());}this.shape.hooks.disableTextEditMode.emit();}}editStartHandler(t){if(!this.editMode)return;if(!this.flatChars.length)return void this.showTextCursor(void 0,void 0);const e=Pl(this.shape,t),i=this.getCharAndDirection(e);this.hideTextSelection();const{char:s,direction:n}=i;this.showTextCursor(s.totalIndex,n),this.isStart=!0,this.startChar=s,this.startDirection=n,this.startPoint=e,this.shape.hooks.reRenderText.emit();}editMoveHandler(t){if(!this.editMode||!this.isStart)return;const{lineChars:e}=this,i=Pl(this.shape,t),s=this.getLineIndexByMoved(i);let{startChar:n,startDirection:o}=this,r=null;const a=e[s],l=s===this.startChar.lineIndex?i.x>this.startPoint.x:i.y>this.startPoint.y,{lineIndex:h,indexInLine:d}=this.startChar;if(!this.startDirection&&!l){if(0===n.totalIndex)return void this.hideTextSelection(!0);const t=n.lineIndex===e.length-1;if(t&&i.y<this.startPoint.y)n=this.flatChars[n.totalIndex-1],o=1;else if(t)return void this.hideTextSelection(!0)}if(l&&o&&(n=e[h][d+1],o=0,!n))return void this.hideTextSelection(!0);if(l&&i.x<a[0].x+a[0].charWidth/2&&n.lineIndex!==s){const t=e[s-1];return r=t[t.length-1],void this.showTextSelection(n,r)}if(l)a.forEach(((t,e)=>{const{x:s,charWidth:n}=t;i.x>s+n/2&&(r=a[e]);}));else for(let t=a.length-1;t>=0;t--){const{x:e,charWidth:s}=a[t];e+s/2>i.x&&(r=a[t]);}if(!r)return void this.hideTextSelection(!0);const{lineIndex:c,indexInLine:u}=n,{lineIndex:p,indexInLine:g}=r;l&&c===p&&u===g+1||!l&&c===p&&u===g-1?this.hideTextSelection(!0):l?this.showTextSelection(n,r):this.showTextSelection(r,n);}editEndHandler(){this.isStart=!1;}editClickHandler(t,e){this.editMode&&(this.canvas=e,this.openTextarea(t));}openTextarea(t){if(this.editMode){if(!this.textarea){const t=document.createElement("textarea");t.className="ddv-annotation-textarea",this.canvas.parentNode.appendChild(t),this.textarea=t,t.addEventListener("input",(t=>{this.inputComposition||this.textareaInput(t);}),!1),t.addEventListener("compositionstart",(t=>this.textareaCompositionstart(t)),!1),t.addEventListener("compositionend",(t=>{this.inputComposition=!1,this.textareaInput(t);}),!1),t.addEventListener("keydown",(t=>this.textareaKeydown(t)),!1);}if(t){const{x:e,y:i}=t;this.textarea.style.left=`${e}px`,this.textarea.style.top=`${i}px`;}this.textarea.value="",this.textarea.focus();}}destroyTextarea(){this.textarea&&(this.textarea.remove(),this.textarea=null);}textareaInput(t){const e=this.textarea.value;if(2===this.textSelection.length&&this.deleteText(!1),this.flatChars.length){const{char:t,isBack:i}=this.textCursorInitCache;this.addText(t,i,e);}else this.addText(void 0,void 0,e);this.textarea.value="";}textareaCompositionstart(t){this.inputComposition=!0;}textareaKeydown(t){if(this.inputComposition||"Backspace"!==t.key||8!==t.keyCode)switch(t.ctrlKey&&"C"===t.key.toLocaleUpperCase()&&this.copyText(),t.ctrlKey&&"X"===t.key.toLocaleUpperCase()&&(this.copyText(),this.textSelection.length&&this.deleteText()),t.ctrlKey&&"V"===t.key.toLocaleUpperCase()&&this.textClipboard.length&&(t.preventDefault(),this.pasteText()),t.ctrlKey&&"Z"===t.key.toLocaleUpperCase()&&t.stopPropagation(),t.ctrlKey&&"A"===t.key.toLocaleUpperCase()&&this.selectAllText(),t.key){case"ArrowLeft":this.moveTextCursor("left");break;case"ArrowRight":this.moveTextCursor("right");break;case"ArrowUp":this.moveTextCursor("up");break;case"ArrowDown":this.moveTextCursor("down");}else this.deleteText();}}function Ql(t,e){return t.color===e.color&&t.fontFamily===e.fontFamily&&t.fontSize===e.fontSize&&t.fontStyle===e.fontStyle&&t.fontWeight===e.fontWeight&&t.lineThrough===e.lineThrough&&t.underline===e.underline}class Kl extends Ma{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"textBox",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_l,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super({type:"annotationFreeText",id:t.id,style:{freeTextType:e,...t.style}}),l(this,"lastSelectedEndChar",void 0),l(this,"lastIsBack",void 0),l(this,"shapeType","annotationFreeText"),l(this,"textEditEventHandler",void 0),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),l(this,"freeTextContentStyle",void 0),l(this,"inputModeTimer",void 0),l(this,"hooks",{reRenderText:zs(),selectTextChars:zs(),textContentUpdated:zs(),enableTextEditMode:zs(),disableTextEditMode:zs()}),this.freeTextContentStyle=i,this.init(t.transform,t.selectableStyle,s),"freeTextWriter"===this.textType&&this.context.updateControlsFlags({enableEdit:!1,enableRotate:!1}),this.hooks.selectTextChars.on((t=>{const e=t.endChar;if(this.isSameChar(e,this.lastSelectedEndChar)&&t.isBack===this.lastIsBack&&!t.needUpdate)return;let i=e.freeContentIndex;e.indexInFreeContent||!e.freeContentIndex||t.isBack||(i-=1);const s=this.style.textContents[i];this.lastSelectedEndChar=e,this.lastIsBack=t.isBack,this.freeTextContentStyle={...s,content:this.freeTextContentStyle.content};}));}get isEditMode(){var t;return null===(t=this.textEditEventHandler)||void 0===t?void 0:t.editMode}get hasSelectedChars(){var t;return (null===(t=this.textEditEventHandler)||void 0===t?void 0:t.textSelection.length)>0}init(t,e,i){if("freeTextWriter"===this.textType&&i&&super.updateOrigin(),this.context=new zl(this,e),this.textEditEventHandler=new Zl(this),this.eventHandler=new Hl(this),this.context.setTransform(t),"freeTextWriter"===this.textType&&i){const{x:t,y:e}=this.getPosition();this.updateOrigin(),this.setPosition({x:t,y:e});}}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.textEditEventHandler.disableEditMode(),this.textEditEventHandler.destroyTextarea(),this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}updateOrigin(){"freeTextWriter"===this.textType?this.setOrigin(0,0):super.updateOrigin();}getAnnotationConfig(){const t="textBox"===this.textType?"annotationTextBox":"annotationFreeText",e=this.context.getTransform(),{position:i}=e,{width:s,height:n,textContents:o}=this.attributes,r={type:t,style:{x:i.x,y:i.y,textContents:As(o),textAlign:this.style.textAlign,...this.context.getCommonStyleConfig(),width:s},transform:e};return "textBox"===this.textType&&(r.style.height=n),r}calculateTotalHeight(){var t,e;const i=rr((null===(t=this.freeTextContentStyle)||void 0===t?void 0:t.fontSize)||16);if(null!==(e=this.lines)&&void 0!==e&&e.length)super.calculateTotalHeight();else if("freeTextWriter"===this.textType)this.totalTextHeight=i.value+2*this.borderOffset;else {const{height:t}=this.parsedStyle;this.totalTextHeight=t.value>i.value+2*this.borderOffset?t.value:i.value+2*this.borderOffset+2*this.padding;}}getBoundingRect(){var t;if(!this.boundsDirty)return this.bounds;const{x:e,y:i}=this.parsedStyle;if("freeTextWriter"===this.textType&&(null===(t=this.lines)||void 0===t||!t.length)){var s;const t=rr((null===(s=this.freeTextContentStyle)||void 0===s?void 0:s.fontSize)||16);return this.boundsDirty=!1,this.bounds={x:e,y:i,width:Ba("  ",{...this.freeTextContentStyle,fontSize:t}),height:t.value+2*this.padding},this.bounds}return super.getBoundingRect(),"textBox"===this.textType&&this.isEditMode&&(this.bounds.height=this.totalTextHeight),this.bounds}updateFreeTextContentStyle(t){this.freeTextContentStyle=t,this.textEditEventHandler.updateCursor();const{flatChars:e}=this.textEditEventHandler;this.isEditMode&&!e.length&&(this.pathDirty=!0,this.boundsDirty=!0,this.calculateTotalHeight(),this.hooks.reRenderText.emit(),this.hooks.enableTextEditMode.emit());}focusTexture(){const t=Ms();this.isEditMode&&this.textEditEventHandler.textarea&&(t||this.textEditEventHandler.textarea.focus());}updateCursor(){this.textEditEventHandler.updateCursor();}isSameChar(t,e){return !(!t||!e)&&(t.charHeight===e.charHeight&&t.charWidth===e.charWidth&&t.freeContentIndex===e.freeContentIndex&&t.indexInFreeContent===e.indexInFreeContent&&t.indexInLine===e.indexInLine&&t.text===e.text&&t.totalIndex===e.totalIndex)}}class th extends Aa{constructor(t){super({id:t,type:"annotationGroup",style:{visibility:"hidden",background:"transparent",borderColor:"transparent"}}),l(this,"shapeType","annotationGroup"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),l(this,"parent",void 0),l(this,"parentPosition",void 0),l(this,"shapes",[]),l(this,"clickedShape",null),l(this,"state",!1),l(this,"groupMode",0),this.context=new zl(this),this.eventHandler=new Hl(this),this.eventHandler.isHit=this.isHit.bind(this),this.groupMode?this.context.updateControlsFlags({enableEdit:!1}):this.context.updateControlsFlags({useDefaultControls:!1});}isHit(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{context:i,parsedStyle:s}=this;let{controls:n}=this;if(!this.state||"hidden"===s.visibility||!i.controlsFlags.enableControl)return this.clickedShape=null,-1;n||(i.initControls(),i.renderControls(),n=this.controls);let o=-1;if(this.groupMode)o=n.checkHitArea(t.x,t.y);else for(let e=0;e<this.shapes.length;e++)if(this.shapes[e].controls||(this.shapes[e].context.initControls(),this.shapes[e].context.renderControls()),this.shapes[e].controls.checkHitArea(t.x,t.y)>=0){this.clickedShape=this.shapes[e],o=9;break}return o<0&&e?(this.clickedShape=null,i.unHitShape(),this.context.destroyControls(),-1):o}init(){this.style.visibility="visible",this.parent.appendChild(this),this.shapes.forEach((t=>{t instanceof Kl&&t.isEditMode&&t.textEditEventHandler.disableEditMode(),this.appendChild(t),t.context.isGrouped=!0;})),this.update(),this.context.initControls();}add(t){if(!this.parent){const e=t.parentNode;this.parent=e,this.parentPosition=e.getPosition();}if("hidden"!==t.parsedStyle.visibility&&-1===this.shapes.indexOf(t)){if(t.context.isInGroup=!0,this.shapes.push(t),this.state){const e=[];this.shapes.forEach((t=>{e.push(t.getWorldTransform().clone());})),t instanceof Kl&&t.isEditMode&&t.textEditEventHandler.disableEditMode(),t.context.isGrouped=!0,this.appendChild(t),this.groupMode||this.showAllControls(t),this.shapes.forEach(((t,i)=>{const s=this.getWorldTransform().inverse().multiply(e[i]);t.setLocalTransform(s);})),this.update();}this.shapes.length>=2&&!1===this.state&&(this.state=!0,this.init());}}update(){const t=[],e=[],i=[];for(let s=0;s<this.shapes.length;s++){const n=this.shapes[s];let{controls:o}=n;o||(n.context.initControls(),o=n.controls),n.context.renderControls(),this.groupMode&&n.context.unHitShape();const r=o.controlPoints.slice(0,4);for(let i=0;i<4;i++){const{x:s,y:n}=r[i].getCenterPosition();t.push(s),e.push(n);}i.push(this.shapes[s].getWorldTransform().clone());}const s=Math.max(...t),n=Math.min(...t),o=Math.max(...e),r=Math.min(...e);this.updateStyle({x:0,y:0,width:s-n,height:o-r}),this.setAngle(180===this.parent.getAngle()?179.99:0),this.setLocalScale(1,1,1);const{x:a,y:l}=this.getScale();this.scale(1/Math.abs(a),1/Math.abs(l)),this.setPosition({x:n,y:r}),this.updateOrigin(),this.context.updateControls(),this.shapes.forEach(((t,e)=>{const s=this.getWorldTransform().inverse().multiply(i[e]);t.setLocalTransform(s);}));}delete(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.parent)return;if(-1===this.shapes.indexOf(t))return;const i=t.getWorldTransform().clone();this.parent.appendChild(t);const s=this.parent.getWorldTransform().inverse().multiply(i);t.setLocalTransform(s),t.context.isInGroup=!1,t.context.isGrouped=!1,t.context.isActive=!1,t.context.destroyControls(),"freeTextWriter"!==(null==t?void 0:t.textType)&&t.context.updateControlsFlags({enableRotate:!0}),Tl(t)&&t.pointEventsHandler.disableEditMode(),this.shapes.splice(this.shapes.indexOf(t),1),e&&this.update(),0===this.shapes.length&&this.clear();}clear(){const{length:t}=this.shapes;for(let e=t-1;e>=0;e--)this.delete(this.shapes[e],!1);this.context.destroyControls(),this.reset();}reset(){this.parent&&this.parent.removeChild(this),this.updateStyle({x:0,y:0,width:0,height:0}),this.resetLocalTransform(),this.shapes=[],this.parent=null,this.state=!1,this.style.visibility="hidden";}destroy(){const{length:t}=this.shapes;for(let e=t-1;e>=0;e--)this.shapes[e].destroy();this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.shapes=[],this.state=!1,this.parent=null,this.style.visibility="hidden",this.updateStyle({x:0,y:0,width:0,height:0});}showAllControls(t){if(!this.state)return;if(this.groupMode)return;const e=t=>{Tl(t)&&t.pointEventsHandler.enableEditMode(),t.controls||t.context.initControls(),t.context.updateControlsFlags({enableRotate:!1}),t.context.isActive=!0,t.context.renderControls();};t?e(t):this.shapes.forEach((t=>{e(t);}));}getAnnotationConfig(){return {type:"annotationGroup"}}}class eh extends Aa{constructor(t){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),l(this,"shapeType","annotationLineControls"),l(this,"container",void 0),this.container=t;}get isVisible(){return "hidden"!==this.parsedStyle.visibility&&Ll(null==this?void 0:this.container)}}class ih{constructor(t){l(this,"shape",void 0),l(this,"editMode",void 0),l(this,"hitIndex",-1),l(this,"hitPointPos",void 0),l(this,"startPoint",void 0),l(this,"controlsBox",void 0),l(this,"controlsPoints",[]),this.shape=t;}getLineShapePoints(){const{shape:t}=this,{shapeType:e}=t;if("annotationLine"===e){const{startPoint:e,endPoint:i}=t.style;return [e,i]}const{points:i}=this.shape.parsedStyle;return i.slice(0,i.length)}initLineControls(){const{shape:t}=this;t.updatePoints();const{x:e,y:i}=this.shape.getScale(),{ctrlBorderColor:s,ctrlBorderWidth:n,ctrlLineDash:o,borderColor:r,borderWidth:a,lineDash:l,ctrlBorderRadius:h,ctrlWidth:d,ctrlHeight:c,background:u,ctrlBackground:p}=t.context.parsedControlsStyle,g={background:p,borderColor:s,borderWidth:n,lineDash:o},f=this.shape.getBoundingRect(),m=this.getLineShapePoints();this.controlsBox=new eh(this.shape,{style:{width:f.width*e,height:f.height*i,borderColor:r,borderWidth:a,background:u,lineDash:l}}),m.forEach((t=>{const s=new Ra({style:{width:d,height:c,roundedRadius:h,...g}}),n=(t.x-f.x)*e-rr(d).value/2,o=(t.y-f.y)*i-rr(c).value/2;s.setLocalPosition(n,o),this.controlsPoints.push(s),this.controlsBox.appendChild(s);})),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.getRootNode().appendChild(this.controlsBox);}isHitPoint(t){if(!this.editMode)return -1;for(let e=0;e<this.controlsPoints.length;e++){const i=Pl(this.controlsPoints[e],t);if(this.controlsPoints[e].isPointInPath(i))return e}return -1}updateLineControls(){if(!this.controlsBox||0===this.controlsPoints.length)return;if(!this.editMode)return;const{ctrlWidth:t,ctrlHeight:e}=this.shape.context.parsedControlsStyle,{x:i,y:s}=this.shape.getScale(),n=this.shape.getBoundingRect(),o=this.getLineShapePoints();this.controlsPoints.length!==o.length&&(this.destroyLineControls(),this.initLineControls()),o.forEach(((o,r)=>{const a=(o.x-n.x)*i-t/2,l=(o.y-n.y)*s-e/2;this.controlsPoints[r].setLocalPosition(a,l);})),this.controlsBox.updateStyle({width:n.width*i,height:n.height*s}),this.controlsBox.setAngle(this.shape.getAngle()),this.controlsBox.setPosition(this.shape.getPosition()),this.shape.controls&&(this.shape.context.lastControlsWidth=this.shape.controls.getLength().width,this.shape.context.lastControlsHeight=this.shape.controls.getLength().height);}destroyLineControls(){var t;null===(t=this.controlsBox)||void 0===t||t.destroy(),this.controlsPoints.forEach((t=>{t.destroy(),t=null;})),this.controlsBox=null,this.controlsPoints=[];}enableEditMode(){if(this.shape.path||this.shape.getPath(),this.shape.path.length>this.shape.pointerLimitCount)return;if(this.controlsPoints.length>0)return;const{shape:t}=this;this.editMode||this.initLineControls(),this.editMode=!0,t.context.isHit=!0,t.controls&&(t.context.lastControlsWidth=t.controls.getLength().width,t.context.lastControlsHeight=t.controls.getLength().height);}disableEditMode(){this.destroyLineControls(),this.editMode=!1;}editStartHandler(t){if(!this.editMode)return;this.hitIndex=-1;const e=this.isHitPoint(t);-1!==e&&(this.hitIndex=e,this.hitPointPos={...this.shape.path[this.hitIndex]}),this.startPoint=t,this.shape.context.lastLocalTransform=this.shape.getLocalTransform();}editMoveHandler(t){if(!this.editMode||-1===this.hitIndex)return;const{shape:e}=this,i="annotationLine"===e.shapeType,s=i?[...e.path]:[...e.parsedStyle.points],n=Pl(e,t);s[this.hitIndex]=n,i?e.updateStyle({startPoint:{x:s[0].x,y:s[0].y},endPoint:{x:s[1].x,y:s[1].y}}):e.style.points=s,this.updateLineControls();}editEndHandler(){this.editMode&&this.shape.updatePoints();}}class sh extends Sa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationPolygon",...t}),l(this,"shapeType","annotationPolygon"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),l(this,"pointEventsHandler",void 0),l(this,"pointerLimitCount",200),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.pointEventsHandler=new ih(this),this.eventHandler=new Hl(this),this.context.setTransform(t),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1});}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls();}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{position:i}=t,s=i.x!==e.x||i.y!==e.y;let n=this.attributes.points;s&&(n=[],this.attributes.points.forEach((t=>{n.push({x:t.x-e.x+i.x,y:t.y-e.y+i.y});})));return {type:"annotationPolygon",style:{points:n,...this.context.getCommonStyleConfig()},transform:t}}}class nh extends Pa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationPolyline",...t}),l(this,"shapeType","annotationPolyline"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),l(this,"pointEventsHandler",void 0),l(this,"pointerLimitCount",200),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.pointEventsHandler=new ih(this),this.eventHandler=new Hl(this),this.context.setTransform(t),this.parsedStyle.points.length<this.pointerLimitCount&&this.context.updateControlsFlags({useDefaultControls:!1});}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls();}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{position:i}=t,s=i.x!==e.x||i.y!==e.y;let n=this.attributes.points;s&&(n=[],this.attributes.points.forEach((t=>{n.push({x:t.x-e.x+i.x,y:t.y-e.y+i.y});})));return {type:"annotationPolyline",style:{points:n,lineEnding:this.attributes.lineEnding,...this.context.getCommonStyleConfig()},transform:t}}}class oh extends Ea{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({type:"annotationLine",...t}),l(this,"shapeType","annotationLine"),l(this,"eventHandler",void 0),l(this,"controls",void 0),l(this,"context",void 0),l(this,"pointEventsHandler",void 0),this.init(t.transform,t.selectableStyle);}init(t,e){this.context=new zl(this,e),this.pointEventsHandler=new ih(this),this.eventHandler=new Hl(this),this.context.setTransform(t),this.context.updateControlsFlags({useDefaultControls:!1});}update(){this.updateOrigin(),this.context.updateControls();}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy(),this.pointEventsHandler.destroyLineControls();}getAnnotationConfig(){const t=this.context.getTransform(),e=this.getBoundingRect(),{startPoint:i,endPoint:s,lineEnding:n}=this.attributes,{position:o}=t,r=o.x!==e.x||o.y!==e.y;return {type:"annotationLine",style:{startPoint:r?{x:i.x-e.x+o.x,y:i.y-e.y+o.y}:i,endPoint:r?{x:s.x-e.x+o.x,y:s.y-e.y+o.y}:s,lineEnding:n,...this.context.getCommonStyleConfig()},transform:t}}}const rh=[{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #a9d776, #40691b)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:417.4818115234375,y:261.32421875,step:2},{x:408.92578125,y:267.67313639322913,step:1},{x:404.0755208333333,y:276.6470947265625,step:1},{x:403.69010416666663,y:277.0937093098958,step:1},{x:403.40885416666663,y:276.3788655598958,step:1},{x:401.96875,y:272.3411458333333,step:1},{x:401.8802083333333,y:270.8835042317708,step:1},{x:399.3177083333333,y:272.16080729166663,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:395.36454264322913,y:272.4173583984375,step:1},{x:399.7317708333333,y:277.8567708333333,step:1},{x:403.5690511067708,y:284.59375,step:1},{x:403.7773030598958,y:284.56766764322913,step:1},{x:406.17447916666663,y:274.89322916666663,step:1},{x:422.41666666666663,y:265.8476155598958,step:1},{x:418.98832194010413,y:263.60477701822913,step:1},{x:417.4140625,y:261.35746256510413,step:1},{x:417.4818115234375,y:261.32421875,step:1}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"round",miterLimit:4}],ah=[{type:"path",stampPoints:[{x:424.45703125,y:294.07291666666663,step:2},{x:424.45703125,y:298.47265625,step:1},{x:420.83984375,y:302.07291666666663,step:1},{x:416.4192708333333,y:302.07291666666663,step:1},{x:222.49481201171875,y:302.07291666666663,step:0},{x:218.07421875,y:302.07291666666663,step:1},{x:214.45703125,y:298.47265625,step:1},{x:214.45703125,y:294.07291666666663,step:1},{x:214.45703125,y:252.07291666666666,step:0},{x:214.45703125,y:247.67313639322916,step:1},{x:218.07421875,y:244.07291666666666,step:1},{x:222.49481201171875,y:244.07291666666666,step:1},{x:416.4192708333333,y:244.07291666666666,step:0},{x:420.83984375,y:244.07291666666666,step:1},{x:424.45703125,y:247.67313639322916,step:1},{x:424.45703125,y:252.07291666666666,step:1},{x:424.45703125,y:294.07291666666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:424.0677083333333,y:293.9374593098958,step:2},{x:424.0677083333333,y:298.3358968098958,step:1},{x:420.45048014322913,y:301.9374593098958,step:1},{x:416.02994791666663,y:301.9374593098958,step:1},{x:222.10614013671875,y:301.9374593098958,step:0},{x:217.685546875,y:301.9374593098958,step:1},{x:214.06837972005206,y:298.3358968098958,step:1},{x:214.06837972005206,y:293.9374593098958,step:1},{x:214.06837972005206,y:251.93684895833331,step:0},{x:214.06837972005206,y:247.53715006510416,step:1},{x:217.685546875,y:243.93684895833331,step:1},{x:222.10614013671875,y:243.93684895833331,step:1},{x:416.02994791666663,y:243.93684895833331,step:0},{x:420.45048014322913,y:243.93684895833331,step:1},{x:424.0677083333333,y:247.53715006510416,step:1},{x:424.0677083333333,y:251.93684895833331,step:1},{x:424.0677083333333,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(41,66,18,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:234.81705729166666,y:280.5859375,step:2},{x:231.83074951171875,y:287.9374593098958,step:0},{x:226.009765625,y:287.9374593098958,step:0},{x:238.44596354166666,y:259.6288655598958,step:0},{x:245.4388224283854,y:259.6288655598958,step:0},{x:248.38736979166666,y:287.9374593098958,step:0},{x:242.67903645833331,y:287.9374593098958,step:0},{x:242.150390625,y:280.5859375,step:0},{x:234.81705729166666,y:280.5859375,step:0},{x:241.9238077799479,y:275.9661458333333,step:2},{x:241.43166097005206,y:269.8769124348958,step:0},{x:241.318359375,y:268.3229573567708,step:1},{x:241.205078125,y:266.0553792317708,step:1},{x:241.0917765299479,y:264.33268229166663,step:1},{x:240.978515625,y:264.33268229166663,step:0},{x:240.33528645833331,y:266.0553792317708,step:1},{x:239.6171671549479,y:268.2389729817708,step:1},{x:238.93684895833331,y:269.8769124348958,step:1},{x:236.44270833333331,y:275.9661458333333,step:0},{x:241.9238077799479,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:255.87109375,y:260.1335042317708,step:2},{x:257.5345052083333,y:259.67057291666663,step:1},{x:260.06705729166663,y:259.41861979166663,step:1},{x:262.52410888671875,y:259.41861979166663,step:1},{x:264.83009847005206,y:259.41861979166663,step:1},{x:267.43815104166663,y:259.8391927083333,step:1},{x:269.2903645833333,y:261.30924479166663,step:1},{x:271.02931722005206,y:262.56901041666663,step:1},{x:272.0501302083333,y:264.58463541666663,step:1},{x:272.0501302083333,y:267.314453125,step:1},{x:272.0501302083333,y:270.884765625,step:1},{x:270.5755208333333,y:273.6145833333333,step:1},{x:268.61002604166663,y:275.2942708333333,step:1},{x:266.5305989583333,y:277.1015625,step:1},{x:263.544921875,y:277.94010416666663,step:1},{x:260.4446818033854,y:277.94010416666663,step:1},{x:259.5384318033854,y:277.94010416666663,step:1},{x:258.78190104166663,y:277.81510416666663,step:1},{x:258.21486409505206,y:277.7734375,step:1},{x:256.4759114583333,y:287.9374593098958,step:0},{x:251.146484375,y:287.9374593098958,step:0},{x:255.87109375,y:260.1335042317708,step:0},{x:259.0462239583333,y:272.8170979817708,step:2},{x:259.61328125,y:272.9427083333333,step:1},{x:260.2181193033854,y:273.0266927083333,step:1},{x:261.1634318033854,y:273.0266927083333,step:1},{x:264.4140625,y:273.0266927083333,step:1},{x:266.56901041666663,y:270.6751302083333,step:1},{x:266.56901041666663,y:267.861328125,step:1},{x:266.56901041666663,y:265.130859375,step:1},{x:264.7923177083333,y:264.24869791666663,step:1},{x:262.712890625,y:264.24869791666663,step:1},{x:261.6927083333333,y:264.24869791666663,step:1},{x:260.9368489583333,y:264.33268229166663,step:1},{x:260.48307291666663,y:264.4167073567708,step:1},{x:259.0462239583333,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:277.19010416666663,y:260.1335042317708,step:2},{x:278.85353597005206,y:259.67057291666663,step:1},{x:281.3860677083333,y:259.41861979166663,step:1},{x:283.84246826171875,y:259.41861979166663,step:1},{x:286.14845784505206,y:259.41861979166663,step:1},{x:288.75651041666663,y:259.8391927083333,step:1},{x:290.6087239583333,y:261.30924479166663,step:1},{x:292.34765625,y:262.56901041666663,step:1},{x:293.3685099283854,y:264.58463541666663,step:1},{x:293.3685099283854,y:267.314453125,step:1},{x:293.3685099283854,y:270.884765625,step:1},{x:291.8938802083333,y:273.6145833333333,step:1},{x:289.92836507161456,y:275.2942708333333,step:1},{x:287.84962972005206,y:277.1015625,step:1},{x:284.86328125,y:277.94010416666663,step:1},{x:281.763671875,y:277.94010416666663,step:1},{x:280.8567708333333,y:277.94010416666663,step:1},{x:280.10028076171875,y:277.81510416666663,step:1},{x:279.533203125,y:277.7734375,step:1},{x:277.794921875,y:287.9374593098958,step:0},{x:272.4648234049479,y:287.9374593098958,step:0},{x:277.19010416666663,y:260.1335042317708,step:0},{x:280.36525472005206,y:272.8170979817708,step:2},{x:280.93229166666663,y:272.9427083333333,step:1},{x:281.537109375,y:273.0266927083333,step:1},{x:282.482421875,y:273.0266927083333,step:1},{x:285.732421875,y:273.0266927083333,step:1},{x:287.88736979166663,y:270.6751302083333,step:1},{x:287.88736979166663,y:267.861328125,step:1},{x:287.88736979166663,y:265.130859375,step:1},{x:286.1106974283854,y:264.24869791666663,step:1},{x:284.03192138671875,y:264.24869791666663,step:1},{x:283.0110677083333,y:264.24869791666663,step:1},{x:282.2552286783854,y:264.33268229166663,step:1},{x:281.80145263671875,y:264.4167073567708,step:1},{x:280.36525472005206,y:272.8170979817708,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:298.583984375,y:260.1335042317708,step:2},{x:300.2845052083333,y:259.67057291666663,step:1},{x:302.8548380533854,y:259.41861979166663,step:1},{x:305.3880208333333,y:259.41861979166663,step:1},{x:307.80731201171875,y:259.41861979166663,step:1},{x:310.3020833333333,y:259.79752604166663,step:1},{x:312.078125,y:261.056640625,step:1},{x:313.7415364583333,y:262.1491292317708,step:1},{x:314.9134318033854,y:263.91276041666663,step:1},{x:314.9134318033854,y:266.5592854817708,step:1},{x:314.9134318033854,y:270.7591145833333,step:1},{x:312.41861979166663,y:273.4049072265625,step:1},{x:309.1302083333333,y:274.58072916666663,step:1},{x:309.1302083333333,y:274.70703125,step:0},{x:310.642578125,y:275.46354166666663,step:1},{x:311.322265625,y:277.3098958333333,step:1},{x:311.54949951171875,y:279.8723958333333,step:1},{x:311.88930257161456,y:283.06510416666663,step:1},{x:312.078125,y:286.76041666666663,step:1},{x:312.53190104166663,y:287.9374593098958,step:1},{x:306.93752034505206,y:287.9374593098958,step:0},{x:306.7109375,y:287.18094889322913,step:1},{x:306.4466145833333,y:284.74479166666663,step:1},{x:306.21940104166663,y:281.2591145833333,step:1},{x:305.955078125,y:277.81510416666663,step:1},{x:304.89650472005206,y:276.765625,step:1},{x:302.7415364583333,y:276.765625,step:1},{x:301.07877604166663,y:276.765625,step:0},{x:299.1888020833333,y:287.9374593098958,step:0},{x:293.82096354166663,y:287.9374593098958,step:0},{x:298.583984375,y:260.1335042317708,step:0},{x:301.9101359049479,y:272.22855631510413,step:2},{x:304.1399739583333,y:272.22855631510413,step:0},{x:307.08917236328125,y:272.22855631510413,step:1},{x:309.24346923828125,y:270.25455729166663,step:1},{x:309.24346923828125,y:267.48246256510413,step:1},{x:309.24346923828125,y:265.1731770833333,step:1},{x:307.5423380533854,y:264.16471354166663,step:1},{x:305.35026041666663,y:264.16471354166663,step:1},{x:304.330078125,y:264.16471354166663,step:1},{x:303.6868693033854,y:264.24869791666663,step:1},{x:303.2337239583333,y:264.3749593098958,step:1},{x:301.9101359049479,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:327.236328125,y:288.3984375,step:2},{x:320.6210734049479,y:288.3984375,step:1},{x:316.91668701171875,y:283.19010416666663,step:1},{x:316.91668701171875,y:276.59635416666663,step:1},{x:316.91668701171875,y:271.47330729166663,step:1},{x:318.61783854166663,y:266.39127604166663,step:1},{x:321.603515625,y:263.19921875,step:1},{x:323.98502604166663,y:260.6790364583333,step:1},{x:327.236328125,y:259.16666666666663,step:1},{x:330.90236409505206,y:259.16666666666663,step:1},{x:337.63087972005206,y:259.16666666666663,step:1},{x:341.18424479166663,y:264.20703125,step:1},{x:341.18424479166663,y:270.9693603515625,step:1},{x:341.18424479166663,y:276.1354573567708,step:1},{x:339.55859375,y:281.17447916666663,step:1},{x:336.6477864583333,y:284.3255208333333,step:1},{x:334.2669270833333,y:286.8880615234375,step:1},{x:331.0540364583333,y:288.3984375,step:1},{x:327.2734375,y:288.3984375,step:1},{x:327.236328125,y:288.3984375,step:0},{x:328.02994791666663,y:283.35941569010413,step:2},{x:329.6555989583333,y:283.35941569010413,step:1},{x:331.12957763671875,y:282.6028645833333,step:1},{x:332.30143229166663,y:281.3021240234375,step:1},{x:334.3040364583333,y:279.0755208333333,step:1},{x:335.40104166666663,y:274.41276041666663,step:1},{x:335.40104166666663,y:271.13736979166663,step:1},{x:335.40104166666663,y:267.6087239583333,step:1},{x:334.2669270833333,y:264.20703125,step:1},{x:330.2597452799479,y:264.20703125,step:1},{x:328.55922444661456,y:264.20703125,step:1},{x:327.04689534505206,y:265.0045166015625,step:1},{x:325.8749796549479,y:266.34891764322913,step:1},{x:323.83400472005206,y:268.57486979166663,step:1},{x:322.69986979166663,y:272.9849853515625,step:1},{x:322.69986979166663,y:276.3880208333333,step:1},{x:322.69986979166663,y:280.3775634765625,step:1},{x:324.3255208333333,y:283.35941569010413,step:1},{x:327.99151611328125,y:283.35941569010413,step:1},{x:328.02994791666663,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:347.61002604166663,y:287.9374593098958,step:2},{x:344.435546875,y:259.6288655598958,step:0},{x:350.06705729166663,y:259.6288655598958,step:0},{x:351.201171875,y:273.1106770833333,step:0},{x:351.4661458333333,y:276.1354573567708,step:1},{x:351.6549886067708,y:278.8646240234375,step:1},{x:351.80594889322913,y:281.8046468098958,step:1},{x:351.88151041666663,y:281.8046468098958,step:0},{x:352.82682291666663,y:279.03385416666663,step:1},{x:354.03641764322913,y:276.0091552734375,step:1},{x:355.283203125,y:273.068359375,step:1},{x:360.9915771484375,y:259.6288655598958,step:0},{x:367.07743326822913,y:259.6288655598958,step:0},{x:353.9232177734375,y:287.9374593098958,step:0},{x:347.61002604166663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:381.7805989583333,y:275.88285319010413,step:2},{x:372.74674479166663,y:275.88285319010413,step:0},{x:371.5755208333333,y:282.7708333333333,step:0},{x:381.7434895833333,y:282.7708333333333,step:0},{x:380.87369791666663,y:287.9374593098958,step:0},{x:365.224609375,y:287.9374593098958,step:0},{x:370.06315104166663,y:259.6288655598958,step:0},{x:385.1451416015625,y:259.6288655598958,step:0},{x:384.2376708984375,y:264.79496256510413,step:0},{x:374.6366780598958,y:264.79496256510413,step:0},{x:373.57877604166663,y:270.8014729817708,step:0},{x:382.68815104166663,y:270.8014729817708,step:0},{x:381.7805989583333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:389.52994791666663,y:260.048828125,step:2},{x:391.7220052083333,y:259.6288655598958,step:1},{x:394.103515625,y:259.41861979166663,step:1},{x:396.5989990234375,y:259.41861979166663,step:1},{x:400.5677083333333,y:259.41861979166663,step:1},{x:403.705078125,y:260.42704264322913,step:1},{x:405.8593343098958,y:262.4849853515625,step:1},{x:407.93876139322913,y:264.33268229166663,step:1},{x:409.22391764322913,y:267.146484375,step:1},{x:409.22391764322913,y:271.3470052083333,step:1},{x:409.22391764322913,y:276.8073323567708,step:1},{x:407.1444905598958,y:281.5521240234375,step:1},{x:404.0071614583333,y:284.3671875,step:1},{x:401.05924479166663,y:287.01298014322913,step:1},{x:397.3170166015625,y:288.1458333333333,step:1},{x:391.7981770833333,y:288.1458333333333,step:1},{x:388.73636881510413,y:288.1458333333333,step:1},{x:386.0904541015625,y:287.85282389322913,step:1},{x:384.80533854166663,y:287.5598958333333,step:1},{x:389.52994791666663,y:260.048828125,step:0},{x:391.080078125,y:283.1067708333333,step:2},{x:391.7220052083333,y:283.19010416666663,step:1},{x:392.5162353515625,y:283.2317708333333,step:1},{x:393.4609375,y:283.2317708333333,step:1},{x:396.40946451822913,y:283.2317708333333,step:1},{x:399.017578125,y:282.0573323567708,step:1},{x:400.6809895833333,y:279.9569905598958,step:1},{x:402.4198811848958,y:277.7317708333333,step:1},{x:403.32682291666663,y:274.7916259765625,step:1},{x:403.32682291666663,y:271.38871256510413,step:1},{x:403.32682291666663,y:266.8952229817708,step:1},{x:401.0970052083333,y:264.24869791666663,step:1},{x:396.5989990234375,y:264.24869791666663,step:1},{x:395.6536865234375,y:264.24869791666663,step:1},{x:394.8600667317708,y:264.33268229166663,step:1},{x:394.2923583984375,y:264.458984375,step:1},{x:391.080078125,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(41,66,18,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],lh=[{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:523.234375,y:293.9374593098958,step:2},{x:523.234375,y:298.3358968098958,step:1},{x:519.3333333333333,y:301.9374593098958,step:1},{x:514.5638020833333,y:301.9374593098958,step:1},{x:305.404296875,y:301.9374593098958,step:0},{x:300.6360677083333,y:301.9374593098958,step:1},{x:296.73504638671875,y:298.3358968098958,step:1},{x:296.73504638671875,y:293.9374593098958,step:1},{x:296.73504638671875,y:251.93745930989581,step:0},{x:296.73504638671875,y:247.53645833333331,step:1},{x:300.6360677083333,y:243.93745930989581,step:1},{x:305.404296875,y:243.93745930989581,step:1},{x:514.5638020833333,y:243.93745930989581,step:0},{x:519.3333333333333,y:243.93745930989581,step:1},{x:523.234375,y:247.53645833333331,step:1},{x:523.234375,y:251.93745930989581,step:1},{x:523.234375,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:329.54166666666663,y:287.13798014322913,step:2},{x:328.1810099283854,y:287.80985514322913,step:1},{x:325.91276041666663,y:288.35673014322913,step:1},{x:322.8515625,y:288.35673014322913,step:1},{x:316.0852864583333,y:288.35673014322913,step:1},{x:311.58660888671875,y:283.8203125,step:1},{x:311.58660888671875,y:276.3437093098958,step:1},{x:311.58660888671875,y:269.9609375,step:1},{x:314.15690104166663,y:265.046875,step:1},{x:318.0130411783854,y:262.1901448567708,step:1},{x:320.65885416666663,y:260.1745198567708,step:1},{x:323.75844319661456,y:259.2083333333333,step:1},{x:327.349609375,y:259.2083333333333,step:1},{x:330.1087443033854,y:259.2083333333333,step:1},{x:332.18817138671875,y:259.92191569010413,step:1},{x:332.943359375,y:260.38541666666663,step:1},{x:331.43166097005206,y:265.29947916666663,step:0},{x:330.71356201171875,y:264.8802490234375,step:1},{x:329.01236979166663,y:264.3749593098958,step:1},{x:326.8203125,y:264.3749593098958,step:1},{x:324.62760416666663,y:264.3749593098958,step:1},{x:322.5488077799479,y:265.1302083333333,step:1},{x:320.99867757161456,y:266.5598958333333,step:1},{x:318.8821614583333,y:268.4895833333333,step:1},{x:317.4837239583333,y:271.7239583333333,step:1},{x:317.4837239583333,y:275.6718343098958,step:1},{x:317.4837239583333,y:280.16666666666663,step:1},{x:319.78971354166663,y:283.19010416666663,step:1},{x:324.25002034505206,y:283.19010416666663,step:1},{x:326.064453125,y:283.19010416666663,step:1},{x:327.84051513671875,y:282.85416666666663,step:1},{x:329.087890625,y:282.265625,step:1},{x:329.54166666666663,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:342.9987386067708,y:288.3984375,step:2},{x:336.3841145833333,y:288.3984375,step:1},{x:332.67970784505206,y:283.19010416666663,step:1},{x:332.67970784505206,y:276.59635416666663,step:1},{x:332.67970784505206,y:271.4739990234375,step:1},{x:334.380859375,y:266.390625,step:1},{x:337.3665364583333,y:263.19791666666663,step:1},{x:339.74806722005206,y:260.6796875,step:1},{x:342.9987386067708,y:259.16666666666663,step:1},{x:346.6653645833333,y:259.16666666666663,step:1},{x:353.3938802083333,y:259.16666666666663,step:1},{x:356.94730631510413,y:264.2083333333333,step:1},{x:356.94730631510413,y:270.96875,step:1},{x:356.94730631510413,y:276.1354573567708,step:1},{x:355.3216145833333,y:281.17447916666663,step:1},{x:352.4107666015625,y:284.3255208333333,step:1},{x:350.0292561848958,y:286.8880615234375,step:1},{x:346.8170979817708,y:288.3984375,step:1},{x:343.0364583333333,y:288.3984375,step:1},{x:342.9987386067708,y:288.3984375,step:0},{x:343.79296875,y:283.35941569010413,step:2},{x:345.4185791015625,y:283.35941569010413,step:1},{x:346.892578125,y:282.6015625,step:1},{x:348.0638020833333,y:281.3021240234375,step:1},{x:350.06705729166663,y:279.0755208333333,step:1},{x:351.1634114583333,y:274.4140625,step:1},{x:351.1634114583333,y:271.13798014322913,step:1},{x:351.1634114583333,y:267.609375,step:1},{x:350.0292561848958,y:264.2083333333333,step:1},{x:346.0227864583333,y:264.2083333333333,step:1},{x:344.3216552734375,y:264.2083333333333,step:1},{x:342.8098958333333,y:265.00516764322913,step:1},{x:341.6380208333333,y:266.34891764322913,step:1},{x:339.5970052083333,y:268.5755208333333,step:1},{x:338.46291097005206,y:272.9843343098958,step:1},{x:338.46291097005206,y:276.3880208333333,step:1},{x:338.46291097005206,y:280.3775634765625,step:1},{x:340.087890625,y:283.35941569010413,step:1},{x:343.75455729166663,y:283.35941569010413,step:1},{x:343.79296875,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:379.5130208333333,y:287.9374593098958,step:2},{x:381.06315104166663,y:276.26041666666663,step:0},{x:381.478515625,y:273.1953125,step:1},{x:382.04557291666663,y:269.33072916666663,step:1},{x:382.76371256510413,y:265.2161865234375,step:1},{x:382.6503499348958,y:265.2161865234375,step:0},{x:381.2519124348958,y:268.8671875,step:1},{x:379.66471354166663,y:272.7734375,step:1},{x:378.26627604166663,y:275.88285319010413,step:1},{x:373.04886881510413,y:287.4739990234375,step:0},{x:368.8157958984375,y:287.4739990234375,step:0},{x:367.908203125,y:276.00785319010413,step:0},{x:367.68168131510413,y:272.90104166666663,step:1},{x:367.4928792317708,y:268.9948323567708,step:1},{x:367.34183756510413,y:265.2161865234375,step:1},{x:367.26627604166663,y:265.2161865234375,step:0},{x:366.54752604166663,y:268.953125,step:1},{x:365.79166666666663,y:273.2369384765625,step:1},{x:365.14908854166663,y:276.26041666666663,step:1},{x:362.6165364583333,y:287.9374593098958,step:0},{x:357.626953125,y:287.9374593098958,step:0},{x:364.0150146484375,y:259.6302083333333,step:0},{x:371.3105061848958,y:259.6302083333333,step:0},{x:372.10416666666663,y:270.42191569010413,step:0},{x:372.255859375,y:273.06766764322913,step:1},{x:372.5201416015625,y:276.26041666666663,step:1},{x:372.5579427083333,y:279.4114583333333,step:1},{x:372.708984375,y:279.4114583333333,step:0},{x:373.69205729166663,y:276.26041666666663,step:1},{x:375.052734375,y:272.9427083333333,step:1},{x:376.1491292317708,y:270.3802083333333,step:1},{x:380.87369791666663,y:259.6302083333333,step:0},{x:388.2447509765625,y:259.6302083333333,step:0},{x:384.80533854166663,y:287.9374593098958,step:0},{x:379.5130208333333,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:393.99027506510413,y:260.1328125,step:2},{x:395.6536865234375,y:259.6718343098958,step:1},{x:398.1862386067708,y:259.4192708333333,step:1},{x:400.64322916666663,y:259.4192708333333,step:1},{x:402.94921875,y:259.4192708333333,step:1},{x:405.5572509765625,y:259.83854166666663,step:1},{x:407.40946451822913,y:261.3098958333333,step:1},{x:409.1484375,y:262.56766764322913,step:1},{x:410.1692708333333,y:264.5859375,step:1},{x:410.1692708333333,y:267.31510416666663,step:1},{x:410.1692708333333,y:270.8854573567708,step:1},{x:408.6946614583333,y:273.6145833333333,step:1},{x:406.72855631510413,y:275.2942708333333,step:1},{x:404.6503499348958,y:277.1015625,step:1},{x:401.66410319010413,y:277.94010416666663,step:1},{x:398.5644124348958,y:277.94010416666663,step:1},{x:397.656982421875,y:277.94010416666663,step:1},{x:396.9010823567708,y:277.81510416666663,step:1},{x:396.333984375,y:277.7734375,step:1},{x:394.59574381510413,y:287.9374593098958,step:0},{x:389.26566569010413,y:287.9374593098958,step:0},{x:393.99027506510413,y:260.1328125,step:0},{x:397.1659749348958,y:272.8177083333333,step:2},{x:397.73246256510413,y:272.9427083333333,step:1},{x:398.337890625,y:273.02604166666663,step:1},{x:399.28251139322913,y:273.02604166666663,step:1},{x:402.5331624348958,y:273.02604166666663,step:1},{x:404.68815104166663,y:270.6745198567708,step:1},{x:404.68815104166663,y:267.859375,step:1},{x:404.68815104166663,y:265.1302083333333,step:1},{x:402.91141764322913,y:264.25,step:1},{x:400.8326416015625,y:264.25,step:1},{x:399.81180826822913,y:264.25,step:1},{x:399.05533854166663,y:264.3333333333333,step:1},{x:398.60221354166663,y:264.4167073567708,step:1},{x:397.1659749348958,y:272.8177083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:415.421875,y:259.6302083333333,step:2},{x:420.8645833333333,y:259.6302083333333,step:0},{x:416.9348958333333,y:282.64579264322913,step:0},{x:426.7239583333333,y:282.64579264322913,step:0},{x:425.8177083333333,y:287.9374593098958,step:0},{x:410.58329264322913,y:287.9374593098958,step:0},{x:415.421875,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.54947916666663,y:275.88285319010413,step:2},{x:436.515625,y:275.88285319010413,step:0},{x:435.3437093098958,y:282.7708333333333,step:0},{x:445.51041666666663,y:282.7708333333333,step:0},{x:444.6419270833333,y:287.9374593098958,step:0},{x:428.9921875,y:287.9374593098958,step:0},{x:433.83072916666663,y:259.6302083333333,step:0},{x:448.9127197265625,y:259.6302083333333,step:0},{x:448.00516764322913,y:264.7942708333333,step:0},{x:438.4036458333333,y:264.7942708333333,step:0},{x:437.34635416666663,y:270.8021240234375,step:0},{x:446.45572916666663,y:270.8021240234375,step:0},{x:445.54947916666663,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:457.0780843098958,y:264.92191569010413,step:2},{x:450.3489990234375,y:264.92191569010413,step:0},{x:451.2942708333333,y:259.6302083333333,step:0},{x:470.2317708333333,y:259.6302083333333,step:0},{x:469.32548014322913,y:264.92191569010413,step:0},{x:462.5208333333333,y:264.92191569010413,step:0},{x:458.58988444010413,y:287.9374593098958,step:0},{x:453.1458333333333,y:287.9374593098958,step:0},{x:457.0780843098958,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:485.0130208333333,y:275.88285319010413,step:2},{x:475.97782389322913,y:275.88285319010413,step:0},{x:474.8059895833333,y:282.7708333333333,step:0},{x:484.9739583333333,y:282.7708333333333,step:0},{x:484.10416666666663,y:287.9374593098958,step:0},{x:468.45572916666663,y:287.9374593098958,step:0},{x:473.2942708333333,y:259.6302083333333,step:0},{x:488.37504069010413,y:259.6302083333333,step:0},{x:487.46875,y:264.7942708333333,step:0},{x:477.8671875,y:264.7942708333333,step:0},{x:476.8098958333333,y:270.8021240234375,step:0},{x:485.9192708333333,y:270.8021240234375,step:0},{x:485.0130208333333,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:492.76041666666663,y:260.04947916666663,step:2},{x:494.953125,y:259.6302083333333,step:1},{x:497.33463541666663,y:259.4192708333333,step:1},{x:499.8294270833333,y:259.4192708333333,step:1},{x:503.7981770833333,y:259.4192708333333,step:1},{x:506.9348958333333,y:260.42704264322913,step:1},{x:509.0911458333333,y:262.4843343098958,step:1},{x:511.1692708333333,y:264.3333333333333,step:1},{x:512.4544270833333,y:267.14579264322913,step:1},{x:512.4544270833333,y:271.34635416666663,step:1},{x:512.4544270833333,y:276.8073323567708,step:1},{x:510.37504069010413,y:281.5521240234375,step:1},{x:507.2382405598958,y:284.3671875,step:1},{x:504.28910319010413,y:287.01298014322913,step:1},{x:500.546875,y:288.1458333333333,step:1},{x:495.0286865234375,y:288.1458333333333,step:1},{x:491.9661458333333,y:288.1458333333333,step:1},{x:489.3203125,y:287.8515218098958,step:1},{x:488.03641764322913,y:287.5598958333333,step:1},{x:492.76041666666663,y:260.04947916666663,step:0},{x:494.3099365234375,y:283.1067708333333,step:2},{x:494.953125,y:283.19010416666663,step:1},{x:495.7473958333333,y:283.2317708333333,step:1},{x:496.6927083333333,y:283.2317708333333,step:1},{x:499.640625,y:283.2317708333333,step:1},{x:502.2473958333333,y:282.0573323567708,step:1},{x:503.91141764322913,y:279.95572916666663,step:1},{x:505.6510823567708,y:277.7317708333333,step:1},{x:506.5572509765625,y:274.7916259765625,step:1},{x:506.5572509765625,y:271.3880615234375,step:1},{x:506.5572509765625,y:266.8958740234375,step:1},{x:504.32816569010413,y:264.25,step:1},{x:499.8294270833333,y:264.25,step:1},{x:498.8841145833333,y:264.25,step:1},{x:498.0911458333333,y:264.3333333333333,step:1},{x:497.52347819010413,y:264.45829264322913,step:1},{x:494.3099365234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],hh=[{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:545.5651041666666,y:293.9374593098958,step:2},{x:545.5651041666666,y:298.3358968098958,step:1},{x:540.8880615234375,y:301.9374593098958,step:1},{x:535.1718343098958,y:301.9374593098958,step:1},{x:284.4602864583333,y:301.9374593098958,step:0},{x:278.74416097005206,y:301.9374593098958,step:1},{x:274.06837972005206,y:298.3358968098958,step:1},{x:274.06837972005206,y:293.9374593098958,step:1},{x:274.06837972005206,y:251.93745930989581,step:0},{x:274.06837972005206,y:247.53645833333331,step:1},{x:278.74416097005206,y:243.93745930989581,step:1},{x:284.4602864583333,y:243.93745930989581,step:1},{x:535.1718343098958,y:243.93745930989581,step:0},{x:540.8880615234375,y:243.93745930989581,step:1},{x:545.5651041666666,y:247.53645833333331,step:1},{x:545.5651041666666,y:251.93745930989581,step:1},{x:545.5651041666666,y:293.9374593098958,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:306.875,y:287.13798014322913,step:2},{x:305.51434326171875,y:287.80985514322913,step:1},{x:303.24609375,y:288.35673014322913,step:1},{x:300.1848958333333,y:288.35673014322913,step:1},{x:293.41861979166663,y:288.35673014322913,step:1},{x:288.91994222005206,y:283.8203125,step:1},{x:288.91994222005206,y:276.3437093098958,step:1},{x:288.91994222005206,y:269.9609375,step:1},{x:291.490234375,y:265.046875,step:1},{x:295.34637451171875,y:262.1901448567708,step:1},{x:297.9921875,y:260.1745198567708,step:1},{x:301.0917765299479,y:259.2083333333333,step:1},{x:304.6829427083333,y:259.2083333333333,step:1},{x:307.44207763671875,y:259.2083333333333,step:1},{x:309.52150472005206,y:259.92191569010413,step:1},{x:310.2766927083333,y:260.38541666666663,step:1},{x:308.7649943033854,y:265.29947916666663,step:0},{x:308.04689534505206,y:264.8802490234375,step:1},{x:306.345703125,y:264.3749593098958,step:1},{x:304.1536458333333,y:264.3749593098958,step:1},{x:301.9609375,y:264.3749593098958,step:1},{x:299.88214111328125,y:265.1302083333333,step:1},{x:298.3320109049479,y:266.5598958333333,step:1},{x:296.21549479166663,y:268.4895833333333,step:1},{x:294.81705729166663,y:271.7239583333333,step:1},{x:294.81705729166663,y:275.6718343098958,step:1},{x:294.81705729166663,y:280.16666666666663,step:1},{x:297.123046875,y:283.19010416666663,step:1},{x:301.5833536783854,y:283.19010416666663,step:1},{x:303.3977864583333,y:283.19010416666663,step:1},{x:305.17384847005206,y:282.85416666666663,step:1},{x:306.4212239583333,y:282.265625,step:1},{x:306.875,y:287.13798014322913,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:320.3320109049479,y:288.3984375,step:2},{x:313.71744791666663,y:288.3984375,step:1},{x:310.0130411783854,y:283.19010416666663,step:1},{x:310.0130411783854,y:276.59635416666663,step:1},{x:310.0130411783854,y:271.4739990234375,step:1},{x:311.7141927083333,y:266.390625,step:1},{x:314.69986979166663,y:263.19791666666663,step:1},{x:317.0814005533854,y:260.6796875,step:1},{x:320.3320109049479,y:259.16666666666663,step:1},{x:323.99867757161456,y:259.16666666666663,step:1},{x:330.72721354166663,y:259.16666666666663,step:1},{x:334.28057861328125,y:264.2083333333333,step:1},{x:334.28057861328125,y:270.96875,step:1},{x:334.28057861328125,y:276.1354573567708,step:1},{x:332.65494791666663,y:281.17447916666663,step:1},{x:329.74416097005206,y:284.3255208333333,step:1},{x:327.3626505533854,y:286.8880615234375,step:1},{x:324.150390625,y:288.3984375,step:1},{x:320.36981201171875,y:288.3984375,step:1},{x:320.3320109049479,y:288.3984375,step:0},{x:321.1263020833333,y:283.35941569010413,step:2},{x:322.751953125,y:283.35941569010413,step:1},{x:324.2259114583333,y:282.6015625,step:1},{x:325.39711507161456,y:281.3021240234375,step:1},{x:327.400390625,y:279.0755208333333,step:1},{x:328.49676513671875,y:274.4140625,step:1},{x:328.49676513671875,y:271.13798014322913,step:1},{x:328.49676513671875,y:267.609375,step:1},{x:327.3626505533854,y:264.2083333333333,step:1},{x:323.35611979166663,y:264.2083333333333,step:1},{x:321.65494791666663,y:264.2083333333333,step:1},{x:320.14322916666663,y:265.00516764322913,step:1},{x:318.97135416666663,y:266.34891764322913,step:1},{x:316.93033854166663,y:268.5755208333333,step:1},{x:315.7962443033854,y:272.9843343098958,step:1},{x:315.7962443033854,y:276.3880208333333,step:1},{x:315.7962443033854,y:280.3775634765625,step:1},{x:317.4212239583333,y:283.35941569010413,step:1},{x:321.087890625,y:283.35941569010413,step:1},{x:321.1263020833333,y:283.35941569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:335.56512451171875,y:287.9374593098958,step:2},{x:340.4036458333333,y:259.6302083333333,step:0},{x:346.79166666666663,y:259.6302083333333,step:0},{x:350.1556396484375,y:270.42191569010413,step:0},{x:351.17643229166663,y:274.03385416666663,step:1},{x:351.8573811848958,y:276.9739583333333,step:1},{x:352.46158854166663,y:280.0833740234375,step:1},{x:352.57486979166663,y:280.0833740234375,step:0},{x:352.6888427734375,y:277.18485514322913,step:1},{x:353.06640625,y:274.0755208333333,step:1},{x:353.74674479166663,y:269.9192708333333,step:1},{x:355.4857177734375,y:259.6302083333333,step:0},{x:360.58854166666663,y:259.6302083333333,step:0},{x:355.75,y:287.9374593098958,step:0},{x:350.11783854166663,y:287.9374593098958,step:0},{x:346.5650634765625,y:276.6380208333333,step:0},{x:345.4309895833333,y:272.7734375,step:1},{x:344.75065104166663,y:270.2135823567708,step:1},{x:344.0697021484375,y:266.7682698567708,step:1},{x:343.9563802083333,y:266.7682698567708,step:0},{x:343.69205729166663,y:269.54166666666663,step:1},{x:343.0872395833333,y:273.53129069010413,step:1},{x:342.3313802083333,y:278.0234375,step:1},{x:340.63087972005206,y:287.9374593098958,step:0},{x:335.56512451171875,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.57743326822913,y:259.6302083333333,step:2},{x:380.50846354166663,y:259.6302083333333,step:0},{x:379.6009521484375,y:264.7942708333333,step:0},{x:370.1516927083333,y:264.7942708333333,step:0},{x:368.9798177083333,y:271.42972819010413,step:0},{x:377.86258951822913,y:271.42972819010413,step:0},{x:376.9557698567708,y:276.51298014322913,step:0},{x:368.11063639322913,y:276.51298014322913,step:0},{x:366.1823323567708,y:287.9374593098958,step:0},{x:360.7395833333333,y:287.9374593098958,step:0},{x:365.57743326822913,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.22265625,y:259.6302083333333,step:2},{x:385.3847249348958,y:287.9374593098958,step:0},{x:379.94071451822913,y:287.9374593098958,step:0},{x:384.7792561848958,y:259.6302083333333,step:0},{x:390.22265625,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:395.1737874348958,y:260.04947916666663,step:2},{x:397.36649576822913,y:259.6302083333333,step:1},{x:399.748046875,y:259.4192708333333,step:1},{x:402.24283854166663,y:259.4192708333333,step:1},{x:406.21158854166663,y:259.4192708333333,step:1},{x:409.3489990234375,y:260.42704264322913,step:1},{x:411.50260416666663,y:262.4843343098958,step:1},{x:413.58329264322913,y:264.3333333333333,step:1},{x:414.8671875,y:267.14579264322913,step:1},{x:414.8671875,y:271.34635416666663,step:1},{x:414.8671875,y:276.8073323567708,step:1},{x:412.7890625,y:281.5521240234375,step:1},{x:409.6510823567708,y:284.3671875,step:1},{x:406.7030843098958,y:287.01298014322913,step:1},{x:402.9609375,y:288.1458333333333,step:1},{x:397.4420166015625,y:288.1458333333333,step:1},{x:394.380859375,y:288.1458333333333,step:1},{x:391.734375,y:287.8515218098958,step:1},{x:390.4491780598958,y:287.5598958333333,step:1},{x:395.1737874348958,y:260.04947916666663,step:0},{x:396.7239583333333,y:283.1067708333333,step:2},{x:397.36649576822913,y:283.19010416666663,step:1},{x:398.16015625,y:283.2317708333333,step:1},{x:399.10477701822913,y:283.2317708333333,step:1},{x:402.0540364583333,y:283.2317708333333,step:1},{x:404.662109375,y:282.0573323567708,step:1},{x:406.3249104817708,y:279.95572916666663,step:1},{x:408.0638020833333,y:277.7317708333333,step:1},{x:408.970703125,y:274.7916259765625,step:1},{x:408.970703125,y:271.3880615234375,step:1},{x:408.970703125,y:266.8958740234375,step:1},{x:406.74088541666663,y:264.25,step:1},{x:402.24283854166663,y:264.25,step:1},{x:401.2974853515625,y:264.25,step:1},{x:400.5038655598958,y:264.3333333333333,step:1},{x:399.9368489583333,y:264.45829264322913,step:1},{x:396.7239583333333,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:432.7096761067708,y:275.88285319010413,step:2},{x:423.67447916666663,y:275.88285319010413,step:0},{x:422.50260416666663,y:282.7708333333333,step:0},{x:432.6718343098958,y:282.7708333333333,step:0},{x:431.80204264322913,y:287.9374593098958,step:0},{x:416.1536865234375,y:287.9374593098958,step:0},{x:420.9921875,y:259.6302083333333,step:0},{x:436.07291666666663,y:259.6302083333333,step:0},{x:435.16666666666663,y:264.7942708333333,step:0},{x:425.56510416666663,y:264.7942708333333,step:0},{x:424.5077718098958,y:270.8021240234375,step:0},{x:433.61722819010413,y:270.8021240234375,step:0},{x:432.7096761067708,y:275.88285319010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:435.69535319010413,y:287.9374593098958,step:2},{x:440.53385416666663,y:259.6302083333333,step:0},{x:446.921875,y:259.6302083333333,step:0},{x:450.2864583333333,y:270.42191569010413,step:0},{x:451.3072509765625,y:274.03385416666663,step:1},{x:451.98697916666663,y:276.9739583333333,step:1},{x:452.59244791666663,y:280.0833740234375,step:1},{x:452.70572916666663,y:280.0833740234375,step:0},{x:452.8190511067708,y:277.18485514322913,step:1},{x:453.1978759765625,y:274.0755208333333,step:1},{x:453.87760416666663,y:269.9192708333333,step:1},{x:455.61722819010413,y:259.6302083333333,step:0},{x:460.71875,y:259.6302083333333,step:0},{x:455.8802083333333,y:287.9374593098958,step:0},{x:450.24869791666663,y:287.9374593098958,step:0},{x:446.6953125,y:276.6380208333333,step:0},{x:445.56119791666663,y:272.7734375,step:1},{x:444.8802083333333,y:270.2135823567708,step:1},{x:444.2005208333333,y:266.7682698567708,step:1},{x:444.0872395833333,y:266.7682698567708,step:0},{x:443.8228759765625,y:269.54166666666663,step:1},{x:443.21875,y:273.53129069010413,step:1},{x:442.4622802734375,y:278.0234375,step:1},{x:440.76041666666663,y:287.9374593098958,step:0},{x:435.69535319010413,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:469.4127197265625,y:264.92191569010413,step:2},{x:462.6848958333333,y:264.92191569010413,step:0},{x:463.6302490234375,y:259.6302083333333,step:0},{x:482.5677083333333,y:259.6302083333333,step:0},{x:481.65885416666663,y:264.92191569010413,step:0},{x:474.85550944010413,y:264.92191569010413,step:0},{x:470.92447916666663,y:287.9374593098958,step:0},{x:465.4818115234375,y:287.9374593098958,step:0},{x:469.4127197265625,y:264.92191569010413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:490.9583740234375,y:259.6302083333333,step:2},{x:486.1197509765625,y:287.9374593098958,step:0},{x:480.67704264322913,y:287.9374593098958,step:0},{x:485.51566569010413,y:259.6302083333333,step:0},{x:490.9583740234375,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:498.1770833333333,y:280.5859375,step:2},{x:495.1913655598958,y:287.9374593098958,step:0},{x:489.3697509765625,y:287.9374593098958,step:0},{x:501.8072509765625,y:259.6302083333333,step:0},{x:508.79947916666663,y:259.6302083333333,step:0},{x:511.7473958333333,y:287.9374593098958,step:0},{x:506.0403645833333,y:287.9374593098958,step:0},{x:505.51041666666663,y:280.5859375,step:0},{x:498.1770833333333,y:280.5859375,step:0},{x:505.28385416666663,y:275.9661458333333,step:2},{x:504.79166666666663,y:269.87760416666663,step:0},{x:504.6796875,y:268.3229573567708,step:1},{x:504.5650634765625,y:266.05472819010413,step:1},{x:504.4530843098958,y:264.3333333333333,step:1},{x:504.3385009765625,y:264.3333333333333,step:0},{x:503.6966552734375,y:266.05472819010413,step:1},{x:502.9792073567708,y:268.2396240234375,step:1},{x:502.2981770833333,y:269.87760416666663,step:1},{x:499.80204264322913,y:275.9661458333333,step:0},{x:505.28385416666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:519.3463541666666,y:259.6302083333333,step:2},{x:524.7890625,y:259.6302083333333,step:0},{x:520.8568115234375,y:282.64579264322913,step:0},{x:530.6484375,y:282.64579264322913,step:0},{x:529.7395833333333,y:287.9374593098958,step:0},{x:514.5077718098958,y:287.9374593098958,step:0},{x:519.3463541666666,y:259.6302083333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],dh=[{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #e4f1ff, #c9cee2)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:480.32816569010413,y:291.3645833333333,step:2},{x:480.32816569010413,y:297.2317708333333,step:1},{x:474.28125,y:302.03125,step:1},{x:466.8880615234375,y:302.03125,step:1},{x:350.91019694010413,y:302.03125,step:0},{x:343.51822916666663,y:302.03125,step:1},{x:337.4700724283854,y:297.2317708333333,step:1},{x:337.4700724283854,y:291.3645833333333,step:1},{x:337.4700724283854,y:254.3671875,step:0},{x:337.4700724283854,y:248.50069173177081,step:1},{x:343.51822916666663,y:243.70052083333331,step:1},{x:350.91019694010413,y:243.70052083333331,step:1},{x:466.8880615234375,y:243.70052083333331,step:0},{x:474.28125,y:243.70052083333331,step:1},{x:480.32816569010413,y:248.50069173177081,step:1},{x:480.32816569010413,y:254.3671875,step:1},{x:480.32816569010413,y:291.3645833333333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(24,37,100,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:356.54886881510413,y:260.048828125,step:2},{x:358.7415364583333,y:259.6288655598958,step:1},{x:361.12308756510413,y:259.41861979166663,step:1},{x:363.61722819010413,y:259.41861979166663,step:1},{x:367.5865478515625,y:259.41861979166663,step:1},{x:370.7239583333333,y:260.42704264322913,step:1},{x:372.8782552083333,y:262.4849853515625,step:1},{x:374.9577229817708,y:264.33268229166663,step:1},{x:376.24283854166663,y:267.146484375,step:1},{x:376.24283854166663,y:271.3470052083333,step:1},{x:376.24283854166663,y:276.8073323567708,step:1},{x:374.1634114583333,y:281.5521240234375,step:1},{x:371.0267333984375,y:284.3671875,step:1},{x:368.07743326822913,y:287.01298014322913,step:1},{x:364.3352864583333,y:288.1458333333333,step:1},{x:358.8170979817708,y:288.1458333333333,step:1},{x:355.7552083333333,y:288.1458333333333,step:1},{x:353.10868326822913,y:287.85282389322913,step:1},{x:351.8235677083333,y:287.5598958333333,step:1},{x:356.54886881510413,y:260.048828125,step:0},{x:358.0989990234375,y:283.1067708333333,step:2},{x:358.7415364583333,y:283.19010416666663,step:1},{x:359.53515625,y:283.2317708333333,step:1},{x:360.47977701822913,y:283.2317708333333,step:1},{x:363.4284261067708,y:283.2317708333333,step:1},{x:366.0370686848958,y:282.0573323567708,step:1},{x:367.69986979166663,y:279.9569905598958,step:1},{x:369.4388020833333,y:277.7317708333333,step:1},{x:370.34574381510413,y:274.7916259765625,step:1},{x:370.34574381510413,y:271.38871256510413,step:1},{x:370.34574381510413,y:266.8952229817708,step:1},{x:368.1158447265625,y:264.24869791666663,step:1},{x:363.61722819010413,y:264.24869791666663,step:1},{x:362.67252604166663,y:264.24869791666663,step:1},{x:361.8782552083333,y:264.33268229166663,step:1},{x:361.31180826822913,y:264.458984375,step:1},{x:358.0989990234375,y:283.1067708333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:382.3288167317708,y:260.1335042317708,step:2},{x:384.0292561848958,y:259.67057291666663,step:1},{x:386.599609375,y:259.41861979166663,step:1},{x:389.1321614583333,y:259.41861979166663,step:1},{x:391.5520833333333,y:259.41861979166663,step:1},{x:394.0462239583333,y:259.79752604166663,step:1},{x:395.8228759765625,y:261.056640625,step:1},{x:397.48636881510413,y:262.1491292317708,step:1},{x:398.658203125,y:263.91276041666663,step:1},{x:398.658203125,y:266.5592854817708,step:1},{x:398.658203125,y:270.7591145833333,step:1},{x:396.1634114583333,y:273.4049072265625,step:1},{x:392.8743489583333,y:274.58072916666663,step:1},{x:392.8743489583333,y:274.70703125,step:0},{x:394.38671875,y:275.46354166666663,step:1},{x:395.06705729166663,y:277.3098958333333,step:1},{x:395.2942708333333,y:279.8723958333333,step:1},{x:395.6341145833333,y:283.06510416666663,step:1},{x:395.8228759765625,y:286.76041666666663,step:1},{x:396.2766927083333,y:287.9374593098958,step:1},{x:390.6823323567708,y:287.9374593098958,step:0},{x:390.45572916666663,y:287.18094889322913,step:1},{x:390.1907552083333,y:284.74479166666663,step:1},{x:389.96415201822913,y:281.2591145833333,step:1},{x:389.69921875,y:277.81510416666663,step:1},{x:388.6412353515625,y:276.765625,step:1},{x:386.486328125,y:276.765625,step:1},{x:384.8236083984375,y:276.765625,step:0},{x:382.9329427083333,y:287.9374593098958,step:0},{x:377.5657958984375,y:287.9374593098958,step:0},{x:382.3288167317708,y:260.1335042317708,step:0},{x:385.6549886067708,y:272.22855631510413,step:2},{x:387.88541666666663,y:272.22855631510413,step:0},{x:390.833984375,y:272.22855631510413,step:1},{x:392.9876708984375,y:270.25455729166663,step:1},{x:392.9876708984375,y:267.48246256510413,step:1},{x:392.9876708984375,y:265.1731770833333,step:1},{x:391.287109375,y:264.16471354166663,step:1},{x:389.0950520833333,y:264.16471354166663,step:1},{x:388.07421875,y:264.16471354166663,step:1},{x:387.431640625,y:264.24869791666663,step:1},{x:386.978515625,y:264.3749593098958,step:1},{x:385.6549886067708,y:272.22855631510413,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:406.9739583333333,y:280.5859375,step:2},{x:403.9876302083333,y:287.9374593098958,step:0},{x:398.1659749348958,y:287.9374593098958,step:0},{x:410.6028645833333,y:259.6288655598958,step:0},{x:417.59635416666663,y:259.6288655598958,step:0},{x:420.5442708333333,y:287.9374593098958,step:0},{x:414.8359375,y:287.9374593098958,step:0},{x:414.30729166666663,y:280.5859375,step:0},{x:406.9739583333333,y:280.5859375,step:0},{x:414.08072916666663,y:275.9661458333333,step:2},{x:413.58854166666663,y:269.8769124348958,step:0},{x:413.4753011067708,y:268.3229573567708,step:1},{x:413.36197916666663,y:266.0553792317708,step:1},{x:413.24869791666663,y:264.33268229166663,step:1},{x:413.1353759765625,y:264.33268229166663,step:0},{x:412.4921468098958,y:266.0553792317708,step:1},{x:411.7734375,y:268.2389729817708,step:1},{x:411.0937093098958,y:269.8769124348958,step:1},{x:408.599609375,y:275.9661458333333,step:0},{x:414.08072916666663,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:428.1419677734375,y:259.6288655598958,step:2},{x:443.07291666666663,y:259.6288655598958,step:0},{x:442.1653645833333,y:264.79496256510413,step:0},{x:432.71610514322913,y:264.79496256510413,step:0},{x:431.5442708333333,y:271.4309895833333,step:0},{x:440.42704264322913,y:271.4309895833333,step:0},{x:439.51822916666663,y:276.51298014322913,step:0},{x:430.67447916666663,y:276.51298014322913,step:0},{x:428.7460530598958,y:287.9374593098958,step:0},{x:423.3033447265625,y:287.9374593098958,step:0},{x:428.1419677734375,y:259.6288655598958,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:451.1614583333333,y:264.9206136067708,step:2},{x:444.43229166666663,y:264.9206136067708,step:0},{x:445.37760416666663,y:259.6288655598958,step:0},{x:464.3151448567708,y:259.6288655598958,step:0},{x:463.40885416666663,y:264.9206136067708,step:0},{x:456.6041259765625,y:264.9206136067708,step:0},{x:452.6731770833333,y:287.9374593098958,step:0},{x:447.22916666666663,y:287.9374593098958,step:0},{x:451.1614583333333,y:264.9206136067708,step:0}],borderWidth:0,borderColor:"rgba(24,37,100,1)",background:"rgba(24,37,100,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],ch=[{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01236979166666,step:0},{x:347.61588541666663,y:248.14583333333331,step:1},{x:352.7974853515625,y:243.345703125,step:1},{x:359.1308186848958,y:243.345703125,step:1},{x:458.4973958333333,y:243.345703125,step:0},{x:464.83203125,y:243.345703125,step:1},{x:470.0130208333333,y:248.14583333333331,step:1},{x:470.0130208333333,y:254.01236979166666,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f1f6ea, #cedfc5)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:470.0130208333333,y:291.0103759765625,step:2},{x:470.0130208333333,y:296.87760416666663,step:1},{x:464.83203125,y:301.67704264322913,step:1},{x:458.4973958333333,y:301.67704264322913,step:1},{x:359.1308186848958,y:301.67704264322913,step:0},{x:352.7974853515625,y:301.67704264322913,step:1},{x:347.61588541666663,y:296.87760416666663,step:1},{x:347.61588541666663,y:291.0103759765625,step:1},{x:347.61588541666663,y:254.01302083333331,step:0},{x:347.61588541666663,y:248.14652506510416,step:1},{x:352.7974853515625,y:243.34635416666666,step:1},{x:359.1308186848958,y:243.34635416666666,step:1},{x:458.4973958333333,y:243.34635416666666,step:0},{x:464.83203125,y:243.34635416666666,step:1},{x:470.0130208333333,y:248.14652506510416,step:1},{x:470.0130208333333,y:254.01302083333331,step:1},{x:470.0130208333333,y:291.0103759765625,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,106,28,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:365.95768229166663,y:259.62955729166663,step:2},{x:380.888671875,y:259.62955729166663,step:0},{x:379.9810791015625,y:264.79496256510413,step:0},{x:370.5318603515625,y:264.79496256510413,step:0},{x:369.36002604166663,y:271.431640625,step:0},{x:378.24283854166663,y:271.431640625,step:0},{x:377.3359375,y:276.51298014322913,step:0},{x:368.4908447265625,y:276.51298014322913,step:0},{x:366.5625,y:287.9374593098958,step:0},{x:361.1197509765625,y:287.9374593098958,step:0},{x:365.95768229166663,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.6028645833333,y:259.62955729166663,step:2},{x:385.76493326822913,y:287.9374593098958,step:0},{x:380.3210042317708,y:287.9374593098958,step:0},{x:385.1595052083333,y:259.62955729166663,step:0},{x:390.6028645833333,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:390.79166666666663,y:287.9374593098958,step:2},{x:395.62955729166663,y:259.62955729166663,step:0},{x:402.01822916666663,y:259.62955729166663,step:0},{x:405.3822021484375,y:270.423828125,step:0},{x:406.4030354817708,y:274.03641764322913,step:1},{x:407.0833333333333,y:276.9739583333333,step:1},{x:407.68815104166663,y:280.0833740234375,step:1},{x:407.8013916015625,y:280.0833740234375,step:0},{x:407.91471354166663,y:277.18485514322913,step:1},{x:408.29300944010413,y:274.078125,step:1},{x:408.97330729166663,y:269.91861979166663,step:1},{x:410.7109375,y:259.62955729166663,step:0},{x:415.81510416666663,y:259.62955729166663,step:0},{x:410.97660319010413,y:287.9374593098958,step:0},{x:405.34440104166663,y:287.9374593098958,step:0},{x:401.79166666666663,y:276.6380208333333,step:0},{x:400.6569417317708,y:272.775390625,step:1},{x:399.9771728515625,y:270.212890625,step:1},{x:399.2962239583333,y:266.7689208984375,step:1},{x:399.18290201822913,y:266.7689208984375,step:0},{x:398.9185791015625,y:269.541015625,step:1},{x:398.31315104166663,y:273.53129069010413,step:1},{x:397.5579427083333,y:278.0260823567708,step:1},{x:395.8567708333333,y:287.9374593098958,step:0},{x:390.79166666666663,y:287.9374593098958,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.9974365234375,y:280.5859375,step:2},{x:420.0103759765625,y:287.9374593098958,step:0},{x:414.1888427734375,y:287.9374593098958,step:0},{x:426.625,y:259.62955729166663,step:0},{x:433.61722819010413,y:259.62955729166663,step:0},{x:436.5677083333333,y:287.9374593098958,step:0},{x:430.859375,y:287.9374593098958,step:0},{x:430.3294270833333,y:280.5859375,step:0},{x:422.9974365234375,y:280.5859375,step:0},{x:430.1028645833333,y:275.9661458333333,step:2},{x:429.61197916666663,y:269.8769124348958,step:0},{x:429.4973958333333,y:268.322265625,step:1},{x:429.38541666666663,y:266.0553792317708,step:1},{x:429.27079264322913,y:264.33268229166663,step:1},{x:429.15751139322913,y:264.33268229166663,step:0},{x:428.515625,y:266.0553792317708,step:1},{x:427.796875,y:268.2389729817708,step:1},{x:427.1171468098958,y:269.8769124348958,step:1},{x:424.6223958333333,y:275.9661458333333,step:0},{x:430.1028645833333,y:275.9661458333333,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:444.1640625,y:259.62955729166663,step:2},{x:449.6068115234375,y:259.62955729166663,step:0},{x:445.67704264322913,y:282.64579264322913,step:0},{x:455.4661458333333,y:282.64579264322913,step:0},{x:454.5598958333333,y:287.9374593098958,step:0},{x:439.32548014322913,y:287.9374593098958,step:0},{x:444.1640625,y:259.62955729166663,step:0}],borderWidth:0,borderColor:"rgba(65,106,28,1)",background:"rgba(65,106,28,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],uh=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(65,50,130,1)",background:"linear-gradient(to right bottom, #ccc2ff, #8677c7)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.35221354166663,y:267.82421875,step:2},{x:384.50846354166663,y:278.6067708333333,step:0},{x:382.435546875,y:278.6067708333333,step:0},{x:384.27799479166663,y:267.82421875,step:0},{x:386.35221354166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:386.4237874348958,y:278.6067708333333,step:2},{x:388.2669677734375,y:267.82421875,step:0},{x:390.7005208333333,y:267.82421875,step:0},{x:391.982421875,y:271.935546875,step:0},{x:392.37113444010413,y:273.3118489583333,step:1},{x:392.6302490234375,y:274.4322509765625,step:1},{x:392.8606770833333,y:275.6145833333333,step:1},{x:392.9036458333333,y:275.6145833333333,step:0},{x:392.94730631510413,y:274.51298014322913,step:1},{x:393.0911458333333,y:273.32816569010413,step:1},{x:393.3503011067708,y:271.744140625,step:1},{x:394.0124104817708,y:267.82421875,step:0},{x:395.9563802083333,y:267.82421875,step:0},{x:394.1132405598958,y:278.6067708333333,step:0},{x:391.9680989583333,y:278.6067708333333,step:0},{x:390.61393229166663,y:274.3046468098958,step:0},{x:390.1823323567708,y:272.83203125,step:1},{x:389.9232177734375,y:271.8561604817708,step:1},{x:389.66410319010413,y:270.5435791015625,step:1},{x:389.6204833984375,y:270.5435791015625,step:0},{x:389.52018229166663,y:271.599609375,step:1},{x:389.28971354166663,y:273.11979166666663,step:1},{x:389.0013020833333,y:274.83203125,step:1},{x:388.353515625,y:278.6067708333333,step:0},{x:386.4237874348958,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.88736979166663,y:267.82421875,step:2},{x:398.0442708333333,y:278.6067708333333,step:0},{x:395.970703125,y:278.6067708333333,step:0},{x:397.8138020833333,y:267.82421875,step:0},{x:399.88736979166663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:403.2141927083333,y:269.83984375,step:2},{x:400.65104166666663,y:269.83984375,step:0},{x:401.0110677083333,y:267.82421875,step:0},{x:408.22526041666663,y:267.82421875,step:0},{x:407.87955729166663,y:269.83984375,step:0},{x:405.28776041666663,y:269.83984375,step:0},{x:403.7897542317708,y:278.6067708333333,step:0},{x:401.71610514322913,y:278.6067708333333,step:0},{x:403.2141927083333,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:411.421875,y:267.82421875,step:2},{x:409.5780843098958,y:278.6067708333333,step:0},{x:407.50455729166663,y:278.6067708333333,step:0},{x:409.3489990234375,y:267.82421875,step:0},{x:411.421875,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:414.1718343098958,y:275.80729166666663,step:2},{x:413.0338948567708,y:278.6067708333333,step:0},{x:410.8177490234375,y:278.6067708333333,step:0},{x:415.55472819010413,y:267.82421875,step:0},{x:418.21875,y:267.82421875,step:0},{x:419.3411458333333,y:278.6067708333333,step:0},{x:417.16666666666663,y:278.6067708333333,step:0},{x:416.9661458333333,y:275.80729166666663,step:0},{x:414.1718343098958,y:275.80729166666663,step:0},{x:416.8802083333333,y:274.04691569010413,step:2},{x:416.6927083333333,y:271.7278645833333,step:0},{x:416.6484375,y:271.1360677083333,step:1},{x:416.6054280598958,y:270.2714436848958,step:1},{x:416.5625,y:269.61588541666663,step:1},{x:416.5181884765625,y:269.61588541666663,step:0},{x:416.27347819010413,y:270.2714436848958,step:1},{x:416,y:271.1034749348958,step:1},{x:415.7421875,y:271.7278645833333,step:1},{x:414.79166666666663,y:274.04691569010413,step:0},{x:416.8802083333333,y:274.04691569010413,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:422.2357177734375,y:267.82421875,step:2},{x:424.3099365234375,y:267.82421875,step:0},{x:422.81254069010413,y:276.5911458333333,step:0},{x:426.5417073567708,y:276.5911458333333,step:0},{x:426.19535319010413,y:278.6067708333333,step:0},{x:420.39322916666663,y:278.6067708333333,step:0},{x:422.2357177734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(65,50,130,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],ph=[{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,0.2)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:551.4908854166666,y:293.8854573567708,step:2},{x:551.4908854166666,y:298.2864583333333,step:1},{x:546.6080729166666,y:301.8854573567708,step:1},{x:540.6393229166666,y:301.8854573567708,step:1},{x:278.845703125,y:301.8854573567708,step:0},{x:272.87760416666663,y:301.8854573567708,step:1},{x:267.99477132161456,y:298.2864583333333,step:1},{x:267.99477132161456,y:293.8854573567708,step:1},{x:267.99477132161456,y:251.88545735677081,step:0},{x:267.99477132161456,y:247.48502604166666,step:1},{x:272.87760416666663,y:243.88545735677081,step:1},{x:278.845703125,y:243.88545735677081,step:1},{x:540.6393229166666,y:243.88545735677081,step:0},{x:546.6080729166666,y:243.88545735677081,step:1},{x:551.4908854166666,y:247.48502604166666,step:1},{x:551.4908854166666,y:251.88545735677081,step:1},{x:551.4908854166666,y:293.8854573567708,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:281.60611979166663,y:288,step:2},{x:286.44403076171875,y:259.69205729166663,step:0},{x:292.83270263671875,y:259.69205729166663,step:0},{x:296.1966145833333,y:270.4856770833333,step:0},{x:297.21744791666663,y:274.0989583333333,step:1},{x:297.89711507161456,y:277.0377197265625,step:1},{x:298.50260416666663,y:280.1458333333333,step:1},{x:298.61588541666663,y:280.1458333333333,step:0},{x:298.72914632161456,y:277.2473958333333,step:1},{x:299.10744222005206,y:274.14066569010413,step:1},{x:299.78774007161456,y:269.9817708333333,step:1},{x:301.52604166666663,y:259.69205729166663,step:0},{x:306.62957763671875,y:259.69205729166663,step:0},{x:301.791015625,y:288,step:0},{x:296.15887451171875,y:288,step:0},{x:292.60546875,y:276.70182291666663,step:0},{x:291.47137451171875,y:272.837890625,step:1},{x:290.791015625,y:270.27604166666663,step:1},{x:290.1106974283854,y:266.83203125,step:1},{x:289.99737548828125,y:266.83203125,step:0},{x:289.73305257161456,y:269.6041259765625,step:1},{x:289.12760416666663,y:273.59375,step:1},{x:288.3724161783854,y:278.0885823567708,step:1},{x:286.67057291666663,y:288,step:0},{x:281.60611979166663,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:318.19596354166663,y:288.4622395833333,step:2},{x:311.58074951171875,y:288.4622395833333,step:1},{x:307.8763020833333,y:283.25394694010413,step:1},{x:307.8763020833333,y:276.66015625,step:1},{x:307.8763020833333,y:271.5364583333333,step:1},{x:309.57682291666663,y:266.4544270833333,step:1},{x:312.56378173828125,y:263.26236979166663,step:1},{x:314.9446614583333,y:260.7421875,step:1},{x:318.19596354166663,y:259.2298177083333,step:1},{x:321.86195882161456,y:259.2298177083333,step:1},{x:328.5911458333333,y:259.2298177083333,step:1},{x:332.14322916666663,y:264.27018229166663,step:1},{x:332.14322916666663,y:271.0325520833333,step:1},{x:332.14322916666663,y:276.1979573567708,step:1},{x:330.51822916666663,y:281.2369384765625,step:1},{x:327.60805257161456,y:284.3880208333333,step:1},{x:325.2265421549479,y:286.9505615234375,step:1},{x:322.0136515299479,y:288.4622395833333,step:1},{x:318.23307291666663,y:288.4622395833333,step:1},{x:318.19596354166663,y:288.4622395833333,step:0},{x:318.9895833333333,y:283.42191569010413,step:2},{x:320.6145833333333,y:283.42191569010413,step:1},{x:322.08854166666663,y:282.66666666666663,step:1},{x:323.26041666666663,y:281.3645833333333,step:1},{x:325.26430257161456,y:279.13798014322913,step:1},{x:326.3606974283854,y:274.4765218098958,step:1},{x:326.3606974283854,y:271.2005208333333,step:1},{x:326.3606974283854,y:267.6718343098958,step:1},{x:325.2265421549479,y:264.27018229166663,step:1},{x:321.2200520833333,y:264.27018229166663,step:1},{x:319.51822916666663,y:264.27018229166663,step:1},{x:318.00649007161456,y:265.06766764322913,step:1},{x:316.83465576171875,y:266.412109375,step:1},{x:314.79361979166663,y:268.6380208333333,step:1},{x:313.65948486328125,y:273.0481770833333,step:1},{x:313.65948486328125,y:276.4505208333333,step:1},{x:313.65948486328125,y:280.44010416666663,step:1},{x:315.28515625,y:283.42191569010413,step:1},{x:318.95182291666663,y:283.42191569010413,step:1},{x:318.9895833333333,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:340.64906819661456,y:264.98368326822913,step:2},{x:333.92055257161456,y:264.98368326822913,step:0},{x:334.865234375,y:259.69205729166663,step:0},{x:353.8033447265625,y:259.69205729166663,step:0},{x:352.8958740234375,y:264.98368326822913,step:0},{x:346.091796875,y:264.98368326822913,step:0},{x:342.16080729166663,y:288,step:0},{x:336.71744791666663,y:288,step:0},{x:340.64906819661456,y:264.98368326822913,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:366.0124104817708,y:280.64969889322913,step:2},{x:363.02604166666663,y:288,step:0},{x:357.2044270833333,y:288,step:0},{x:369.640625,y:259.69205729166663,step:0},{x:376.6341145833333,y:259.69205729166663,step:0},{x:379.58203125,y:288,step:0},{x:373.8743489583333,y:288,step:0},{x:373.3450520833333,y:280.64969889322913,step:0},{x:366.0124104817708,y:280.64969889322913,step:0},{x:373.11844889322913,y:276.0299886067708,step:2},{x:372.626953125,y:269.94010416666663,step:0},{x:372.513671875,y:268.38602701822913,step:1},{x:372.400390625,y:266.1184895833333,step:1},{x:372.2864583333333,y:264.3958333333333,step:1},{x:372.1731770833333,y:264.3958333333333,step:0},{x:371.5305989583333,y:266.1184895833333,step:1},{x:370.81254069010413,y:268.3020833333333,step:1},{x:370.1321614583333,y:269.94010416666663,step:1},{x:367.63736979166663,y:276.0299886067708,step:0},{x:373.11844889322913,y:276.0299886067708,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:387.06640625,y:260.1966552734375,step:2},{x:388.7292073567708,y:259.7337239583333,step:1},{x:391.2624104817708,y:259.4818115234375,step:1},{x:393.71940104166663,y:259.4818115234375,step:1},{x:396.0247395833333,y:259.4818115234375,step:1},{x:398.63346354166663,y:259.90234375,step:1},{x:400.4856770833333,y:261.3723958333333,step:1},{x:402.22391764322913,y:262.6321614583333,step:1},{x:403.2447509765625,y:264.6477864583333,step:1},{x:403.2447509765625,y:267.37760416666663,step:1},{x:403.2447509765625,y:270.94791666666663,step:1},{x:401.77079264322913,y:273.6783447265625,step:1},{x:399.8052978515625,y:275.35807291666663,step:1},{x:397.7259114583333,y:277.1640625,step:1},{x:394.7395833333333,y:278.00394694010413,step:1},{x:391.6399739583333,y:278.00394694010413,step:1},{x:390.73307291666663,y:278.00394694010413,step:1},{x:389.9771728515625,y:277.87760416666663,step:1},{x:389.41015625,y:277.8359375,step:1},{x:387.6712239583333,y:288,step:0},{x:382.3411458333333,y:288,step:0},{x:387.06640625,y:260.1966552734375,step:0},{x:390.2415364583333,y:272.8802490234375,step:2},{x:390.80863444010413,y:273.0058186848958,step:1},{x:391.4134114583333,y:273.0898030598958,step:1},{x:392.35807291666663,y:273.0898030598958,step:1},{x:395.609375,y:273.0898030598958,step:1},{x:397.763671875,y:270.7382405598958,step:1},{x:397.763671875,y:267.92447916666663,step:1},{x:397.763671875,y:265.19401041666663,step:1},{x:395.98697916666663,y:264.3118489583333,step:1},{x:393.908203125,y:264.3118489583333,step:1},{x:392.8880615234375,y:264.3118489583333,step:1},{x:392.13151041666663,y:264.3958333333333,step:1},{x:391.67838541666663,y:264.4798177083333,step:1},{x:390.2415364583333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.3847249348958,y:260.1966552734375,step:2},{x:410.0481770833333,y:259.7337239583333,step:1},{x:412.58072916666663,y:259.4818115234375,step:1},{x:415.0378011067708,y:259.4818115234375,step:1},{x:417.3437093098958,y:259.4818115234375,step:1},{x:419.9517822265625,y:259.90234375,step:1},{x:421.8033447265625,y:261.3723958333333,step:1},{x:423.5417073567708,y:262.6321614583333,step:1},{x:424.5638020833333,y:264.6477864583333,step:1},{x:424.5638020833333,y:267.37760416666663,step:1},{x:424.5638020833333,y:270.94791666666663,step:1},{x:423.08854166666663,y:273.6783447265625,step:1},{x:421.12369791666663,y:275.35807291666663,step:1},{x:419.0442708333333,y:277.1640625,step:1},{x:416.05729166666663,y:278.00394694010413,step:1},{x:412.9583740234375,y:278.00394694010413,step:1},{x:412.0520833333333,y:278.00394694010413,step:1},{x:411.2956136067708,y:277.87760416666663,step:1},{x:410.7292073567708,y:277.8359375,step:1},{x:408.9896240234375,y:288,step:0},{x:403.66019694010413,y:288,step:0},{x:408.3847249348958,y:260.1966552734375,step:0},{x:411.5598958333333,y:272.8802490234375,step:2},{x:412.12760416666663,y:273.0058186848958,step:1},{x:412.7317708333333,y:273.0898030598958,step:1},{x:413.67704264322913,y:273.0898030598958,step:1},{x:416.9270833333333,y:273.0898030598958,step:1},{x:419.08203125,y:270.7382405598958,step:1},{x:419.08203125,y:267.92447916666663,step:1},{x:419.08203125,y:265.19401041666663,step:1},{x:417.3059895833333,y:264.3118489583333,step:1},{x:415.2265625,y:264.3118489583333,step:1},{x:414.20572916666663,y:264.3118489583333,step:1},{x:413.45048014322913,y:264.3958333333333,step:1},{x:412.9974365234375,y:264.4798177083333,step:1},{x:411.5598958333333,y:272.8802490234375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:429.77860514322913,y:260.1966552734375,step:2},{x:431.4792073567708,y:259.7337239583333,step:1},{x:434.0494384765625,y:259.4818115234375,step:1},{x:436.58329264322913,y:259.4818115234375,step:1},{x:439.00260416666663,y:259.4818115234375,step:1},{x:441.4973958333333,y:259.8606770833333,step:1},{x:443.2734375,y:261.11979166666663,step:1},{x:444.9362386067708,y:262.2122395833333,step:1},{x:446.10807291666663,y:263.9759114583333,step:1},{x:446.10807291666663,y:266.6223958333333,step:1},{x:446.10807291666663,y:270.82230631510413,step:1},{x:443.6145833333333,y:273.46879069010413,step:1},{x:440.3255208333333,y:274.64322916666663,step:1},{x:440.3255208333333,y:274.7708333333333,step:0},{x:441.83719889322913,y:275.5260823567708,step:1},{x:442.5181884765625,y:277.37369791666663,step:1},{x:442.7447509765625,y:279.93619791666663,step:1},{x:443.08463541666663,y:283.12760416666663,step:1},{x:443.2734375,y:286.82425944010413,step:1},{x:443.7265625,y:288,step:1},{x:438.1328125,y:288,step:0},{x:437.90625,y:287.24479166666663,step:1},{x:437.640625,y:284.8073323567708,step:1},{x:437.4140625,y:281.3229573567708,step:1},{x:437.1497395833333,y:277.87760416666663,step:1},{x:436.0911458333333,y:276.82816569010413,step:1},{x:433.9374593098958,y:276.82816569010413,step:1},{x:432.27347819010413,y:276.82816569010413,step:0},{x:430.3841145833333,y:288,step:0},{x:425.01566569010413,y:288,step:0},{x:429.77860514322913,y:260.1966552734375,step:0},{x:433.1054280598958,y:272.2916259765625,step:2},{x:435.3359375,y:272.2916259765625,step:0},{x:438.2838948567708,y:272.2916259765625,step:1},{x:440.43876139322913,y:270.31766764322913,step:1},{x:440.43876139322913,y:267.54557291666663,step:1},{x:440.43876139322913,y:265.2362874348958,step:1},{x:438.73697916666663,y:264.2279052734375,step:1},{x:436.5442708333333,y:264.2279052734375,step:1},{x:435.5247395833333,y:264.2279052734375,step:1},{x:434.88151041666663,y:264.3118489583333,step:1},{x:434.42838541666663,y:264.4381103515625,step:1},{x:433.1054280598958,y:272.2916259765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:458.43094889322913,y:288.4622395833333,step:2},{x:451.81510416666663,y:288.4622395833333,step:1},{x:448.1119384765625,y:283.25394694010413,step:1},{x:448.1119384765625,y:276.66015625,step:1},{x:448.1119384765625,y:271.5364583333333,step:1},{x:449.8125,y:266.4544270833333,step:1},{x:452.79947916666663,y:263.26236979166663,step:1},{x:455.1796468098958,y:260.7421875,step:1},{x:458.43094889322913,y:259.2298177083333,step:1},{x:462.09765625,y:259.2298177083333,step:1},{x:468.8255208333333,y:259.2298177083333,step:1},{x:472.3802083333333,y:264.27018229166663,step:1},{x:472.3802083333333,y:271.0325520833333,step:1},{x:472.3802083333333,y:276.1979573567708,step:1},{x:470.75390625,y:281.2369384765625,step:1},{x:467.8437093098958,y:284.3880208333333,step:1},{x:465.4622802734375,y:286.9505615234375,step:1},{x:462.24869791666663,y:288.4622395833333,step:1},{x:458.4687093098958,y:288.4622395833333,step:1},{x:458.43094889322913,y:288.4622395833333,step:0},{x:459.22391764322913,y:283.42191569010413,step:2},{x:460.85026041666663,y:283.42191569010413,step:1},{x:462.32421875,y:282.66666666666663,step:1},{x:463.49609375,y:281.3645833333333,step:1},{x:465.5,y:279.13798014322913,step:1},{x:466.59635416666663,y:274.4765218098958,step:1},{x:466.59635416666663,y:271.2005208333333,step:1},{x:466.59635416666663,y:267.6718343098958,step:1},{x:465.4622802734375,y:264.27018229166663,step:1},{x:461.45572916666663,y:264.27018229166663,step:1},{x:459.75390625,y:264.27018229166663,step:1},{x:458.2421875,y:265.06766764322913,step:1},{x:457.0703125,y:266.412109375,step:1},{x:455.0286865234375,y:268.6380208333333,step:1},{x:453.8958333333333,y:273.0481770833333,step:1},{x:453.8958333333333,y:276.4505208333333,step:1},{x:453.8958333333333,y:280.44010416666663,step:1},{x:455.5208740234375,y:283.42191569010413,step:1},{x:459.1875,y:283.42191569010413,step:1},{x:459.22391764322913,y:283.42191569010413,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:478.8046875,y:288,step:2},{x:475.6302490234375,y:259.69205729166663,step:0},{x:481.2630208333333,y:259.69205729166663,step:0},{x:482.3958740234375,y:273.1737874348958,step:0},{x:482.6614583333333,y:276.1979573567708,step:1},{x:482.8489990234375,y:278.9284261067708,step:1},{x:483.0013020833333,y:281.8684895833333,step:1},{x:483.07682291666663,y:281.8684895833333,step:0},{x:484.0208740234375,y:279.09635416666663,step:1},{x:485.23173014322913,y:276.07291666666663,step:1},{x:486.47916666666663,y:273.13151041666663,step:1},{x:492.1862386067708,y:259.69205729166663,step:0},{x:498.27213541666663,y:259.69205729166663,step:0},{x:485.1171468098958,y:288,step:0},{x:478.8046875,y:288,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:512.9766031901041,y:275.9466145833333,step:2},{x:503.94266764322913,y:275.9466145833333,step:0},{x:502.7708333333333,y:282.8333333333333,step:0},{x:512.9388020833333,y:282.8333333333333,step:0},{x:512.0690104166666,y:288,step:0},{x:496.4192708333333,y:288,step:0},{x:501.2578125,y:259.69205729166663,step:0},{x:516.3411458333333,y:259.69205729166663,step:0},{x:515.4323323567708,y:264.85807291666663,step:0},{x:505.83203125,y:264.85807291666663,step:0},{x:504.7734375,y:270.8646240234375,step:0},{x:513.8828125,y:270.8646240234375,step:0},{x:512.9766031901041,y:275.9466145833333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:520.7252604166666,y:260.1119384765625,step:2},{x:522.9166259765625,y:259.69205729166663,step:1},{x:525.2994791666666,y:259.4818115234375,step:1},{x:527.7942708333333,y:259.4818115234375,step:1},{x:531.7630208333333,y:259.4818115234375,step:1},{x:534.8997395833333,y:260.4901936848958,step:1},{x:537.0547281901041,y:262.5482177734375,step:1},{x:539.1340738932291,y:264.3958333333333,step:1},{x:540.4192708333333,y:267.20963541666663,step:1},{x:540.4192708333333,y:271.4101155598958,step:1},{x:540.4192708333333,y:276.86979166666663,step:1},{x:538.33984375,y:281.61588541666663,step:1},{x:535.203125,y:284.4296875,step:1},{x:532.25390625,y:287.0755208333333,step:1},{x:528.5116780598958,y:288.20963541666663,step:1},{x:522.9935302734375,y:288.20963541666663,step:1},{x:519.9309895833333,y:288.20963541666663,step:1},{x:517.2851155598958,y:287.91666666666663,step:1},{x:516,y:287.6223958333333,step:1},{x:520.7252604166666,y:260.1119384765625,step:0},{x:522.2747802734375,y:283.1692708333333,step:2},{x:522.9166259765625,y:283.25394694010413,step:1},{x:523.7109375,y:283.29557291666663,step:1},{x:524.65625,y:283.29557291666663,step:1},{x:527.6041666666666,y:283.29557291666663,step:1},{x:530.2135416666666,y:282.11979166666663,step:1},{x:531.8763020833333,y:280.0208333333333,step:1},{x:533.6145833333333,y:277.7942708333333,step:1},{x:534.5221354166666,y:274.85416666666663,step:1},{x:534.5221354166666,y:271.45182291666663,step:1},{x:534.5221354166666,y:266.95829264322913,step:1},{x:532.2917073567708,y:264.3118489583333,step:1},{x:527.7942708333333,y:264.3118489583333,step:1},{x:526.8489990234375,y:264.3118489583333,step:1},{x:526.0547281901041,y:264.3958333333333,step:1},{x:525.4870198567708,y:264.52213541666663,step:1},{x:522.2747802734375,y:283.1692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],gh=[{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,1)",background:"linear-gradient(to right bottom, #f89077, #b21f10)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:420.5598958333333,y:265.5247395833333,step:2},{x:416.81119791666663,y:261.8561604817708,step:0},{x:409.3333333333333,y:269.3333333333333,step:0},{x:401.9127197265625,y:261.912109375,step:0},{x:398.3177490234375,y:265.50846354166663,step:0},{x:405.7382405598958,y:272.9290364583333,step:0},{x:398.3151448567708,y:280.3515218098958,step:0},{x:402.0638020833333,y:284.01822916666663,step:0},{x:409.48832194010413,y:276.5989583333333,step:0},{x:416.95703125,y:284.06766764322913,step:0},{x:420.5520833333333,y:280.4713134765625,step:0},{x:413.08203125,y:273.0032552083333,step:0},{x:420.5598958333333,y:265.5247395833333,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],fh=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(110,0,5,1)",background:"linear-gradient(to right bottom, #f89077, #cc4a31)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:397.2669270833333,y:276.1119384765625,step:2},{x:397.8430989583333,y:276.4791259765625,step:1},{x:398.64908854166663,y:276.78385416666663,step:1},{x:399.556640625,y:276.78385416666663,step:1},{x:400.3483479817708,y:276.78385416666663,step:1},{x:401.08268229166663,y:276.3671875,step:1},{x:401.08268229166663,y:275.5364583333333,step:1},{x:401.08268229166663,y:274.9114583333333,step:1},{x:400.6653645833333,y:274.5286458333333,step:1},{x:399.77274576822913,y:274,step:1},{x:398.75,y:273.3919270833333,step:1},{x:397.77079264322913,y:272.5598958333333,step:1},{x:397.77079264322913,y:271.16796875,step:1},{x:397.77079264322913,y:268.9921875,step:1},{x:399.4700520833333,y:267.6640625,step:1},{x:401.5865478515625,y:267.6640625,step:1},{x:402.75321451822913,y:267.6640625,step:1},{x:403.44462076822913,y:267.95182291666663,step:1},{x:403.86258951822913,y:268.1920979817708,step:1},{x:403.2141927083333,y:270.111328125,step:0},{x:402.8977864583333,y:269.919921875,step:1},{x:402.220703125,y:269.6314697265625,step:1},{x:401.4140625,y:269.6477864583333,step:1},{x:400.4491780598958,y:269.6477864583333,step:1},{x:399.9452718098958,y:270.17582194010413,step:1},{x:399.9452718098958,y:270.767578125,step:1},{x:399.9452718098958,y:271.3919270833333,step:1},{x:400.53580729166663,y:271.775390625,step:1},{x:401.35611979166663,y:272.28776041666663,step:1},{x:402.53776041666663,y:272.9759114583333,step:1},{x:403.2720947265625,y:273.83984375,step:1},{x:403.2720947265625,y:275.13541666666663,step:1},{x:403.2720947265625,y:277.5364583333333,step:1},{x:401.48636881510413,y:278.7682698567708,step:1},{x:399.34049479166663,y:278.7682698567708,step:1},{x:398.0013020833333,y:278.75260416666663,step:1},{x:397.0221761067708,y:278.3671875,step:1},{x:396.5755208333333,y:278,step:1},{x:397.2669270833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:408.052734375,y:267.82421875,step:2},{x:406.20963541666663,y:278.6067708333333,step:0},{x:404.1361083984375,y:278.6067708333333,step:0},{x:405.97916666666663,y:267.82421875,step:0},{x:408.052734375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:416.1302083333333,y:278.1119384765625,step:2},{x:415.3958740234375,y:278.3827718098958,step:1},{x:414.2161458333333,y:278.71879069010413,step:1},{x:412.9921875,y:278.71879069010413,step:1},{x:411.66666666666663,y:278.71879069010413,step:1},{x:410.5572509765625,y:278.3358968098958,step:1},{x:409.765625,y:277.5364583333333,step:1},{x:408.98832194010413,y:276.78385416666663,step:1},{x:408.5423177083333,y:275.5833333333333,step:1},{x:408.5423177083333,y:274.2083333333333,step:1},{x:408.5423177083333,y:272.1920979817708,step:1},{x:409.27665201822913,y:270.44791666666663,step:1},{x:410.515625,y:269.279296875,step:1},{x:411.609375,y:268.2714436848958,step:1},{x:413.12109375,y:267.7115478515625,step:1},{x:414.8059895833333,y:267.7115478515625,step:1},{x:416.05859375,y:267.7115478515625,step:1},{x:416.9948323567708,y:267.98368326822913,step:1},{x:417.3697509765625,y:268.1920979817708,step:1},{x:416.75,y:270.1438802083333,step:0},{x:416.3177490234375,y:269.919921875,step:1},{x:415.55472819010413,y:269.69596354166663,step:1},{x:414.69010416666663,y:269.69596354166663,step:1},{x:413.7265625,y:269.69596354166663,step:1},{x:412.8763020833333,y:270,step:1},{x:412.2292073567708,y:270.5598958333333,step:1},{x:411.37890625,y:271.29557291666663,step:1},{x:410.8177490234375,y:272.57621256510413,step:1},{x:410.8177490234375,y:274.04691569010413,step:1},{x:410.8177490234375,y:275.8567708333333,step:1},{x:411.7812093098958,y:276.7682698567708,step:1},{x:413.3072509765625,y:276.7682698567708,step:1},{x:413.796875,y:276.7682698567708,step:1},{x:414.12894694010413,y:276.6875,step:1},{x:414.37504069010413,y:276.5755208333333,step:1},{x:414.7630615234375,y:274.3046468098958,step:0},{x:413.2499593098958,y:274.3046468098958,step:0},{x:413.58203125,y:272.46354166666663,step:0},{x:417.109375,y:272.46354166666663,step:0},{x:416.1302083333333,y:278.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:417.81510416666663,y:278.6067708333333,step:2},{x:419.65885416666663,y:267.82421875,step:0},{x:422.09244791666663,y:267.82421875,step:0},{x:423.37504069010413,y:271.935546875,step:0},{x:423.7630208333333,y:273.3118489583333,step:1},{x:424.0221761067708,y:274.4322509765625,step:1},{x:424.25260416666663,y:275.6145833333333,step:1},{x:424.2956136067708,y:275.6145833333333,step:0},{x:424.3385009765625,y:274.51298014322913,step:1},{x:424.4817708333333,y:273.32816569010413,step:1},{x:424.7421875,y:271.744140625,step:1},{x:425.4036458333333,y:267.82421875,step:0},{x:427.3489990234375,y:267.82421875,step:0},{x:425.50516764322913,y:278.6067708333333,step:0},{x:423.359375,y:278.6067708333333,step:0},{x:422.00516764322913,y:274.3046468098958,step:0},{x:421.5729573567708,y:272.83203125,step:1},{x:421.31510416666663,y:271.8561604817708,step:1},{x:421.05472819010413,y:270.5435791015625,step:1},{x:421.0130208333333,y:270.5435791015625,step:0},{x:420.91141764322913,y:271.599609375,step:1},{x:420.6809895833333,y:273.11979166666663,step:1},{x:420.39322916666663,y:274.83203125,step:1},{x:419.7447509765625,y:278.6067708333333,step:0},{x:417.81510416666663,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:433.97135416666663,y:267.82421875,step:2},{x:433.25260416666663,y:272.0163167317708,step:0},{x:436.76566569010413,y:272.0163167317708,step:0},{x:437.48441569010413,y:267.82421875,step:0},{x:439.5729573567708,y:267.82421875,step:0},{x:437.7292073567708,y:278.6067708333333,step:0},{x:435.65629069010413,y:278.6067708333333,step:0},{x:436.4192708333333,y:274.0638020833333,step:0},{x:432.8905843098958,y:274.0638020833333,step:0},{x:432.12760416666663,y:278.6067708333333,step:0},{x:430.05472819010413,y:278.6067708333333,step:0},{x:431.8983968098958,y:267.82421875,step:0},{x:433.97135416666663,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:445.9530843098958,y:274.015625,step:2},{x:442.5103759765625,y:274.015625,step:0},{x:442.06510416666663,y:276.640625,step:0},{x:445.9374593098958,y:276.640625,step:0},{x:445.6068115234375,y:278.6067708333333,step:0},{x:439.6458740234375,y:278.6067708333333,step:0},{x:441.48832194010413,y:267.82421875,step:0},{x:447.234375,y:267.82421875,step:0},{x:446.8880615234375,y:269.7916259765625,step:0},{x:443.23173014322913,y:269.7916259765625,step:0},{x:442.828125,y:272.08011881510413,step:0},{x:446.29691569010413,y:272.08011881510413,step:0},{x:445.9530843098958,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:448.9192708333333,y:268.0163167317708,step:2},{x:449.5677490234375,y:267.83984375,step:1},{x:450.546875,y:267.744140625,step:1},{x:451.51041666666663,y:267.744140625,step:1},{x:452.43229166666663,y:267.744140625,step:1},{x:453.3827718098958,y:267.8880615234375,step:1},{x:454.0598958333333,y:268.36783854166663,step:1},{x:454.6927083333333,y:268.78385416666663,step:1},{x:455.1405843098958,y:269.45572916666663,step:1},{x:455.1405843098958,y:270.46354166666663,step:1},{x:455.1405843098958,y:272.0638020833333,step:1},{x:454.1888427734375,y:273.07157389322913,step:1},{x:452.9375,y:273.5208333333333,step:1},{x:452.9375,y:273.5677083333333,step:0},{x:453.5130208333333,y:273.8567708333333,step:1},{x:453.77079264322913,y:274.5598958333333,step:1},{x:453.8580322265625,y:275.5364583333333,step:1},{x:453.98697916666663,y:276.75260416666663,step:1},{x:454.0598958333333,y:278.1588948567708,step:1},{x:454.2317708333333,y:278.6067708333333,step:1},{x:452.1015625,y:278.6067708333333,step:0},{x:452.01566569010413,y:278.3203125,step:1},{x:451.9140625,y:277.3919270833333,step:1},{x:451.828125,y:276.0638020833333,step:1},{x:451.7265625,y:274.75260416666663,step:1},{x:451.32291666666663,y:274.3515218098958,step:1},{x:450.50260416666663,y:274.3515218098958,step:1},{x:449.86979166666663,y:274.3515218098958,step:0},{x:449.1484375,y:278.6067708333333,step:0},{x:447.1041259765625,y:278.6067708333333,step:0},{x:448.9192708333333,y:268.0163167317708,step:0},{x:450.1862386067708,y:272.6236572265625,step:2},{x:451.0364583333333,y:272.6236572265625,step:0},{x:452.15885416666663,y:272.6236572265625,step:1},{x:452.9792073567708,y:271.87174479166663,step:1},{x:452.9792073567708,y:270.8157958984375,step:1},{x:452.9792073567708,y:269.935546875,step:1},{x:452.3307698567708,y:269.5521240234375,step:1},{x:451.4973958333333,y:269.5521240234375,step:1},{x:451.1067708333333,y:269.5521240234375,step:1},{x:450.8620198567708,y:269.583984375,step:1},{x:450.69010416666663,y:269.6314697265625,step:1},{x:450.1862386067708,y:272.6236572265625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:461.79166666666663,y:274.015625,step:2},{x:458.3515625,y:274.015625,step:0},{x:457.90360514322913,y:276.640625,step:0},{x:461.77860514322913,y:276.640625,step:0},{x:461.44657389322913,y:278.6067708333333,step:0},{x:455.48441569010413,y:278.6067708333333,step:0},{x:457.328125,y:267.82421875,step:0},{x:463.07291666666663,y:267.82421875,step:0},{x:462.7292073567708,y:269.7916259765625,step:0},{x:459.0703125,y:269.7916259765625,step:0},{x:458.66666666666663,y:272.08011881510413,step:0},{x:462.1380208333333,y:272.08011881510413,step:0},{x:461.79166666666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(110,0,5,1)",background:"rgba(0,0,0,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],mh=[{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:0,borderColor:"rgba(0,0,0,0.8509803921568627)",background:"linear-gradient(to right bottom, #f8eae7, #ffc6c6)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:10},{type:"path",stampPoints:[{x:465.87760416666663,y:290.62760416666663,step:2},{x:465.87760416666663,y:296.4948323567708,step:1},{x:461.0780843098958,y:301.2942708333333,step:1},{x:455.2109375,y:301.2942708333333,step:1},{x:363.1640625,y:301.2942708333333,step:0},{x:357.2974853515625,y:301.2942708333333,step:1},{x:352.4973958333333,y:296.4948323567708,step:1},{x:352.4973958333333,y:290.62760416666663,step:1},{x:352.4973958333333,y:253.63081868489581,step:0},{x:352.4973958333333,y:247.7642822265625,step:1},{x:357.2974853515625,y:242.96415201822916,step:1},{x:363.1640625,y:242.96415201822916,step:1},{x:455.2109375,y:242.96415201822916,step:0},{x:461.0780843098958,y:242.96415201822916,step:1},{x:465.87760416666663,y:247.7642822265625,step:1},{x:465.87760416666663,y:253.63081868489581,step:1},{x:465.87760416666663,y:290.62760416666663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(145,15,5,1)",background:null,lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:371.2519124348958,y:286.9765625,step:2},{x:368.0761311848958,y:258.6692708333333,step:0},{x:373.708984375,y:258.6692708333333,step:0},{x:374.84183756510413,y:272.15043131510413,step:0},{x:375.1073811848958,y:275.17447916666663,step:1},{x:375.2962239583333,y:277.90360514322913,step:1},{x:375.447265625,y:280.8450520833333,step:1},{x:375.5228271484375,y:280.8450520833333,step:0},{x:376.46805826822913,y:278.07291666666663,step:1},{x:377.677734375,y:275.0494384765625,step:1},{x:378.923828125,y:272.1087239583333,step:1},{x:384.6321614583333,y:258.6692708333333,step:0},{x:390.71805826822913,y:258.6692708333333,step:0},{x:377.564453125,y:286.9765625,step:0},{x:371.2519124348958,y:286.9765625,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:399.7519124348958,y:287.4388427734375,step:2},{x:393.1373291015625,y:287.4388427734375,step:1},{x:389.4329427083333,y:282.2318115234375,step:1},{x:389.4329427083333,y:275.63798014322913,step:1},{x:389.4329427083333,y:270.51298014322913,step:1},{x:391.1347249348958,y:265.4309895833333,step:1},{x:394.1204427083333,y:262.2389729817708,step:1},{x:396.501953125,y:259.7193603515625,step:1},{x:399.7519124348958,y:258.20768229166663,step:1},{x:403.4185791015625,y:258.20768229166663,step:1},{x:410.14847819010413,y:258.20768229166663,step:1},{x:413.7005615234375,y:263.2473958333333,step:1},{x:413.7005615234375,y:270.0091552734375,step:1},{x:413.7005615234375,y:275.17447916666663,step:1},{x:412.0755208333333,y:280.2161865234375,step:1},{x:409.1634114583333,y:283.3645833333333,step:1},{x:406.7831624348958,y:285.9270833333333,step:1},{x:403.5697021484375,y:287.4388427734375,step:1},{x:399.791015625,y:287.4388427734375,step:1},{x:399.7519124348958,y:287.4388427734375,step:0},{x:400.5462239583333,y:282.3984375,step:2},{x:402.1712239583333,y:282.3984375,step:1},{x:403.646484375,y:281.64322916666663,step:1},{x:404.818359375,y:280.3411458333333,step:1},{x:406.8210042317708,y:278.1145833333333,step:1},{x:407.91727701822913,y:273.453125,step:1},{x:407.91727701822913,y:270.1771240234375,step:1},{x:407.91727701822913,y:266.64908854166663,step:1},{x:406.7831624348958,y:263.2473958333333,step:1},{x:402.7753499348958,y:263.2473958333333,step:1},{x:401.0761311848958,y:263.2473958333333,step:1},{x:399.5631917317708,y:264.044921875,step:1},{x:398.39127604166663,y:265.38871256510413,step:1},{x:396.3509114583333,y:267.6145833333333,step:1},{x:395.21683756510413,y:272.0247395833333,step:1},{x:395.21683756510413,y:275.4270833333333,step:1},{x:395.21683756510413,y:279.4167073567708,step:1},{x:396.84183756510413,y:282.3984375,step:1},{x:400.50846354166663,y:282.3984375,step:1},{x:400.5462239583333,y:282.3984375,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:425.1536458333333,y:258.6692708333333,step:2},{x:420.3151448567708,y:286.9765625,step:0},{x:414.8723958333333,y:286.9765625,step:0},{x:419.7109375,y:258.6692708333333,step:0},{x:425.1536458333333,y:258.6692708333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:430.10416666666663,y:259.0892333984375,step:2},{x:432.29691569010413,y:258.6692708333333,step:1},{x:434.6796875,y:258.458984375,step:1},{x:437.1744384765625,y:258.458984375,step:1},{x:441.1431884765625,y:258.458984375,step:1},{x:444.2786458333333,y:259.46683756510413,step:1},{x:446.43485514322913,y:261.5247395833333,step:1},{x:448.51298014322913,y:263.373046875,step:1},{x:449.79947916666663,y:266.1868896484375,step:1},{x:449.79947916666663,y:270.38736979166663,step:1},{x:449.79947916666663,y:275.8463134765625,step:1},{x:447.71875,y:280.59375,step:1},{x:444.58072916666663,y:283.40625,step:1},{x:441.6328125,y:286.0521240234375,step:1},{x:437.8905843098958,y:287.1874593098958,step:1},{x:432.3724365234375,y:287.1874593098958,step:1},{x:429.3098958333333,y:287.1874593098958,step:1},{x:426.6640625,y:286.89322916666663,step:1},{x:425.3802083333333,y:286.5989583333333,step:1},{x:430.10416666666663,y:259.0892333984375,step:0},{x:431.6536865234375,y:282.1458333333333,step:2},{x:432.29691569010413,y:282.2318115234375,step:1},{x:433.0911458333333,y:282.2734375,step:1},{x:434.03641764322913,y:282.2734375,step:1},{x:436.98441569010413,y:282.2734375,step:1},{x:439.59375,y:281.09635416666663,step:1},{x:441.2552083333333,y:278.9973958333333,step:1},{x:442.9948323567708,y:276.7708333333333,step:1},{x:443.90104166666663,y:273.83072916666663,step:1},{x:443.90104166666663,y:270.42899576822913,step:1},{x:443.90104166666663,y:265.9348958333333,step:1},{x:441.6718343098958,y:263.28971354166663,step:1},{x:437.1744384765625,y:263.28971354166663,step:1},{x:436.2292073567708,y:263.28971354166663,step:1},{x:435.4348958333333,y:263.373046875,step:1},{x:434.8671875,y:263.4993489583333,step:1},{x:431.6536865234375,y:282.1458333333333,step:0}],borderWidth:0,borderColor:"rgba(145,15,5,1)",background:"rgba(145,15,5,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}],yh=[{type:"path",stampPoints:[{x:347.4140625,y:272.89908854166663,step:2},{x:369.1386311848958,y:288.7083333333333,step:0},{x:463.5677490234375,y:288.7083333333333,step:0},{x:468.39322916666663,y:288.7083333333333,step:1},{x:472.33984375,y:285.10941569010413,step:1},{x:472.33984375,y:280.7083333333333,step:1},{x:472.33984375,y:264.2591145833333,step:0},{x:472.33984375,y:259.8587239583333,step:1},{x:468.39322916666663,y:256.2591145833333,step:1},{x:463.5677490234375,y:256.2591145833333,step:1},{x:369.1386311848958,y:256.2591145833333,step:0},{x:347.4140625,y:272.89908854166663,step:0}],borderWidth:1.3333333333333333,borderColor:"rgba(213,177,66,1)",background:"linear-gradient(to right bottom, #f7fc93, #f8fb4f)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:409.1328125,y:278.6067708333333,step:2},{x:408.75846354166663,y:267.82421875,step:0},{x:410.8606770833333,y:267.82421875,step:0},{x:410.8606770833333,y:272.6236572265625,step:0},{x:410.8606770833333,y:273.9348958333333,step:1},{x:410.83203125,y:275.1510009765625,step:1},{x:410.80338541666663,y:276.12760416666663,step:1},{x:410.83203125,y:276.12760416666663,step:0},{x:411.17704264322913,y:275.07157389322913,step:1},{x:411.52347819010413,y:273.9674886067708,step:1},{x:411.96875,y:272.6555989583333,step:1},{x:413.7109375,y:267.82421875,step:0},{x:415.98697916666663,y:267.82421875,step:0},{x:415.9583333333333,y:272.6399739583333,step:0},{x:415.9439697265625,y:273.9348958333333,step:1},{x:415.9140625,y:275.0078125,step:1},{x:415.8567708333333,y:276.0638020833333,step:1},{x:415.88541666666663,y:276.0638020833333,step:0},{x:416.21744791666663,y:274.9427083333333,step:1},{x:416.5780843098958,y:273.7916259765625,step:1},{x:416.9661458333333,y:272.6236572265625,step:1},{x:418.6366780598958,y:267.82421875,step:0},{x:420.8255208333333,y:267.82421875,step:0},{x:416.54947916666663,y:278.6067708333333,step:0},{x:414.28910319010413,y:278.6067708333333,step:0},{x:414.23050944010413,y:274.1927490234375,step:0},{x:414.2161458333333,y:272.912109375,step:1},{x:414.2447509765625,y:271.82421875,step:1},{x:414.3020833333333,y:270.607421875,step:1},{x:414.27347819010413,y:270.607421875,step:0},{x:413.9270833333333,y:271.759765625,step:1},{x:413.58203125,y:272.927734375,step:1},{x:413.1067708333333,y:274.2396240234375,step:1},{x:411.4375,y:278.6067708333333,step:0},{x:409.1328125,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:424.0234375,y:267.82421875,step:2},{x:422.1796875,y:278.6067708333333,step:0},{x:420.10546875,y:278.6067708333333,step:0},{x:421.9478759765625,y:267.82421875,step:0},{x:424.0234375,y:267.82421875,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:427.3489990234375,y:269.83984375,step:2},{x:424.7851155598958,y:269.83984375,step:0},{x:425.1458333333333,y:267.82421875,step:0},{x:432.359375,y:267.82421875,step:0},{x:432.01432291666663,y:269.83984375,step:0},{x:429.421875,y:269.83984375,step:0},{x:427.92447916666663,y:278.6067708333333,step:0},{x:425.8515218098958,y:278.6067708333333,step:0},{x:427.3489990234375,y:269.83984375,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:431.6823323567708,y:278.6067708333333,step:2},{x:433.52604166666663,y:267.82421875,step:0},{x:435.95963541666663,y:267.82421875,step:0},{x:437.2421875,y:271.935546875,step:0},{x:437.6302490234375,y:273.3118489583333,step:1},{x:437.88932291666663,y:274.4322509765625,step:1},{x:438.1197509765625,y:275.6145833333333,step:1},{x:438.16276041666663,y:275.6145833333333,step:0},{x:438.20572916666663,y:274.51298014322913,step:1},{x:438.3503011067708,y:273.32816569010413,step:1},{x:438.6093343098958,y:271.744140625,step:1},{x:439.27079264322913,y:267.82421875,step:0},{x:441.2161458333333,y:267.82421875,step:0},{x:439.3723958333333,y:278.6067708333333,step:0},{x:437.2265625,y:278.6067708333333,step:0},{x:435.8723958333333,y:274.3046468098958,step:0},{x:435.44010416666663,y:272.83203125,step:1},{x:435.18229166666663,y:271.8561604817708,step:1},{x:434.921875,y:270.5435791015625,step:1},{x:434.8802083333333,y:270.5435791015625,step:0},{x:434.77860514322913,y:271.599609375,step:1},{x:434.5481770833333,y:273.11979166666663,step:1},{x:434.26041666666663,y:274.83203125,step:1},{x:433.61197916666663,y:278.6067708333333,step:0},{x:431.6823323567708,y:278.6067708333333,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:447.58072916666663,y:274.015625,step:2},{x:444.1380208333333,y:274.015625,step:0},{x:443.6927083333333,y:276.640625,step:0},{x:447.56510416666663,y:276.640625,step:0},{x:447.234375,y:278.6067708333333,step:0},{x:441.2734375,y:278.6067708333333,step:0},{x:443.1171468098958,y:267.82421875,step:0},{x:448.8620198567708,y:267.82421875,step:0},{x:448.515625,y:269.7916259765625,step:0},{x:444.859375,y:269.7916259765625,step:0},{x:444.45572916666663,y:272.08011881510413,step:0},{x:447.92578125,y:272.08011881510413,step:0},{x:447.58072916666663,y:274.015625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:449.1497395833333,y:276.1119384765625,step:2},{x:449.7265625,y:276.4791259765625,step:1},{x:450.5312093098958,y:276.78385416666663,step:1},{x:451.44010416666663,y:276.78385416666663,step:1},{x:452.2317708333333,y:276.78385416666663,step:1},{x:452.9661458333333,y:276.3671875,step:1},{x:452.9661458333333,y:275.5364583333333,step:1},{x:452.9661458333333,y:274.9114583333333,step:1},{x:452.546875,y:274.5286458333333,step:1},{x:451.65629069010413,y:274,step:1},{x:450.6328125,y:273.3919270833333,step:1},{x:449.6536865234375,y:272.5598958333333,step:1},{x:449.6536865234375,y:271.16796875,step:1},{x:449.6536865234375,y:268.9921875,step:1},{x:451.3529052734375,y:267.6640625,step:1},{x:453.46875,y:267.6640625,step:1},{x:454.63541666666663,y:267.6640625,step:1},{x:455.328125,y:267.95182291666663,step:1},{x:455.7447509765625,y:268.1920979817708,step:1},{x:455.09635416666663,y:270.111328125,step:0},{x:454.7812093098958,y:269.919921875,step:1},{x:454.10416666666663,y:269.6314697265625,step:1},{x:453.29691569010413,y:269.6477864583333,step:1},{x:452.33207194010413,y:269.6477864583333,step:1},{x:451.828125,y:270.17582194010413,step:1},{x:451.828125,y:270.767578125,step:1},{x:451.828125,y:271.3919270833333,step:1},{x:452.4192708333333,y:271.775390625,step:1},{x:453.2395833333333,y:272.28776041666663,step:1},{x:454.4192708333333,y:272.9759114583333,step:1},{x:455.1536458333333,y:273.83984375,step:1},{x:455.1536458333333,y:275.13541666666663,step:1},{x:455.1536458333333,y:277.5364583333333,step:1},{x:453.3697509765625,y:278.7682698567708,step:1},{x:451.22391764322913,y:278.7682698567708,step:1},{x:449.8841145833333,y:278.75260416666663,step:1},{x:448.90494791666663,y:278.3671875,step:1},{x:448.4583333333333,y:278,step:1},{x:449.1497395833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4},{type:"path",stampPoints:[{x:456.4934895833333,y:276.1119384765625,step:2},{x:457.0703125,y:276.4791259765625,step:1},{x:457.87504069010413,y:276.78385416666663,step:1},{x:458.7838134765625,y:276.78385416666663,step:1},{x:459.5755208333333,y:276.78385416666663,step:1},{x:460.3099365234375,y:276.3671875,step:1},{x:460.3099365234375,y:275.5364583333333,step:1},{x:460.3099365234375,y:274.9114583333333,step:1},{x:459.8919270833333,y:274.5286458333333,step:1},{x:459,y:274,step:1},{x:457.9765625,y:273.3919270833333,step:1},{x:456.9974365234375,y:272.5598958333333,step:1},{x:456.9974365234375,y:271.16796875,step:1},{x:456.9974365234375,y:268.9921875,step:1},{x:458.6966145833333,y:267.6640625,step:1},{x:460.81254069010413,y:267.6640625,step:1},{x:461.97916666666663,y:267.6640625,step:1},{x:462.6718343098958,y:267.95182291666663,step:1},{x:463.08854166666663,y:268.1920979817708,step:1},{x:462.44010416666663,y:270.111328125,step:0},{x:462.125,y:269.919921875,step:1},{x:461.4478759765625,y:269.6314697265625,step:1},{x:460.6405843098958,y:269.6477864583333,step:1},{x:459.67704264322913,y:269.6477864583333,step:1},{x:459.1718343098958,y:270.17582194010413,step:1},{x:459.1718343098958,y:270.767578125,step:1},{x:459.1718343098958,y:271.3919270833333,step:1},{x:459.7630208333333,y:271.775390625,step:1},{x:460.58329264322913,y:272.28776041666663,step:1},{x:461.7642822265625,y:272.9759114583333,step:1},{x:462.49869791666663,y:273.83984375,step:1},{x:462.49869791666663,y:275.13541666666663,step:1},{x:462.49869791666663,y:277.5364583333333,step:1},{x:460.71354166666663,y:278.7682698567708,step:1},{x:458.5677083333333,y:278.7682698567708,step:1},{x:457.22782389322913,y:278.75260416666663,step:1},{x:456.2499593098958,y:278.3671875,step:1},{x:455.80204264322913,y:278,step:1},{x:456.4934895833333,y:276.1119384765625,step:0}],borderWidth:0,borderColor:"rgba(213,177,66,1)",background:"rgba(35,31,32,1)",lineDash:[0,0],lineCap:"butt",lineJoin:"miter",miterLimit:4}];class vh extends Ia{constructor(t){var e;super({type:"annotationStamp",...t,style:{...t.style,stampConfig:(null==t||null===(e=t.style)||void 0===e?void 0:e.stampConfig)||xh(null==t?void 0:t.style.iconName)}}),l(this,"shapeType","annotationStamp"),l(this,"stampType","base"),l(this,"controls",void 0),l(this,"eventHandler",void 0),l(this,"context",void 0),l(this,"shapes",[]),l(this,"initialRect",void 0),l(this,"iconName",void 0),l(this,"imageLoadedByDraw",!1),l(this,"initByDraw",!1),l(this,"hooks",{reRenderImage:zs()}),this.initByDraw=(null==t?void 0:t.initByDraw)||!1,this.initStamp(),this.init(t.transform,t.selectableStyle),this.initSize(t.style,t.transform);}init(t,e){this.eventHandler=new Hl(this),this.context=new zl(this,e),this.context.setTransform(t),this.initialRect=this.getBoundingRect();}initStamp(){const{imageData:t,width:e,height:i}=this.style;if(this.stampItemShapes.forEach((t=>{t.destroy();})),this.stampItemShapes=[],t){let s;this.renderType="image",this.imageLoadedByDraw=!1,s=t instanceof Blob?URL.createObjectURL(t):t;const n=new Image;n.src=s,this.style.img=n,n.onload=()=>{if(this.initByDraw||!Bs(e)||!Bs(i)){const{width:t,height:e}=n;let i=t,s=e;if(t>400||e>400){const n=Math.max(t/400,e/400);i/=n,s/=n;}this.updateStyle({width:i,height:s}),this.setLocalScale(1,1,1),this.initialWidth=i,this.initialHeight=s,this.initByDraw=!1,this.imageLoadedByDraw=!0;}this.hooks.reRenderImage.emit();};}else this.initByDraw=!1,super.initStamp();}initSize(t,e){if("image"===this.renderType){const{x:t,y:e}=this.getLocalScale();1===t&&1===e||this.updateSize(this.parsedStyle.width.value,this.parsedStyle.height.value);}const i={},s=this.getAnnotationConfig(),{x:n,y:o}=(null==e?void 0:e.scale)||{x:1,y:1};var r;Bs(null==t?void 0:t.x)&&(null==t?void 0:t.x)!==s.style.x&&(i.x=t.x),Bs(null==t?void 0:t.y)&&(null==t?void 0:t.y)!==s.style.y&&(i.y=t.y),Bs(null==t?void 0:t.width)&&t.width*n!==s.style.width&&(i.width=t.width),Bs(null==t?void 0:t.height)&&t.height*o!==s.style.height&&(i.height=t.height),r=i,(0!==Object.keys(r).length||r.constructor!==Object)&&this.updateStampStyle(i);}update(){this.updateOrigin(),this.context.updateControls();}updateSize(t,e){const{x:i,y:s}=this.getLocalScale(),{x:n,y:o}=this.getPosition();if("image"===this.renderType){const{x:n,y:o}=this.getLocalPosition(),r=this.getAngle(),a=t*i,l=e*s;this.setAngle(0),this.setLocalScale(1,1,1),this.updateStyle({width:a,height:l});const h=n+(t-a)/2,d=o+(e-l)/2;return this.initialWidth=a,this.initialHeight=l,this.setLocalPosition({x:h,y:d}),void this.setAngle(r)}const{width:r,height:a}=this.parsedStyle,l=t||r.value*i,h=e||a.value*s;this.setLocalScale(l/r.value,h/a.value),this.setPosition({x:n,y:o});}updateStampStyle(t){const{x:e,y:i}=this.getLocalPosition(),{x:s,y:n}=this.getLocalScale(),{width:o,height:r}=this.parsedStyle,{width:a,height:l}=t,{imageData:h,iconName:d}=this.style;let c=e,u=i;h||Ts(null==t?void 0:t.imageData)||this.setLocalScale(1),null!=t&&t.imageData&&t.imageData!==h?(this.style.imageData=t.imageData,this.initStamp()):null!=t&&t.iconName&&t.iconName!==d&&(this.style.imageData=null,this.style.iconName=t.iconName,this.stampConfig=xh(t.iconName),this.initStamp()),Bs(null==t?void 0:t.opacity)&&(null==t?void 0:t.opacity)!==this.style.opacity&&(this.style.opacity=t.opacity),this.updateSize(Bs(a)?a:o.value*s,Bs(l)?l:r.value*n);const{x:p,y:g}=this.getLocalScale();if(Bs(null==t?void 0:t.x)){const e=this.initialWidth*p;c=t.x-(this.initialWidth-e)/2;}if(Bs(null==t?void 0:t.y)){const e=this.initialHeight*g;u=t.y-(this.initialHeight-e)/2;}this.setLocalPosition(c,u);}getAnnotationConfig(){const t=this.context.getTransform(),{x:e,y:i}=this.style,s=As(t);if(s.position.x===e&&s.position.y===i&&1===s.scale.x&&1===s.scale.y&&(delete s.position,delete s.scale),this.style.imageData)return {type:"annotationStamp",style:{x:t.position.x,y:t.position.y,width:this.style.width,height:this.style.height,opacity:this.style.opacity,imageData:this.style.imageData},transform:{...s}};const{initialWidth:n,initialHeight:o}=this,r=n*t.scale.x,a=o*t.scale.y;return {type:"annotationStamp",style:{x:t.position.x+(n-r)/2,y:t.position.y+(o-a)/2,width:r,height:a,opacity:this.style.opacity,stampConfig:[...this.stampConfig],iconName:this.style.iconName},transform:{...s}}}destroy(){this.parentElement&&this.parentElement.removeChild(this),this.controls&&this.controls.destroy();}}function xh(t){const e=[Ul.REJECTED,Ul.ACCEPTED,Ul.APPROVED,Ul.NOT_APPROVED,Ul.COMPLETED,Ul.DRAFT,Ul.FINAL,Ul.VOID,Ul.CONFIDENTIAL,Ul.INITIAL_HERE,Ul.SIGN_HERE,Ul.WITNESS];return [gh,rh,ah,ph,lh,dh,ch,mh,hh,uh,fh,yh][e.indexOf(t)]}var wh;!function(t){t.HIGHLIGHT="highlight",t.UNDERLINE="underline",t.STRIKEOUT="strikeout";}(wh||(wh={}));class bh extends vh{constructor(t,e){super({...t}),l(this,"stampType","textAssist"),l(this,"textAssistType",void 0),l(this,"annotationRaw",void 0),this.textAssistType=e,this.annotationRaw=t.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1});}getAnnotationConfig(){const t=super.getAnnotationConfig();return this.annotationRaw&&(t.style.annotationRaw=this.annotationRaw),t}}class Ch extends vh{constructor(t){super({...t}),l(this,"stampType","raw"),l(this,"annotationRaw",void 0),this.annotationRaw=t.style.annotationRaw,this.context.updateControlsFlags({enableControl:!1});}getAnnotationConfig(){const t=super.getAnnotationConfig();return this.annotationRaw&&(t.style.annotationRaw=this.annotationRaw),t}}function Sh(t,e,i){var s;(i instanceof $l||i instanceof Gl||i instanceof jl)&&t!==e&&(null===(s=i.context)||void 0===s||s.updateControls());}function Ph(t,e,i){t!==e&&i.childNodes.length>0&&i.childNodes.forEach((t=>{t&&t.style&&(t.style.opacity=e);}));}function Ah(t,e,i){var s;(i instanceof Yl||i instanceof sh||i instanceof nh)&&t!==e&&(null===(s=i.context)||void 0===s||s.updateControls());}function Th(t,e,i){if(!(i instanceof sh||i instanceof nh||i instanceof oh||i instanceof Yl))return;if(t===e)return;const{x:s,y:n}=i.getBoundingRect();i.updatePosition(s,n),i.updateOrigin();}function kh(t,e,i){var s;(i instanceof Jl||i instanceof Kl)&&t!==e&&(null===(s=i.context)||void 0===s||s.updateControls());}function Dh(t,e,i){var s;i instanceof ql&&t!==e&&(null===(s=i.context)||void 0===s||s.updateControls(),i.parentNode);}function Eh(t,e,i){var s;i instanceof oh&&t!==e&&(null==i||null===(s=i.context)||void 0===s||s.updateControls());}function Ih(t,e,i){i instanceof Kl&&t!==e&&(i.textEditEventHandler.calculateCharPosition(),i.updateCursor(),i.hooks.reRenderText.emit());}function Rh(t,e,i){i instanceof Kl&&t!==e&&(i.textEditEventHandler.calculateCharPosition(),i.textEditEventHandler.updateTextSelection(),i.hooks.reRenderText.emit());}const Mh={annotationRect:"rectangle",annotationEllipse:"ellipse",annotationPolygon:"polygon",annotationPolyline:"polyline",annotationLine:"line",annotationInk:"ink",annotationTextBox:"textBox",annotationFreeText:"textTypewriter",annotationStamp:"stamp"};class Bh{constructor(t){l(this,"eraser",void 0),l(this,"eraserPath",void 0),l(this,"erasedShapeIds",[]),l(this,"selectionBox",void 0),l(this,"startCanvasPoint",void 0),l(this,"startLocalPoint",void 0),l(this,"lastMovePoint",void 0),l(this,"resetActivatedZIndex",!0),l(this,"isSeparateText",!1),l(this,"lastClickPointerType",""),l(this,"drawType","annotationRect"),l(this,"isStartEdit",!1),l(this,"isStartDraw",!1),l(this,"controller",void 0),l(this,"eventArea",void 0),l(this,"eventMode","none"),l(this,"defaultGroup",void 0),l(this,"activatedShape",void 0),l(this,"activatedZIndex",0),l(this,"drawLineShape",!1),l(this,"stampPreview",void 0),l(this,"inkDelayTimeout",void 0),l(this,"drawInkShape",!1),this.controller=t,this.defaultGroup=new th("ddvDefaultGroup"),this.defaultGroup.style.zIndex=1e5;}isDefaultGroup(t){return t===this.defaultGroup}getDrawInitStyle(t,e){var i,s;let n={};const{defaultStyleConfig:o,eraserStyle:r,selectionStyle:a}=this.controller.interactiveConfig,l={x:e.x,y:e.y};switch(t){case"annotationInk":n={lineCap:"round",lineJoin:"round",segments:[[e]]};break;case"annotationPolygon":case"annotationPolyline":n={points:[e]};break;case"annotationLine":n={startPoint:e,endPoint:e};break;case"annotationFreeText":n={...l,textContents:[{...Nl.textContent,...null==o||null===(i=o.textTypewriter)||void 0===i?void 0:i.textContent}]};break;case"annotationTextBox":n={...l,textContents:[{...Nl.textContent,...null==o||null===(s=o.textBox)||void 0===s?void 0:s.textContent}]};break;default:n=l;}let h={...Nl,...o[Mh[t]]||{}};return "select"===this.eventMode?h={...a,zIndex:999}:"erase"===this.eventMode&&(h=r),{...h,...n}}getDrawUpdateStyle(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=(this.startLocalPoint.x+e.x)/2,n=(this.startLocalPoint.y+e.y)/2,o=e.x-this.startLocalPoint.x,r=e.y-this.startLocalPoint.y;const a=["annotationCircle","annotationEllipse"].includes(t),l=Math.min(Math.abs(o),Math.abs(r));i&&(o=e.x>=this.startLocalPoint.x?l:-l,r=e.y>=this.startLocalPoint.y?l:-l,a&&(s=(2*this.startLocalPoint.x+o)/2,n=(2*this.startLocalPoint.y+r)/2));let h={};switch(t){case"annotationFreeText":break;case"annotationCircle":case"annotationArc":h={x:s,y:n,r:l};break;case"annotationEllipse":h={x:s,y:n,rx:Math.abs(o)/2,ry:Math.abs(r)/2};break;case"annotationLine":h={endPoint:e};break;default:h={width:o,height:r};}return h}limitPoint(t,e,i){if(!this.eventArea)return;const{x:s,y:n,width:o,height:r}=this.eventArea;let a=0,l=0,h=0;if(e){const{lastHitControlPoint:t,lastHitControlPointCenter:e}=this.activatedShape.context;t&&e&&(l=t.x-e.x,h=t.y-e.y);}else a=Al(i)?i.parsedStyle.borderWidth.value:0;t.x<s+a+l&&(t.x=s+a+l),t.y<n+a+h&&(t.y=n+a+h),t.x>s+o+l&&(t.x=s+o+l),t.y>n+r+h&&(t.y=n+r+h);}executeErase(){var t;"erase"===this.eventMode&&(this.erasedShapeIds.length>0&&this.controller.deleteShape(this.erasedShapeIds),this.controller.deleteShape([null===(t=this.eraserPath)||void 0===t?void 0:t.id],!1),this.eraser=null,this.eraserPath=null,this.activatedShape=null,this.erasedShapeIds=[]);}executeBoxSelect(){if("select"!==this.eventMode)return;const{shapeArrMap:t,containerId:e}=this.controller,i=[],s=t.get(e),{width:n,height:o}=this.selectionBox.parsedStyle;if(n.value<2&&o.value<2){const t=[];s.forEach((e=>{if("hidden"===e.style.visibility||!e.context.controlsFlags.enableControl||e===this.selectionBox||"annotationGroup"===e.shapeType)return;const i=Pl(e,this.startCanvasPoint);!e.context.isGrouped&&e.isPointInPath(i,this.getHitBorderOffset(e))&&t.push(e);})),t.length&&(t.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),i.push(t[t.length-1]));}else s.forEach((t=>{"annotationGroup"!==t.shapeType&&"visible"===t.style.visibility&&t.context.controlsFlags.enableControl&&t!==this.selectionBox&&function(t,e){e.controls||e.context.initControls(),e.context.renderControls();const i=e.controls.controlPoints.slice(0,4);for(let e=0;e<4;e++){const s=Pl(t,i[e].getPosition());if(t.isPointInPath(s))return !0}const s=[],{x:n,y:o}=t.getPosition(),{width:r,height:a}=t.parsedStyle,l=Math.abs(t.getScale().x),h=Math.abs(t.getScale().y);s.push({x:n,y:o},{x:n+r.value*l,y:o},{x:n+r.value*l,y:o+a.value*h},{x:n,y:o+a.value*h});const d=e.getBoundingRectObject();d.setLocalTransform(e.getLocalTransform()),e.parentNode.appendChild(d);const c=d.getWorldTransform().inverse();for(let t=0;t<4;t++){const e=c.transformPoint(s[t]);if(e.x+=d.parsedStyle.x,e.y+=d.parsedStyle.y,d.isPointInPath(e))return d.destroy(),!0}return d.destroy(),e.context.destroyControls(),!1}(this.selectionBox,t)&&i.push(t);}));1===i.length?this.selectShapes([i[0]]):i.length>1?this.selectShapes(i):(this.activatedShape=null,this.controller.hooks.emitSelectAnnotation(null)),this.controller.deleteShape([this.selectionBox.id],!1),this.selectionBox=null,this.controller.hooks.emitAnnotationRender();}activateShape(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||"hidden"===t.style.visibility||!t.context.controlsFlags.enableControl)return;if(this.activatedShape===t&&t.context.isActive)return;const{showOnTopWhenSelected:s}=this.controller.interactiveConfig;var n;this.activatedShape&&this.activatedShape!==t&&(e?(s&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.isDefaultGroup(this.activatedShape)||this.defaultGroup.shapes.includes(this.activatedShape)||((null===(n=this.activatedShape)||void 0===n?void 0:n.parentNode)===(null==t?void 0:t.parentNode)?this.defaultGroup.add(this.activatedShape):this.inactivateShape())):this.inactivateShape());this.activatedShape=t,this.activatedShape.context.isActive=!0,this.activatedShape.eventHandler.setLimitArea(this.eventArea),s&&(this.resetActivatedZIndex&&(this.activatedZIndex=this.activatedShape.style.zIndex),this.resetActivatedZIndex=!0,this.activatedShape.style.zIndex=99999),this.activatedShape.controls||t.context.initControls(),t.context.renderControls(),Tl(t)&&t.pointEventsHandler.enableEditMode(),this.isDefaultGroup(t)&&t.showAllControls(),e||this.controller.hooks.emitSelectAnnotation(t),i&&this.controller.hooks.emitAnnotationRender();}inactivateShape(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.activatedShape)return;const{showOnTopWhenSelected:i}=this.controller.interactiveConfig;if(i&&!this.isDefaultGroup(this.activatedShape)&&(this.activatedShape.style.zIndex=this.activatedZIndex),this.drawInkShape&&this.activatedShape instanceof Yl&&(this.drawInkShape=!1,clearTimeout(this.inkDelayTimeout)),this.activatedShape.context.unHitShape(),this.activatedShape.context.destroyControls(),this.isDefaultGroup(this.activatedShape)&&this.activatedShape.clear(),this.activatedShape instanceof Kl&&"freeTextWriter"===this.activatedShape.textType){const{textContents:t}=this.activatedShape.style;let e="";t.forEach((t=>{e+=(null==t?void 0:t.content)||"";})),0===e.length&&this.controller.deleteShape([this.activatedShape.id],!0);}this.activatedShape=null,this.controller.hooks.emitAnnotationRender(),t&&this.controller.hooks.emitSelectAnnotation(null,e);}setEventArea(t){this.eventArea=t,this.activatedShape&&this.activatedShape.eventHandler.setLimitArea(this.eventArea);}setEventMode(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"annotationRect";if("draw"===this.eventMode&&this.activatedShape&&("annotationInk"===this.drawType&&this.activatedShape instanceof Yl&&this.activatedShape.setUseDouglasPeucker(!0),this.drawLineShape)){const t=[...this.activatedShape.style.points];Ms()||t.pop(),this.activatedShape.style.points=t;}this.drawLineShape&&this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape]),(this.drawInkShape||this.drawLineShape)&&(clearTimeout(this.inkDelayTimeout),this.inactivateShape(!1)),this.isStartDraw=!1,this.drawLineShape=!1,this.drawInkShape=!1,this.eventMode=t,this.drawType=e,this.stampPreview&&(this.controller.deleteShape([this.stampPreview.id],!1),this.stampPreview=null,this.controller.hooks.emitAnnotationRender()),"none"!==t&&(this.inactivateShape(!0),"erase"===t&&(this.drawType="annotationInk"),"select"===t&&(this.drawType="annotationRect"));}getFreeTextLimitWidth(t,e,i,s,n,o){const r=t,a=e,l=Math.round(i),h=Math.round(o);if(!r)return 0;let d=r,c=s;if(h!==l){if(0===h)switch(l){case 90:return n;case 180:return s;case-90:d=a,c=n;}if(-90===h)switch(l){case 0:return n;case 90:return s;case 180:d=a,c=n;}if(180===h||-180===h)switch(l){case 0:return s;case-90:return n;case 90:d=a,c=n;}if(90===h)switch(l){case 180:return n;case-90:return s;case 0:d=a,c=n;}}let u=d-c;return u<0&&(u=d),u}selectShapes(t){const e=[];return t.forEach((t=>{"visible"===t.parsedStyle.visibility&&t.context.controlsFlags.enableControl&&e.push(t);})),this.inactivateShape(!t.length),!!e.length&&(this.defaultGroup.clear(),1===e.length?this.activateShape(e[0],!1,!0):(e.forEach((t=>{this.defaultGroup.add(t);})),this.activateShape(this.defaultGroup,!1,!0)),!0)}editStartHandler(t){if("none"!==this.eventMode)return;if(!this.activatedShape)return;const{offsetX:e,offsetY:i}=Dl(this.controller.canvas,t),s={x:e,y:i};this.isStartEdit=!0,180===this.activatedShape.getAngle()&&this.activatedShape.setAngle(179.99),this.activatedShape.eventHandler.startHandler(s,!0),this.controller.hooks.emitBeforeAnnotationEdit(this.activatedShape);}editMoveHandler(t){if(!this.activatedShape||"none"!==this.eventMode||!this.isStartEdit)return;const{offsetX:e,offsetY:i}=Dl(this.controller.canvas,t),s={x:e,y:i};this.limitPoint(s,!0,this.activatedShape),this.activatedShape.eventHandler.moveHandler(s,t.shiftKey),this.controller.hooks.emitAnnotationRender();}editEndHandler(t){this.isStartEdit=!1,this.activatedShape&&"none"===this.eventMode&&(this.activatedShape.eventHandler.endHandler(this.controller.hooks),this.controller.hooks.emitAfterAnnotationEdit(this.activatedShape));}drawStartHandler(t){if(!this.controller.container||"none"===this.eventMode)return;if("draw"===this.eventMode&&"annotationStamp"===this.drawType)return void("touch"!==t.pointerType&&"pen"!==t.pointerType||this.drawStampMoveHandler(t,!1));if(!this.eventArea)return;const{controller:e}=this,{drawType:i,drawLineShape:s,eventMode:n}=this,{offsetX:o,offsetY:r}=Dl(e.canvas,t),{x:a,y:l,width:h,height:d}=this.eventArea;if(o<a||o>a+h||r<l||r>l+d)return;const c={x:o,y:r},u=e.container.getWorldTransform().inverse().transformPoint(c);if(this.isStartDraw=!0,this.startCanvasPoint=c,this.startLocalPoint=u,this.lastMovePoint=null,"select"===n&&(this.inactivateShape(),this.controller.hooks.emitBeforeAnnotationEdit(null)),this.drawInkShape&&clearTimeout(this.inkDelayTimeout),"draw"===n&&(s||this.drawInkShape)){const e=this.activatedShape instanceof Yl;return e&&(this.activatedShape.addSegment(),this.activatedShape.setUseDouglasPeucker(!1)),this.activatedShape.addPoint(u),void(e||"touch"!==t.pointerType&&"pen"!==t.pointerType||this.controller.hooks.emitAnnotationRender())}-1!==["annotationPolyline","annotationPolygon"].indexOf(i)&&(this.drawLineShape=!0),"draw"===n&&-1!==["annotationInk"].indexOf(i)&&(this.drawInkShape=!0);const p={style:this.getDrawInitStyle(this.drawType,u)};if("annotationFreeText"===this.drawType){const{cropBoxRect:t}=this.controller.container.parentNode.parentNode.parentNode,e=this.getFreeTextLimitWidth(t.width,t.height,this.controller.container.getAngle(),p.style.x-t.left||0,p.style.y-t.top||0,0);p.style.width=e||p.style.width;}const g=this.controller.addShape(this.drawType,p,!1);g.style.zIndex=999,g instanceof Yl&&g.setUseDouglasPeucker(!1);const f=()=>{0!==this.controller.container.getAngle()&&Lh(g)&&(g.setAngle(0),g.setPosition(c));},{container:m}=this.controller;if("draw"===n)this.controller.hooks.emitBeforeAnnotationDraw(g),f();else if("erase"===n){if(g.style.background=null,m){const t=g.style.borderWidth/m.getScale().x;g.style.borderWidth=t;}this.eraserPath=g;}else {if(m){const t=g.style.borderWidth/m.getScale().x;g.style.borderWidth=t;}this.selectionBox=g,f();}this.activatedShape=g,this.controller.hooks.emitAnnotationRender();}drawMoveHandler(t,e){const{activatedShape:i,eventMode:s,isStartDraw:n,drawType:o}=this;if("none"===s)return;if("draw"===s&&"annotationStamp"===o)return void this.drawStampMoveHandler(t,e);if("draw"===s&&"annotationFreeText"===o)return;if(!n)return;const{offsetX:r,offsetY:a}=Dl(this.controller.canvas,t),l={x:r,y:a};this.limitPoint(l,!1,this.activatedShape);const h=this.controller.container.getWorldTransform().inverse().transformPoint(l);if("annotationPolyline"===o||"annotationPolygon"===o){const t=As(i.parsedStyle.points),e=t.length;1===e?t[e]=h:t[e-1]=h,i.style.points=t;}else if("annotationInk"===o)i.addPoint(h);else {const e=this.getDrawUpdateStyle(this.drawType,h,t.shiftKey),s=this.controller.container.getAngle();if(0!==s&&Lh(i)){if(90===Math.abs(Math.round(s))){const t=e.width;e.width=e.height,e.height=t;}e.width=l.x-this.startCanvasPoint.x>0?Math.abs(e.width):-Math.abs(e.width),e.height=l.y-this.startCanvasPoint.y>0?Math.abs(e.height):-Math.abs(e.height),i.updateStyle(e),i.setPosition({...this.startCanvasPoint});}else i.updateStyle(e);}this.controller.hooks.emitAnnotationRender();}drawStampMoveHandler(t,e){const{offsetX:i,offsetY:s}=Dl(this.controller.canvas,t),n={x:i,y:s},o=this.controller.container.getRootNode(),r=o.getWorldTransform().inverse().transformPoint(n),a=()=>{if(!this.stampPreview)return;const i=this.stampPreview.getBoundingRect(),s=(null==t?void 0:t.target)instanceof HTMLCanvasElement;this.stampPreview.style.visibility=!e&&s?"visible":"hidden",this.stampPreview.setLocalPosition(r.x-i.width/2,r.y-i.height/2);};if(!this.stampPreview){const{defaultStyleConfig:t}=this.controller.interactiveConfig,{stamp:e}=t,i=(null==e?void 0:e.stampIcon)||(null==Nl?void 0:Nl.stampIcon),s=(null==e?void 0:e.imageData)||(null==Nl?void 0:Nl.imageData);if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:i,imageData:s,opacity:Bs(e.opacity)?e.opacity:.5,zIndex:9999},initByDraw:!0}),o.appendChild(this.stampPreview),!s&&i){const{width:t,height:e}=this.stampPreview.parsedStyle;if(e.value>60){const i=e.value/60;this.stampPreview.updateSize(t.value/i,e.value/i);}this.stampPreview.hooks.reRenderImage.on((()=>{this.controller.hooks.emitAnnotationRender();}));}else this.stampPreview.hooks.reRenderImage.on((()=>{a(),this.controller.hooks.emitAnnotationRender();}));}a(),this.controller.hooks.emitAnnotationRender();}eraseMoveHandler(t){const{eraserStyle:e}=this.controller.interactiveConfig,{eventMode:i,eraser:s,isStartDraw:n,erasedShapeIds:o,controller:r}=this;if("erase"!==i&&s&&(this.eraser=null,s.destroy()),"erase"!==i||!r.container||!n)return;const{offsetX:a,offsetY:l}=Dl(r.canvas,t),h={x:a,y:l};this.lastMovePoint||(this.lastMovePoint=h);r.shapeArrMap.get(r.containerId).forEach((t=>{t!==this.eraserPath&&"visible"===t.parsedStyle.visibility&&t.context.controlsFlags.enableControl&&function(t,e,i){const s=Pl(t,e),n=Js(e,i),o=t.isPointInPath(s,5);if(o||n<=.9)return o;const r=n/1,a=(e.x-i.x)/r,l=(e.y-i.y)/r;for(let e=0;e<Math.abs(r);e++){const s=Pl(t,{x:i.x+a*e,y:i.y+l*e});if(t.isPointInPath(s,5))return !0}return !1}(t,h,this.lastMovePoint,e.borderWidth)&&(t.style.opacity=.5,o.push(t.id));})),this.lastMovePoint=h,this.controller.hooks.emitAnnotationRender();}drawEndHandler(t){const{eventMode:e,isStartDraw:i,drawLineShape:s,drawType:n,activatedShape:o,controller:r}=this;if("draw"===e&&"annotationStamp"===n)return void this.drawStampEndHandler(t);if("none"===e||!i||s)return;this.isStartDraw=!1;if(["annotationRect","annotationTextBox"].includes(n)){const{width:t,height:e,borderWidth:i}=o.parsedStyle,{x:s,y:n}=o.getPosition(),{x:r,y:a}=o.getScale(),l=(null==i?void 0:i.value)||0;let h=s,d=n;t.value<0&&(h=s-(-t.value+l)*r,o.style.width=-t.value+2*l),e.value<0&&(d=n-(-e.value+l)*a,o.style.height=-e.value+2*l),o.setPosition({x:h,y:d});}if("draw"===e&&this.drawInkShape)return o.setUseDouglasPeucker(!0),this.controller.hooks.emitAnnotationRender(),1===this.activatedShape.style.segments.length?r.hooks.emitAddAnnotation("draw",[this.activatedShape]):r.hooks.emitModifyAnnotation(["resized"],[this.activatedShape]),void(this.inkDelayTimeout=setTimeout((()=>{this.drawInkShape&&(this.drawInkShape=!1,this.activatedShape&&this.activatedShape instanceof Yl&&(this.activatedShape.setUseDouglasPeucker(!0),this.inactivateShape(!1,!1)));}),this.controller.interactiveConfig.inkCreateDelay));if("draw"===e&&"annotationFreeText"!==n&&"annotationStamp"!==n){const{offsetX:e,offsetY:i}=Dl(r.canvas,t);((this.startCanvasPoint.x-e)**2+(this.startCanvasPoint.y-i)**2)**.5<2&&"annotationStamp"!==o.shapeType&&(r.deleteShape([o.id],!1),r.hooks.emitAfterAnnotationDraw(null),this.activatedShape=null);}const a=(t,e)=>{t instanceof Kl&&(t.textEditEventHandler.enableEditMode(this.startCanvasPoint,e),"textBox"===t.textType&&this.controller.hooks.emitAnnotationRender(),"freeTextWriter"===t.textType&&setTimeout((()=>{document.activeElement instanceof HTMLTextAreaElement||t.textEditEventHandler.enableEditMode(this.startCanvasPoint,e);}),10));};if("draw"===e&&this.activatedShape){const t=this.activatedShape,{canvas:e}=this.controller;r.hooks.emitAddAnnotation("draw",[this.activatedShape]),r.interactiveConfig.enableContinuousDrawing?o instanceof Kl?(this.eventMode="none",this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),a(o,e)):this.activatedShape=null:(this.controller.setAnnotationMode("none",!0),r.hooks.emitAfterAnnotationDraw(t),this.resetActivatedZIndex=!1,this.activateShape(this.activatedShape,!1,!0),a(o,e));}"erase"===e&&this.executeErase(),"select"===e&&this.executeBoxSelect();}drawStampEndHandler(t){const{offsetX:e,offsetY:i}=Dl(this.controller.canvas,t);if(!this.stampPreview)return;if(!this.eventArea)return;if(this.stampPreview&&"image"===this.stampPreview.renderType&&!this.stampPreview.imageLoadedByDraw)return;const{x:s,y:n,width:o,height:r}=this.eventArea;if(e<s||e>o+s||i<n||i>r+n)return;const{defaultStyleConfig:a}=this.controller.interactiveConfig,{stamp:l}=a,h=Bs(null==l?void 0:l.opacity)?null==l?void 0:l.opacity:null==Nl?void 0:Nl.opacity,d=this.stampPreview;d.style.opacity=h;const{containerId:c,container:u,shapeArrMap:p}=this.controller,g={...d.getPosition()},f={...d.getScale()},m=u.getScale(),y=f.x/m.x,v=f.y/m.y;if(p.get(c).set(d.id,d),d.index=p.get(c).size,d.pageUid=c,u.appendChild(d),d.style.imageData){const{width:t,height:e}=d.parsedStyle;d.updateStyle({width:t.value*y,height:e.value*v}),d.setLocalScale(1,1,1);}else d.scale(y,v);d.setAngle(0),d.setPosition(g),this.stampPreview=null,this.activatedShape=d,this.controller.hooks.emitBeforeAnnotationDraw(d),this.controller.hooks.emitAddAnnotation("draw",[d]),this.controller.interactiveConfig.enableContinuousDrawing||(this.resetActivatedZIndex=!1,this.controller.setAnnotationMode("none",!0),this.activateShape(d,!1,!0),this.controller.hooks.emitAfterAnnotationDraw(d));}dblClickHandler(t){const{activatedShape:e,controller:i}=this;if(!e)return;const{shapeType:s}=e;if(this.drawLineShape&&("annotationPolygon"===s||"annotationPolyline"===s)){const t=[...e.style.points],s=t.length;return Ms()?Js(t[s-1],t[s-2])<=15&&t.pop():t.pop(),"mouse"===this.lastClickPointerType&&(t.pop(),this.lastClickPointerType=""),t.length<2?(i.deleteShape([e.id],!1),this.activatedShape=null):(e.style.points=t,this.controller.hooks.emitAddAnnotation("draw",[this.activatedShape])),this.isStartDraw=!1,this.drawLineShape=!1,void(!i.interactiveConfig.enableContinuousDrawing&&this.activatedShape?(this.controller.setAnnotationMode("none",!0),this.controller.hooks.emitAfterAnnotationDraw(e),this.resetActivatedZIndex=!1,this.activateShape(e,!1,!0)):this.activatedShape=null)}if("annotationFreeText"===s&&!this.isSeparateText){const{offsetX:i,offsetY:s}=Dl(this.controller.canvas,t),{textEditEventHandler:n}=e,o={x:i,y:s};if(this.activatedShape instanceof Kl&&"freeTextWriter"===this.activatedShape.textType){const{cropBoxRect:t}=this.controller.container.parentNode.parentNode.parentNode,e=this.getFreeTextLimitWidth(t.width,t.height,this.controller.container.getAngle(),this.activatedShape.getLocalPosition().x-t.left,this.activatedShape.getLocalPosition().y-t.top,this.activatedShape.getAngle());e!==this.activatedShape.style.width&&(this.activatedShape.style.width=e,this.controller.hooks.emitModifyAnnotation(["appearanceChanged"],[this.activatedShape]));}n.enableEditMode(o,this.controller.canvas),this.controller.hooks.emitAnnotationRender();}}clickHandler(t){const{activatedShape:e,eventMode:i}=this;if(!e)return;const{shapeType:s}=e,n=()=>{if("annotationFreeText"===s){const{offsetX:i,offsetY:s}=Dl(this.controller.canvas,t),{textEditEventHandler:n}=e,o={x:i,y:s};n.editClickHandler(o,this.controller.canvas);}};if(this.lastClickPointerType=null==t?void 0:t.pointerType,this.isSeparateText=!1,"none"===i){if(t.ctrlKey){if(this.isDefaultGroup(e)){const{clickedShape:t}=e;this.defaultGroup.delete(t);const{shapes:i}=this.defaultGroup;if(i.length<2&&(this.defaultGroup.context.isActive=!1),1===i.length){const t=i[0];this.activateShape(t,!1,!1),this.isSeparateText=t instanceof Kl;}}else this.defaultGroup.parent&&this.defaultGroup.parent!==this.controller.container&&this.defaultGroup.clear(),this.defaultGroup.add(this.activatedShape),this.defaultGroup.shapes.length>=2?(this.defaultGroup.context.isActive=!0,this.activateShape(this.defaultGroup,!1,!1)):(this.controller.hooks.emitSelectAnnotation(e),n());return void this.controller.hooks.emitAnnotationRender()}n();}}keyDownHandler(t){const{activatedShape:e}=this;if(e&&("Delete"===t.key||"Backspace"===t.key)){if(kl(e)&&e.textEditEventHandler.editMode)return;this.controller.deleteShape([e.id]),this.inactivateShape();}}getHitBorderOffset(t){if(!t)return 10;const e=t.getScale();if(e.x<1||e.y<1){const t=Math.min(e.x,e.y);return Math.round(Math.abs(10/t))}return 10}createStampPreviewForMobile(){if(this.stampPreview)return;const{defaultStyleConfig:t}=this.controller.interactiveConfig,{stamp:e}=t,i=(null==e?void 0:e.stampIcon)||(null==Nl?void 0:Nl.stampIcon),s=(null==e?void 0:e.imageData)||(null==Nl?void 0:Nl.imageData),n=this.controller.container.getRootNode();if(this.stampPreview=this.controller.createShape("annotationStamp",{style:{iconName:i,imageData:s,opacity:Bs(e.opacity)?e.opacity:.5,zIndex:9999,visibility:!1},initByDraw:!0}),n.appendChild(this.stampPreview),!s&&i){const{width:t,height:e}=this.stampPreview.parsedStyle;if(e.value>60){const i=e.value/60;this.stampPreview.updateSize(t.value/i,e.value/i);}}}}function Lh(t){return ["annotationFreeText","annotationTextBox","annotationRect"].includes(t.shapeType)}var Uh,Oh,_h=new WeakMap;class Nh extends Tn{constructor(){super(...arguments),l(this,"renderAnnotation",En(this)),l(this,"addAnnotation",En(this)),l(this,"deleteAnnotation",En(this)),l(this,"selectAnnotation",En(this)),l(this,"modifyAnnotation",En(this)),l(this,"annotationModeChanged",En(this)),l(this,"beforeAnnotationEdit",En(this)),l(this,"afterAnnotationEdit",En(this)),l(this,"beforeAnnotationDraw",En(this)),l(this,"afterAnnotationDraw",En(this)),l(this,"selectAnnotationTextChars",En(this)),l(this,"enableAnnotationTextEditMode",En(this)),l(this,"disableAnnotationTextEditMode",En(this)),n(this,_h,[]);}emitAddAnnotation(t,e){const i=[];e.forEach((t=>{i.push({uid:t.id,shape:t});})),this.addAnnotation.emit({action:t,shapes:i});}emitDeleteAnnotation(t){const e=[];t.forEach((t=>{e.push({uid:t.id,shape:t});})),this.deleteAnnotation.emit({shapes:e});}emitSelectAnnotation(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[];t instanceof th?t.shapes.forEach((t=>{i.push(t.id);})):t&&i.push(t.id),(i.length||s(_h,this).length)&&(this.selectAnnotation.emit({newAnnotationUids:[...i],oldAnnotationsUids:[...s(_h,this)],emitSelected:e}),o(_h,this,i));}emitModifyAnnotation(t,e){const i=[];e.forEach((t=>{t instanceof th?t.shapes.forEach((t=>{i.push({uid:t.id,shape:t});})):i.push({uid:t.id,shape:t});})),this.modifyAnnotation.emit({actions:t,shapes:i});}emitAnnotationModeChanged(t){this.annotationModeChanged.emit(t);}emitBeforeAnnotationEdit(t){t instanceof Kl&&t.textEditEventHandler.editMode||this.beforeAnnotationEdit.emit(t);}emitAfterAnnotationEdit(t){this.afterAnnotationEdit.emit(t);}emitAnnotationRender(){this.renderAnnotation.emit();}emitSelectAnnotationTextChar(t){this.selectAnnotationTextChars.emit(t);}emitBeforeAnnotationDraw(t){this.beforeAnnotationDraw.emit(t);}emitAfterAnnotationDraw(t){this.afterAnnotationDraw.emit(t);}emitEnableAnnotationTextEditMode(t){this.enableAnnotationTextEditMode.emit(t);}emitDisableAnnotationTextEditMode(t){this.disableAnnotationTextEditMode.emit(t);}}class Wh{constructor(t){l(this,"shapeArrMap",void 0),l(this,"shapeMap",void 0),l(this,"annotationMode","none"),l(this,"brush","annotationRect"),l(this,"canvas",void 0),l(this,"hooks",void 0),l(this,"interactiveConfig",As(Fl)),l(this,"eventService",void 0),l(this,"containerId",void 0),l(this,"container",void 0),ua.bindHandler(["opacity"],void 0,Ph),ua.bindHandler(["fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,Dh),ua.bindHandler(["text","width","wordWarp","borderWidth","lineHeight","fontWeight","textTransform","textBaseLine"],void 0,Dh),ua.bindHandler(["width","height","borderWidth"],void 0,kh),ua.bindHandler(["startPoint","endPoint","lineEnding"],void 0,Eh),ua.bindHandler(["r","rx","ry","borderWidth"],void 0,Sh),ua.bindHandler(["points","segments"],void 0,Ah),ua.bindHandler(["borderWidth"],void 0,Th),ua.bindHandler(["textContents","borderWidth","textAlign"],void 0,Ih),ua.bindHandler(["textAlign"],void 0,Rh),this.canvas=t,this.eventService=new Bh(this),this.hooks=new Nh,this.shapeArrMap=new Map,this.shapeMap=new Map;}set drawType(t){this.brush=t,"draw"===this.annotationMode&&this.eventService.setEventMode("draw",t);}get drawType(){return this.brush}bindFreeTextHooks(t){if(!(t instanceof Kl))return;const e=t.hooks;let i;e.reRenderText.on((()=>{this.hooks.emitAnnotationRender();})),e.textContentUpdated.on((()=>{this.hooks.emitModifyAnnotation(["contentChanged"],[t]);})),e.selectTextChars.on((e=>{var s;if(e.startChar===e.endChar&&t.isSameChar(i,e.endChar)&&!e.needUpdate)return;const{freeTextContentStyle:n}=t,o="freeTextWriter"===t.textType?"textTypewriter":"textBox",{defaultStyleConfig:r}=this.interactiveConfig;r[o]||(r[o]={}),r[o].textContent={...n,content:null===(s=r[o])||void 0===s||null===(s=s.textContent)||void 0===s?void 0:s.content},i=e.endChar,this.hooks.emitSelectAnnotationTextChar(t);})),e.enableTextEditMode.on((e=>{this.hooks.emitEnableAnnotationTextEditMode(t);})),e.disableTextEditMode.on((e=>{i=null,this.hooks.emitDisableAnnotationTextEditMode(t);}));}bindStampHooks(t){t instanceof vh&&t.hooks.reRenderImage.on((()=>{this.hooks.emitAnnotationRender();}));}isHitShape(t){const{offsetX:e,offsetY:i}=Dl(this.canvas,t),{activatedShape:s,defaultGroup:n}=this.eventService,o={x:e,y:i},{shapeArrMap:r,shapeMap:a,containerId:l}=this,h=r.get(l)||a,d=n===this.eventService.activatedShape&&(null==n?void 0:n.parentNode)===this.container;if(s&&(d||h.has(s.id))){const t=s.eventHandler.isHit(o,!1);if(-1!==t)return {isHit:!0,isHitSelected:!0,hitControlPointIndex:t,shape:s}}const c=[];let u=!1,p=null;return h.forEach((t=>{if("hidden"===t.style.visibility||!t.context.controlsFlags.enableControl||t===s)return;const e=Pl(t,o);!t.context.isGrouped&&t.isPointInPath(e,this.eventService.getHitBorderOffset(t))&&(u=!0,c.push(t));})),u&&(c.sort(((t,e)=>t.style.zIndex-e.style.zIndex)),p=c[c.length-1]),{isHit:u,shape:p,isHitSelected:!1,hitControlPointIndex:-1}}isInTextEditMode(){return !!(this.eventService.activatedShape&&this.eventService.activatedShape instanceof Kl)&&this.eventService.activatedShape.isEditMode}setAnnotationMode(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.annotationMode=t,this.eventService.setEventMode(t,this.drawType),Ms()&&"draw"===t&&"annotationStamp"===this.drawType&&this.eventService.createStampPreviewForMobile(),"none"!==t&&this.eventService.inactivateShape(),e&&this.hooks.emitAnnotationModeChanged(t);}setAnnotationContainer(t,e){if(e!==this.container){const{activatedShape:t,drawLineShape:e,drawInkShape:i,drawType:s}=this.eventService;if("draw"===this.eventService.eventMode&&t){if(i&&t instanceof Yl&&(clearTimeout(this.eventService.inkDelayTimeout),t.setUseDouglasPeucker(!0),this.eventService.drawInkShape=!1),e){const e=[...t.style.points];t.style.points=e,this.eventService.drawLineShape=!1,this.eventService.isStartDraw=!1;}"annotationInk"!==s&&(this.hooks.emitAddAnnotation("draw",[t]),this.interactiveConfig.enableContinuousDrawing||(this.setAnnotationMode("none",!0),this.hooks.emitAfterAnnotationDraw(t)),this.eventService.activatedShape=null);}}this.containerId=t,this.container=e,this.shapeArrMap.get(t)||this.shapeArrMap.set(t,new Map);}setAnnotationInteractiveConfig(t){const e=As(t),{controlsStyle:i,defaultStyleConfig:s,eraserStyle:n,selectionStyle:o}=this.interactiveConfig;e.defaultStyleConfig=(null==e?void 0:e.defaultStyleConfig)||{};const{stamp:r}=s,{stamp:a}=e.defaultStyleConfig,l=(null==r?void 0:r.stampIcon)||Nl.stampIcon,h=(null==a?void 0:a.stampIcon)||Nl.stampIcon,d=(null==r?void 0:r.imageData)||Nl.imageData,c=(null==a?void 0:a.imageData)||Nl.imageData;this.interactiveConfig={...this.interactiveConfig,...e,controlsStyle:vn((null==e?void 0:e.controlsStyle)||{},i),defaultStyleConfig:vn((null==e?void 0:e.defaultStyleConfig)||{},s),eraserStyle:vn((null==e?void 0:e.eraserStyle)||{},n),selectionStyle:vn((null==e?void 0:e.selectionStyle)||{},o)},null!=e&&e.controlsStyle&&this.updateAllShapeControlsStyle(this.interactiveConfig.controlsStyle);const{stampPreview:u}=this.eventService;var p;(u&&u.style.opacity!==(null==a?void 0:a.opacity)&&(this.eventService.stampPreview.style.opacity=null==a?void 0:a.opacity),l===h&&d===c||!this.eventService.stampPreview)||(null===(p=this.eventService.stampPreview)||void 0===p||p.destroy(),this.eventService.stampPreview=null);}setAnnotationFlags(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=this.getShape(t);if(!(s instanceof Ch||s instanceof bh)&&s){if(s!==this.eventService.activatedShape||!1!==e.enableControl&&!1!==e.isVisible||this.eventService.inactivateShape(!0),s.context.updateControlsFlags({...e}),s.context.isInGroup&&(!s.context.controlsFlags.isVisible||!s.context.controlsFlags.enableControl)){const{defaultGroup:t}=this.eventService;t.delete(s),this.eventService.activatedShape===t&&1===t.shapes.length&&this.eventService.activateShape(t.shapes[0],!1,!0);}i&&this.hooks.emitAnnotationRender();}}getShape(t){if("ddvDefaultGroup"===t)return this.eventService.defaultGroup;const e=this.shapeMap.get(t);return e||null}getSelectedShapeUids(){const{activatedShape:t}=this.eventService;if(!t)return [];const e=[];return t instanceof th?t.shapes.forEach((t=>{e.push(t.id);})):e.push(t.id),e}createShape(t,e){var i,s;let n;if(e.selectableStyle={...this.interactiveConfig.controlsStyle,...e.selectableStyle},"annotationEllipse"===t){const{style:t}=e;t.x+=t.width/2||0,t.y+=t.height/2||0,t.rx=t.width/2||t.rx,t.ry=t.height/2||t.ry;}const{defaultStyleConfig:o}=this.interactiveConfig;switch(t){case"annotationRect":n=new Jl(e);break;case"annotationGroup":n=new th(null==e?void 0:e.id);break;case"annotationArc":n=new jl(e);break;case"annotationCircle":n=new $l(e);break;case"annotationEllipse":n=new Gl(e);break;case"annotationLine":n=new oh(e);break;case"annotationInk":n=new Yl(e);break;case"annotationPolygon":n=new sh(e);break;case"annotationPolyline":n=new nh(e);break;case"annotationFreeText":n=new Kl(e,"freeTextWriter",{...Nl.textContent,...null===(i=o.textTypewriter)||void 0===i?void 0:i.textContent});break;case"annotationTextBox":n=new Kl(e,"textBox",{...Nl.textContent,...null===(s=o.textBox)||void 0===s?void 0:s.textContent});break;case"annotationImage":n=new Xl(e);break;case"annotationStamp":n=new vh(e);break;case"annotationHighlight":n=new bh(e,wh.HIGHLIGHT);break;case"annotationUnderline":n=new bh(e,wh.UNDERLINE);break;case"annotationStrikeout":n=new bh(e,wh.STRIKEOUT);break;default:n=new Ch(e);}return n?(n.id||(n.id=_s()),this.shapeMap.set(n.id,n),n):null}addShape(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null!=e&&e.id){const t=this.getShape(null==e?void 0:e.id);if(t)return t}const s=this.createShape(t,e);return this.containerId&&this.shapeArrMap.get(this.containerId).set(s.id,s),this.container&&(s.index=this.shapeArrMap.get(this.containerId).size,s.pageUid=this.containerId,this.container.appendChild(s),i&&this.hooks.emitAddAnnotation("data",[s])),this.bindFreeTextHooks(s),this.bindStampHooks(s),s}updateShape(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=this.getShape(t);if(!s)return !1;const{isGrouped:n}=s.context;if(n&&this.eventService.defaultGroup.delete(s),null!=e&&e.style)if(s instanceof vh)s.updateStampStyle({...e.style});else {if(s instanceof Gl){const{x:t,y:i,width:n,height:o}=e.style,{x:r,y:a}=s.getLocalPosition(),l=n?rr(n).value/2:0,h=o?rr(o).value/2:0,d=Bs(t)?t+l:r,c=Bs(i)?i+h:a,u=l||s.style.rx,p=h||s.style.ry;e.style={...e.style,x:d,y:c,rx:u,ry:p};}s.updateStyle({...e.style});}if(null!=e&&e.transform){const{angle:t,scale:i}=e.transform;Ts(t)||s.setLocalAngle(t),Ts(i)||s instanceof vh||s.setLocalScale(i);}return i&&this.hooks.emitModifyAnnotation(["appearanceChanged"],[s]),n&&this.eventService.defaultGroup.add(s),!0}updateAllShapeControlsStyle(t){let e=!1;this.shapeMap.forEach((i=>{if(i.context.controlsStyle=t,i.context.parseControlsStyle(),i.controls){i.controls.isVisible&&(e=!0),i.context.destroyControls(),i.context.initControls(),i.context.renderControls();}})),e&&this.hooks.emitAnnotationRender();}updateFreeTextDefaultConfig(){const{defaultStyleConfig:t}=this.interactiveConfig;this.shapeMap.forEach((e=>{if(e instanceof Kl){const i=Nl.textContent,s="freeTextWriter"===e.textType?"textTypewriter":"textBox",{textContent:n}=t[s]||{};e.updateFreeTextContentStyle({...i,...n,content:i.content});}}));}updateLayer(t,e){const i=this.getShape(t);return !!i&&(this.interactiveConfig.showOnTopWhenSelected&&this.eventService.activatedShape===i?this.eventService.activatedZIndex=e:i.updateStyle({zIndex:e}),this.interactiveConfig.showOnTopWhenSelected&&this.interactiveConfig.enableContinuousDrawing&&"draw"===this.eventService.eventMode&&i.updateStyle({zIndex:e}),!0)}deleteShape(t){var e;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=[],{eventService:o}=this,r=t.includes(null==o||null===(e=o.activatedShape)||void 0===e?void 0:e.id);if(t.forEach((t=>{const e=this.getShape(t);e&&(e instanceof th?(n.push(...e.shapes),e.clear()):n.push(e));})),!n.length)return !1;i&&this.hooks.emitDeleteAnnotation(n),n.forEach((t=>{t.context.isInGroup&&this.eventService.defaultGroup.delete(t),this.shapeMap.delete(t.id),this.shapeArrMap.get(t.pageUid)&&this.shapeArrMap.get(t.pageUid).delete(t.id),t.destroy();}));const{activatedShape:a,defaultGroup:l}=o,h=a===l&&!l.state;return (r||h)&&this.eventService.inactivateShape(!0,s),!0}selectShape(t){const e=[];return t.forEach((t=>{e.push(this.getShape(t));})),this.eventService.selectShapes(e)}moveShape(t,e,i){t.forEach((t=>{const s=this.getShape(t);if(!s)return;const n=s.pageUid,o=this.shapeArrMap.get(n);o&&o.delete(t),this.shapeArrMap.get(e)||this.shapeArrMap.set(e,new Map),this.shapeArrMap.get(e).set(t,s),s.context.isGrouped&&s.parentNode.delete(s,!0),i.appendChild(s);}));}setShapeLayout(t,e){var i;if(!t.parentNode)return;const s=t.parentNode;let n,o;if(s instanceof ya)n=s.width,o=s.height;else {const{width:t,height:e}=El(s);n=t,o=e;}const{x:r,y:a}=s.getLocalScale();s.scale(r<0?-1:1,a<0?-1:1);const l=s.getAngle(),{width:h,height:d}=El(t),{x:c,y:u}=s.getPosition(),{x:p,y:g}=t.getPosition(),{shapeType:f}=t;let m,y;if(s.setAngle(0),null!=s&&null!==(i=s.context)&&void 0!==i&&i.referencePoint){const{x:t,y:e}=s.context.referencePoint.getPosition();m=t,y=e;}else m=c,y=u;switch(e){case"left":y=g;break;case"top":m=p;break;case"right":m+=n-h,y=g;break;case"bottom":m=p,y+=o-d;break;case"center":m+=n/2-h/2,y+=o/2-d/2;break;case"horizontal-center":m+=n/2-h/2,y=g;break;case"vertical-center":m=p,y+=o/2-d/2;}const v=t.getAngle();if(t.setAngle(0),["annotationCircle","annotationArc","annotationEllipse"].includes(f)&&(["left","right","horizontal-center"].includes(e)?m+=h/2:(["top","bottom","vertical-center"].includes(e)||(m+=h/2),y+=d/2)),"annotationText"===f&&["top","bottom","vertical-center","center"].includes(e)){var x;const{lineHeight:e}=t.parsedStyle,i=null===(x=t.chars[0])||void 0===x?void 0:x.height,s=Math.max(e,i);y+=t.getTextBaseLineOffset(s)/2;}t.setPosition({x:m,y:y}),t.setAngle(v),s.setAngle(l),s.scale(r<0?-1:1,a<0?-1:1),this.hooks.emitAnnotationRender();}clickHandler(t){this.eventService.clickHandler(t);}dblClickHandler(t){this.eventService.dblClickHandler(t);}keyDownHandler(t){this.eventService.keyDownHandler(t);}startHandler(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.isHitShape(t);if("none"===this.annotationMode&&e&&(i.isHit?this.eventService.activateShape(i.shape,t.ctrlKey,!0):this.eventService.inactivateShape()),"draw"!==this.annotationMode||i.isHit||this.annotationMode===this.eventService.eventMode||this.eventService.setEventMode(this.annotationMode,this.brush),"draw"===this.annotationMode&&!this.eventService.drawLineShape&&"annotationInk"!==this.brush&&"annotationStamp"!==this.brush&&i.isHit&&(this.eventService.setEventMode("none"),this.eventService.activateShape(i.shape,t.ctrlKey,!0)),"select"===this.annotationMode){const{isHitSelected:e,isHit:s}=i;e?this.eventService.setEventMode("none"):!e&&s&&t.ctrlKey?(this.eventService.setEventMode("none"),this.eventService.activateShape(i.shape,t.ctrlKey,!0)):(this.eventService.setEventMode("select"),this.eventService.defaultGroup.clear());}this.eventService.editStartHandler(t),this.eventService.drawStartHandler(t);}moveHandler(t,e){this.eventService.editMoveHandler(t),this.eventService.drawMoveHandler(t,e),this.eventService.eraseMoveHandler(t);}endHandler(t){this.eventService.editEndHandler(t),this.eventService.drawEndHandler(t);}cursorHandler(t,e,i){if(!this.container)return;if(!(t.target instanceof HTMLCanvasElement))return;if(e)return void(t.target.style.cursor=i);if(!(this.shapeArrMap.get(this.containerId)||this.shapeMap).size&&"none"===this.eventService.eventMode)return void(t.target.style.cursor=i);if("erase"===this.eventService.eventMode)return void(t.target.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAATtJREFUOE+Vk8ErRFEUxs93/gXZUUrNhiRFWUkWVpaWSomlpaVkaUlZ2CiWllZKjbJQVqQokaYspPwL5+e9aeb15s17z7i7273nd77v3O/KBliSrs1sycxugMV8if6ql3RpZiPAvaR5M/vJQ2oBki7MbBR47DYqQioB7n4OjAHPRZV5SCnA3U+AceCtyqKkZTP76AO4+yHQAFoDzGerB+DuB8DUgMXpQL8zgLvvA3P/KG4BK13AnqQFMxsC7uqkS5o1s3dgNb0ndz9ON8BwAmnWQSRNS3qNiLXcswogs1IFSTIxIeklIjZ7kij1AtqyCkokNSQ9RcR2Xybc/QyYASYL5LYdM/uS9BARO2WzaUvvdLS+jyI1Jd1GxG5loHLDSDtmEEmfSWSvImKj9lXyh+5+Cqx3VB2VeS7CfgHdAKKUgZXPMQAAAABJRU5ErkJggg==) 10 10,auto");if(this.eventService.isStartDraw)return;const s=this.isHitShape(t);if(this.eventService.isStartEdit){if(!s.isHitSelected||9!==s.hitControlPointIndex)return;t.target.style.cursor="move";}if("draw"===this.eventService.eventMode&&["annotationInk","annotationStamp"].includes(this.eventService.drawType))t.target.style.cursor="crosshair";else if(s.isHit)if(s.isHitSelected){if(9===s.hitControlPointIndex)t.target.style.cursor="move";else t.target.style.cursor="grab";9===s.hitControlPointIndex&&s.shape instanceof Kl&&s.shape.isEditMode&&(t.target.style.cursor="text");}else t.target.style.cursor="pointer";else "draw"===this.annotationMode?t.target.style.cursor="crosshair":t.target.style.cursor=i;}}class Fh extends nl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class Hh extends Fh{constructor(){super(),this.close=!1;}}class Vh extends Fh{render(t,e){super.render(t,e);}}class zh extends Fh{}class jh extends fl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()));}}class $h extends Fh{}class Gh extends ll{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class Xh extends hl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class Yh extends Fh{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()));}}class Jh extends cl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&(t.pointEventsHandler.updateLineControls(),t.context.renderControls()));}}class qh extends Fh{}class Zh extends nl{render(t,e){if("hidden"!==t.parsedStyle.visibility){if("stamp"===t.renderType)super.render(t,e);else {const{width:i,height:s,img:n,opacity:o}=t.parsedStyle;if(Ls(n))return;e.save(),e.globalAlpha=o,e.imageSmoothingEnabled=!0,e.imageSmoothingQuality&&(e.imageSmoothingQuality="high"),e.drawImage(n,0,0,i.value,s.value),e.restore();}t.controls&&t.context.renderControls();}}}class Qh extends pl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class Kh extends yl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(super.render(t,e),t.controls&&t.context.renderControls());}}class td extends nl{render(t,e){"hidden"!==t.parsedStyle.visibility&&ed(t,e);}}function ed(t,e){const{container:i}=t,s=t.parentNode;if(!s)return;const n=s.getLocalTransform(),{a:o,b:r,c:a,d:l,e:h,f:d}=n;let c=null,u=i.parentNode;for(;!c&&u;)"pageCropBox"===u.name&&(c=u),u=u.parentNode;if(c){const{x:t,y:i,width:s,height:n}=function(t){let{x:e,y:i}=t.getPosition(),{width:s,height:n}=t;const o=t.parentNode.parentNode,r=(o.rotation%360+360)%360/90,a=devicePixelRatio;1===r?e-=n:2===r?(e-=s,i-=n):3===r&&(i-=s);if(1===r||3===r){const t=s;s=n,n=t;}return {x:e*a,y:i*a,width:s*a,height:n*a}}(c);e.save(),e.setTransform(o,r,a,l,h,d),e.beginPath(),e.moveTo(t,i),e.lineTo(t+s,i),e.lineTo(t+s,i+n),e.lineTo(t,i+n),e.closePath(),e.restore(),e.clip();}}class id extends nl{render(t,e){"hidden"!==t.parsedStyle.visibility&&(ed(t,e),super.render(t,e));}}class sd{init(t){[{name:"annotationArc",renderer:new Hh},{name:"annotationCircle",renderer:new Vh},{name:"annotationEllipse",renderer:new zh},{name:"annotationLine",renderer:new jh},{name:"annotationImage",renderer:new Gh},{name:"annotationInk",renderer:new Xh},{name:"annotationPolygon",renderer:new Yh},{name:"annotationPolyline",renderer:new Jh},{name:"annotationRect",renderer:new qh},{name:"annotationText",renderer:new Qh},{name:"annotationFreeText",renderer:new Kh},{name:"annotationGroup",renderer:new $h},{name:"annotationStamp",renderer:new Zh},{name:"annotationControls",renderer:new td},{name:"annotationLineControls",renderer:new id}].forEach((e=>{let{name:i,renderer:s}=e;t.contextService.registerShapeRenderer(i,s);}));}destroy(){}}function nd(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eo.displayResolution;const i={left:0,top:0,width:t.imageWidth/t.imageXResolution*e,height:t.imageHeight/t.imageYResolution*e};return {fileIndex:0,mediaBox:i,cropBox:{...i},resource:{data:t.imageData,width:t.imageWidth,height:t.imageHeight,resolutionX:t.imageXResolution,resolutionY:t.imageYResolution,bitDepth:t.imageBitDepth}}}class od extends Co{constructor(){super(),l(this,"type","imageParser"),l(this,"once",!1),l(this,"imgReader",void 0),l(this,"isDestroy",!1),l(this,"source",void 0),l(this,"parserOptions",void 0),this.imgReader=new Yn;}initParser(t,e){this.source={fileSource:t},e&&(this.parserOptions=e);}async getPageCount(){return 1}destroy(){var t;null===(t=this.imgReader)||void 0===t||t.destroy(),this.imgReader=null,this.isDestroy=!0;}async parse(){if(this.isDestroy)return null;return [nd(await this.imgReader.readImageInfo(this.source))]}async getPage(){var t;if(this.isDestroy)return null;const e={"image/jpeg":Fn.IT_JPG,"image/png":Fn.IT_PNG,"image/bmp":Fn.IT_BMP},{outputType:i,jpegQuality:s,returnBase64:n}=null!==(t=this.parserOptions)&&void 0!==t?t:{},o=await this.imgReader.readImage({source:this.source,outputType:null!=i?i:e[this.source.fileSource.type],jpegQuality:s,returnBase64:n});if(o){return nd(o)}return null}cancelGetPage(t){var e;if(this.isDestroy)return;const{outputType:i}=null!==(e=this.parserOptions)&&void 0!==e?e:{};this.imgReader.cancelReadImage(this.source,i);}}class rd{constructor(){l(this,"type","tiffParser"),l(this,"once",!1),l(this,"imgReader",void 0),l(this,"parserOptions",void 0),l(this,"source",void 0),l(this,"isDestroy",!1),this.imgReader=new Yn;}initParser(t,e){this.source={fileSource:t},e&&(this.parserOptions=e);}async getPageCount(){return this.imgReader.getTiffPageCount(this.source)}destroy(){var t;null===(t=this.imgReader)||void 0===t||t.destroy(),this.imgReader=void 0,this.isDestroy=!0;}async parse(t){if(this.isDestroy||!this.source)return null;return (await this.imgReader.readTiffPageInfo(this.source,t)).map((t=>{const e=nd(t);return e.fileIndex=t.pageIndex,e}))}async getPage(t){var e;if(this.isDestroy||!this.source)return null;const{outputType:i,returnBase64:s}=null!==(e=this.parserOptions)&&void 0!==e?e:{},n=await this.imgReader.readTiffPage({source:this.source,index:t,outputType:i,returnBase64:s});if(n){const t=nd(n);return t.fileIndex=n.pageIndex,t}return null}cancelGetPage(t){!this.isDestroy&&this.source&&this.imgReader.cancelReadTiffPage(this.source,t);}}function ad(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=mr(t),n=e||1;if(Ss(s)&&s[0]&&s[0]instanceof dr){const t=s[0].value.steps,{length:e}=s[0].value.steps,n=[0,0,0];t.forEach((t=>{const e=mr(t.color);n[0]+=e.r,n[1]+=e.g,n[2]+=e.b;}));const o=[n[0]/e,n[1]/e,n[2]/e];return i&&(o[3]=255),o}const{r:o,g:r,b:a,alpha:l}=s,h=[o,r,a];return i&&(h[3]=Math.floor(l*n*255+.5)),h}function ld(t,e){return {strokeColor:t?ad(t,1,!1):null,fillColor:e?ad(e,1,!1):null}}function hd(t,e,i){let s,n;return s=t?ad(t,i,!0):null,n=e?ad(e,i,!0):null,{apStrokeColor:s,apFillColor:n}}function dd(t,e,i){const s=t.value?t.value/i:0,n=md(e||[],i);return n.length?{width:s,style:"D",dash:n}:{width:s}}function cd(t){const e=t.getLocalTransform().clone(),{a:i,b:s,c:n,d:o}=e;return [Dd(i),-Dd(s),-Dd(n),Dd(o),0,0]}function ud(t,e){const{min:i,max:s}=Math;let n=t[0][0],o=t[0][1],r=t[0][0],a=t[0][1];for(let e=1;e<t.length;e++){const l=t[e];n=i(n,l[0]),r=s(r,l[0]),a=i(a,l[1]),o=s(o,l[1]);}return n===r&&(n-=1,r+=1),a===o&&(a-=1,o+=1),[n-e/2,a-e/2,r+e/2,o+e/2]}function pd(t,e,i,s,n,o){const r=[],a=Xr(e),l=i/2,h=[{x:a.left-l*s,y:a.bottom+l*n},{x:a.right+l*s,y:a.bottom+l*n},{x:a.right+l*s,y:a.top-l*n},{x:a.left-l*s,y:a.top-l*n}],d=t.getLocalTransform();return h.forEach((t=>{const e=d.transformPoint({x:t.x,y:t.y});r.push([e.x/s,o-e.y/n]);})),ud(r,0)}function gd(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[],{length:s}=t;if(s>50&&e){const e=Math.floor(s/2),n=Math.floor(s/4);i.push(t[0][0],t[0][1]),i.push(t[n][0],t[n][1]),i.push(t[e][0],t[e][1]),i.push(t[s-n][0],t[s-n][1]),i.push(t[s-1][0],t[s-1][1]),i.push(t[0][0],t[0][1]);}else t.forEach((t=>{i.push(t[0],t[1]);}));return i}function fd(t){const e=[];for(let i=0;i<t.length;i++){const s=[];t[i].forEach((t=>{s.push(t[0],t[1]);})),e.push(s);}return e}function md(t,e){if(!t)return [];if(2===t.length&&0===t[0]&&0===t[1])return [];return t.map((t=>t/e))}function yd(t){return Math.max(["butt","round","square"].indexOf(t),0)}function vd(t){return Math.max(["miter","round","bevel"].indexOf(t),0)}function xd(t){const e=[],i=t.getLocalTransform();return t.renderPath.forEach((t=>{const s=i.transformPoint({x:t.x,y:t.y});e.push({x:s.x,y:s.y});})),e}function wd(t,e){const i=mr(t);let s=0,n=0,o=99999,r=99999;if(Ss(i)&&i[0]&&i[0]instanceof dr){const i=(t=>{const e=t.match(/(to\s+\w+\s+\w+)|(#\w+)/g);if(!e)return null;const i=e[0],s=e.slice(1);return {direction:i.replace(/\s+/g," ").trim(),colors:s.map((t=>t.trim()))}})(t);e.forEach((t=>{s=Math.max(s,t[0]),o=Math.min(o,t[0]),n=Math.max(n,t[1]),r=Math.min(r,t[1]);}));const a=[o,n,s,r];i.direction.includes("left")&&(a[0]=s,a[2]=o),i.direction.includes("top")&&(a[1]=r,a[3]=n);const l=mr(i.colors[0]),h=mr(i.colors[1]);return {coords:a,extend:[!0,!0],function:[{bounds:[],domain:[0,1],encode:[0,1],functions:[{c0:[l.r/255,l.g/255,l.b/255],c1:[h.r/255,h.g/255,h.b/255],domain:[0,1],n:1,type:"exponentialInterpolation"}],type:"stitching"}],shadingType:"axial",type:"shading"}}return null}function bd(t){return t.map((t=>t.toLowerCase()))}function Cd(t,e,i,s,n){const{width:o,height:r}=t.parsedStyle;let a=o.value,l=r.value;if(t instanceof Kl){const{width:e,height:i}=t.getBoundingRect();a=e,l=i;}const{x:h,y:d}=t.getLocalPosition(),c=e/2,u=h/i,p=n-d/s,g=a/i,f=l/s;return [[u+c,p-f+c,2,!1],[u+g-c,p-f+c,0,!1],[u+g-c,p-c,0,!1],[u+c,p-c,0,!1],[u+c,p-f+c,0,!0]]}function Sd(t,e,i,s){t.renderPath||t.getPath();const{renderPath:n}=t,o=[],{x:r,y:a}=t.getLocalPosition();let l=[];for(let t=0;t<n.length;t++){const{step:h,close:d}=n[t],c=(n[t].x+r)/e,u=s-(n[t].y+a)/i;0!==t?0!==h||0===t?l.push([c,u,0,d]):(o.push(l),l=[],l.push([c,u,2,d])):l.push([c,u,2,d]);}return o.push(l),o}function Pd(t,e,i,s){const n=t.childNodes,o=[];for(let t=0;t<n.length;t++){if(!(n[t]instanceof Da))continue;const r=[],{renderPath:a}=n[t],{x:l,y:h}=n[t].getLocalPosition();a.forEach(((t,n)=>{const o=[(t.x+l)/e,s-(t.y+h)/i,t.step,!1];n===a.length-1&&(o[3]=!0),r.push(o);})),o.push(r);}return o}function Ad(t,e,i,s,n,o,r){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const{lineDash:l}=t.parsedStyle,h=cd(t),d=ud(o,n),c=[];a&&c.push(Td(t,o,e,i,n,md(l,r)));return {bbox:d,matrix:h,transform:d,objs:c}}function Td(t,e,i,s,n,o){const{miterLimit:r,lineCap:a,lineJoin:l}=t.parsedStyle;return {dashArray:o,dashPhase:0,fillColor:i||[0,0,0,0],fillType:i?2:0,isStroke:n>0,lineCap:yd(a),lineJoin:vd(l),lineWidth:n,miterLimit:r,objMatrix:[1,0,0,1,0,0],segments:e,strokeColor:s||[0,0,0,0],type:"path"}}function kd(t,e,i,s){const{fontSize:n,fontFamily:o,fontWeight:r,fontStyle:a,opacity:l,text:h}=t.parsedStyle,{color:d,borderColor:c}=t.style,{x:u,y:p}=t.getLocalPosition(),{fillColor:g,strokeColor:f}=ld(c,d),m=Ed(r),y="italic"===a;return {type:"text",charSpace:0,wordSpace:0,fillColor:g?[...g,255*l]:[0,0,0,255],strokeColor:f?[...f,255*l]:[0,0,0,255],fontName:o,renderMode:0,fontIsBold:m,fontIsItalic:y,fontSize:n.value/e,fontPitchFamily:16,text:h,position:[u/e,p/i],objMatrix:[1,0,0,1,u/e,s-p/i]}}function Dd(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;const i=t.toFixed(e);return Number.parseFloat(i)}function Ed(t){return "bold"===t||Bs(t)&&t>=600}function Id(t,e,i){return t.replace(new RegExp(e,"g"),i)}function Rd(t,e,i,s,n){const{segments:o,lineWidth:r,strokeColor:a,fillType:l,fillColor:h,dashArray:d,lineCap:c,lineJoin:u,miterLimit:p,isStroke:g,pattern:f}=t,m={type:"path",stampPoints:_d(o,i,s,n),borderWidth:g?(r||1)*i:0,borderColor:Fd(a,e),background:l>0?Fd(h,e):null,lineDash:Hd(d,i),lineCap:Nd(c),lineJoin:Wd(u),miterLimit:p};return f&&(m.background=function(t,e,i,s){var n,o,r,a;const{coords:l,type:h}=t;if("shading"!==h)return null;const d={x:l[0]*e,y:s-l[1]*i},c={x:l[2]*e,y:s-l[3]*i},u=d.x<c.x?"right":"left",p=d.y===c.y?"":d.y<c.y?"bottom":"top";if(!t||null==t||!t.function||null==t||null===(n=t.function[0])||void 0===n||!n.functions)return null;let g=null==t||null===(o=t.function[0])||void 0===o||null===(o=o.functions[0])||void 0===o?void 0:o.c0,f=null==t||null===(r=t.function[0])||void 0===r||null===(r=r.functions[0])||void 0===r?void 0:r.c1;if(!g||!f)return null;const m=(null==t||null===(a=t.function[0])||void 0===a?void 0:a.encode)||[1,0];if(m[0]>m[m.length-1]){const t=f;f=g,g=t;}const y=`rgb(${255*g[0]},${255*g[1]},${255*g[2]})`,v=`rgb(${255*f[0]},${255*f[1]},${255*f[2]})`;return `linear-gradient(to ${u} ${p}, ${gr(y)}, ${gr(v)})`}(f,i,s,n)||m.background),m}function Md(t,e,i,s,n){const{text:o,renderMode:r,fontIsBold:a,fontIsItalic:l,fillColor:h,fontSize:d,fontName:c,strokeColor:u,objMatrix:p}=t,g=new zo(p),{scale:f}=g.decompose(),m=function(t,e,i,s,n,o){const r=Ld(t,e,o),a=r[0],l=r[1];return [a*i,(n-l)*s]}(p[4],p[5],i,s,n,[1,0,0,1,0,0]);return {type:"text",text:o,color:Fd(h,e),borderWidth:r?i:"0px",borderColor:Fd(u,e),fontWeight:a?"bold":"normal",fontStyle:l?"italic":"normal",fontSize:d*i*Math.abs(f.x),fontFamily:c,textBaseLine:"alphabetic",x:m[0],y:m[1]+Math.floor(d*i*Math.abs(f.x))}}function Bd(t,e,i){const s=function(t,e){const i=t.replace(/[^A-Za-z0-9\+\/]/g,""),s=i.length,n=e?Math.ceil((3*s+1>>>2)/e)*e:3*s+1>>>2,o=new Uint8Array(n);for(let t,e,r=0,a=0,l=0;l<s;l++)if(e=3&l,r|=zd(i.charCodeAt(l))<<18-6*e,3===e||s-l==1){for(t=0;t<3&&a<n;t++,a++)o[a]=r>>>(16>>>t&24)&255;r=0;}return o}(t),n=new ImageData(new Uint8ClampedArray(s),e,i);let o=document.createElement("canvas");o.width=e,o.height=i;o.getContext("2d").putImageData(n,0,0);const r=o.toDataURL();return o=null,r}function Ld(t,e,i){return [i[0]*t+i[2]*e+i[4],i[1]*t+i[3]*e+i[5]]}function Ud(t,e,i,s,n,o){let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const a=new zo(i),l=a.decompose(),h={x:(e[2]+e[0])/2,y:(e[1]+e[3])/2},d=(e[2]-e[0])/2,c=(e[1]-e[3])/2,u=a.transformPoint(h),p={x:(u.x-d)*s,y:(o-u.y+c)*n},g=-l.rotation.z,f={x:l.scale.x,y:l.scale.y};let m=p;var y;r&&(m=null!==(y=function(t,e,i,s,n,o){const r=[];let a=!0;if(t.forEach((t=>{let e;"path"===t.type?(e=Rd(t,1,s,n,o),a=!1):"text"===t.type&&(e=Md(t,1,s,n,o),a=!1),e&&r.push(e);})),a)return null;if(r.length){const t=function(t,e,i,s,n){const o={x:e[0]*i,y:(n-e[3])*s},r=[],a=[];if(t.forEach((t=>{if("path"!==t.type)return;const{borderWidth:e,stampPoints:i,lineCap:s}=t;if(2===i.length){const t=Kr(i[0],i[1],rr(e).value,s);r.push(t.x,t.x+t.width),a.push(t.y,t.y+t.height);}else {const t=Xr(i),s=rr(e).value/2,n=t.left-s,o=t.top-s,l=t.width+2*s,h=t.height+2*s;r.push(n,n+l),a.push(o,o+h);}})),0===r.length)return {offsetX:0,offsetY:0};const l=Math.min(...r),h=Math.min(...a);return {offsetX:l-o.x,offsetY:h-o.y}}(r,e,s,n,o);i.x+=t.offsetX,i.y+=t.offsetY;}return i}(t,e,{...p},s,n,o))&&void 0!==y?y:m);return {position:m,angle:g,scale:f}}function Od(t,e,i,s){const n=[];return t.forEach((t=>{n.push({x:t[0]*e,y:(s-t[1])*i});})),n}function _d(t,e,i,s){const n=[];return t.forEach((t=>{const o=t[0],r=t[1];n.push({x:o*e,y:(s-r)*i,step:t[2]});})),n}function Nd(t){return ["butt","round","square"][null!=t?t:0]}function Wd(t){return ["miter","round","bevel"][null!=t?t:0]}function Fd(t,e){return t.length<3?null:4===t.length?`rgba(${t.slice(0,3).join()},${t[3]/255/(e||1)})`:`rgb(${t.join()})`}function Hd(t,e){if(!t||0===t.length)return [0,0];return t.map((t=>t*e))}function Vd(t){let e=[];for(let i=0;i<t.length;i++)t[i]instanceof Array?e=e.concat(Vd(t[i])):e.push(As(t[i]));return e}function zd(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0}function jd(t,e){if(!t)return "";let i="";return t.split(";").forEach((t=>{const s=t.split(":");s[0].trim()===e&&(i=s[1].trim());})),i}function $d(t){if(!t)return {contents:[],textStyle:{}};const e=new DOMParser,i='xmlns="http://www.w3.org/1999/xhtml"';let s=t;t.includes('xmlns="')||(s=t.replace(/<body/,`<body ${i}`)),s=Id(s,'xmlns=""',i);const n=e.parseFromString(s,"text/xml"),o=n.getElementsByTagName("body")[0],r=n.getElementsByTagName("span"),a=n.getElementsByTagName("p"),l=t=>{for(const e in t)null!==t[e]&&void 0!==t[e]&&""!==t[e]||delete t[e];return t},{color:h,fontFamily:d,fontSize:c,fontWeight:u,fontStyle:p,textDecoration:g}=o.style,f=l({color:h,fontFamily:d,fontSize:c,fontWeight:u,fontStyle:p,lineThrough:g.includes("line-through"),underline:g.includes("word")||g.includes("underline")}),m=[],y=t=>{for(let e=0;e<t.length;e++){const i=t[e],{color:s,fontFamily:n,fontSize:o,fontStyle:r,fontWeight:a}=i.style||{},h=jd(i.getAttribute("style"),"text-decoration"),d=l({content:i.textContent,color:s,fontFamily:n,fontSize:o,fontWeight:a,fontStyle:r,lineThrough:h.includes("line-through")||void 0,underline:h.includes("word")||h.includes("underline")||void 0});m.push(d);}};return r.length?y(r):y(a),{textStyle:f,contents:m}}class Gd{constructor(){l(this,"pageWidth",void 0),l(this,"pageHeight",void 0),l(this,"ratioX",0),l(this,"ratioY",0);}setParserConfig(t,e,i,s){this.pageWidth=t,this.pageHeight=e,this.ratioX=i,this.ratioY=s;}parseAnnotation(t){let e=null;switch(t.type){case"FreeText":e=t.intent&&"FreeText"!==t.intent?"freetexttypewriter"===t.intent.toLocaleLowerCase()?this.parseFreeText(t):this.parseIncomplete(t):this.parseTextBox(t);break;case"Circle":e=this.parseCircle(t);break;case"Square":e=this.parseRect(t);break;case"Line":e=t.intent&&"linedimension"===t.intent.toLocaleLowerCase()?this.parseIncomplete(t):this.parseLine(t);break;case"Polygon":e=!t.intent||"polygondimension"!==t.intent.toLocaleLowerCase()&&"polygoncloud"!==t.intent.toLocaleLowerCase()?this.parsePolygon(t):this.parseIncomplete(t);break;case"PolyLine":e=t.intent&&"polylinedimension"===t.intent.toLocaleLowerCase()?this.parseIncomplete(t):this.parsePolyline(t);break;case"Ink":e=this.parseInk(t);break;case"Stamp":e=this.parseStamp(t);break;case"Highlight":e=this.parseTextAssist(t,"highlight");break;case"StrikeOut":e=this.parseTextAssist(t,"strikeout");break;case"Underline":e=this.parseTextAssist(t,"underline");break;default:e=t.normalAppearance?this.parseIncomplete(t):this.parseUnknown(t);}if(e||(e=t.normalAppearance?this.parseIncomplete(t):this.parseUnknown(t)),e){var i;const{opacity:s}=t,n=e.style;if(e.raw=t,n.opacity=Bs(n.opacity)?n.opacity:null!=s?s:1,null!=t&&t.normalAppearance){const{blendMode:i}=t.normalAppearance;e.style.renderBlendMode=i.toLowerCase();}null!==(i=e)&&void 0!==i&&i.transform&&e.transform.angle<0&&(e.transform.angle+=360),e.uid=_s();}return e}parseFreeText(t){const{normalAppearance:e,richText:i,rect:s,defaultAppearanceData:n,defaultStyle:o}=t,{objs:r,transform:a,bbox:l}=e,{ratioX:h,ratioY:d,pageHeight:c}=this,{position:u,angle:p,scale:g}=Ud(0===r.length?null:Vd(r),l,a,h,d,c,!1),{x:f,y:m}=u;let y;(Math.round(p)+360)/90%2==0?(y=(s[2]-s[0])*this.ratioX+12,y+f>this.pageWidth*this.ratioX&&(y=this.pageWidth*this.ratioX-f)):(y=(s[3]-s[1])*this.ratioY,y+f>this.pageHeight*this.ratioY&&(y=this.pageHeight*this.ratioY-f));const{fontName:v,fontSize:x,fontColor:w}=n,b={content:"",fontFamily:v,color:jd(o,"color")||`rgb(${w[0]},${w[1]},${w[2]})`,fontSize:x},C=$d(i),S=[];C.contents.forEach((t=>{const e={...b,...C.textStyle,...t},i=rr(e.fontSize);e.fontFamily=e.fontFamily.replace(/^"|"$/g,""),(Bs(e.fontSize)||"pt"===i.unit)&&(e.fontSize=i.value*this.ratioX),S.push(e);}));return {type:"textTypewriter",style:{x:f,y:m,width:y,textContents:S},transform:{scale:g,angle:p},iconColor:b.color}}parseTextBox(t){const{normalAppearance:e,richText:i,defaultAppearanceData:s,defaultStyle:n,opacity:o}=t;if(!e)return null;const{objs:r,transform:a,bbox:l}=e;if(!r||0===r.length)return null;const{fillType:h,fillColor:d,dashArray:c,isStroke:u,lineWidth:p,strokeColor:g,segments:f}=r[0],{ratioX:m,ratioY:y,pageHeight:v}=this,{position:x,angle:w,scale:b}=Ud(Vd(r),l,a,m,y,v,"path"===r[0].type),C="path"===r[0].type?(f[1][0]-f[0][0]+p)*this.ratioX:(l[2]-l[0])*this.ratioX,S="path"===r[0].type?(f[2][1]-f[0][1]+p)*this.ratioY:(l[3]-l[1])*this.ratioY,{x:P,y:A}=x,{fontName:T,fontSize:k,fontColor:D}=s,E={content:"",fontFamily:T,color:jd(n,"color")||`rgb(${D[0]},${D[1]},${D[2]})`,fontSize:k},I=$d(i);let R=jd(i,"text-align")||jd(n,"text-align");"justify-center"===R&&(R="justify");const M=[];if(I.contents.forEach((t=>{const e={...E,...I.textStyle,...t},i=rr(e.fontSize);e.fontFamily=e.fontFamily.replace(/^"|"$/g,""),(Bs(e.fontSize)||"pt"===i.unit)&&(e.fontSize=i.value*this.ratioX),M.push(e);})),0===M.length&&t.contents){const e={...E,content:t.contents};Bs(e.fontSize)&&(e.fontSize*=this.ratioX),M.push(e);}return {type:"textBox",style:{x:P,y:A,width:C,height:S,borderWidth:u?(p||1)*this.ratioX:0,borderColor:Fd(g,o),background:h>0?Fd(d,o):"",lineDash:Hd(c,this.ratioX),textContents:M,textAlign:R},transform:{scale:b,angle:w},iconColor:E.color}}parseCircle(t){const{normalAppearance:e,opacity:i,rect:s,color:n,interiorColor:o,borderStyle:r}=t,{objs:a,transform:l,bbox:h}=e,{ratioX:d,ratioY:c,pageHeight:u}=this;let p;if(0===a.length){var g;const{position:t,angle:e,scale:s}=Ud(null,h,l,d,c,u,!1),{x:a,y:f}=t,m=(h[2]-h[0])*this.ratioX,y=(h[3]-h[1])*this.ratioY,v=Fd(n||[0,0,0],i),x=o?Fd(o,i):"";p={type:"ellipse",style:{x:a,y:f,width:m,height:y,borderWidth:(null!==(g=null==r?void 0:r.width)&&void 0!==g?g:1)*this.ratioX,borderColor:v,background:o?x:"",lineDash:Hd(null==r?void 0:r.dash,this.ratioX)},transform:{angle:e,scale:s},iconColor:o?x:v};}else {if("path"!==a[0].type)return null;{const{fillColor:t,strokeColor:e,lineWidth:s,dashArray:n,fillType:o,isStroke:r}=a[0],{position:g,angle:f,scale:m}=Ud(Vd(a),h,l,d,c,u),{x:y,y:v}=g,x=(h[2]-h[0])*this.ratioX,w=(h[3]-h[1])*this.ratioY,b=Fd(e,i),C=Fd(t,i);p={type:"ellipse",style:{x:y,y:v,width:x,height:w,borderWidth:r?(s||1)*this.ratioX:0,borderColor:b,background:o>0?C:"",lineDash:Hd(n,this.ratioX)},transform:{angle:f,scale:m},iconColor:o>0?C:b};}}return p}parseRect(t){const{normalAppearance:e,opacity:i,rect:s,color:n,interiorColor:o,borderStyle:r}=t,{objs:a,transform:l,bbox:h}=e,{ratioX:d,ratioY:c,pageHeight:u}=this;let p;if(0===a.length){var g;const{position:t,angle:e,scale:s}=Ud(null,h,l,d,c,u,!1),{x:a,y:f}=t,m=(h[2]-h[0])*this.ratioX,y=(h[3]-h[1])*this.ratioY,v=Fd(n||[0,0,0],i),x=o?Fd(o,i):"";p={type:"rectangle",style:{x:a,y:f,width:m,height:y,borderWidth:(null!==(g=null==r?void 0:r.width)&&void 0!==g?g:1)*this.ratioX,borderColor:v,background:x,lineDash:Hd(null==r?void 0:r.dash,this.ratioX),lineCap:Nd(0),lineJoin:Wd(0)},transform:{scale:s,angle:e},iconColor:o?x:v};}else {const{fillColor:t,strokeColor:e,lineWidth:s,dashArray:n,isStroke:o,fillType:r,segments:g,lineCap:f,lineJoin:m}=a[0],{position:y,angle:v,scale:x}=Ud(Vd(a),h,l,d,c,u),{x:w,y:b}=y,C=(g[1][0]-g[0][0]+s)*this.ratioX,S=(g[2][1]-g[0][1]+s)*this.ratioY,P=Fd(e,i),A=Fd(t,i);p={type:"rectangle",style:{x:w,y:b,width:C,height:S,borderWidth:o?(s||1)*this.ratioX:0,borderColor:P,background:r>0?A:"",lineDash:Hd(n,this.ratioX),lineCap:Nd(f),lineJoin:Wd(m)},transform:{scale:x,angle:v},iconColor:r>0?A:P};}return p}parseLine(t){const{normalAppearance:e,lineEnding:i,interiorColor:s,opacity:n}=t;if(!e)return null;const{objs:o,bbox:r}=e;let{transform:a}=e;if(0===o.length)return null;const{strokeColor:l,lineWidth:h,dashArray:d,lineCap:c,lineJoin:u,miterLimit:p,isStroke:g,segments:f}=o[0],{ratioX:m,ratioY:y,pageHeight:v}=this;if(1!==Math.abs(a[0])||1!==Math.abs(a[3])){const t=Ld(r[0],r[1],a),e=Ld(r[2],r[3],a);o.forEach((t=>{t.segments.forEach((t=>{const e=Ld(t[0],t[1],a);t[0]=e[0],t[1]=e[1];}));})),r[0]=t[0],r[1]=t[1],r[2]=e[0],r[3]=e[1],a=[1,0,0,1,0,0];}const{position:x,angle:w,scale:b}=Ud(Vd(o),r,a,m,y,v),C=Fd(l,n);return {type:"line",style:{startPoint:{x:f[0][0]*this.ratioX,y:(this.pageHeight-f[0][1])*this.ratioY},endPoint:{x:f[1][0]*this.ratioX,y:(this.pageHeight-f[1][1])*this.ratioY},lineEnding:i||["None","None"],borderColor:C,borderWidth:g?(h||1)*this.ratioX:0,background:s?Fd(s,n):"",lineCap:Nd(c),lineJoin:Wd(u),miterLimit:p,lineDash:Hd(d,this.ratioX)},transform:{position:x,scale:b,angle:w},iconColor:C}}parsePolygon(t){const{normalAppearance:e,opacity:i}=t,{objs:s,bbox:n}=e;let{transform:o}=e;if(0===s.length)return null;const{dashArray:r,fillColor:a,fillType:l,lineCap:h,lineJoin:d,lineWidth:c,miterLimit:u,segments:p,strokeColor:g}=s[0],{ratioX:f,ratioY:m,pageHeight:y}=this;if(1!==Math.abs(o[0])||1!==Math.abs(o[3])){const t=Ld(n[0],n[1],o),e=Ld(n[2],n[3],o);s.forEach((t=>{t.segments.forEach((t=>{const e=Ld(t[0],t[1],o);t[0]=e[0],t[1]=e[1];}));})),n[0]=t[0],n[1]=t[1],n[2]=e[0],n[3]=e[1],o=[1,0,0,1,0,0];}const{position:v,angle:x,scale:w}=Ud(Vd(s),n,o,f,m,y),b=Od(p,this.ratioX,this.ratioY,this.pageHeight),C=Fd(g,i),S=Fd(a,i);var P,A;return b.length>2&&(P=b[0],A=b[b.length-1],P.x===A.x&&P.y===A.y)&&b.pop(),{type:"polygon",style:{points:b,borderWidth:(c||0)*this.ratioX,borderColor:C,background:l>0?S:"",lineDash:Hd(r,this.ratioX),lineCap:Nd(h),lineJoin:Wd(d),miterLimit:u},transform:{position:v,scale:w,angle:x},iconColor:l>0?S:C}}parsePolyline(t){const{normalAppearance:e,interiorColor:i,opacity:s}=t,{objs:n,bbox:o}=e;let{transform:r}=e;if(0===n.length)return null;const{dashArray:a,lineCap:l,lineJoin:h,lineWidth:d,miterLimit:c,segments:u,strokeColor:p,isStroke:g}=n[0],{ratioX:f,ratioY:m,pageHeight:y}=this;if(1!==Math.abs(r[0])||1!==Math.abs(r[3])){const t=Ld(o[0],o[1],r),e=Ld(o[2],o[3],r);n.forEach((t=>{t.segments.forEach((t=>{const e=Ld(t[0],t[1],r);t[0]=e[0],t[1]=e[1];}));})),o[0]=t[0],o[1]=t[1],o[2]=e[0],o[3]=e[1],r=[1,0,0,1,0,0];}const{position:v,angle:x,scale:w}=Ud(Vd(n),o,r,f,m,y),b=Od(u,this.ratioX,this.ratioY,this.pageHeight),C=Fd(p,s);return {type:"polyline",style:{points:b,borderWidth:g?(d||1)*this.ratioX:0,borderColor:C,background:i?Fd(i,s):"",lineDash:Hd(a,this.ratioX),lineCap:Nd(l),lineJoin:Wd(h),lineEnding:t.lineEnding||["None","None"],miterLimit:c},transform:{position:v,scale:w,angle:x},iconColor:C}}parseInk(t){const{normalAppearance:e,inkList:i,opacity:s}=t,{objs:n,transform:o,bbox:r}=e;if(0===n.length)return null;if(!i)return null;const{dashArray:a,lineCap:l,fillColor:h,lineJoin:d,lineWidth:c,miterLimit:u,strokeColor:p,fillType:g,isStroke:f}=n[0],m=[];for(let t=0;t<i.length;t++){const e=i[t],s=[];for(let t=0;t<e.length;t+=2){const i=e[t],n=e[t+1];s.push([i,n,1,!1]);}const n=Od(s,this.ratioX,this.ratioY,this.pageHeight);m.push(n);}const{ratioX:y,ratioY:v,pageHeight:x}=this,{position:w,angle:b,scale:C}=Ud(Vd(n),r,o,y,v,x),S=Fd(p,s);return {type:"ink",style:{segments:m,borderWidth:f?(c||1)*this.ratioX:0,borderColor:S,background:g>0?Fd(h,s):"",lineDash:Hd(a,this.ratioX),lineCap:Nd(l),lineJoin:Wd(d),miterLimit:u},transform:{position:w,scale:C,angle:b},iconColor:S}}parseStamp(t){const{icon:e,opacity:i}=t,{objs:s,transform:n,bbox:o}=t.normalAppearance;if(0===s.length)return null;const r=Vd(s),a=[],{ratioX:l,ratioY:h,pageHeight:d}=this,{position:c,angle:u,scale:p}=Ud(r,o,n,l,h,d),g={position:c,angle:u,scale:p};for(let t=0;t<r.length;t++){let e;if("path"===r[t].type&&(e=Rd(r[t],i,this.ratioX,this.ratioY,this.pageHeight)),"text"===r[t].type&&(e=Md(r[t],i,this.ratioX,this.ratioY,this.pageHeight)),"image"===r[t].type){let e;e=r[t].jpegBase64?`data:image/jpeg;base64,${r[t].jpegBase64}`:Bd(r[t].RGBABase64,r[t].width,r[t].height);return {type:"stamp",style:{imageData:e,width:o[2]*this.ratioX,height:o[3]*this.ratioY},transform:g}}e&&a.push(e);}return {type:"stamp",style:{iconName:e,stampConfig:a},transform:g,iconColor:"#868E96"}}parseTextAssist(t,e){const{objs:i,transform:s,bbox:n}=t.normalAppearance,{opacity:o}=t;if(0===i.length)return null;const r=Vd(i),a=[],{ratioX:l,ratioY:h,pageHeight:d}=this,{position:c,angle:u,scale:p}=Ud(r,n,s,l,h,d),g={position:c,angle:u,scale:p};for(let t=0;t<r.length;t++){let e;"path"===r[t].type&&(e=Rd(r[t],o,this.ratioX,this.ratioY,this.pageHeight)),e&&a.push(e);}return {type:e,style:{opacity:o||1,stampConfig:a,annotationRaw:t},transform:g}}parseIncomplete(t){const{normalAppearance:e,opacity:i}=t;if(!e)return null;const{objs:s,transform:n,bbox:o}=t.normalAppearance;if(!s||0===s.length)return null;const r=Vd(s),a=[],{ratioX:l,ratioY:h,pageHeight:d}=this,{position:c,angle:u,scale:p}=Ud(r,o,n,l,h,d),g={position:c,angle:u,scale:p};for(let e=0;e<r.length;e++){let s;if("path"===r[e].type)s=Rd(r[e],i,l,h,d);else if("text"===r[e].type)s=Md(r[e],i,l,h,d);else if("image"===r[e].type){let i;i=r[e].jpegBase64?`data:image/jpeg;base64,${r[e].jpegBase64}`:Bd(r[e].RGBABase64,r[e].width,r[e].height);return {type:"incomplete",style:{imageData:i,width:o[2]*this.ratioX,height:o[3]*this.ratioY,annotationRaw:t},transform:g}}s&&a.push(s);}return {type:"incomplete",style:{stampConfig:a,annotationRaw:t},transform:g}}parseUnknown(t){return {type:"unknown",style:{annotationRaw:t}}}}class Xd{constructor(){l(this,"map",new Map),l(this,"ratioX",eo.displayResolution/eo.pdfResolution),l(this,"ratioY",eo.displayResolution/eo.pdfResolution);}async toPdfAnnotations(t,e){const i=[],s=[...t];s.sort(((t,e)=>t.layer-e.layer));for(let t=0;t<s.length;t++){const n=s[t];if(n){const t=await this.toPdfAnnotation(n,{width:e.width/this.ratioX,height:e.height/this.ratioY});t&&(t.oriIndex=n.oriIndex,t.modified=n.modified,i.push(t));}}return i}async toPdfAnnotation(t,e){if("stamp"===t.type&&t.style.imageData&&(!Bs(t.style.width)||!Bs(t.style.height))){const e=new Yn,i=await e.readImageInfo({fileSource:t.style.imageData});let s=i.imageWidth,n=i.imageHeight;if(s>400||n>400){const t=Math.max(s/400,n/400);s/=t,n/=t;}t.style.width=s,t.style.height=n;}const i=this.createShape(t);if(i instanceof Kl&&"freeTextWriter"===i.textType){const{width:t,height:e}=i.getBoundingRect();i.setOrigin(t/2,e/2);}let s=null;switch(t.type){case"rectangle":case"ellipse":s=this.toPdfRectOrEllipse(t,e,i);break;case"polyline":case"polygon":s=this.toPdfPolygonal(t,e,i);break;case"line":s=this.toPdfLine(t,e,i);break;case"ink":s=this.toPdfInk(t,e,i);break;case"stamp":s=await this.toPdfStamp(t,e,i);break;case"textBox":s=this.toPdfFreeText(t,e,i,"textBox");break;case"textTypewriter":s=this.toPdfFreeText(t,e,i,"freeTextWriter");break;case"highlight":s=this.toPdfTextAssist(t,"Highlight",e,i);break;case"underline":s=this.toPdfTextAssist(t,"Underline",e,i);break;case"strikeout":s=this.toPdfTextAssist(t,"StrikeOut",e,i);break;case"incomplete":s=t.style.annotationRaw;}return s&&(s.title=t.comment.author,s.subject=t.comment.subject,s.creationdate=t.comment.creationDate),s}toPdfRectOrEllipse(t,e,i){const{borderColor:s,background:n,lineDash:o}=t.style,{borderWidth:r,opacity:a}=i.parsedStyle,{strokeColor:l,fillColor:h}=ld(s,n),{apStrokeColor:d,apFillColor:c}=hd(s,n,a),u=dd(r,o,this.ratioX),p=u.width,g="rectangle"===t.type?Cd(i,p,this.ratioX,this.ratioY,e.height):function(t,e,i,s){const{x:n,y:o}=t.getLocalPosition();t.path||t.getPath();const{path:r}=t,a=[];for(let t=0;t<r.length;t++){const l=(r[t].x+n)/e,h=s-(r[t].y+o)/i;0===t?(a.push([l,h,2,!1]),a.push([l,h,0,!1])):t===r.length-1?a.push([l,h,1,!0]):a.push([l,h,1,!1]);}return a}(i,this.ratioX,this.ratioY,e.height),f=Ad(i,c,d,a,p,g,this.ratioX);i.path||i.getPath();return {type:"rectangle"===t.type?"Square":"Circle",normalAppearance:f,interiorColor:h,color:l,borderStyle:u,opacity:a,rect:pd(i,i.path,p,this.ratioX,this.ratioY,e.height),flags:bd([...t.flags]),date:t.comment.modificationDate,name:t.uid,contents:""}}toPdfPolygonal(t,e,i){const{borderWidth:s,opacity:n}=i.parsedStyle,{borderColor:o,background:r,lineEnding:a,lineDash:l}=t.style,h="polyline"===t.type,{strokeColor:d,fillColor:c}=ld(o,r),{apStrokeColor:u,apFillColor:p}=hd(o,r,n),g=dd(s,l,this.ratioX),f=g.width;let m,y,v;h?(m=Sd(i,this.ratioX,this.ratioY,e.height),y=m.flat(),v=gd(m[0])):(m=function(t,e,i,s){t.renderPath||t.getPath();const{x:n,y:o}=t.getLocalPosition(),{renderPath:r}=t,a=[];for(let t=0;t<r.length;t++){const l=(r[t].x+n)/e,h=s-(r[t].y+o)/i;if(0!==t){if(t===r.length-1){a.push([l,h,0,!0]);break}a.push([l,h,0,!1]);}else a.push([l,h,2,!1]);}return a}(i,this.ratioX,this.ratioY,e.height),y=m,v=gd(y));const x=Ad(i,p,u,n,f,y,this.ratioX,!h);if(h){const t=[];m.forEach((e=>{t.push(Td(i,e,p,u,f,md(l,this.ratioX)));})),x.objs=t;}const w={type:h?"PolyLine":"Polygon",borderStyle:g,color:d,interiorColor:c,normalAppearance:x,vertices:v,opacity:n,rect:pd(i,i.renderPath,f,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:bd([...t.flags]),date:t.comment.modificationDate};return h&&i.isLineArrow()&&(w.lineEnding=a),w}toPdfLine(t,e,i){const{borderWidth:s,opacity:n}=i.parsedStyle,{borderColor:o,background:r,lineEnding:a,lineDash:l}=t.style,{strokeColor:h,fillColor:d}=ld(o,r),{apStrokeColor:c,apFillColor:u}=hd(o,r,n),p=dd(s,l,this.ratioX),g=p.width,f=Sd(i,this.ratioX,this.ratioY,e.height),m=f.flat(),y=[];f.forEach((t=>{y.push(Td(i,t,u,c,g,md(l,this.ratioX)));}));const v=Ad(i,u,c,n,g,m,this.ratioX,!1);v.objs=y;const x={type:"Line",line:[m[0][0],m[0][1],m[1][0],m[1][1]],interiorColor:d,color:h,normalAppearance:v,borderStyle:p,opacity:n,rect:pd(i,i.renderPath,g,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:bd([...t.flags]),date:t.comment.modificationDate,toJsonString:()=>""};return i.isLineArrow()&&(x.lineEnding=a,x.intent="LineArrow"),x}toPdfInk(t,e,i){const{borderWidth:s,opacity:n}=i.parsedStyle,{borderColor:o,background:r,lineDash:a}=t.style,{strokeColor:l}=ld(o,r),{apStrokeColor:h,apFillColor:d}=hd(o,r,n),c=dd(s,a,this.ratioX),u=c.width,p=function(t,e,i,s){t.inkOriginalRenderPath||t.getInkOriginalRenderPath();const{x:n,y:o}=t.getLocalPosition(),{inkOriginalRenderPath:r}=t,a=[];for(let t=0;t<r.length;t++){const l=r[t],h=[];for(let t=0;t<l.length;t++){const r=(l[t].x+n)/e,a=s-(l[t].y+o)/i;0===t?h.push([r,a,2,!1]):h.push([r,a,1,!1]);}if(h.length&&h.length<4)for(;h.length<4;){const t=h[h.length-1];h.push([...t]);}a.push(h);}return a}(i,this.ratioX,this.ratioY,e.height),g=p.flat(),f=[],{x:m,y:y}=i.getLocalPosition();i.getPath();const{inkRenderSteps:v}=i,x=[];v.forEach((t=>{const i=[];t.forEach(((t,s)=>{if(0===s){const s=(t.data[0].x+m)/this.ratioX,n=e.height-(t.data[0].y+y)/this.ratioY;i.push([s,n,2,!1]);}else t.data.forEach((t=>{const s=(t.x+m)/this.ratioX,n=e.height-(t.y+y)/this.ratioY;i.push([s,n,1,!1]);}));})),x.push(i);})),x.forEach((t=>{f.push(Td(i,t,d,h,u,md(a,this.ratioX)));}));const w=Ad(i,d,h,n,u,g,this.ratioX,!1);w.objs=f;return {type:"Ink",color:l,normalAppearance:w,borderStyle:c,opacity:n,inkList:fd(p),rect:pd(i,i.inkOriginalRenderPath.flat(),u,this.ratioX,this.ratioY,e.height),name:t.uid,contents:"",flags:bd([...t.flags]),date:t.comment.modificationDate}}async toPdfStamp(t,e,i){const{imageData:s,iconName:n,opacity:o}=t.style;if(s){return await this.toPdfStampImage(t,e,i)}const r=i.childNodes,a=Pd(i,this.ratioX,this.ratioY,e.height),l=[],h=[];let d=0,c=0;for(let i=0;i<r.length;i++){let s;const n=r[i].parsedStyle.opacity;if(r[i].style.opacity=n/(t.style.opacity||1),r[i]instanceof Da){const t=xd(r[i]);h.push(...t);const{borderWidth:e,lineDash:n}=r[i].parsedStyle,{borderColor:u,background:p}=r[i].style,{apStrokeColor:g,apFillColor:f}=hd(u,p,o),m=dd(e,n,this.ratioX).width,y=wd(p,a[d]);c=Math.max(m,c),s=Td(r[i],a[d],f,g,m,md(n,this.ratioX)),y&&(s.pattern=y),d+=1,l.push(s);}r[i]instanceof Ta&&(s=kd(r[i],this.ratioX,this.ratioY,e.height),l.push(s));}const u=Ad(i,null,null,o,c,a.flat(),this.ratioX,!1);u.objs=l;return {type:"Stamp",icon:n,rect:pd(i,h,c,this.ratioX,this.ratioY,e.height),normalAppearance:u,opacity:o,name:t.uid,contents:"",flags:bd([...t.flags]),date:t.comment.modificationDate}}async toPdfStampImage(t,e,i){const{imageData:s,opacity:n}=t.style;let o=s,r=[];Ls(s)&&(r=s.split(","),r[0].match(/:(.*?);/)[1],o=function(t){let e=null;const i=t.split(","),s=i[0].match(/:(.*?);/)[1],n=window.atob(i[1]);let o=n.length;const r=new Uint8Array(o);for(;o--;)r[o]=n.charCodeAt(o);return e=new Blob([r],{type:s}),e}(s));const{width:a,height:l}=i.parsedStyle,h=cd(i),d=[0,0,a.value/this.ratioX,l.value/this.ratioY],c=await async function(t,e,i,s){const{width:n,height:o}=t.parsedStyle,r=n.value/i,a=o.value/s;let l;if("image/jpeg"===e.type){const t=new Yn,i=await t.readImage({source:{fileSource:e},outputType:1,returnBase64:!0});t.destroy(),l={type:"image",jpegBase64:i.imageData,objMatrix:[r,0,0,a,0,0],rect:[0,0,r,a]};}else {const t=new Yn,i=await t.readImage({source:{fileSource:e},outputType:-2,returnBase64:!0});t.destroy(),l={type:"image",RGBABase64:i.imageData,height:i.imageHeight,width:i.imageWidth,objMatrix:[r,0,0,a,0,0],rect:[0,0,r,a]};}return l}(i,o,this.ratioX,this.ratioY),u=function(t,e,i,s){const{width:n,height:o}=t.parsedStyle,{x:r,y:a}=t.getLocalScale(),{x:l,y:h}=t.getLocalPosition(),d=t.getAngle(),c=l+n.value/2,u=h+o.value/2,p=n.value*r*.5,g=s*i-o.value*a*.5-u;let f=new Aa({style:{x:c-p,y:s*i-o.value*a-g,width:n.value*r,height:o.value*a}});f.setAngle(d),f.getPath();const m=pd(f,f.path,0,e,i,s);return f=null,m}(i,this.ratioX,this.ratioY,e.height);return {type:"Stamp",normalAppearance:{bbox:d,matrix:h,objs:[c],transform:h},rect:u,opacity:n,name:t.uid,contents:"",flags:bd([...t.flags]),date:t.comment.modificationDate}}toPdfFreeText(t,e,i,s){const{opacity:n,textContents:o,borderColor:r,background:a,lineDash:l,textAlign:h}=t.style;"freeTextWriter"===s&&(i.style.borderWidth=0);const{borderWidth:d}=i.parsedStyle,{strokeColor:c,fillColor:u}=ld(r,a),{apStrokeColor:p,apFillColor:g}=hd(r,a,n),f="textBox"===s?dd(d,l,this.ratioX):{width:0},m=f.width,y=Ad(i,g,p,n,m,Cd(i,m,this.ratioX,this.ratioY,e.height),this.ratioX,"textBox"===s),v=function(t,e,i,s){const{lines:n}=t,{opacity:o}=t.parsedStyle,r=[],a=(t,e,i)=>({type:"path",strokeColor:t,fillColor:t,fillType:0,isStroke:!0,lineCap:0,lineJoin:0,miterLimit:10,lineWidth:i,objMatrix:[1,0,0,1,0,0],segments:e,dashArray:[],dashPhase:0});return n.forEach((n=>{const l=n.height/30,h=t.getTextAlignOffset(n);n.words.forEach((t=>{const{fontFamily:d,fontSize:c,fontStyle:u,fontWeight:p,color:g,underline:f,lineThrough:m}=t.style,y=ad(g,1,!1),v=y?[...y,255*o]:[0,0,0,255],x=(t.x+h)/e,w=s-n.y/i,b={type:"text",charSpace:0,wordSpace:0,renderMode:0,fontPitchFamily:0,strokeColor:[0,0,0,255],fillColor:v,fontName:d,fontIsBold:Ed(p),fontIsItalic:"italic"===u,fontSize:c.value/e,text:(C=t.text,C.replace(/\r?\n$/,"")),objMatrix:[1,0,0,1,x,w],position:[x,w]};var C;if(r.push(b),f){const o=s-(n.y+l)/i,h=a(v,[[x,o,2,!1],[x+t.widthWithoutLf/e,o,0,!1]],l/i);r.push(h);}if(m){const o=s-(n.y-t.wordHeight/3)/i,h=a(v,[[x,o,2,!1],[x+t.widthWithoutLf/e,o,0,!1]],l/i);r.push(h);}}));})),r}(i,this.ratioX,this.ratioY,e.height);"textBox"===s?y.objs.push(...v):y.objs=v;const{defaultAppearance:x,defaultAppearanceData:w,defaultStyle:b}=function(t,e,i,s,n){const o=i[0]||{color:"rgb(0,0,0)",fontFamily:"Times Roman",fontStyle:"normal",fontWeight:"normal",fontSize:"12px"},{fontFamily:r,fontSize:a,fontStyle:l,fontWeight:h,color:d}=o,c=ad(d,1,!1),u=gr(`rgb(${c[0]}, ${c[1]}, ${c[2]})`),p=rr(a).value/n,g=Id(r," ","");return {defaultAppearance:"textBox"===t?`${e[0]/255} ${e[1]/255} ${e[2]/255} rg /${g} ${p} Tf`:`${c[0]/255} ${c[1]/255} ${c[2]/255} rg /${g} ${p} Tf`,defaultStyle:`font:${"bold"===h?"bold":""} ${"italic"===l?"italic":""} '${r}' ${p}pt; text-align:${"justify"===s?"justify-center":s}; color:${u.toLocaleUpperCase()}`,defaultAppearanceData:{fontColor:c,fontSize:p,fontName:r}}}(s,c||[0,0,0],o,"freeTextWriter"===s?"left":h,this.ratioX);i.getPath();const C=pd(i,i.path,m,this.ratioX,this.ratioY,e.height);let S="";o.forEach((t=>{S+=t.content;}));const P=function(t,e,i){if(!t||!t.length)return null;const s=document.implementation.createDocument(null,"body",null),n=s.documentElement;n.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),n.setAttribute("xmlns:xfa","http://www.xfa.org/schema/xfa-data/1.0/"),n.setAttribute("xfa:APIVersion","Acrobat:18.11.0"),n.setAttribute("xfa:spec","2.0.2");const o=t=>`font-size:${rr(t).value/i}pt;`,r=t=>`font-weight:${"bold"===t?"bold":"normal"};`,a=t=>`font-style:${"italic"===t?"italic":"normal"};`,l=t=>`color:${gr(mr(t).formatted)};`,h=t=>`font-family:'${t}';`,d=t[0],{fontFamily:c,fontSize:u,fontStyle:p,fontWeight:g,color:f}=d,m=mr(f),y=`${o(u)}text-align:${"justify"===e?"justify-center":e};${l(m.formatted)}${r(g)}${a(p)}${h(c)}font-stretch:normal;`;n.setAttribute("style",y);const v=s.createElement("p");v.setAttribute("dir","ltr"),t.forEach((t=>{if(!t.content.length)return;const e=s.createElement("span"),i=s.createTextNode(t.content);e.appendChild(i);let n="";c!==t.fontFamily&&(n+=h(t.fontFamily)),u!==t.fontSize&&(n+=o(t.fontSize)),p!==t.fontStyle&&(n+=a(t.fontStyle)),g!==t.fontWeight&&(n+=r(t.fontWeight)),f!==t.color&&(n+=l(t.color)),(t.lineThrough||t.underline)&&(n+=`text-decoration:${t.underline?"word":""} ${t.lineThrough?"line-through":""}`),n&&e.setAttribute("style",n),v.appendChild(e);})),n.appendChild(v);const x=`<?xml version="1.0"?>${(new XMLSerializer).serializeToString(s)}`,w='xmlns="http://www.w3.org/1999/xhtml"';return x.includes(w)?Id(x,'xmlns=""',w):Id(x.replace(/<body/,`<body ${w}`),'xmlns=""',w)}(o,h,this.ratioX),A={borderStyle:f,type:"FreeText",color:u,normalAppearance:y,defaultAppearance:x,defaultAppearanceData:w,defaultStyle:b,rect:C,name:t.uid,contents:S,opacity:n,flags:bd([...t.flags]),date:t.comment.modificationDate};return "freeTextWriter"===s&&(A.intent="FreeTextTypeWriter"),P&&(A.richText=P),A}toPdfTextAssist(t,e,i,s){if(t.style.annotationRaw)return t.style.annotationRaw;const{opacity:n}=t.style,o=s.childNodes,r=Pd(s,this.ratioX,this.ratioY,i.height),a=[],l=[];for(let t=0;t<o.length;t++){const e=xd(o[t]);l.push(...e);const{borderWidth:i,lineDash:s}=o[t].parsedStyle,{borderColor:h,background:d}=o[t].style,{apStrokeColor:c,apFillColor:u}=hd(h,d,n),p=dd(i,s,this.ratioX).width,g=Td(o[t],r[t],u,c,p,md(s,this.ratioX));a.push(g);}const h=Ad(s,null,null,n,0,r.flat(),this.ratioX,!1);h.objs=a;const d=pd(s,l,0,this.ratioX,this.ratioY,i.height),c=[];r.forEach((t=>{const e=[];t.forEach((t=>{e.push({x:t[0],y:t[1]});}));const i=Xr(e),{left:s,bottom:n,top:o,right:r}=i;c.push([s,n,r,n,s,o,r,o]);}));return {type:e,rect:d,normalAppearance:h,opacity:n,quadPoints:c,name:t.uid,flags:bd([...t.flags]),date:t.comment.modificationDate}}createShape(t){const{type:e,transform:i,style:s}=As(t),n={id:t.uid,style:s,transform:i};let o;switch("ellipse"===e&&(s.x+=s.width/2||0,s.y+=s.height/2||0,s.rx=s.width/2||s.rx,s.ry=s.height/2||s.ry),e){case"rectangle":o=new Jl(n);break;case"ellipse":o=new Gl(n);break;case"line":o=new oh(n);break;case"ink":o=new Yl(n);break;case"polygon":o=new sh(n);break;case"polyline":o=new nh(n);break;case"textTypewriter":o=new Kl(n,"freeTextWriter",{},!1);break;case"textBox":o=new Kl(n,"textBox");break;case"stamp":o=new vh(n);break;case"highlight":o=new bh(n,wh.HIGHLIGHT);break;case"underline":o=new bh(n,wh.UNDERLINE);break;case"strikeout":o=new bh(n,wh.STRIKEOUT);}return o}}class Yd{constructor(){l(this,"annotationParser",new Gd),l(this,"annotationWriter",new Xd);}getParsedAnnotations(t,e,i){const s=eo.displayResolution/eo.pdfResolution;t=t.filter((t=>null!==t)),this.annotationParser.setParserConfig(e,i,s,s),this.moveReplyToAnnotation(t);const n=[];return t.forEach((t=>{if(t){const i=this.annotationParser.parseAnnotation(t);if(i){var e;i.flags=this.parseFlags(t.flags||[]);const s=this.parseReply(t);null!==(e=t.replies)&&void 0!==e&&e.length&&(s.replies=t.replies.map((t=>this.parseReply(t)))||[]),i.comment=s,n.push(i);}}})),n}moveReplyToAnnotation(t){t.forEach((e=>{if(e&&"Text"===e.type&&!Ts(e.inreplyto)){const i=t[e.inreplyto];"Review"===e.statemodel?(i.reviewStates||(i.reviewStates=[]),i.reviewStates.push(e)):"Marked"===e.statemodel?(i.markedStates||(i.markedStates=[]),i.markedStates.push(e)):(i.replies||(i.replies=[]),i.replies.push(e));}})),t.slice().forEach((e=>{if(!e||"Popup"===e.type||!Ts(e.inreplyto)){const i=t.findIndex((t=>t===e));t.splice(i,1);}}));}parseReply(t){var e,i;const s=this.parseCommon(t);return s.subject=t.subject,null!==(e=t.reviewStates)&&void 0!==e&&e.length&&(s.reviewStates=t.reviewStates.map((t=>this.parseState(t)))),null!==(i=t.markedStates)&&void 0!==i&&i.length&&(s.markedStates=t.markedStates.map((t=>this.parseState(t)))),s}parseFlags(t){const e=[],i={readonly:"readOnly",noview:"noView"};return t.forEach((t=>{e.push(i[t]||t);})),e}parseState(t){return {...this.parseCommon(t),state:t.state,stateModel:t.statemodel}}parseCommon(t){const e=t.creationdate,i=t.date;return {uid:_s(),author:t.title,contents:t.contents,type:t.type,creationDate:e||i,modifiedDate:i||e,flags:t.flags?[...t.flags]:[]}}parseDate(t){if(!t)return;let e=2;if(!t)return "";const i=[4,2,2,2,2,2].map((i=>{const s=t.slice(e,e+i);return e+=i,parseInt(s,10)}));i[1]-=1;const s=new Date(...i).getTime();return ks("yyyy.MM.dd hh:mm:ss",s)}async getOriginalAnnotations(t,e){return await this.annotationWriter.toPdfAnnotations(t,e)}}function Jd(t){return {left:t[0],top:t[1],width:t[2]-t[0],height:t[3]-t[1]}}!function(t){t.CM_RENDERALL="cm/renderall",t.CM_IMAGEONLY="cm/imageonly",t.CM_AUTO="cm/auto";}(Uh||(Uh={})),function(t){t.NO_ANNOTATIONS="noAnnotations",t.RENDER_ANNOTATIONS="renderAnnotations",t.LOAD_ANNOTATIONS="loadAnnotations";}(Oh||(Oh={}));var qd=new WeakSet;class Zd{constructor(){a(this,qd),l(this,"type","pdfParser"),l(this,"once",!1),l(this,"pdfReader",void 0),l(this,"parserOptions",{convertMode:Uh.CM_AUTO}),l(this,"source",void 0),l(this,"isDestroy",!1),l(this,"annotationMapper",void 0),this.pdfReader=new qn,this.annotationMapper=new Yd;}initParser(t,e){this.parserOptions=null!=e?e:{convertMode:Uh.CM_AUTO},this.source={fileSource:t,password:this.parserOptions.password};}async getPageCount(){return this.pdfReader.getPdfPageCount(this.source,e(qd,this,Qd).call(this))}destroy(){var t;null===(t=this.pdfReader)||void 0===t||t.destroy(),this.pdfReader=null,this.isDestroy=!0;}async parse(t){if(this.isDestroy||!this.source)return null;const i=[],s=await this.pdfReader.readPageImageInfos({source:this.source,indices:(null==t?void 0:t.slice())||[],readOptions:e(qd,this,Qd).call(this),outputType:Fn.IT_JPG,isInfoOnly:!1,returnBase64:!1}),{displayResolution:n,pdfResolution:o}=eo;for(let t=0;t<s.length;++t){var r,a,l;const e=s[t],h=1===e.realReadMode,d=h?Jd(e.mediaBox):{left:0,top:0,width:e.imageWidth/e.imageXResolution*o,height:e.imageHeight/e.imageYResolution*o},c=h?Jd([e.cropBox[0],e.mediaBox[1]+e.mediaBox[3]-e.cropBox[3],e.cropBox[2],e.mediaBox[1]+e.mediaBox[3]-e.cropBox[1]]):{...d},u={fileIndex:e.pageIndex,rotation:e.rotation,mediaBox:Cn(d,o,n),cropBox:Cn(c,o,n),resource:{width:e.imageWidth,height:e.imageHeight,resolutionX:e.imageXResolution,resolutionY:e.imageYResolution,bitDepth:e.imageBitDepth},pdfOptions:{convertMode:h?Uh.CM_RENDERALL:Uh.CM_IMAGEONLY,renderOptions:{renderAnnotations:null===(r=this.parserOptions.renderOptions)||void 0===r?void 0:r.renderAnnotations,renderGrayscale:null===(a=this.parserOptions.renderOptions)||void 0===a?void 0:a.renderGrayscale}},annotations:[]};if(h&&(null===(l=this.parserOptions.renderOptions)||void 0===l?void 0:l.renderAnnotations)===Oh.LOAD_ANNOTATIONS){const t=await this.pdfReader.readAnnotations(this.source,u.fileIndex);t.length&&(u.annotations=this.annotationMapper.getParsedAnnotations(t,2*d.left+d.width,2*d.top+d.height));}i.push(u);}return i}async getPage(t){if(this.isDestroy||!this.source)return null;const i=await this.pdfReader.readPage({source:this.source,index:t,readOptions:e(qd,this,Qd).call(this),outputType:Fn.IT_JPG,isInfoOnly:!1,returnBase64:!1});if(i){const{displayResolution:t,pdfResolution:e}=eo,s=i.imageInfos[0];return {fileIndex:i.pageIndex,rotation:i.rotation,mediaBox:Cn(Jd(i.mediaBox),e,t),cropBox:Cn(Jd(i.cropBox),e,t),resource:{data:i.imageData,width:s.imageWidth,height:s.imageHeight,resolutionX:s.imageXResolution,resolutionY:s.imageYResolution,bitDepth:s.imageBitDepth}}}return null}cancelGetPage(t){!this.isDestroy&&this.source&&this.pdfReader.cancelReadPage(this.source,t);}}function Qd(){var t,e;if(this.isDestroy)return null;if(!this.parserOptions)return null;const i={[Oh.NO_ANNOTATIONS]:0,[Oh.RENDER_ANNOTATIONS]:1,[Oh.LOAD_ANNOTATIONS]:2};return {convertMode:{[Uh.CM_IMAGEONLY]:2,[Uh.CM_RENDERALL]:1,[Uh.CM_AUTO]:3}[(null===(t=this.parserOptions)||void 0===t?void 0:t.convertMode)||Uh.CM_AUTO],renderOptions:{...this.parserOptions.renderOptions||{},renderAnnotations:i[null===(e=this.parserOptions.renderOptions)||void 0===e?void 0:e.renderAnnotations]||0,renderIgnoreCrop:!0}}}class Kd{constructor(){l(this,"type","rgbaParser"),l(this,"once",!1),l(this,"processor",void 0),l(this,"cachePage",[]),l(this,"source",void 0),l(this,"parserOptions",void 0),this.processor=new Xn;}initParser(t,e){this.source=t,this.parserOptions=e;}async getPageCount(){return 1}destroy(){var t;null===(t=this.processor)||void 0===t||t.terminate(),this.processor=void 0;}async parse(){var t;const{outputType:e,jpegQuality:i,returnBase64:s,width:n,height:o,bitDepth:r,xResolution:a,yResolution:l}=null!==(t=this.parserOptions)&&void 0!==t?t:{},h=await this.source.arrayBuffer();await this.processor.initImage({source:h,isRGBA:!0,width:n,height:o,isBGRA:!1});const d=await this.processor.getImage({jpegQuality:i,ifDeleteObject:!0,isRGBA:!0,bitDepth:r,xDpi:a,yDpi:l,returnBlob:!0,returnType:e}),c=nd(d);return d.srcBuffer,this.cachePage=[c],this.cachePage}async getPage(){return Promise.resolve(this.cachePage[0])}cancelGetPage(t){}}class tc{constructor(){l(this,"db",void 0),this.db=new Map;}saveByMime(t,e){this.db.set(t,e);}hasByMime(t){return this.db.has(t)}deleteConstructorByMime(t){return !!this.hasByMime(t)&&(this.db.delete(t),!0)}getConstructorByMime(t){return this.db.get(t)}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear();}}const ec=new class{constructor(){l(this,"db",void 0),this.db=new Map;}saveByFileUid(t,e){this.db.set(t,e);}getParserByFileUid(t){return this.db.get(t)}deleteParserByFileUid(t){return this.db.delete(t)}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear();}getAllParsers(){return Array.from(this.db.values())}},ic=new tc,sc=new tc,nc=new class{constructor(){l(this,"db",void 0),this.db=new Map;}getDefaultOptionsByMime(t){return this.db.get(t)}deleteDefaultOptionsByMime(t){return this.db.delete(t)}saveDefaultOptionsByMime(t,e){this.db.set(t,e);}has(t){throw new Error("Method not implemented.")}save(t){throw new Error("Method not implemented.")}clear(){this.db.clear();}};const oc=new class{constructor(t,e,i){l(this,"parserRepo",void 0),l(this,"parserConstructorRepo",void 0),l(this,"customParserConstructorRepo",void 0),this.parserRepo=t,this.parserConstructorRepo=e,this.customParserConstructorRepo=i;}getParser(t,e){let i=this.parserRepo.getParserByFileUid(t);if(i)return i;return i=new(this.customParserConstructorRepo.getConstructorByMime(e)||this.parserConstructorRepo.getConstructorByMime(e)),i.once||this.parserRepo.saveByFileUid(t,i),i}}(ec,ic,sc);const rc=new class{constructor(t){l(this,"parserRepo",void 0),this.parserRepo=t;}execute(t){let{fileIndex:e,fileUid:i}=t;const s=this.parserRepo.getParserByFileUid(i);s&&s.cancelGetPage(e);}}(ec),ac=new class{constructor(t){l(this,"parserRepo",void 0),this.parserRepo=t;}execute(t){const e=this.parserRepo.getParserByFileUid(t);e&&(e.destroy(),this.parserRepo.deleteParserByFileUid(t));}}(ec),lc=new class{constructor(t,e){l(this,"parserService",void 0),l(this,"parserRepo",void 0),this.parserService=t,this.parserRepo=e;}async execute(t){const{fileData:e,mime:i,fileUid:s,fileIndex:n}=t;let o=this.parserRepo.getParserByFileUid(s);return o||(o=this.parserService.getParser(s,i),o.initParser(e)),o.getPage(n)}}(oc,ec),hc=new class{constructor(t,e){l(this,"parserService",void 0),l(this,"defaultParserOptionsRepo",void 0),this.parserService=t,this.defaultParserOptionsRepo=e;}async execute(t){const{fileData:e,mime:i,fileUid:s,indices:n}=t;let{parseOptions:o}=t;o=o||this.defaultParserOptionsRepo.getDefaultOptionsByMime(i);const r=this.parserService.getParser(s,i);return r.initParser(e,o),r.parse(n)}}(oc,nc),dc=new class{constructor(t){l(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=t;}execute(t){let{mime:e,parser:i}=t;this.parserConstructorRepo.saveByMime(e,i);}}(ic),cc=new class{constructor(t){l(this,"parserConstructorRepo",void 0),this.parserConstructorRepo=t;}execute(t){this.parserConstructorRepo.deleteConstructorByMime(t);}}(sc),uc=new class{constructor(t){l(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t;}execute(t){let{mime:e,parser:i}=t;this.customParserConstructorRepo.saveByMime(e,i);}}(ic),pc=new class{constructor(t){l(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t;}execute(t){this.customParserConstructorRepo.deleteConstructorByMime(t);}}(sc),gc=new class{constructor(t){l(this,"defaultParserOptionsRepo",void 0),this.defaultParserOptionsRepo=t;}execute(t){return this.defaultParserOptionsRepo.getDefaultOptionsByMime(t)}}(nc),fc=new class{constructor(t,e,i){l(this,"defaultParserOptionsRepo",void 0),l(this,"parserConstructorRepo",void 0),l(this,"customParserConstructorRepo",void 0),this.defaultParserOptionsRepo=t,this.parserConstructorRepo=e,this.customParserConstructorRepo=i;}execute(t){let{mime:e,options:i}=t;return !(!i||!Ps(i)||!this.customParserConstructorRepo.hasByMime(e)&&!this.parserConstructorRepo.hasByMime(e))&&(this.defaultParserOptionsRepo.saveDefaultOptionsByMime(e,As(i)),!0)}}(nc,ic,sc),mc=new class{constructor(t){l(this,"customParserConstructorRepo",void 0),this.customParserConstructorRepo=t;}execute(t){return this.customParserConstructorRepo.getConstructorByMime(t)}}(sc),yc=new class{constructor(t,e){l(this,"parserService",void 0),l(this,"defaultParserOptionsRepo",void 0),this.parserService=t,this.defaultParserOptionsRepo=e;}async execute(t){var e,i;let{fileData:s,mime:n,fileUid:o,options:r}=t;r=r||this.defaultParserOptionsRepo.getDefaultOptionsByMime(n);const a=this.parserService.getParser(o,n);a.initParser(s,r);return {pageCount:await a.getPageCount(),batchSize:null!==(e=null===(i=r)||void 0===i?void 0:i.batchSize)&&void 0!==e?e:0}}}(oc,nc);class vc{constructor(){l(this,"type",void 0),l(this,"once",!1),l(this,"cachedPage",void 0),l(this,"parserOptions",void 0);}initParser(t,e){this.parserOptions=e;}async getPageCount(){return Promise.resolve(1)}destroy(){}async parse(){const{width:t,height:e,bitDepth:i,resolutionX:s,resolutionY:n}=this.parserOptions,o=nd({imageBitDepth:i,imageHeight:e,imageWidth:t,imageXResolution:s,imageYResolution:n});return this.cachedPage=o,[this.cachedPage]}async getPage(){const t=await this.createBlankPage(this.parserOptions.width,this.parserOptions.height);return this.cachedPage.resource.data=t,this.cachedPage}cancelGetPage(){}async createBlankPage(t,e){var i,s,n;const o=new Uint8Array([255,255,255,255]),r=new Xn;await r.initImage({source:o,isRGBA:!0,width:1,height:1,isBGRA:!1}),await r.resize(t,e);const a=await r.getImage({jpegQuality:null!==(i=this.parserOptions.jpegQuality)&&void 0!==i?i:80,ifDeleteObject:!0,isRGBA:!0,bitDepth:24,xDpi:null!==(s=this.parserOptions.resolutionX)&&void 0!==s?s:96,yDpi:null!==(n=this.parserOptions.resolutionY)&&void 0!==n?n:96,returnBlob:!1,returnType:Kn[Wn.JPEG]});return new Blob([a.imageData],{type:a.blobType})}}var xc;!function(t){t.GOOD="Good",t.AUTO_CAPTURE="AutoCaptured",t.SMALL_SIZE="SmallSize",t.OFF_CENTER="OffCenter",t.SKEW="Skew",t.NOTHING_DETECTED="NothingDetected";}(xc||(xc={}));var wc,bc=new WeakSet;class Cc{constructor(){a(this,bc),l(this,"detector",void 0),l(this,"succeedDetect",0),l(this,"failedDetect",0),l(this,"autoCaptureStartTime",0),this.succeedDetect=0,this.failedDetect=0;}destroy(){this.clear();}clear(){var t;null===(t=this.detector)||void 0===t||t.terminate(),this.detector=void 0;}async detect(t,e){return Promise.resolve({success:!1})}getStatusMsg(t){switch(t){case xc.AUTO_CAPTURE:return "Auto capture completed.";case xc.GOOD:return "Capturing your document... Please do not move the camera.";case xc.SMALL_SIZE:return "The document is too small. Try moving closer.";case xc.OFF_CENTER:return "Try holding the device at the center of the document.";case xc.SKEW:return "Please hold the device over a document to start scanning.";case xc.NOTHING_DETECTED:return "No document is detected."}}processDetectResult(t){if([].concat(...t.location).every((t=>0===t)))return {success:!1,confidence:0,status:xc.NOTHING_DETECTED};let e;const i=this.calculateConfidence(t.location,t.width,t.height);e=Ts(t.confidence)?this.calculateTotalConfidence(i):t.confidence;const s={success:!0,location:t.location,confidence:e},{angleConfidence:n,areaConfidence:o,centerConfidence:r}=i,{config:a}=t;if(e>=(null==a?void 0:a.acceptedPolygonConfidence))if(this.succeedDetect+=1,s.status=xc.GOOD,this.succeedDetect,5===this.succeedDetect||this.succeedDetect,null!=a&&a.enableAutoCapture)if(this.autoCaptureStartTime<=0)this.autoCaptureStartTime=(new Date).getTime();else {(new Date).getTime()-this.autoCaptureStartTime>a.autoCaptureDelay&&(this.autoCaptureStartTime=0,s.status=xc.AUTO_CAPTURE);}else this.autoCaptureStartTime=0;else .45*n+.45*r+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),s.status=xc.SMALL_SIZE):.45*n+.45*o+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),s.status=xc.OFF_CENTER):.45*o+.45*r+10>=(null==a?void 0:a.acceptedPolygonConfidence)?(this.reset(),s.status=xc.SKEW):(s.success=!1,s.status=xc.NOTHING_DETECTED,this.failedDetect+=1,this.autoCaptureStartTime=0);return this.failedDetect>5&&this.reset(),s.statusMsg=this.getStatusMsg(s.status),s}calculateConfidence(t,i,s){return e(bc,this,Pc).call(this,e(bc,this,Sc).call(this,t),i,s)}calculateTotalConfidence(t){const{angleConfidence:e,areaConfidence:i,centerConfidence:s}=t;return e&&i&&s?.3*e+.3*i+.3*s+10:0}reset(){this.succeedDetect=0,this.failedDetect=0,this.autoCaptureStartTime=0;}}function Sc(t){if(!t)return [0,0,0,0,0,0,0,0];return [t[0][0],t[0][1],t[1][0],t[1][1],t[2][0],t[2][1],t[3][0],t[3][1]]}function Pc(t,i,s){return {angleConfidence:e(bc,this,Ac).call(this,t),areaConfidence:e(bc,this,Tc).call(this,t,i,s),centerConfidence:e(bc,this,kc).call(this,t,i,s)}}function Ac(t){let i=0;const s=e(bc,this,Ec).call(this,[t[0],t[1]],[t[2],t[3]],[t[4],t[5]]),n=e(bc,this,Ec).call(this,[t[2],t[3]],[t[4],t[5]],[t[6],t[7]]),o=e(bc,this,Ec).call(this,[t[4],t[5]],[t[6],t[7]],[t[0],t[1]]),r=e(bc,this,Ec).call(this,[t[6],t[7]],[t[0],t[1]],[t[2],t[3]]);return i+=Math.abs(s-90),i+=Math.abs(n-90),i+=Math.abs(o-90),i+=Math.abs(r-90),Math.max(0,100*Math.min(1,1-.025*i))}function Tc(t,i,s){const n=e(bc,this,Rc).call(this,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]);return Math.min(100,400*Math.max(0,n/(i*s)))}function kc(t,i,s){const n=[(t[0]+t[2]+t[4]+t[6])/4,(t[1]+t[3]+t[5]+t[7])/4],o=e(bc,this,Dc).call(this,n,[i/2,s/2]);return Math.max(0,100*Math.min(1,1-o/Math.min(i,s)))}function Dc(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function Ec(t,i,s){const n=e(bc,this,Dc).call(this,i,t),o=e(bc,this,Dc).call(this,i,s),r=e(bc,this,Dc).call(this,t,s);return 0===n||0===o?0:Math.acos((n*n+o*o-r*r)/(2*n*o))/Math.PI*180}function Ic(t,e,i,s,n,o){return (t*s+e*n+i*o-n*s-o*t-i*e)/2}function Rc(t,i,s,n,o,r,a,l){return e(bc,this,Ic).call(this,t,i,s,n,o,r)+e(bc,this,Ic).call(this,t,i,o,r,a,l)}!function(t){t.NONE="none",t.BLACK_AND_WHITE="blackAndWhite",t.GRAY="gray",t.REMOVE_SHADOW="removeShadow",t.SAVE_INK="saveInk",t.ENHANCE="enhance",t.INVERT="invert",t.BRIGHTNESS="brightness",t.CONTRAST="contrast",t.BRIGHTNESS_AND_CONTRAST="brightnessAndContrast";}(wc||(wc={}));var Mc=new WeakMap,Bc=new WeakMap,Lc=new WeakSet;async function Uc(t,e,i,s){var n;return await(null===(n=this.filter)||void 0===n?void 0:n.applyFilter(t,e))}function Oc(t){return s(Mc,this).push(t),s(Bc,this)||(o(Bc,this,!0),e(Lc,this,_c).call(this)),t.promise}async function _c(){do{if(s(Mc,this).isEmpty())break;const t=s(Mc,this).pop();try{let i;if("filter"===(null==t?void 0:t.api))i=await e(Lc,this,Uc).apply(this,t.params);null==t||t.resolve(i);}catch(e){t.retry<1?(t.retry+=1,s(Mc,this).push(t)):null==t||t.reject(e);}}while(!s(Mc,this).isEmpty());o(Bc,this,!1);}const Nc=new Map([[wc.NONE,"None"],[wc.BLACK_AND_WHITE,"toBW"],[wc.GRAY,"toGray"],[wc.REMOVE_SHADOW,"removeShadow"],[wc.SAVE_INK,"toBW"],[wc.ENHANCE,"enhance"],[wc.INVERT,"invert"],[wc.CONTRAST,"brightnessAndContrast"],[wc.BRIGHTNESS,"brightnessAndContrast"],[wc.BRIGHTNESS_AND_CONTRAST,"brightnessAndContrast"]]);var Wc,Fc=new WeakSet;function Hc(t,e){const i={...e||{}};return t===wc.SAVE_INK&&(i.method="adaptiveThreshold"),i}function Vc(t){var e,i;(t.returnType=Kn[t.outputType],t.bRGBA=t.outputType===Wn.RGBA,t.returnBlob=null!==(e=t.returnBlob)&&void 0!==e&&e,t.bRGBA&&void 0===t.returnType)?t.returnType=Fn.IT_JPG:t.returnType=null!==(i=t.returnType)&&void 0!==i?i:Fn.IT_ALL;return t.is1BitTo8Bit=Mn.isApple,t}class zc{static replaceMessage(t,e,i){let s=t;return e&&(s=s.replace("<%api%>",e)),i&&(s=s.replace("<%param%>",i)),s}static getLastError(){return this.lastError}static clearLastError(){this.lastError=null;}static buildError(t,e,i){if(t&&!t.code&&t.cause&&t.cause.code&&t.cause.message)return Ls(t.message)&&(t.message=this.replaceMessage(t.message,e,i)),t;const s={code:t.code,message:t.message};null!=t&&t.details&&(s.details=t.details);let n={...t};return s.code>-8e4&&0!==s.code?s.code<=-2e4||(s.code=zc.WASM_ERR.code,s.message=zc.WASM_ERR.message,n.actualCode=n.code,n.code=s.code):s.code?(s.message=this.replaceMessage(s.message,e,i),n={...s},Array.isArray(s.details)&&0!==s.details.length&&(n.details=s.details)):(s.code=zc.EXTERNAL_ERR.code,s.message=zc.EXTERNAL_ERR.message,n.actualCode=t.code,n.message=t.message,t.name&&(n.name=t.name),t.stack&&(n.stack=t.stack),n.code=s.code,n.actualError=t),new Error(s.message,{cause:n})}static warning(t,e,i){const s=zc.buildError(t,e,i);this.lastError=s,this.onWarning.emit(s);}static error(t,e,i){const s=zc.buildError(t,e,i);throw this.lastError=s,this.onError.emit(s),s}static verbose(t,e,i){this.onVerbose.emit(t);}static throw(t,e,i){const s=zc.buildError(t,e,i);throw this.lastError=s,this.onError.emit(s),s}static reject(t,e,i){const s=zc.buildError(t,e,i);return this.lastError=s,this.onError.emit(s),Promise.reject(s)}static on(t,e){"error"===t?this.onError.on(e):"verbose"===t?(this.onVerbose.on(e),0===this.verboseListenerCount&&(Mn.enableDebugOutput(!0,(t=>{this.verbose(t);})),this.verboseListenerCount+=1)):"warning"===t&&this.onWarning.on(e);}static off(t,e){"error"===t?this.onError.off(e):"verbose"===t?(this.onVerbose.off(e),this.verboseListenerCount-=1,0===this.verboseListenerCount&&Mn.enableDebugOutput(!1,void 0)):"warning"===t&&this.onWarning.off(e);}}function jc(t,e,i,s){return e?i?`${e}${s?"":"."}${i}`:`${e}`:i?`${t}${s?"":"."}${i}`:`${t}`}l(zc,"onError",new Vs),l(zc,"onWarning",new Vs),l(zc,"onVerbose",new Vs),l(zc,"verboseListenerCount",0),l(zc,"lastError",void 0),l(zc,"LIC_EMPTY",{code:-8e4,message:"No license."}),l(zc,"LIC_INVALID",{code:-80001,message:"License string is invalid."}),l(zc,"LIC_EXPIRED",{code:-80002,message:"XXX module license has expired."}),l(zc,"LIC_MISS_MODULE",{code:-80003,message:"XXX module license is missing."}),l(zc,"LIC_VER_NOT_MATCHED",{code:-80004,message:"XXX module license version does not match."}),l(zc,"LIC_DOMAIN_NOT_MATCHED",{code:-80005,message:"Domain does not match the domain bound to the XXX module license."}),l(zc,"INIT_SHOULD_SET_CONFIG",{code:-80050,message:"DDV.Core.init() has not been set up yet."}),l(zc,"INIT_CONFIG_NOT_DONE",{code:-80051,message:"DDV.Core.init() has not been completed."}),l(zc,"RESOURCE_NOT_FOUND",{code:-80052,message:"<%api%>: Resource is not found from the specified engineResourcePath."}),l(zc,"WASM_ERR",{code:-81e3,message:"WASM Error"}),l(zc,"PARAM_INVALID",{code:-80100,message:"<%api%>: '<%param%>' is invalid."}),l(zc,"PARAM_OUT_OF_RANGE",{code:-80101,message:"<%api%>: '<%param%>' is out of range."}),l(zc,"PARAM_MISS",{code:-80102,message:"<%api%>: '<%param%>' is missing."}),l(zc,"PARAM_NOT_SUPPORT",{code:-80103,message:"<%api%>: The value for '<%param%>' is not supported."}),l(zc,"DOC_NOT_EXIST",{code:-80104,message:"<%api%>: The specified document(s) do not exist."}),l(zc,"PAGE_NOT_EXIST",{code:-80105,message:"<%api%>: The specified page(s) do not exist."}),l(zc,"ANNOTATION_NOT_EXIST",{code:-80106,message:"<%api%>: The specified annotation does not exist."}),l(zc,"FILE_NOT_SUPPORT",{code:-80200,message:"File type is not supported."}),l(zc,"DOC_UID_DUPLICATE",{code:-80201,message:"DocUid does not allow duplicate."}),l(zc,"CONTAINER_NOT_EXIST",{code:-80301,message:"The specified container does not exist."}),l(zc,"MIN_ZOOM_INVALID",{code:-80302,message:"minZoom value cannot be larger than maxZoom value."}),l(zc,"MAX_ZOOM_INVALID",{code:-80303,message:"maxZoom value cannot be smaller than minZoom value."}),l(zc,"DOC_NOT_OPEN",{code:-80304,message:"No document opened."}),l(zc,"DOC_NO_IMAGE",{code:-80305,message:"There is no image in the current document."}),l(zc,"ZOOM_TOO_LARGE",{code:-80306,message:"The value for zoom is larger than maxZoom value."}),l(zc,"ZOOM_TOO_SMALL",{code:-80307,message:"The value for zoom is smaller than minZoom value."}),l(zc,"ROW_COLUMN_CAN_NOT_CHANGE",{code:-80308,message:"<%api%>: Not available in current displayMode."}),l(zc,"RECT_EXCEED_PAGE_BOUND",{code:-80309,message:"The specified rect exceeds the bounds of the current page."}),l(zc,"UNDO_NOOP",{code:-80310,message:"No operations to undo."}),l(zc,"REDO_NOOP",{code:-80311,message:"No operations to redo."}),l(zc,"QUAD_EXCEED_PAGE_BOUND",{code:-80312,message:"The specified quad exceeds the bounds of the current page."}),l(zc,"ELEMENT_UNSUPPORTED",{code:-80313,message:"The element '<%param%>' is not supported in <%api%> class."}),l(zc,"TOOL_MODE_NOT_AVAILABLE",{code:-80314,message:"<%api%>: Not available in current toolMode."}),l(zc,"DOC_DETECT_MISS",{code:-80315,message:"DocumentDetect needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the document detection feature."}),l(zc,"IMG_FILTER_MISS",{code:-80316,message:"ImageFilter needs to be configured by Dynamsoft.DDV.setProcessingHandler to enable the image filter feature."}),l(zc,"ANNOTATION_SELECT",{code:-80317,message:"The specified annotation(s) is not on the current page or does not exist."}),l(zc,"WASM_FONT_LOSS",{code:-80318,message:"The document contains unsupported fonts, which may result in font loss after saving."}),l(zc,"UNSELECTED_READONLY",{code:-80319,message:"ReadOnly annotation or noView annotation cannot be selected."}),l(zc,"UNSELECTED_UNKNOWN",{code:-80320,message:"Unknown annotation or incomplete annotation cannot be selected."}),l(zc,"CAMERA_NOT_EXIST",{code:-80400,message:"The specified camera does not exist."}),l(zc,"CAMERA_OCCUPIED",{code:-80401,message:"The specified camera is occupied."}),l(zc,"CAMERA_NO_VIDEO",{code:-80402,message:"No video stream is played."}),l(zc,"CAMERA_NEED_HTTPS",{code:-80403,message:"Not HTTPS, failed to play the video stream."}),l(zc,"CAMERA_NOT_SUPPORT_TORCH",{code:-80404,message:"The camera does not support a flashlight."}),l(zc,"CAMERA_NO_CAMERA",{code:-80405,message:"No camera available."}),l(zc,"CAMERA_DENIED",{code:-80406,message:"The selected camera is denied by browser."}),l(zc,"CONTAINER_NO_BOUND",{code:-80407,message:"No bound container."}),l(zc,"EXTERNAL_ERR",{code:-81100,message:"External Error"});class $c{static makeSureValid(t,e,i,s){const n=this.composeError(i,s);zc.throw(n,t,e);}static output(t,e,i,s,n){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=this.composeError(s,n);return 2===t?zc.reject(r,e,i):1===t?(zc.warning(r,e,i),o):0===t?zc.error(r,e,i):3===t?zc.verbose(r,e,i):void 0}static error(t,e,i,s){const n=this.composeError(i,s);zc.throw(n,t,e);}static warning(t,e,i,s){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=this.composeError(i,s);return zc.warning(o,t,e),n}static verbose(t,e,i,s){const n=this.composeError(i,s);zc.verbose(n,t,e);}static reject(t,e,i,s){const n=this.composeError(i,s);return zc.reject(n,t,e)}static composeError(t,e){const i={...Ts(e)?zc.PARAM_INVALID:e};return t&&(i.details=t),i}static formatDetails(t,e){const i=[];if(Is(e))e||i.push(`'${t}' is invalid.`);else {const{isValid:s,isInRange:n,isSupported:o}=e;!1===s&&i.push(`'${t}' is invalid.`),!1===n&&i.push(`'${t}' is out of range.`),!1===o&&i.push(`'${t}' is not supported.`);}return i}static formatError(t,e){const{isValid:i,isInRange:s,isSupported:n}=t;if(!1===i||!1===s||!1===n){if(e)return e;if(!i)return zc.PARAM_INVALID;if(!s)return zc.PARAM_OUT_OF_RANGE;if(!n)return zc.PARAM_NOT_SUPPORT}return null}static isArrayBufferOrBlob(t){return Ds(t)||Es(t)}static isArrayAndMeetMinLength(t,e){return Ss(t)?Bs(e)?{isValid:0!==t.length,isInRange:t.length>=e}:{isValid:!0}:{isValid:!1}}static isNumberAndIsInRange(t,e,i){return Bs(t)?{isValid:!0,isInRange:!(!Ts(e)&&t<e||!Ts(i)&&t>i)}:{isValid:!1}}static isStringAndNotEmpty(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ls(t)?e?{isValid:!0}:{isValid:0!==t.trim().length}:{isValid:!1}}static isPdfDate(t){if(!Ls(t))return {isValid:!1};const e=t.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['’](\d{2})['’]|)$/);let i=!1;if(e){const[,t,s,n,o,r,a,l,h,d]=e,c=new Date(`${t}-${s}-${n}T${o}:${r}:${a}`);if(i=!0,c.getFullYear()===parseInt(t,10)&&c.getMonth()+1===parseInt(s,10)&&c.getDate()===parseInt(n,10)&&c.getHours()===parseInt(o,10)&&c.getMinutes()===parseInt(r,10)&&c.getSeconds()===parseInt(a,10)||(i=!1),i&&l){const t=parseInt(h,10),e=parseInt(d,10);(t<0||t>12||e<0||e>59||"+"!==l&&"-"!==l)&&(i=!1);}}return {isSupported:i}}}!function(t){t[t.BlackAndWhite=1]="BlackAndWhite",t[t.Gray=2]="Gray",t[t.RemoveShadow=3]="RemoveShadow",t[t.Enhance=4]="Enhance",t[t.Invert=5]="Invert",t[t.Brightness=6]="Brightness",t[t.Contrast=7]="Contrast",t[t.BrightnessAndContrast=8]="BrightnessAndContrast",t[t.Perspective=9]="Perspective",t[t.Deskew=10]="Deskew",t[t.Rotate=11]="Rotate",t[t.Flip=12]="Flip",t[t.Resize=13]="Resize",t[t.SetHeight=14]="SetHeight",t[t.SetWidth=15]="SetWidth",t[t.SetDPI=16]="SetDPI",t[t.Crop=17]="Crop",t[t.Erase=18]="Erase",t[t.DrawPolygon=19]="DrawPolygon";}(Wc||(Wc={}));var Gc=new WeakSet;class Xc{constructor(){a(this,Gc);}async process(t,i,s){Ss(i)||(i=[i]),e(Gc,this,Yc).call(this,i);const n=new Xn,o={inputImageInfo:null,output:null,outputImageInfo:null,outputContentType:"",outputType:null};try{var r,a,l,h;const d=await n.initImage({source:t.data,isRGBA:t.type===Wn.RGBA,width:t.width,height:t.height,isBGRA:t.type===Wn.BGRA});d.srcBuffer&&(t.data=d.srcBuffer);for(const t of i)e(Gc,this,Jc).call(this,n,t);const c=await n.getImage({jpegQuality:null==s||null===(r=s.params)||void 0===r?void 0:r.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===Wn.RGBA,bitDepth:null==s||null===(a=s.params)||void 0===a?void 0:a.bitDepth,xDpi:null==s||null===(l=s.params)||void 0===l?void 0:l.xDpi,yDpi:null==s||null===(h=s.params)||void 0===h?void 0:h.yDpi,returnBlob:!1,returnType:Kn[null==s?void 0:s.type]});await n.freeReservedData(),o.output=c.imageData,o.outputContentType=c.blobType,o.outputImageInfo={width:c.imageWidth,height:c.imageHeight,bitDepth:c.imageBitDepth,resolutionX:c.imageXResolution,resolutionY:c.imageYResolution},o.outputType=to[c.imageType];}finally{try{await n.terminate();}catch(t){zc.warning(t);}}return o}}function Yc(t){for(const e of t)e.type&&(e.type<=0||(e.type,Wc.DrawPolygon),e.params);}async function Jc(t,e){var i;const s=null!==(i=e.params)&&void 0!==i?i:{};switch(e.type){case Wc.BlackAndWhite:return t.toBinaryLevel(s.saveInk,s.level);case Wc.Gray:return t.toGrayscale(s.level);case Wc.RemoveShadow:return t.removeShadowLevel(s.level,s.alpha);case Wc.Enhance:return t.brighten();case Wc.Invert:return t.invert();case Wc.Contrast:return t.changeBrightnessAndContrast(void 0,s.contrast);case Wc.Brightness:return t.changeBrightnessAndContrast(s.brightness,void 0);case Wc.BrightnessAndContrast:return t.changeBrightnessAndContrast(s.brightness,s.contrast);case Wc.Perspective:return t.perspective(s.location);case Wc.Deskew:{var n;const e=await t.getSkewAngle(s.options);return t.rotate({angle:e,fillColor:s.fillColor,keepSize:null===(n=s.keepSize)||void 0===n||n,mode:s.mode})}case Wc.Rotate:return t.rotate({angle:s.angle,fillColor:s.fillColor,keepSize:s.keepSize,mode:s.mode});case Wc.Flip:return t.flip();case Wc.Resize:{const{newWidth:e,newHeight:i,mode:n}=s;return t.resize(e,i,n)}case Wc.SetHeight:{const{newHeight:e,fillColor:i}=s;return t.setImageHeight(e,i)}case Wc.SetWidth:{const{newWidth:e,fillColor:i}=s;return t.setImageWidth(e,i)}case Wc.SetDPI:return t.setDpi({rawResolutionX:0,rawResolutionY:0,resolutionX:s.xRes,resolutionY:s.yRes,resample:!1});case Wc.Crop:return t.crop({left:s.left,top:s.top,width:s.right-s.left,height:s.bottom-s.top});case Wc.Erase:return t.erase({left:s.left,top:s.top,width:s.right-s.left,height:s.bottom-s.top},s.fillColor);case Wc.DrawPolygon:return t.drawQuadrangle({location:s.location,strokeColor:s.strokeColor,lineWidth:s.lineWidth})}}!Ji&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")),!Ji&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const qc=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=t;if(i._pLoad.isEmpty){let t,s,n,o=i._license||"",r=JSON.parse(JSON.stringify(i._licenseServer)),a=i._sessionPassword,l=0;if(o.startsWith("t")||o.startsWith("f"))l=0;else if(0===o.length||o.startsWith("P")||o.startsWith("L")||o.startsWith("Y")||o.startsWith("A"))l=1;else {l=2;const e=o.indexOf(":");-1!=e&&(o=o.substring(e+1));const i=o.indexOf("?");if(-1!=i&&(s=o.substring(i+1),o=o.substring(0,i)),o.startsWith("DLC2"))l=0;else {if(o.startsWith("DLS2")){let e;try{let t=o.substring(4);t=atob(t),e=JSON.parse(t);}catch(t){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(o=e.handshakeCode?e.handshakeCode:e.organizationID?e.organizationID:"","number"==typeof o&&(o=JSON.stringify(o)),0===r.length){let t=[];e.mainServerURL&&(t[0]=e.mainServerURL),e.standbyServerURL&&(t[1]=e.standbyServerURL),r=(t=>{if(null==t)t=[];else {t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!Ji){let i=document.createElement("a");i.href=t[e],t[e]=i.href;}t[e].endsWith("/")||(t[e]+="/");}}return t})(t);}!a&&e.sessionPassword&&(a=e.sessionPassword),t=e.remark;}o&&"200001"!==o&&!o.startsWith("200001-")||(l=1);}}if(l&&(e||(qi.crypto||(n="Please upgrade your browser to support online key."),qi.crypto.subtle||(n="Require https to use online key in this browser."))),n){if(1!==l)throw new Error(n);l=0,i._lastErrorCode=-1,i._lastErrorString=n;}return 1===l&&(o=""),{lt:l,l:o,ls:r,sp:a,rmk:t,cv:s}}throw new Error("Can't preprocess license again is not allowed to change after `createInstance` or `loadWasm` is called.")},Zc=async(t,e,i)=>{if(!t._bNeverShowDialog)try{let s=await fetch(t.engineResourcePath+"dls.license.dialog.html");if(!s.ok)throw Error("Get license dialog fail. Network Error: "+s.statusText);let n=await s.text();if(!n.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let o=document.createElement("div");o.innerHTML=n;let r=[];for(let t=0;t<o.childElementCount;++t){let e=o.children[t];e instanceof HTMLStyleElement&&(r.push(e),document.head.append(e));}let a=1==o.childElementCount?o.children[0]:o;a.remove();let l,h,d,c,u,p=[a],g=a.children;for(let t of g)p.push(t);for(let t=0;t<p.length;++t)for(let e of p[t].children)p.push(e);for(let t of p)if(!l&&t.classList.contains("dls-license-mask"))l=t,t.addEventListener("click",(e=>{if(t==e.target){a.remove();for(let t of r)t.remove();}}));else if(!h&&t.classList.contains("dls-license-icon-close"))h=t,t.addEventListener("click",(()=>{a.remove();for(let t of r)t.remove();}));else if(!d&&t.classList.contains("dls-license-icon-error"))d=t,"error"!=e&&t.remove();else if(!c&&t.classList.contains("dls-license-icon-warn"))c=t,"warn"!=e&&t.remove();else if(!u&&t.classList.contains("dls-license-msg-content")){u=t;let e=i;for(;e;){let i=e.indexOf("["),s=e.indexOf("]",i),n=e.indexOf("(",s),o=e.indexOf(")",n);if(-1==i||-1==s||-1==n||-1==o){t.appendChild(new Text(e));break}i>0&&t.appendChild(new Text(e.substring(0,i)));let r=document.createElement("a"),a=e.substring(i+1,s);r.innerText=a;let l=e.substring(n+1,o);r.setAttribute("href",l),r.setAttribute("target","_blank"),t.appendChild(r),e=e.substring(o+1);}}document.body.appendChild(a);}catch(e){t._onLog&&t._onLog(e.message||e);}};var Qc=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function Kc(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(n){if("TypeError"!==n.name)throw n;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<t.length;s+=1)i.append(t[s]);return i.getBlob(e.type)}}function tu(t,e){e&&t.then((function(t){e(null,t);}),(function(t){e(t);}));}function eu(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i);}function iu(t){return "string"!=typeof t&&(t=String(t)),t}function su(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const nu="local-forage-detect-blob-support";let ou;const ru={},au=Object.prototype.toString,lu="readonly",hu="readwrite";function du(t){return "boolean"==typeof ou?Promise.resolve(ou):function(t){return new Promise((function(e){var i=t.transaction(nu,hu),s=Kc([""]);i.objectStore(nu).put(s,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1);},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43);};})).catch((function(){return !1}))}(t).then((function(t){return ou=t,ou}))}function cu(t){var e=ru[t.name],i={};i.promise=new Promise((function(t,e){i.resolve=t,i.reject=e;})),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then((function(){return i.promise})):e.dbReady=i.promise;}function uu(t){var e=ru[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function pu(t,e){var i=ru[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function gu(t,e){return new Promise((function(i,s){if(ru[t.name]=ru[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return i(t.db);cu(t),t.db.close();}var n=[t.name];e&&n.push(t.version);var o=Qc.open.apply(Qc,n);e&&(o.onupgradeneeded=function(e){var i=o.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(nu);}catch(t){if("ConstraintError"!==t.name)throw t}}),o.onerror=function(t){t.preventDefault(),s(o.error);},o.onsuccess=function(){var e=o.result;e.onversionchange=function(t){t.target.close();},i(e),uu(t);};}))}function fu(t){return gu(t,!1)}function mu(t){return gu(t,!0)}function yu(t,e){if(!t.db)return !0;var i=!t.db.objectStoreNames.contains(t.storeName),s=t.version<t.db.version,n=t.version>t.db.version;if(s&&(t.version,t.version=t.db.version),n||i){if(i){var o=t.db.version+1;o>t.version&&(t.version=o);}return !0}return !1}function vu(t){var e=function(t){for(var e=t.length,i=new ArrayBuffer(e),s=new Uint8Array(i),n=0;n<e;n++)s[n]=t.charCodeAt(n);return i}(atob(t.data));return Kc([e],{type:t.type})}function xu(t){var e=this,i=e._initReady().then((function(){var t=ru[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return eu(i,t,t),i}function wu(t,e,i,s){void 0===s&&(s=1);try{var n=t.db.transaction(t.storeName,e);i(null,n);}catch(n){if(s>0&&(!t.db||"InvalidStateError"===n.name||"NotFoundError"===n.name))return Promise.resolve().then((()=>{if(!t.db||"NotFoundError"===n.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),mu(t)})).then((()=>function(t){cu(t);for(var e=ru[t.name],i=e.forages,s=0;s<i.length;s++){const t=i[s];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null);}return t.db=null,fu(t).then((e=>(t.db=e,yu(t)?mu(t):e))).then((s=>{t.db=e.db=s;for(var n=0;n<i.length;n++)i[n]._dbInfo.db=s;})).catch((e=>{throw pu(t,e),e}))}(t).then((function(){wu(t,e,i,s-1);})))).catch(i);i(n);}}var bu={_driver:"asyncStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var s in t)i[s]=t[s];var n=ru[i.name];n||(n={forages:[],db:null,dbReady:null,deferredOperations:[]},ru[i.name]=n),n.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=xu);var o=[];function r(){return Promise.resolve()}for(var a=0;a<n.forages.length;a++){var l=n.forages[a];l!==e&&o.push(l._initReady().catch(r));}var h=n.forages.slice(0);return Promise.all(o).then((function(){return i.db=n.db,fu(i)})).then((function(t){return i.db=t,yu(i,e._defaultConfig.version)?mu(i):t})).then((function(t){i.db=n.db=t,e._dbInfo=i;for(var s=0;s<h.length;s++){var o=h[s];o!==e&&(o._dbInfo.db=i.db,o._dbInfo.version=i.version);}}))},_support:function(){try{if(!Qc||!Qc.open)return !1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return (!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return !1}}(),getItem:function(t,e){var i=this;t=iu(t);var s=new Promise((function(e,s){i.ready().then((function(){wu(i._dbInfo,lu,(function(n,o){if(n)return s(n);try{var r=o.objectStore(i._dbInfo.storeName).get(t);r.onsuccess=function(){var t=r.result;void 0===t&&(t=null),function(t){return t&&t.__local_forage_encoded_blob}(t)&&(t=vu(t)),e(t);},r.onerror=function(){s(r.error);};}catch(t){s(t);}}));})).catch(s);}));return tu(s,e),s},setItem:function(t,e,i){var s=this;t=iu(t);var n=new Promise((function(i,n){var o;s.ready().then((function(){return o=s._dbInfo,"[object Blob]"===au.call(e)?du(o.db).then((function(t){return t?e:(i=e,new Promise((function(t,e){var s=new FileReader;s.onerror=e,s.onloadend=function(e){var s=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:s,type:i.type});},s.readAsBinaryString(i);})));var i;})):e})).then((function(e){wu(s._dbInfo,hu,(function(o,r){if(o)return n(o);try{var a=r.objectStore(s._dbInfo.storeName);null===e&&(e=void 0);var l=a.put(e,t);r.oncomplete=function(){void 0===e&&(e=null),i(e);},r.onabort=r.onerror=function(){var t=l.error?l.error:l.transaction.error;n(t);};}catch(t){n(t);}}));})).catch(n);}));return tu(n,i),n},removeItem:function(t,e){var i=this;t=iu(t);var s=new Promise((function(e,s){i.ready().then((function(){wu(i._dbInfo,hu,(function(n,o){if(n)return s(n);try{var r=o.objectStore(i._dbInfo.storeName).delete(t);o.oncomplete=function(){e();},o.onerror=function(){s(r.error);},o.onabort=function(){var t=r.error?r.error:r.transaction.error;s(t);};}catch(t){s(t);}}));})).catch(s);}));return tu(s,e),s},clear:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){wu(e._dbInfo,hu,(function(s,n){if(s)return i(s);try{var o=n.objectStore(e._dbInfo.storeName).clear();n.oncomplete=function(){t();},n.onabort=n.onerror=function(){var t=o.error?o.error:o.transaction.error;i(t);};}catch(t){i(t);}}));})).catch(i);}));return tu(i,t),i},length:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){wu(e._dbInfo,lu,(function(s,n){if(s)return i(s);try{var o=n.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result);},o.onerror=function(){i(o.error);};}catch(t){i(t);}}));})).catch(i);}));return tu(i,t),i},keys:function(t){var e=this,i=new Promise((function(t,i){e.ready().then((function(){wu(e._dbInfo,lu,(function(s,n){if(s)return i(s);try{var o=n.objectStore(e._dbInfo.storeName).openKeyCursor(),r=[];o.onsuccess=function(){var e=o.result;e?(r.push(e.key),e.continue()):t(r);},o.onerror=function(){i(o.error);};}catch(t){i(t);}}));})).catch(i);}));return tu(i,t),i},dropInstance:function(t,e){e=su.apply(this,arguments);var i,s=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||s.name,t.storeName=t.storeName||s.storeName),t.name){const e=t.name===s.name&&this._dbInfo.db?Promise.resolve(this._dbInfo.db):fu(t).then((e=>{const i=ru[t.name],s=i.forages;i.db=e;for(var n=0;n<s.length;n++)s[n]._dbInfo.db=e;return e}));i=t.storeName?e.then((e=>{if(!e.objectStoreNames.contains(t.storeName))return;const i=e.version+1;cu(t);const s=ru[t.name],n=s.forages;e.close();for(let t=0;t<n.length;t++){const e=n[t];e._dbInfo.db=null,e._dbInfo.version=i;}const o=new Promise(((e,s)=>{const n=Qc.open(t.name,i);n.onerror=t=>{n.result.close(),s(t);},n.onupgradeneeded=()=>{n.result.deleteObjectStore(t.storeName);},n.onsuccess=()=>{const t=n.result;t.close(),e(t);};}));return o.then((t=>{s.db=t;for(let e=0;e<n.length;e++){const i=n[e];i._dbInfo.db=t,uu(i._dbInfo);}})).catch((e=>{throw (pu(t,e)||Promise.resolve()).catch((()=>{})),e}))})):e.then((e=>{cu(t);const i=ru[t.name],s=i.forages;e.close();for(var n=0;n<s.length;n++){s[n]._dbInfo.db=null;}const o=new Promise(((e,i)=>{var s=Qc.deleteDatabase(t.name);s.onerror=()=>{const t=s.result;t&&t.close(),i(s.error);},s.onblocked=()=>{},s.onsuccess=()=>{const t=s.result;t&&t.close(),e(t);};}));return o.then((t=>{i.db=t;for(var e=0;e<s.length;e++){uu(s[e]._dbInfo);}})).catch((e=>{throw (pu(t,e)||Promise.resolve()).catch((()=>{})),e}))}));}else i=Promise.reject("Invalid arguments");return tu(i,e),i}};const Cu=new Map;function Su(t,e){let i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}var Pu={_driver:"tempStorageWrapper",_initStorage:async function(t){const e={};if(t)for(let i in t)e[i]=t[i];const i=e.keyPrefix=Su(t,this._defaultConfig);this._dbInfo=e,Cu.has(i)||Cu.set(i,new Map);},getItem:function(t,e){t=iu(t);const i=this.ready().then((()=>Cu.get(this._dbInfo.keyPrefix).get(t)));return tu(i,e),i},setItem:function(t,e,i){t=iu(t);const s=this.ready().then((()=>(void 0===e&&(e=null),Cu.get(this._dbInfo.keyPrefix).set(t,e),e)));return tu(s,i),s},removeItem:function(t,e){t=iu(t);const i=this.ready().then((()=>{Cu.get(this._dbInfo.keyPrefix).delete(t);}));return tu(i,e),i},clear:function(t){const e=this.ready().then((()=>{const t=this._dbInfo.keyPrefix;Cu.has(t)&&Cu.delete(t);}));return tu(e,t),e},length:function(t){const e=this.ready().then((()=>Cu.get(this._dbInfo.keyPrefix).size));return tu(e,t),e},keys:function(t){const e=this.ready().then((()=>[...Cu.get(this._dbInfo.keyPrefix).keys()]));return tu(e,t),e},dropInstance:function(t,e){if(e=su.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){const e=this.config();t.name=t.name||e.name,t.storeName=t.storeName||e.storeName;}let i;return i=t.name?new Promise((e=>{t.storeName?e(Su(t,this._defaultConfig)):e(`${t.name}/`);})).then((t=>{Cu.delete(t);})):Promise.reject("Invalid arguments"),tu(i,e),i}};const Au=(t,e)=>t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e),Tu=(t,e)=>{const i=t.length;let s=0;for(;s<i;){if(Au(t[s],e))return !0;s++;}return !1},ku=Array.isArray||function(t){return "[object Array]"===Object.prototype.toString.call(t)},Du={},Eu={},Iu={INDEXEDDB:bu,TEMPSTORAGE:Pu},Ru=[Iu.INDEXEDDB._driver,Iu.TEMPSTORAGE._driver],Mu=["dropInstance"],Bu=["clear","getItem","keys","length","removeItem","setItem"].concat(Mu),Lu={description:"",driver:Ru.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Uu(t,e){t[e]=function(){const i=arguments;return t.ready().then((function(){return t[e].apply(t,i)}))};}function Ou(){for(let t=1;t<arguments.length;t++){const e=arguments[t];if(e)for(let t in e)e.hasOwnProperty(t)&&(ku(e[t])?arguments[0][t]=e[t].slice():arguments[0][t]=e[t]);}return arguments[0]}class _u{constructor(t){for(let t in Iu)if(Iu.hasOwnProperty(t)){const e=Iu[t],i=e._driver;this[t]=i,Du[i]||this.defineDriver(e);}this._defaultConfig=Ou({},Lu),this._config=Ou({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}));}config(t){if("object"==typeof t){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e];}return !("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return "string"==typeof t?this._config[t]:this._config}defineDriver(t,e,i){const s=new Promise((function(e,i){try{const s=t._driver,n=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(n);const o=Bu.concat("_initStorage");for(let e=0,s=o.length;e<s;e++){const s=o[e];if((!Tu(Mu,s)||t[s])&&"function"!=typeof t[s])return void i(n)}const r=function(){const e=function(t){return function(){const e=new Error(`Method ${t} is not implemented by the current driver`),i=Promise.reject(e);return tu(i,arguments[arguments.length-1]),i}};for(let i=0,s=Mu.length;i<s;i++){const s=Mu[i];t[s]||(t[s]=e(s));}};r();const a=function(i){Du[s],Du[s]=t,Eu[s]=i,e();};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(a,i):a(!!t._support):a(!0);}catch(t){i(t);}}));return eu(s,e,i),s}driver(){return this._driver||null}getDriver(t,e,i){const s=Du[t]?Promise.resolve(Du[t]):Promise.reject(new Error("Driver not found."));return eu(s,e,i),s}ready(t){const e=this,i=e._driverSet.then((()=>(null===e._ready&&(e._ready=e._initDriver()),e._ready)));return eu(i,t,t),i}setDriver(t,e,i){const s=this;ku(t)||(t=[t]);const n=this._getSupportedDrivers(t);function o(){s._config.driver=s.driver();}function r(t){return s._extend(t),o(),s._ready=s._initStorage(s._config),s._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>Promise.resolve())):Promise.resolve();return this._driverSet=a.then((()=>{const t=n[0];return s._dbInfo=null,s._ready=null,s.getDriver(t).then((t=>{s._driver=t._driver,o(),s._wrapLibraryMethodsWithReady(),s._initDriver=function(t){return function(){let e=0;return function i(){for(;e<t.length;){let n=t[e];return e++,s._dbInfo=null,s._ready=null,s.getDriver(n).then(r).catch(i)}o();const n=new Error("No available storage method found.");return s._driverSet=Promise.reject(n),s._driverSet}()}}(n);}))})).catch((()=>{o();const t=new Error("No available storage method found.");return s._driverSet=Promise.reject(t),s._driverSet})),eu(this._driverSet,e,i),this._driverSet}supports(t){return !!Eu[t]}_extend(t){Ou(this,t);}_getSupportedDrivers(t){const e=[];for(let i=0,s=t.length;i<s;i++){const s=t[i];this.supports(s)&&e.push(s);}return e}_wrapLibraryMethodsWithReady(){for(let t=0,e=Bu.length;t<e;t++)Uu(this,Bu[t]);}createInstance(t){return new _u(t)}}var Nu=new _u;Date.prototype.kUtilFormat=function(t){const e={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"H+":this.getUTCHours(),"h+":this.getUTCHours()%12||12,"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),"S+":this.getUTCMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length)));for(let i in e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("000"+e[i]).substr(("000"+e[i]).length-RegExp.$1.length)));return t},String.prototype.startsWith||(String.prototype.startsWith=function(t){return 0==this.indexOf(t)});let Wu=t=>{let e,i,s,n,o,r,a,l,h,d,c,u,p,g,f,m,y,v,x,w,b,C,S=t.fetch||qi.fetch,P=t.btoa||qi.btoa,A=t.atob||qi.atob,T=t.bd,k=t.dm,D=["https://mlts.dynamsoft.com/","https://slts.dynamsoft.com/"],E=!1,I=Promise.resolve(),R=t.lf,M=t.log&&function(){try{for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];t.log.apply(null,i);}catch(t){setTimeout((()=>{throw t}),0);}}||(()=>{}),B=T&&M||(()=>{}),L=t.fol,U=t.sutlcb,O=t.feab,_=t=>A(A(t.replace(/\n/g,"+").replace(/\s/g,"=")).substring(1)),N=t=>P(String.fromCharCode(97+25*Math.random())+P(t)).replace(/\+/g,"\n").replace(/=/g," "),W=()=>{if(C)return C;if(qi.crypto){let t=new Uint8Array(36);qi.crypto.getRandomValues(t);let e="";for(let i=0;i<36;++i){let s=t[i]%36;e+=s<10?s:String.fromCharCode(s+87);}return e}return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return ("x"==t?e:3&e|8).toString(16)}))};const F=" Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.";let H,V,z,j,$={dlsErrorAndCacheExpire:"Failed to connect to the Dynamsoft License Server. The cached license has expired. Please get connected to the network as soon as possible or contact the site administrator for more information.",publicTrialNetworkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out."+F,networkTimeout:"Failed to connect to the Dynamsoft License Server: network timed out. Check your Internet connection or contact the site administrator for more information.",publicTrialFailConnect:"Failed to connect to the Dynamsoft License Server: network connection error."+F,failConnect:"Failed to connect to the Dynamsoft License Server: network connection error. Check your Internet connection or contact the site administrator for more information.",checkLocalTime:"Your system date and time appear to have been changed, causing the license to fail. Please correct the system data and time and try again."},G=async()=>(H=H||(async()=>{await(async()=>{R||(R=Nu);})();{let t=await R.createInstance({name:"dynamjssdkhello"});await t.setItem("dynamjssdkhello","available");}if(m=await R.createInstance({name:"dynamdlsinfo"}),y=C?null:P(P("v2")+String.fromCharCode(k.charCodeAt(k.length/2)+1)+P(k)),!C){try{var t,e;let i=await m.getItem(y);if(!i&&null!==(t=await(null===(e=self.indexedDB)||void 0===e?void 0:e.databases()))&&void 0!==t&&t.some((t=>"dynamltsinfo"===(null==t?void 0:t.name)))){let t=await R.createInstance({name:"dynamltsinfo"});i=await t.getItem(y),i&&await m.setItem(y,i);}i&&([a,p]=JSON.parse(await _(i)));}catch(t){}try{null==a&&(a=W(),m.setItem(y,await N(JSON.stringify([a,null]))));}catch(t){}}})(),H),X=async t=>{z=Date.now(),V||(V=(async()=>{try{let g={pd:e,vm:s,v:i,dt:r||"browser",ed:"javascript",cu:a,ad:k,os:l,fn:h};u&&(g.rmk=u),n&&(-1!=n.indexOf("-")?g.hs=n:g.og=n);let f={};if(p&&!C){let t=await m.getItem(y);t&&([a,p]=JSON.parse(await _(t))),f["lts-time"]=p;}c&&(g.sp=c);let x=await Promise.race([(async()=>{let e,i=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");p&&!C&&(m.setItem(y,await N(JSON.stringify([a,i]))),p=i);let s,n="auth/?ext="+encodeURIComponent(P(JSON.stringify(g))),r=!1,l=!1,h=async t=>{if(t&&!t.ok)try{let e=await t.text();if(e){let t=JSON.parse(e);t.errorCode&&(s=t,t.errorCode>100&&t.errorCode<200&&(o=null,r=!0,l=!0));}}catch(t){}};try{e=await S(D[0]+n,{headers:f,cache:t?"reload":"default",mode:"cors",timeout:1e4}),await h(e);}catch(t){}if(!(o||e&&e.ok||r))try{e=await S(D[1]+n,{headers:f,mode:"cors",timeout:3e4});}catch(t){}if(!(o||e&&e.ok||r))try{e=await S(D[0]+n,{headers:f,mode:"cors",timeout:3e4}),await h(e);}catch(t){}s&&151==s.errorCode&&!C&&(m.removeItem(y),m.removeItem(v),a=W(),g.cu=a,p=void 0,n="auth/?ext="+encodeURIComponent(P(JSON.stringify(g))),e=await S(D[0]+n,{headers:f,mode:"cors",timeout:3e4}),await h(e)),(()=>{if(!e||!e.ok){let t;l&&m.setItem(v,""),s?111==s.errorCode?t=s.message:(t=s.message.trim(),t.endsWith(".")||(t+="."),t=d?`An error occurred during authorization: ${t} [Contact Dynamsoft](https://www.dynamsoft.com/company/contact/) for more information.`:`An error occurred during authorization: ${t} Contact the site administrator for more information.`):t=d?$.publicTrialFailConnect:$.failConnect;let e=Error(t);throw s&&s.errorCode&&(e.ltsErrorCode=s.errorCode),e}})();let c=await e.text();try{p||C||(m.setItem(y,await N(JSON.stringify([a,i]))),p=i),m.setItem(v,c);}catch(t){}return c})(),new Promise(((t,e)=>{let i;i=d?$.publicTrialNetworkTimeout:$.networkTimeout,setTimeout((()=>e(new Error(i))),o?3e3:15e3);}))]);o=x;}catch(t){g=t;}V=null;})()),await V;},Y=async()=>{j||(j=(async()=>{if(B(a),!o){if(!E)throw M(g.message),g;return}let t={dm:k};T&&(t.bd=!0),t.brtk=!0,t.ls=D[0],n&&(-1!=n.indexOf("-")?t.hs=n:t.og=n),t.cu=a,h&&(t.fn=h),e&&(t.pd=e),i&&(t.v=i),r&&(t.dt=r),l&&(t.os=l),u&&(t.rmk=u),B(o);try{t.ar=o,t.bafc=!!g;}catch(t){}B(t);try{await x(t);}catch(t){B("error updl");}await J(),E||(E=!0),j=null;})()),await j;},J=async()=>{let t=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),e=await b();if(B(e),e&&e<t)throw g?new Error($.dlsErrorAndCacheExpire):new Error($.checkLocalTime)},q=null;const Z=new Promise((t=>{q=()=>{Z.isPending=!1,Z.isFulfilled=!0,t();};}));let Q=null,K=async(t,e)=>(I=I.then((async()=>{try{let i=await f.keys();if(e||(Z.isFulfilled?t&&(i=i.filter((e=>e<t))):t&&i.includes(t)?i=[t]:(i=[],B("Unexpected null key"))),!i.length)return;for(let t=0;t<i.length/1e3;++t){let e=i.slice(1e3*t,1e3*(t+1)),s=[];for(let t=0;t<e.length;++t)s.push(await f.getItem(e[t]));if(p=(new Date).kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),!C){let t=await m.getItem(y);t&&([a]=JSON.parse(await _(t))),m.setItem(y,await N(JSON.stringify([a,p])));}try{let t,i,n=D[0]+"verify/v2";p&&!C&&(n+="?ltstime="+encodeURIComponent(p));try{t=S(n,{method:"POST",body:s.join(";"),keepalive:!0});}finally{!Z.isFulfilled&&is&&q();}try{i=await t;}finally{Z.isFulfilled||q();}if(!i.ok)throw new Error("verify failed. Status Code: "+i.status);for(let t=0;t<e.length;++t)await f.removeItem(e[t]);}catch(t){throw Z.isFulfilled||q(),L&&(L(t),L=null),t}}U&&U();}catch(t){}})),await I);return {i:async t=>(e=t.pd,i=t.v,s=i.split(".")[0],t.dt&&(r=t.dt),n=t.l||"",l="string"!=typeof t.os?JSON.stringify(t.os):t.os,h=t.fn,"string"==typeof h&&(h=h.substring(0,255)),t.ls&&t.ls.length&&(D=t.ls,1==D.length&&D.push(D[0])),d=!n||"200001"===n||n.startsWith("200001-"),c=t.sp,u=t.rmk,"string"==typeof u&&(u=u.substring(0,255)),t.lf&&(R=t.lf),t.lsu&&(a=C=t.lsu),t.feab&&(O=t.feab),x=t.updl,w=t.mnet,b=t.mxet,t.sutlcb&&(U=t.sutlcb),await G(),await(async()=>{v=P(String.fromCharCode(n.charCodeAt(0)+10)+P(e)+P(n)+s+P(""+r)),f=await R.createInstance({name:"dynamdlsuns"+P(P("v2"))+P(String.fromCharCode(n.charCodeAt(0)+10)+P(e)+P(n)+s+P(""+r))});try{o=await m.getItem(v);}catch(t){}})(),await X(),await Y(),(!g||g.ltsErrorCode>=102&&g.ltsErrorCode<=120)&&K(null,!0),{ar:o,cu:a}),c:async()=>{let t=new Date;if(t.getTime()<z+36e4)return;let e=t.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ"),i=await w(),s=await b();if(s&&s<e)await X(!0),await Y();else if(i&&i<e){let e=new Date(t.getTime());e.setMinutes(t.getMinutes()-6);let i=e.kUtilFormat("yyyy-MM-ddTHH:mm:ss.SSSZ");p<i&&X().then((()=>Y()));}},s:async(t,e,i,s)=>{if(e){try{let t;t=e.startsWith("{")&&e.endsWith("}")?await O(e):e,t?(B("bs "+i),await f.setItem(i,t),B("ss "+i)):B("ept ecpt");}catch(t){}s&&(B("bd "+i),await K(i,2==s),B("sd "+i)),Q&&clearTimeout(Q),Q=setTimeout((async()=>{await K();}),36e4);}else await K(i);},p:Z,u:async()=>(await G(),a),caret:J}};var Fu;class Hu{static init(){$u._=e(Hu,this,void 0),Gu._=e(Hu,this,void 0),Xu._=e(Hu,this,"init");}static reset(){$u._=e(Hu,this,void 0),Gu._=e(Hu,this,void 0),Xu._=e(Hu,this,"");}static setLicenseInfo(t){var i;Xu._=e(Hu,this,"done"),$u._=e(Hu,this,[]),$u._=e(Hu,this,null!==(i=null==t?void 0:t.modules)&&void 0!==i?i:[]);}static setLicenseErr(t){Gu._=e(Hu,this,t),Xu._=e(Hu,this,"done");}static makeSureLoadLicenseExist(){return e(Hu,this,zu).call(this,3101,5001)}static makeSureCoreLicenseExist(){return e(Hu,this,zu).call(this,3101)}static makeSureCameraLicenseExist(){return e(Hu,this,zu).call(this,3006,8002)}static makeSureAnnotationLicenseExist(){return e(Hu,this,zu).call(this,15)}static annotationLicenseModuleIsExist(){return e(Hu,this,ju).call(this,15)}}function Vu(t){for(const i of e(Fu,this,$u)._)if(i.module===t)return i;return {code:zc.LIC_MISS_MODULE.code,message:zc.LIC_MISS_MODULE.message,module:t}}function zu(t,i){""===e(Fu,this,Xu)._&&zc.throw(zc.INIT_SHOULD_SET_CONFIG),"done"!==e(Fu,this,Xu)._&&zc.throw(zc.INIT_CONFIG_NOT_DONE),e(Fu,this,Gu)._&&zc.throw(e(Fu,this,Gu)._);const s=e(Fu,this,Vu).call(this,t);0!==s.code&&(!i||i&&0!==e(Fu,this,Vu).call(this,i).code)&&zc.throw({code:s.code,message:s.message});}function ju(t){return 0===e(Fu,this,Vu).call(this,t).code}Fu=Hu;var $u={_:void 0},Gu={_:void 0},Xu={_:""};function Yu(t){let e;if(t){let i;const s=t.message;i=t.ltsErrorCode,Bs(i)?111===i?i=zc.LIC_EXPIRED.code:106===i||108===i?i=zc.LIC_INVALID.code:i>0&&(i=-(2e4+i)):i=zc.LIC_INVALID.code,e={code:i,message:s};}else e=zc.LIC_INVALID;return e}const Ju="2.0.0";var qu;!function(t){t[t.publicTrial=0]="publicTrial",t[t.privateTrial=1]="privateTrial",t[t.normal=2]="normal";}(qu||(qu={}));var Zu,Qu=new WeakMap,Ku=new WeakMap,tp=new WeakMap,ep=new WeakMap,ip=new WeakMap,sp=new WeakMap,np=new WeakMap,op=new WeakMap,rp=new WeakSet;class ap{constructor(t){a(this,rp),n(this,Qu,void 0),n(this,Ku,void 0),n(this,tp,void 0),n(this,ep,void 0),n(this,ip,void 0),n(this,sp,void 0),n(this,np,void 0),n(this,op,void 0),o(Ku,this,void 0),o(Qu,this,void 0),o(tp,this,""),o(ep,this,""),o(sp,this,qu.publicTrial),o(op,this,void 0),o(np,this,"");const i=qc({_pLoad:{isEmpty:!0},_license:t,_licenseServer:[]},!0);let r;if(i&&Ls(i.l)?(r=i.l.trim(),1===i.lt?o(sp,this,qu.publicTrial):2===i.lt?o(sp,this,qu.privateTrial):o(sp,this,qu.normal)):(r="",o(sp,this,qu.publicTrial)),""===r?o(Qu,this,r):r.includes("-")?o(Ku,this,r):o(Qu,this,r),Ss(i.ls)){i.ls.length>0&&o(op,this,i.ls);const t=s(op,this);let n,a;if(t&&t.length>0){for(n=0;n<t.length;n++)a=t[n],a.endsWith("/")||(t[n]=`${a}/`);e(rp,this,lp).call(this,t,r)&&o(sp,this,qu.publicTrial);}}o(np,this,i.sp);}async init(t,i,n){let o=t;o.endsWith("/")||(o=`${o}/`),s(ip,this)||await e(rp,this,dp).call(this,n);try{await e(rp,this,pp).call(this,i);}catch(t){const e=Yu(t);let i=!1;e.code===zc.LIC_EXPIRED.code?-1!==e.message.toLowerCase().indexOf("trial license")&&(i=!0):this.isPublicTrial()&&(i=!0),i&&Zc({_bNeverShowDialog:!1,engineResourcePath:o,_onLog:console.log},"error",e.message),zc.throw(e);}}getClientUUID(){return s(ep,this)}getAuthResult(){return s(tp,this)}isPublicTrial(){return s(sp,this)===qu.publicTrial}setClientUUID(t){o(ep,this,t);}setAuthResult(t){o(tp,this,t);}}function lp(t,e){let i=!0;if(Ss(t)&&t.length>0){const e=t[0];Ls(e)&&""!==e&&!e.includes("https://mlts.dynamsoft.com")&&(i=!1);}return i&&(!e||"200001"===e||e.startsWith("200001-"))}function hp(){return window.location.origin?window.location.origin.startsWith("http")?window.location.origin:"https://localhost":window.location.href.startsWith("http")?window.location.href:"https://localhost"}function dp(t){const i={dm:e(rp,this,hp).call(this),fetch:window.fetch};t&&(i.bd=!0,i.log=console.log),o(ip,this,Wu(i));}function cp(){return this.isPublicTrial()?"":s(Ku,this)||s(Qu,this)}function up(){const t=[];return t.push(es.browser),t.push(es.version.toString()),t.push(es.OS),t.join(" ")}async function pp(t){if(this.getAuthResult()&&this.getClientUUID())return {ar:this.getAuthResult(),cu:this.getClientUUID()};const i={pd:"ddv",dt:"browser",v:Ju,os:e(rp,this,up).call(this),l:e(rp,this,cp).call(this),ls:s(op,this),sp:s(np,this),fn:t||"",mnet(){},mxet(){}};""!==this.getClientUUID()&&(i.lsu=this.getClientUUID()),i.updateLicense=t=>{this.setAuthResult(t.ar),this.getClientUUID()||this.setClientUUID(t.cu);};const n=await s(ip,this).i(i);return this.getAuthResult()||this.setAuthResult(n.ar),this.getClientUUID()||this.setClientUUID(n.cu),n}async function gp(e){let i=e.engineResourcePath.trim();i.endsWith("/")||(i=`${i}/`),Mn.resourceDir=i,Hu.init();if(!await Mn.isResourceDirValid())return Hu.reset(),zc.reject(zc.RESOURCE_NOT_FOUND,"DDV.Core.init");await Mn.preloadModule("core");const s=e.license.trim();let n,o,r=s.startsWith("DLS")||0===s.length,a=!1,l=!1;if(r)try{var h;let c=!1;if(!s&&null!==(h=window)&&void 0!==h&&null!==(h=h.Dynamsoft)&&void 0!==h&&h.DWT){let t=window.Dynamsoft.DWT,e=t.lgar(t.EnumInstance.dwt_desktop,""),i=t.li({instanceMode:t.EnumInstance.dwt_desktop},"");e&&i&&(n=e,o=i,a=t.isPublicLicense(),c=!0);}if(!c){var d;let h;if(null!=mapPackageRegister&&mapPackageRegister.license?h=await mapPackageRegister.license.getAR():null!==(d=window)&&void 0!==d&&null!==(d=d.Dynamsoft)&&void 0!==d&&null!==(d=d.Core)&&void 0!==d&&null!==(d=d.mapPackageRegister)&&void 0!==d&&d.license&&(h=await window.Dynamsoft.Core.mapPackageRegister.license.getAR()),h)n=h.ar,o=h.u,a=h.pt,h.pk?(n=h.pk,r=!1):l=!0,Ts(n)&&h.ae&&zc.throw(Yu(h.ae));else {const t=await async function(t,e,i,s){const n=new ap(t);return await n.init(e,i,s),{authResult:n.getAuthResult(),clientUUID:n.getClientUUID(),bPublicTrial:n.isPublicTrial()}}(s,i,e.deviceFriendlyName||"");n=t.authResult,o=t.clientUUID,a=t.bPublicTrial;}}}catch(t){throw Hu.setLicenseErr(t),t}else n=s,o="";const c={licenseInfo:null};try{const t=await Mn.getLicenseInfo(n,r,o);c.licenseInfo=t,Hu.setLicenseInfo(t),!l&&a&&t.trial&&t.msg&&Zc({_bNeverShowDialog:!1,engineResourcePath:i,_onLog:console.log},"warn",t.msg);}catch(t){throw t&&t.code<=-8e4&&Hu.setLicenseErr(t),t}return r&&(c.deviceUuid=o),c}const fp={scrollToLatest:!1};class mp{constructor(t){l(this,"viewerUids",void 0),l(this,"groupUid",void 0),l(this,"config",void 0),l(this,"isSetScrollToLatest",!1),this.groupUid=t,this.viewerUids=new Set,this.config=As(fp);}getViewerUids(){return [...this.viewerUids.values()]}updateConfig(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this.config,t);}}var yp,vp;!function(t){t.LEFT="left",t.TOP="top",t.RIGHT="right",t.BOTTOM="bottom";}(yp||(yp={})),function(t){t.DEFAULT="default",t.CAPTURE="capture",t.PERSPECTIVE="perspective",t.THUMBNAIL="thumbnail";}(vp||(vp={}));class xp{constructor(){l(this,"db",void 0),this.db=new Map;}async set(t,e){return new Promise(((i,s)=>{this.db.has(t)?s(new Error(`The item ${t} already exists.`)):(this.db.set(t,e),i(`Save ${t} to database successful.`));}))}async get(t){return new Promise(((e,i)=>{this.db.has(t)?e(this.db.get(t)):i(new Error(`The item ${t} does not exist.`));}))}async remove(t){return new Promise(((e,i)=>{const s=this.db.get(t);this.db.delete(t),e(s);}))}async update(t,e){return new Promise(((i,s)=>{this.db.has(t)?(this.db.set(t,e),i(`Update ${t} successful.`)):s(new Error(`The item ${t} does not exist.`));}))}dispose(){this.db.clear();}reset(){this.db.clear();}}class wp extends Tn{constructor(){super(),l(this,"openDocument",void 0),l(this,"closeDocument",void 0),l(this,"syncDocument",void 0),l(this,"addPagesToDoc",void 0),l(this,"deletePages",void 0),l(this,"updatePage",void 0),l(this,"selectedPageChanged",void 0),l(this,"viewerModeChanged",void 0),l(this,"pageChanged",void 0),l(this,"currentPageChanged",void 0),l(this,"pageChangedAfterRender",void 0),l(this,"pageExistenceChanged",void 0),l(this,"tabChanged",void 0),l(this,"displayModeChanged",void 0),l(this,"fitModeChanged",void 0),l(this,"filterChanged",void 0),l(this,"toolModeChanged",void 0),l(this,"zoomChanged",void 0),l(this,"visibleChanged",void 0),l(this,"cropRectDrawn",void 0),l(this,"cropRectDeleted",void 0),l(this,"cropModeChanged",void 0),l(this,"quadModified",void 0),l(this,"autoCaptureChanged",void 0),l(this,"autoDetectChanged",void 0),l(this,"torchChanged",void 0),l(this,"cameraPlayed",void 0),l(this,"cameraClosed",void 0),l(this,"cameraInit",void 0),l(this,"beforeLayout",void 0),l(this,"afterLayout",void 0),l(this,"beforeRender",void 0),l(this,"afterRender",void 0),l(this,"destroy",void 0),l(this,"canvasCursorStyleChanged",void 0),l(this,"quadSelectionStyleChanged",void 0),l(this,"perspectiveQuadChanged",void 0),l(this,"beforeCropPages",void 0),l(this,"operationsChanged",void 0),l(this,"resize",void 0),l(this,"annotationsUpdated",void 0),l(this,"annotationModeChanged",void 0),l(this,"annotationDefaultStyleChanged",void 0),l(this,"selectedAnnotationsChanged",void 0),l(this,"annotationLayerStateChanged",void 0),l(this,"beforeAnnotationEdit",void 0),l(this,"afterAnnotationEdit",void 0),l(this,"beforeAnnotationDraw",void 0),l(this,"afterAnnotationDraw",void 0),l(this,"annotationTextCharsSelected",void 0),l(this,"scroll",void 0),this.openDocument=En(this),this.closeDocument=En(this),this.syncDocument=En(this),this.addPagesToDoc=En(this),this.deletePages=En(this),this.updatePage=En(this),this.selectedPageChanged=En(this),this.viewerModeChanged=En(this),this.pageChanged=En(this),this.currentPageChanged=En(this),this.pageChangedAfterRender=En(this),this.pageExistenceChanged=En(this),this.tabChanged=En(this),this.displayModeChanged=En(this),this.fitModeChanged=En(this),this.filterChanged=En(this),this.toolModeChanged=En(this),this.zoomChanged=En(this),this.visibleChanged=En(this),this.cropRectDrawn=En(this),this.cropRectDeleted=En(this),this.cropModeChanged=En(this),this.quadModified=En(this),this.autoCaptureChanged=En(this),this.autoDetectChanged=En(this),this.torchChanged=En(this),this.cameraPlayed=En(this),this.cameraClosed=En(this),this.cameraInit=En(this),this.beforeLayout=En(this),this.afterLayout=En(this),this.beforeRender=En(this),this.afterRender=En(this),this.destroy=En(this),this.canvasCursorStyleChanged=En(this),this.quadSelectionStyleChanged=En(this),this.perspectiveQuadChanged=En(this),this.beforeCropPages=En(this),this.operationsChanged=En(this),this.resize=En(this),this.annotationModeChanged=En(this),this.selectedAnnotationsChanged=En(this),this.annotationLayerStateChanged=En(this),this.annotationDefaultStyleChanged=En(this),this.beforeAnnotationEdit=En(this),this.afterAnnotationEdit=En(this),this.beforeAnnotationDraw=En(this),this.afterAnnotationDraw=En(this),this.annotationsUpdated=En(this),this.annotationTextCharsSelected=En(this),this.scroll=En(this);}}class bp{static numberArrayIsValid(t,i,s,n,o){return e(bp,this,Cp).call(this,t,1,i,s,o,n)}static stringArrayIsValid(t,i){return e(bp,this,Cp).call(this,t,2,void 0,void 0,0,i)}static blobArrayIsValid(t,i){return e(bp,this,Cp).call(this,t,4,void 0,void 0,void 0,i)}static quadIsValid(t,i){const s=[],n="Quad";e(bp,this,Tp).call(this,s,t,6,e(bp,this,Pp).call(this,n,i,void 0),4);let o=0;for(const r of t){const t=`[${o}]`;s.push(...e(bp,this,Cp).call(this,r,1,void 0,void 0,2,e(bp,this,Pp).call(this,n,i,t,!0))),o+=1;}return s}static docDetectConfigIsValid(t,i){const s=[],n="DocumentDetectConfig";return e(bp,this,Tp).call(this,s,t,5,e(bp,this,Pp).call(this,n,i)),e(bp,this,Tp).call(this,s,t.autoCaptureDelay,1,e(bp,this,Pp).call(this,n,i,"autoCaptureDelay")),Ts(t.acceptedPolygonConfidence)||e(bp,this,Tp).call(this,s,t.acceptedPolygonConfidence,1,e(bp,this,Pp).call(this,n,i,"acceptedPolygonConfidence")),Ts(t.enableAutoCapture)||e(bp,this,Tp).call(this,s,t.enableAutoCapture,3,e(bp,this,Pp).call(this,n,i,"enableAutoCapture")),s}static docDetectConfIsValid(t,i){const s=[],n="DocumentDetectConfidence";return e(bp,this,Tp).call(this,s,t,5,e(bp,this,Pp).call(this,n,i)),e(bp,this,Tp).call(this,s,t.angleConfidence,1,e(bp,this,Pp).call(this,n,i,"angleConfidence"),0,100),e(bp,this,Tp).call(this,s,t.areaConfidence,1,e(bp,this,Pp).call(this,n,i,"areaConfidence"),0,100),e(bp,this,Tp).call(this,s,t.centerConfidence,1,e(bp,this,Pp).call(this,n,i,"centerConfidence"),0,100),s}static imageDataIsValid(t,i){const s=[],n="VImageData";return e(bp,this,Tp).call(this,s,t,5,e(bp,this,Pp).call(this,n,i)),e(bp,this,Tp).call(this,s,t.data,8,e(bp,this,Pp).call(this,n,i,"data")),e(bp,this,Tp).call(this,s,t.type,9,e(bp,this,Pp).call(this,n,i,"type")),Ts(t.height)||e(bp,this,Tp).call(this,s,t.height,1,e(bp,this,Pp).call(this,n,i,"height")),Ts(t.width)||e(bp,this,Tp).call(this,s,t.width,1,e(bp,this,Pp).call(this,n,i,"width")),s}static filterTypeIsValid(t,i){const s=[];return e(bp,this,Tp).call(this,s,t,10,e(bp,this,Pp).call(this,"EnumImageFilterType",i)),s}static imageEncodeOptionIsValid(t,i){const s=[],n="ImageEncodeOption";return e(bp,this,Tp).call(this,s,t,5,e(bp,this,Pp).call(this,n,i)),e(bp,this,Tp).call(this,s,t.type,9,e(bp,this,Pp).call(this,n,i,"type")),Ts(t.params)||e(bp,this,Tp).call(this,s,t.params,5,e(bp,this,Pp).call(this,n,i,"params")),s}static makeSureNumberValid(t,i,s,n,o,r){return e(bp,this,Sp).call(this,e(bp,this,Op).call(this,t,i,s),n,o,r)}static makeSureStringValid(t,i,s,n){return e(bp,this,Sp).call(this,{isValid:e(bp,this,_p).call(this,t)},i,s,n)}static makeSureDetectResultValid(t,i,s,n){const o=[],r="DetectResult";e(bp,this,Tp).call(this,o,t,5,e(bp,this,Pp).call(this,r,n)),o.push(...bp.quadIsValid(null==t?void 0:t.location,r)),e(bp,this,Tp).call(this,o,null==t?void 0:t.width,1,e(bp,this,Pp).call(this,r,n,"width"),1,void 0),e(bp,this,Tp).call(this,o,null==t?void 0:t.height,1,e(bp,this,Pp).call(this,r,n,"height"),1,void 0),o.push(...bp.docDetectConfigIsValid(null==t?void 0:t.config,r)),null!=t&&t.confidence&&e(bp,this,Tp).call(this,o,t.confidence,1,e(bp,this,Pp).call(this,r,n,"confidence")),this.makeSureValid(o,i,s);}static makeSureValid(t,i,s,n){0!==t.length&&e(bp,this,Ap).call(this,t,i,s,n);}static makeSureMissing(t,i,s){Ts(t)&&e(bp,this,Ap).call(this,void 0,i,s,zc.PARAM_MISS);}static makeSureCameraObject(t,i,s){const n=[],o=s;this.makeSureMissing(t,i,s),Ls(t)?this.makeSureStringValid(t,i,s):(e(bp,this,Tp).call(this,n,t,5,e(bp,this,Pp).call(this,o)),e(bp,this,Tp).call(this,n,t.deviceId,2,e(bp,this,Pp).call(this,o,void 0,"deviceId")),e(bp,this,Tp).call(this,n,t.label,2,e(bp,this,Pp).call(this,o,void 0,"label")),this.makeSureValid(n,i,s));}static initTypeCheckMap(){e(bp,this,Fp)._[7]=Ds,e(bp,this,Fp)._[15]=Ls,e(bp,this,Fp)._[3]=Is,e(bp,this,Fp)._[5]=Ps,e(bp,this,Fp)._[4]=Es,e(bp,this,Fp)._[2]=e(bp,this,_p),e(bp,this,Fp)._[8]=e(bp,this,Dp),e(bp,this,Fp)._[11]=e(bp,this,Mp),e(bp,this,Fp)._[12]=e(bp,this,Bp),e(bp,this,Fp)._[13]=e(bp,this,Lp),e(bp,this,Fp)._[14]=e(bp,this,Up),e(bp,this,Fp)._[1]=e(bp,this,Op),e(bp,this,Fp)._[6]=e(bp,this,Ep),e(bp,this,Fp)._[9]=e(bp,this,Ip),e(bp,this,Fp)._[10]=e(bp,this,Rp),e(bp,this,Fp)._[16]=e(bp,this,Np);}}function Cp(t,i,s,n,o,r){const a=[],l="Array";if(e(Zu,this,Tp).call(this,a,t,6,e(Zu,this,Pp).call(this,l,r),o),a.length>0)return a;let h=0;for(const o of t){const t=`[${h}]`;e(Zu,this,Tp).call(this,a,o,i,e(Zu,this,Pp).call(this,l,r,t,!0),s,n),h+=1;}return a}function Sp(t,i,s,n){const{isValid:o,isInRange:r,isSupported:a}=t,l=!!Ts(o)||o,h=!!Ts(r)||r,d=!!Ts(a)||a;l&&h&&d||(n||(n=l?h?zc.PARAM_NOT_SUPPORT:zc.PARAM_OUT_OF_RANGE:zc.PARAM_INVALID),e(Zu,this,Ap).call(this,void 0,i,s,n));}function Pp(t,e,i,s){return e?i?`${e}${s?"":"."}${i}`:`${e}`:i?`${t}${s?"":"."}${i}`:`${t}`}function Ap(t,e,i,s){const n=Ts(s)?{...zc.PARAM_INVALID}:{...s};t&&(n.details=t),zc.throw(n,e,i);}function Tp(t,i,s,n,o,r){const a=e(Zu,this,kp).call(this,i,s,n,o,r);a&&t.push(a);}function kp(t,i,s,n,o){if(Ts(t))return `${s} is missing.`;const r=e(Zu,this,Fp)._[i];if(r){const e=r.bind(this)(t,n,o);if(Is(e)){if(!e)return `${s} is invalid.`}else if(Ps(e)){const{isValid:t,isInRange:i,isSupported:n}=e;if(!1===t)return `${s} is invalid.`;if(!1===i)return `${s} is out of range.`;if(!1===n)return `${s} is not supported.`}}}function Dp(t){return Ds(t)||Es(t)}function Ep(t,e){return Ss(t)?Bs(e)&&0===t.length||!Ts(e)&&t.length<e?{isValid:!1}:{isValid:!0,isInRange:!!Ts(e)||t.length>=e}:{isValid:!1}}function Ip(t){return Bs(t)?{isValid:!0,isInRange:t>=Wn.RGBA&&t<=Wn.PNG}:{isValid:!1}}function Rp(t){return Ls(t)?{isValid:!0,isInRange:(e=t,!!Nc.get(e))}:{isValid:!1};var e;}function Mp(t){return void 0!==go.get(t)}function Bp(t){return void 0!==fo.get(t)}function Lp(t){return void 0!==po.get(t)}function Up(t){if(Ls(t)){const i=t.trim();return -1!==e(Zu,this,Wp)._.indexOf(i)}return !1}function Op(t,e,i){let s=!0;return Bs(t)?(Ts(e)||(s=t>=e),!Ts(i)&&s&&(s=t<=i),{isValid:!0,isInRange:s}):{isValid:!1}}function _p(t){return !!Ls(t)&&0!==t.trim().length}function Np(t){if(!e(Zu,this,_p).call(this,t))return {isValid:!1};const i=t.match(/^D:(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(?:([+-])(\d{2})['’](\d{2})['’]|)$/);let s=!1;if(i){const[,t,e,n,o,r,a,l,h,d]=i,c=new Date(`${t}-${e}-${n}T${o}:${r}:${a}`);if(s=!0,c.getFullYear()===parseInt(t,10)&&c.getMonth()+1===parseInt(e,10)&&c.getDate()===parseInt(n,10)&&c.getHours()===parseInt(o,10)&&c.getMinutes()===parseInt(r,10)&&c.getSeconds()===parseInt(a,10)||(s=!1),s&&l){const t=parseInt(h,10),e=parseInt(d,10);("+"===l&&(t<0||t>12||e<0||e>59)||"-"===l&&(t<0||t>12||e<0||e>59))&&(s=!1);}}return {isSupported:s}}Zu=bp;var Wp={_:["1.1","1.2","1.3","1.4","1.5","1.6","1.7"]},Fp={_:Object.create(null)};bp.initTypeCheckMap();class Hp{constructor(t){l(this,"maxConcurrency",void 0),l(this,"currentConcurrency",void 0),l(this,"queue",void 0),this.maxConcurrency=t,this.currentConcurrency=0,this.queue=[];}async acquire(){return new Promise((t=>{this.currentConcurrency<this.maxConcurrency?(this.currentConcurrency+=1,t(!0)):this.queue.push(t);}))}release(){if(this.queue.length>0){this.queue.shift()();}else this.currentConcurrency-=1;}}class Vp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;l(this,"tasks",void 0),l(this,"semaphore",void 0),this.tasks=[],this.semaphore=new Hp(t);}async process(t){await this.semaphore.acquire();let e=null;try{t.cancelled||(e=await this.handler(t.taskUid));}catch(t){e=null;}if(t.completed=!0,this.tasks.includes(t)){const e=this.tasks.indexOf(t);this.tasks.splice(e,1);}t.emitter.emit(t.taskUid,e),this.semaphore.release();}async executeTask(t){return new Promise(((e,i)=>{let s=this.tasks.find((e=>e.taskUid===t));s||(s={taskUid:t,emitter:new Fs,completed:!1,cancelled:!1,running:!1},this.tasks.push(s)),s.cancelled=!1,s.emitter.on(t,(t=>{e(t);})),s.running||(s.running=!0,this.process(s));}))}cancel(t){const e=this.tasks.find((e=>e.taskUid===t));e&&(e.cancelled=!0);}destroy(){this.tasks=[];}async handler(t){return Promise.resolve(null)}}class zp extends Vp{async handler(t){return new Promise(((e,i)=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{s.onload=null,s.onerror=null,e(s);},s.onerror=t=>{s.onload=null,s.onerror=null,e(null);},s.src=t;}))}}class jp extends zp{constructor(t,e){super(),l(this,"core",void 0),l(this,"imageLoader",void 0),this.core=t,this.imageLoader=e;}async handler(t){let e=this.core.pageService.getPage(t);if(!e||e.isDestroyed)return null;let{img:i}=e.raw;if(!i){let{url:s}=e.raw;if(!s){let i=e.raw.data;if(!i){let s=await this.core.imageDataService.getRaw(t);const n=this.core.pageService.getPage(t);if(!n)return null;if(e.isDestroyed&&!n.isDestroyed&&(s=await this.core.imageDataService.getRaw(t,!0)),!s||n.isDestroyed)return null;i=s.data;}s=URL.createObjectURL(i),e.raw.url=s;}if(i=await this.imageLoader.executeTask(s),e=this.core.pageService.getPage(t),!e||e.isDestroyed)return null;e.raw.img=i;}return i}}class $p extends zp{constructor(t,e){super(),l(this,"core",void 0),l(this,"imageLoader",void 0),this.core=t,this.imageLoader=e;}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let s=null===(e=i.original)||void 0===e?void 0:e.img;if(!s){var n;let e=null===(n=i.original)||void 0===n?void 0:n.url;if(!e){var o;let s=null===(o=i.original)||void 0===o?void 0:o.data;if(!s){let e=await this.core.imageDataService.getOriginal(t);const n=this.core.pageService.getPage(t);if(!n)return null;if(i.isDestroyed&&!n.isDestroyed&&(e=await this.core.imageDataService.getRaw(t,!0)),!e||n.isDestroyed)return null;s=e.data;}e=URL.createObjectURL(s),i.original.url=e;}if(s=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),!i||i.isDestroyed)return null;i.original.img=s;}return s}}class Gp extends zp{constructor(t,e){super(),l(this,"core",void 0),l(this,"imageLoader",void 0),this.core=t,this.imageLoader=e;}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let s=null===(e=i.display)||void 0===e?void 0:e.img;if(!s){var n;let e=null===(n=i.display)||void 0===n?void 0:n.url;if(!e){var o;let s=null===(o=i.display)||void 0===o?void 0:o.data;if(!s){let e=await this.core.imageDataService.getDisplay(t,!0);const n=this.core.pageService.getPage(t);if(!n)return null;if(i.isDestroyed&&!n.isDestroyed&&(e=await this.core.imageDataService.getDisplay(t,!0)),!e||n.isDestroyed)return null;s=e.data;}e=URL.createObjectURL(s),i.display.url=e;}const{filter:r}=i;if(s=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),!i||i.isDestroyed)return null;if(r!==i.filter)return this.handler(i.uid);i.display.img=s;}return s}}class Xp extends zp{constructor(t,e){super(),l(this,"core",void 0),l(this,"imageLoader",void 0),this.core=t,this.imageLoader=e;}async handler(t){var e;let i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let s=null===(e=i.thumbnail)||void 0===e?void 0:e.img;if(!s){var n;let e=null===(n=i.thumbnail)||void 0===n?void 0:n.url;if(!e){var o;let s=null===(o=i.thumbnail)||void 0===o?void 0:o.data;if(!s){const e=await this.core.imageDataService.getThumbnail(t);if(i=this.core.pageService.getPage(t),!e||i.isDestroyed)return null;s=e.data;}e=URL.createObjectURL(s),i.thumbnail.url=e;}if(s=await this.imageLoader.executeTask(e),i=this.core.pageService.getPage(t),i.isDestroyed)return null;i.thumbnail.img=s;}return s}}class Yp{constructor(t){l(this,"rawImageLoader",void 0),l(this,"originalImageLoader",void 0),l(this,"displayImageLoader",void 0),l(this,"thumbnailImageLoader",void 0);const e=new zp;this.rawImageLoader=new jp(t,e),this.originalImageLoader=new $p(t,e),this.displayImageLoader=new Gp(t,e),this.thumbnailImageLoader=new Xp(t,e);}async loadRawImage(t){return this.rawImageLoader.executeTask(t)}cancelLoadRawImage(t){this.rawImageLoader.cancel(t);}async loadOriginalImage(t){return this.originalImageLoader.executeTask(t)}cancelLoadOriginalImage(t){this.originalImageLoader.cancel(t);}async loadDisplayImage(t){return this.displayImageLoader.executeTask(t)}cancelLoadDisplayImage(t){this.displayImageLoader.cancel(t);}async loadThumbnailImage(t){return this.thumbnailImageLoader.executeTask(t)}cancelLoadThumbnailImage(t){this.thumbnailImageLoader.cancel(t);}}class Jp{constructor(t,e,i){l(this,"worker",void 0),l(this,"id",void 0),l(this,"manager",void 0),l(this,"callbacks",{}),l(this,"busy",!1),l(this,"counter",0),l(this,"tasks",[]),this.worker=t,this.id=e,this.manager=i,this.worker.addEventListener("message",(t=>{this.onMessage(t);}),!1);}cancel(t){const e=this.tasks.findIndex((e=>{var i;return (null===(i=e.data)||void 0===i?void 0:i.taskUid)===t}));if(e>=0){const t=this.tasks.splice(e,1)[0];this.callbacks[t.callbackId]&&delete this.callbacks[t.callbackId],this.setBusy(!1);}}setBusy(t){if(this.busy=t,!t)if(this.tasks.length){const t=this.tasks.shift();this.send(t);}else this.worker.terminate(),this.manager.removeActor(this);}isBusy(){return this.busy}getWorker(){return this.worker}onMessage(t){this.setBusy(!1);const{callbackId:e}=t.data,i=e?this.callbacks[e]:null;i&&i(t.data),delete this.callbacks[e];}send(t,e){if(this.busy)return void this.tasks.push({...t});this.setBusy(!0);const i=`${this.id}-${t.action}-cb-${this.counter}`;t.callback&&(this.callbacks[i]=t.callback,this.counter+=1),t.callbackId=i;const s={...t.data,callbackId:i};e?this.worker.postMessage(s,[e.data.buffer]):this.worker.postMessage(s);}}class qp{constructor(t,e){l(this,"concurrency",1),l(this,"actors",[]),l(this,"workerUrl",void 0),this.workerUrl=t,this.concurrency=e;}send(t,e){this.getActor().send(t,e);}getActor(){const t=this.actors.filter((t=>!t.isBusy()))[0];if(t)return t;if(this.actors.length<this.concurrency){const t=new Worker(this.workerUrl),e=new Jp(t,this.actors.length,this);return this.actors.push(e),e}const e=Math.floor(Math.random()*this.concurrency);return this.actors[e]}removeActor(t){const e=this.actors.indexOf(t);this.actors.splice(e,1);}cancel(t){for(const e of this.actors)e.cancel(t);}clear(){for(const t of this.actors)t.getWorker().terminate();this.actors=[];}}function Zp(){onmessage=t=>{const{index:e}=t.data,i=t.data.sourceWidth,s=t.data.sourceHeight,n=t.data.width,o=t.data.height,r=t.data.source.data,a=n*o*4,l=new ArrayBuffer(a);let h=null;try{h=new Uint8ClampedArray(l,0,a);}catch(t){h=new Uint8Array(l,0,a);}for(let t=0;t<o;t++){const e=t*s/o,a=Math.floor(e),l=1-(e-a),d=a,c=(t+1)*s/o,u=Math.floor(c-1e-5),p=c-u,g=u;let f=t*n*4;for(let t=0;t<n;t++){const e=t*i/n,s=Math.floor(e),o=1-(e-s),a=s,c=(t+1)*i/n,u=Math.floor(c-1e-5),m=c-u,y=u;let v=0,x=0,w=0,b=0,C=0;const S=255;let P,A,T=(d+1)*i*4+4*a;for(P=d+1;P<g;++P){const t=S;v+=r[T+2]*o*t,x+=r[T+1]*o*t,w+=r[T]*o*t,b+=r[T+3]*o*t,C+=S*o,T+=4*i;}let k=(d+1)*i*4+4*y;for(P=d+1;P<g;++P){const t=S;v+=r[k+2]*m*t,x+=r[k+1]*m*t,w+=r[k]*m*t,b+=r[k+3]*m*t,C+=S*m,k+=4*i;}let D=d*i*4+4*(a+1);for(A=a+1;A<y;++A){const t=S;v+=r[D+2]*l*t,x+=r[D+1]*l*t,w+=r[D]*l*t,b+=r[D+3]*l*t,C+=S*l,D+=4;}let E=g*i*4+4*(a+1);for(A=a+1;A<y;++A){const t=S;v+=r[E+2]*p*t,x+=r[E+1]*p*t,w+=r[E]*p*t,b+=r[E+3]*p*t,C+=S*p,E+=4;}for(P=d+1;P<g;++P){let t=P*i*4+4*(a+1);for(A=a+1;A<y;++A){const e=S;v+=r[t+2]*e,x+=r[t+1]*e,w+=r[t]*e,b+=r[t+3]*e,C+=e,t+=4;}}let I=d*i*4+4*a;const R=S;v+=r[I+2]*(l*o)*R,x+=r[I+1]*(l*o)*R,w+=r[I]*(l*o)*R,b+=r[I+3]*(l*o)*R,C+=S*(l*o),I=d*i*4+4*y;const M=S;v+=r[I+2]*(l*m)*M,x+=r[I+1]*(l*m)*M,w+=r[I]*(l*m)*M,b+=r[I+3]*(l*m)*M,C+=S*(l*m),I=g*i*4+4*a;const B=S;v+=r[I+2]*(p*o)*B,x+=r[I+1]*(p*o)*B,w+=r[I]*(p*o)*B,b+=r[I+3]*(p*o)*B,C+=S*(p*o),I=g*i*4+4*y;const L=S;v+=r[I+2]*(p*m)*L,x+=r[I+1]*(p*m)*L,w+=r[I]*(p*m)*L,b+=r[I+3]*(p*m)*L,C+=S*(p*m);let U=b/C,O=0,_=0,N=0;0!==U&&(O=v/C,_=x/C,N=w/C),O+=.5,_+=.5,N+=.5,U+=.5,h[f]=Math.floor(N),f+=1,h[f]=Math.floor(_),f+=1,h[f]=Math.floor(O),f+=1,h[f]=Math.floor(U),f+=1;}}const d={index:e,target:h,taskUid:t.data.taskUid,callbackId:t.data.callbackId};try{postMessage(d,[h.buffer]);}catch(t){postMessage(d,null);}h=null;};}let Qp=class{constructor(){l(this,"actorSystem",void 0),l(this,"concurrency",3);const t=window.URL.createObjectURL(new Blob(["(",Zp.toString(),")()"],{type:"text/plain"}));this.actorSystem=new qp(t,this.concurrency);}cancel(t){this.actorSystem.cancel(t);}optimize(t,e,i,s,n,o){return new Promise(((r,a)=>{const l=t.getContext("2d"),h=Math.floor(e)||1,d=Math.floor(i)||1,c=l.getImageData(0,0,h,d),u={action:"optimize",data:{taskUid:o,sourceWidth:h,sourceHeight:d,width:Math.ceil(s)||1,height:Math.ceil(n)||1,source:c},callback(t){r(t);}};this.actorSystem.send(u,u.data.source);}))}};class Kp{constructor(){}reset(){}async perspectivePreview(t,e,i,s){var n,o,r;let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const l=new Xn,h=await l.initImage({source:t,isRGBA:e===Wn.RGBA,width:s.width,height:s.height,isBGRA:e===Wn.BGRA});h.srcBuffer&&(t=h.srcBuffer);let d=s.width,c=s.height;const u=null!==(n=s.angle)&&void 0!==n?n:0;90!==u&&270!==u||(d=s.height,c=s.width);const p=Math.min((null!==(o=a.width)&&void 0!==o?o:d)/d,(null!==(r=a.height)&&void 0!==r?r:c)/c),g=Math.floor(d*p+.5),f=Math.floor(c*p+.5);await l.resize(g,f,a.mode),null!=s&&s.angle&&await l.rotate({angle:s.angle});const m=[[Math.floor(i[0][0]*p+.5),Math.floor(i[0][1]*p+.5)],[Math.floor(i[1][0]*p+.5),Math.floor(i[1][1]*p+.5)],[Math.floor(i[2][0]*p+.5),Math.floor(i[2][1]*p+.5)],[Math.floor(i[3][0]*p+.5),Math.floor(i[3][1]*p+.5)]];await l.drawQuadrangle({location:m,strokeColor:a.strokeColor,lineWidth:a.lineWidth});const y=await l.getImage({ifDeleteObject:!0,isRGBA:e===Wn.RGBA,returnBlob:!1});await l.freeReservedData();const v={data:new Blob([y.imageData],{type:y.blobType}),width:y.imageWidth,height:y.imageHeight,resolutionX:y.imageXResolution,resolutionY:y.imageYResolution};return l.terminate(),v}async resize(t,e,i,s,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const r=new Xn,a=await r.initImage({source:t,isRGBA:e===Wn.RGBA,width:i,height:s,isBGRA:e===Wn.BGRA});if(a.srcBuffer&&(t=a.srcBuffer),n>0){let t=1;t=i>s?i/n:s/n;const e=Math.floor(i/t+.5),a=Math.floor(s/t+.5);await r.resize(e,a,o.mode);}const l=await r.getImage({ifDeleteObject:!0,isRGBA:e===Wn.RGBA,returnBlob:!1});await r.freeReservedData();const h={data:new Blob([l.imageData],{type:l.blobType}),width:l.imageWidth,height:l.imageHeight,resolutionX:l.imageXResolution,resolutionY:l.imageYResolution};return r.terminate(),h}}class tg{constructor(t){}}class eg extends tg{static create(t,e){return new eg(t,e)}constructor(t,e){super("cameraChanged"),l(this,"oldDeviceId",void 0),l(this,"newDeviceId",void 0),this.oldDeviceId=t,this.newDeviceId=e;}}class ig extends tg{static create(t){return new ig(t)}constructor(t){super("captured"),l(this,"pageUid",void 0),this.pageUid=t;}}class sg extends tg{static create(t){return new sg(t)}constructor(t){super("cropRectDeleted"),l(this,"rect",void 0),this.rect=t;}}class ng extends tg{static create(t){return new ng(t)}constructor(t){super("cropRectDrawn"),l(this,"rect",void 0),this.rect=t;}}class og extends tg{static create(t,e){return new og(t,e)}constructor(t,e){super("cropRectModified"),l(this,"oldRect",void 0),l(this,"newRect",void 0),this.oldRect=t,this.newRect=e;}}class rg extends tg{static create(t,e){return new rg(t,e)}constructor(t,e){super("currentIndexChanged"),l(this,"oldIndex",void 0),l(this,"newIndex",void 0),this.oldIndex=t,this.newIndex=e;}}class ag extends tg{static create(t,e){return new ag(t,e)}constructor(t,e){super("displayModeChanged"),l(this,"oldDisplayMode",void 0),l(this,"newDisplayMode",void 0),this.oldDisplayMode=t,this.newDisplayMode=e;}}class lg extends tg{static create(t,e){return new lg(t,e)}constructor(t,e){super("document"),l(this,"docUid",void 0),l(this,"docName",void 0),this.docUid=t,this.docName=e;}}class hg extends tg{static create(t,e){return new hg(t,e)}constructor(t,e){super("fitModeChanged"),l(this,"oldFitMode",void 0),l(this,"newFitMode",void 0),this.oldFitMode=t,this.newFitMode=e;}}class dg extends tg{static create(t,e){return new dg(t,e)}constructor(t,e){super("pagesDragged"),l(this,"indices",void 0),l(this,"pageUids",void 0),this.indices=t,this.pageUids=e;}}class cg extends tg{static create(t,e,i){return new cg(t,e,i)}constructor(t,e,i){super("pagesDropped"),l(this,"indicesBefore",void 0),l(this,"indicesAfter",void 0),l(this,"pageUids",void 0),this.indicesBefore=t,this.indicesAfter=e,this.pageUids=i;}}class ug extends tg{static create(t,e){return new ug(t,e)}constructor(t,e){super("pageRendered"),l(this,"index",void 0),l(this,"pageUid",void 0),this.index=t,this.pageUid=e;}}class pg extends tg{static create(t,e,i){return new pg(t,e,i)}constructor(t,e,i){super("pagesAdded"),l(this,"docUid",void 0),l(this,"indices",void 0),l(this,"pageUids",void 0),this.docUid=t,this.indices=e,this.pageUids=i;}}class gg extends tg{static create(t,e,i){return new gg(t,e,i)}constructor(t,e,i){super("pagesDeleted"),l(this,"docUid",void 0),l(this,"pageUids",void 0),l(this,"indices",void 0),this.docUid=t,this.pageUids=e,this.indices=i;}}class fg extends tg{static create(t,e){return new fg(t,e)}constructor(t,e){super("played"),l(this,"deviceId",void 0),l(this,"resolution",void 0),this.deviceId=t,this.resolution=e;}}class mg extends tg{static create(t,e){return new mg(t,e)}constructor(t,e){super("quadModified"),l(this,"oldQuad",void 0),l(this,"newQuad",void 0),this.oldQuad=t,this.newQuad=e;}}class yg extends tg{static create(t,e,i,s){return new yg(t,e,i,s)}constructor(t,e,i,s){super("resized"),l(this,"oldWidth",void 0),l(this,"oldHeight",void 0),l(this,"newWidth",void 0),l(this,"newHeight",void 0),this.oldWidth=t,this.oldHeight=e,this.newWidth=i,this.newHeight=s;}}class vg extends tg{static create(t,e,i,s){return new vg(t,e,i,s)}constructor(t,e,i,s){super("selectedPagesChanged"),l(this,"oldIndices",void 0),l(this,"newIndices",void 0),l(this,"oldPageUids",void 0),l(this,"newPageUids",void 0),this.oldIndices=t,this.newIndices=e,this.oldPageUids=i,this.newPageUids=s;}}class xg extends tg{static create(t){return new xg(t)}constructor(t){super("stopped"),l(this,"deviceId",void 0),this.deviceId=t;}}class wg extends tg{static create(t,e){return new wg(t,e)}constructor(t,e){super("toolModeChanged"),l(this,"oldToolMode",void 0),l(this,"newToolMode",void 0),this.oldToolMode=t,this.newToolMode=e;}}class bg extends tg{static create(t,e,i,s,n,o,r){return new bg(t,e,i,s,n,o,r)}constructor(t,e,i,s,n,o,r){super("vPointer"),l(this,"index",void 0),l(this,"pageUid",void 0),l(this,"imageX",void 0),l(this,"imageY",void 0),l(this,"canvasX",void 0),l(this,"canvasY",void 0),l(this,"nativeEvent",void 0),this.index=t,this.pageUid=e,this.imageX=i,this.imageY=s,this.canvasX=n,this.canvasY=o,this.nativeEvent=r;}}class Cg extends tg{static create(t,e){return new Cg(t,e)}constructor(t,e){super("zoomChanged"),l(this,"oldZoomRatio",void 0),l(this,"newZoomRatio",void 0),this.oldZoomRatio=t,this.newZoomRatio=e;}}class Sg extends tg{static create(t,e){return new Sg(t,e)}constructor(t,e){super("currentPageChanged"),l(this,"oldPageUid",void 0),l(this,"newPageUid",void 0),this.oldPageUid=t,this.newPageUid=e;}}class Pg extends tg{static create(t,e){return new Pg(t,e)}constructor(t,e){super("selectedAnnotationsChanged"),l(this,"oldAnnotationUids",void 0),l(this,"newAnnotationUids",void 0),this.oldAnnotationUids=t,this.newAnnotationUids=e;}}class Ag extends tg{static create(t,e){return new Ag(t,e)}constructor(t,e){super("annotationModeChanged"),l(this,"oldAnnotationMode",void 0),l(this,"newAnnotationMode",void 0),this.oldAnnotationMode=t,this.newAnnotationMode=e;}}class Tg extends tg{static create(t){return new Tg(t)}constructor(t){super("annotationLayerStateChanged"),l(this,"state",void 0),this.state=t;}}class kg extends tg{static create(t,e,i,s){return new kg(t,e,i,s)}constructor(t,e,i,s){super("addPagesToDoc"),l(this,"docUid",void 0),l(this,"pageUids",void 0),l(this,"indices",void 0),l(this,"index",void 0),this.docUid=t,this.pageUids=e,this.indices=i,this.index=s;}}class Dg extends tg{static create(t,e,i){return new Dg(t,e,i)}constructor(t,e,i){super("createPage"),l(this,"pageUid",void 0),l(this,"fileUid",void 0),l(this,"fileIndex",void 0),this.pageUid=t,this.fileUid=e,this.fileIndex=i;}}class Eg extends tg{static create(t,e,i){return new Eg(t,e,i)}constructor(t,e,i){super("movePages"),l(this,"docUid",void 0),l(this,"indices",void 0),l(this,"insertBeforeIndex",void 0),this.docUid=t,this.indices=e,this.insertBeforeIndex=i;}}class Ig extends tg{static create(t,e,i){return new Ig(t,e,i)}constructor(t,e,i){super("renameDocument"),l(this,"docUid",void 0),l(this,"oldName",void 0),l(this,"newName",void 0),this.docUid=t,this.oldName=e,this.newName=i;}}class Rg extends tg{static create(t,e){return new Rg(t,e)}constructor(t,e){super("reorderPages"),l(this,"docUid",void 0),l(this,"indices",void 0),this.docUid=t,this.indices=e;}}class Mg extends tg{static create(t,e,i){return new Mg(t,e,i)}constructor(t,e,i){super("switchPage"),l(this,"docUid",void 0),l(this,"one",void 0),l(this,"another",void 0),this.docUid=t,this.one=e,this.another=i;}}class Bg extends tg{static create(t,e,i){return new Bg(t,e,i)}constructor(t,e,i){super("updatePage"),l(this,"docUid",void 0),l(this,"pageUid",void 0),l(this,"data",void 0),this.docUid=t,this.pageUid=e,this.data=i;}}class Lg extends tg{static create(t){return new Lg(t)}constructor(t){super("autoCaptureChanged"),l(this,"enableAutoCapture",void 0),this.enableAutoCapture=t;}}class Ug extends tg{static create(t){return new Ug(t)}constructor(t){super("autoDetectChanged"),l(this,"enableAutoDetect",void 0),this.enableAutoDetect=t;}}class Og extends tg{static create(t){return new Og(t)}constructor(t){super("torchChanged"),l(this,"torchState",void 0),this.torchState=t;}}class _g extends tg{static create(t){return new _g(t)}constructor(t){super("cameraPlayed"),l(this,"resolution",void 0),this.resolution=t;}}class Ng extends tg{static create(t,e){return new Ng(t,e)}constructor(t,e){super("paginationChanged"),l(this,"current",void 0),l(this,"total",void 0),this.current=t,this.total=e;}}class Wg extends tg{static create(t,e){return new Wg(t,e)}constructor(t,e){super("visibleChanged"),l(this,"newVisibility",void 0),l(this,"oldVisibility",void 0),this.newVisibility=t,this.oldVisibility=e;}}class Fg extends tg{static create(t,e,i){return new Fg(t,e,i)}constructor(t,e,i){super("openDocument"),l(this,"doc",void 0),l(this,"viewerUid",void 0),l(this,"groupUid",void 0),this.doc=t,this.viewerUid=e,this.groupUid=i;}}class Hg extends tg{static create(t,e,i){return new Hg(t,e,i)}constructor(t,e,i){super("closeDocument"),l(this,"doc",void 0),l(this,"viewerUid",void 0),l(this,"groupUid",void 0),this.doc=t,this.viewerUid=e,this.groupUid=i;}}class Vg extends tg{static create(t,e,i,s){return new Vg(t,e,i,s)}constructor(t,e,i,s){super("gotoPage"),l(this,"docUid",void 0),l(this,"groupUid",void 0),l(this,"viewerUid",void 0),l(this,"index",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=i,this.index=s;}}class zg extends tg{static create(t){return new zg(t)}constructor(t){super("cameraInit"),l(this,"enableConvert",void 0),this.enableConvert=t;}}class jg extends tg{static create(t,e,i,s){return new jg(t,e,i,s)}constructor(t,e,i,s){super("selectPages"),l(this,"docUid",void 0),l(this,"groupUid",void 0),l(this,"viewerUid",void 0),l(this,"indices",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=i,this.indices=s;}}class $g extends tg{static create(t,e,i){return new $g(t,e,i)}constructor(t,e,i){super("filterChanged"),l(this,"docUid",void 0),l(this,"pageUids",void 0),l(this,"filterType",void 0),this.docUid=t,this.pageUids=e,this.filterType=i;}}class Gg extends tg{static create(t,e,i,s){return new Gg(t,e,i,s)}constructor(t,e,i,s){super("currentChangedByScroll"),l(this,"docUid",void 0),l(this,"groupUid",void 0),l(this,"viewerUid",void 0),l(this,"current",void 0),this.docUid=t,this.groupUid=e,this.viewerUid=i,this.current=s;}}class Xg extends tg{static create(t,e,i){return new Xg(t,e,i)}constructor(t,e,i){super("rotatePages"),l(this,"docUid",void 0),l(this,"angle",void 0),l(this,"pageUids",void 0),this.docUid=t,this.angle=e,this.pageUids=i;}}class Yg extends tg{static create(t,e,i){return new Yg(t,e,i)}constructor(t,e,i){super("cropPages"),l(this,"docUid",void 0),l(this,"rect",void 0),l(this,"pageUids",void 0),this.docUid=t,this.rect=e,this.pageUids=i;}}class Jg extends tg{static create(t,e){return new Jg(t,e)}constructor(t,e){super("perspectiveQuadChanged"),l(this,"quad",void 0),l(this,"isFull",void 0),this.quad=t,this.isFull=e;}}class qg extends tg{static create(t){return new qg(t)}constructor(t){super("deletePages"),l(this,"pageUids",void 0),this.pageUids=t;}}class Zg extends tg{static create(t,e,i){return new Zg(t,e,i)}constructor(t,e,i){super("operationsChanged"),l(this,"docUid",void 0),l(this,"undo",void 0),l(this,"redo",void 0),this.docUid=t,this.undo=e,this.redo=i;}}class Qg extends tg{static create(t,e,i,s,n){return new Qg(t,e,i,s,n)}constructor(t,e,i,s,n){super("perspective"),l(this,"docUid",void 0),l(this,"pageUid",void 0),l(this,"quad",void 0),l(this,"width",void 0),l(this,"height",void 0),this.docUid=t,this.pageUid=e,this.quad=i,this.width=s,this.height=n;}}class Kg extends tg{static create(t){return new Kg(t)}constructor(t){super("pageExistenceChanged"),l(this,"pageCount",void 0),this.pageCount=t;}}class tf extends tg{static create(t){return new tf(t)}constructor(t){super("deleteDocs"),l(this,"docUids",void 0),this.docUids=t;}}class ef extends tg{static create(t,e,i,s){return new ef(t,e,i,s)}constructor(t,e,i,s){super("pagePreloadChanged"),l(this,"docUid",void 0),l(this,"viewerUid",void 0),l(this,"viewerMode",void 0),l(this,"changes",void 0),this.docUid=t,this.viewerUid=e,this.viewerMode=i,this.changes=s;}}class sf extends tg{static create(t){return new sf(t)}constructor(t){super("viewerCreated"),l(this,"viewer",void 0),this.viewer=t;}}class nf extends tg{static create(t,e){return new nf(t,e)}constructor(t,e){super("annotationsUpdated"),l(this,"uids",void 0),l(this,"actions",void 0),this.uids=t,this.actions=e;}}class of extends tg{static create(t,e,i,s){return new of(t,e,i,s)}constructor(t,e,i,s){super("copyPage"),l(this,"pageUid",void 0),l(this,"fileUid",void 0),l(this,"fileIndex",void 0),l(this,"annotations",void 0),this.pageUid=t,this.fileUid=e,this.fileIndex=i,this.annotations=s;}}let rf=0;const af=()=>{const t=`doc-${Date.now().toString()}-${rf.toString()}`;return rf+=1,t};function lf(t){t||(t=`D:${ks("yyyyMMddhhmmss")}`);if(/[+-]\d{2}'\d{2}'$/.test(t))return t;const e=-(new Date).getTimezoneOffset();return `${t}${e>=0?"+":"-"}${String(Math.floor(Math.abs(e)/60)).padStart(2,"0")}'${String(Math.abs(e)%60).padStart(2,"0")}'`}class hf{constructor(){var t,e;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(this,"type",void 0),l(this,"uid",void 0),l(this,"name",void 0),l(this,"pages",void 0),l(this,"tags",void 0),l(this,"creationDate",void 0),l(this,"author",void 0),l(this,"isDestroyed",void 0),l(this,"pageSize",void 0),this.uid=_s(),this.name=null!==(t=i.name)&&void 0!==t?t:af(),this.type=i.type||"document",this.pages=[],this.tags=i.tags||[],this.creationDate=lf(i.creationDate),this.author=null!==(e=i.author)&&void 0!==e?e:"",this.pageSize="none";}dispose(){this.isDestroyed=!0;}}class df{constructor(){l(this,"users",void 0),this.users=[];}addUser(t){this.users.push(t);}deleteUser(t){const e=this.users.indexOf(t);e>-1&&this.users.splice(e,1);}}var cf;!function(t){t.IMAGE_PNG="image/png",t.IMAGE_JPEG="image/jpeg",t.IMAGE_BMP="image/bmp",t.IMAGE_TIFF="image/tiff",t.IMAGE_JP2="image/jp2",t.APPLICATION_PDF="application/pdf";}(cf||(cf={}));class uf{constructor(t){let{uid:e,mime:i,pageCount:s}=t;l(this,"uid",void 0),l(this,"mime",void 0),l(this,"pageCount",void 0),l(this,"name",void 0),l(this,"count",void 0),l(this,"pages",void 0),this.uid=e,this.mime=i,this.count=0,this.pages=[],this.pageCount=s;for(let t=0;t<s;t++){const t=new df;this.pages.push(t);}}getPageByIndex(t){return this.pages[t]}addUser(t,e){const i=this.pages[t];return !!i&&(i.addUser(e),this.count+=1,!0)}deleteUser(t,e){const i=this.pages[t];return !!i&&(i.deleteUser(e),this.count-=1,!0)}}function pf(t,e,i,s){if(0===(e=(e%360+360)%360))return t;const n=e/90;for(let e=0;e<4;e++){const o=t[2*e],r=t[2*e+1];1===n?(t[2*e]=r,t[2*e+1]=s-o):2===n?(t[2*e]=i-o,t[2*e+1]=s-r):3===n&&(t[2*e]=i-r,t[2*e+1]=o);}return mf(t,8-2*n),t}function gf(t,e,i,s){if(0===(e=(e%360+360)%360))return t;const n=e/90;for(let e=0;e<4;e++){const o=t[2*e],r=t[2*e+1];1===n?(t[2*e]=s-r,t[2*e+1]=o):2===n?(t[2*e]=i-o,t[2*e+1]=s-r):3===n&&(t[2*e]=r,t[2*e+1]=i-o);}return mf(t,2*n),t}function ff(t,e,i){for(;e<i;){const s=t[e];t[e]=t[i],t[i]=s,e+=1,i-=1;}}function mf(t,e){const i=e%t.length;0!==i&&(ff(t,0,t.length-1),ff(t,0,i-1),ff(t,i,t.length-1));}const yf=t=>Array(4).fill(0).map(((e,i)=>[t[2*i],t[2*i+1]])),vf=(t,e,i)=>0===t[0][0]&&0===t[0][1]&&t[1][0]===e&&0===t[1][1]&&t[2][0]===e&&t[2][1]===i&&0===t[3][0]&&t[3][1]===i;class xf{constructor(t){l(this,"data",void 0),l(this,"width",void 0),l(this,"height",void 0),l(this,"url",void 0),l(this,"img",void 0),l(this,"users",void 0),l(this,"isDestroyed",void 0),l(this,"isAvailable",void 0),l(this,"pageWidth",void 0),l(this,"pageHeight",void 0),l(this,"docPage",void 0),this.isDestroyed=!1,this.users=[],this.isAvailable=!1,this.docPage=t;}getImageDetail(){const{docPage:t}=this;return {data:this.data,width:this.width,height:this.height,pageWidth:this.pageWidth,pageHeight:this.pageHeight,resolutionX:t.resolutionX,resolutionY:t.resolutionY,url:this.url,img:this.img}}getPageSize(){return {width:this.pageWidth,height:this.pageHeight}}updateImageDetail(t){if(!t)return;t.data&&(this.isAvailable=!0,this.data=t.data);const{docPage:e}=this;this.width=t.width,this.height=t.height,this.pageWidth=t.width/e.resolutionX*eo.displayResolution,this.pageHeight=t.height/e.resolutionY*eo.displayResolution;}addUser(t){this.getUserIndex(t)<0&&this.users.push(t);}deleteUser(t){const e=this.getUserIndex(t);e>-1&&this.users.splice(e,1);}hasUser(){return !!this.users.length}reset(){this.resetBlob(),this.resetImg();}resetBlob(){this.isAvailable=!1,this.data=null,this.url&&URL.revokeObjectURL(this.url),this.url=null;}resetImg(){this.img&&(this.img.src&&URL.revokeObjectURL(this.img.src),this.img.src=""),this.img=null;}getUserIndex(t){return this.users.findIndex((e=>{let{viewerUid:i,docUid:s,pageUid:n}=e;return i===t.viewerUid&&s===t.docUid&&n===t.pageUid}))}dispose(){this.isDestroyed=!0,this.isAvailable=!1,this.reset();}}function wf(t){const e=function(t){const e=[...t];e.sort(((t,e)=>e[1]-t[1]));let i=Number.MAX_SAFE_INTEGER,s=0;t.forEach(((t,e)=>{t[1]<i&&([,i]=t,s=e);}));const n=(s+3)%4,o=(s+1)%4,r=bf(t[n],t[s]),a=bf(t[o],t[s]);if(a>r)return n;return s}(t),i=t.map(((e,i)=>{let s=t[i+1];return 3===i&&([s]=t),Cf(s,e)}));let s=Math.max(i[e],i[(e+2)%4]),n=Math.max(i[(e+1)%4],i[(e+3)%4]);return s=Math.round(s),n=Math.round(n),{width:s,height:n}}function bf(t,e){const i=Math.abs(t[0]-e[0]),s=Cf(t,e);return Math.acos(i/s)}function Cf(t,e){return ((t[0]-e[0])**2+(t[1]-e[1])**2)**.5}const Sf=t=>{if(!t)return;t.forEach((t=>{const e=Math.ceil(t[0]);e-t[0]<=1e-7?t[0]=e:t[0]=Math.floor(t[0]);const i=Math.ceil(t[1]);i-t[1]<=1e-7?t[1]=i:t[1]=Math.floor(t[1]);}));};function Pf(t,e,i,s){e=(e%360+360)%360;const n={...t},{left:o,top:r,width:a,height:l}=t,h=Math.floor(e/90);return 1===h?(n.left=s-r-l,n.top=o):2===h?(n.left=i-o-a,n.top=s-r-l):3===h&&(n.left=r,n.top=i-o-a),h%2>0&&(n.width=l,n.height=a),n}class Af{constructor(t,e){let{fileIndex:i,pageUid:s,fileUid:n,rotation:o,filter:r,perspectiveQuad:a,annotations:h,pdfOptions:d,resource:c,cropBox:u,mediaBox:p,pageSize:g}=t;l(this,"uid",void 0),l(this,"doc",void 0),l(this,"metadata",void 0),l(this,"customData",void 0),l(this,"fileUid",void 0),l(this,"fileIndex",void 0),l(this,"resolutionX",void 0),l(this,"resolutionY",void 0),l(this,"filter",void 0),l(this,"rotation",void 0),l(this,"quad",void 0),l(this,"activeQuad",void 0),l(this,"isFull",void 0),l(this,"raw",void 0),l(this,"original",void 0),l(this,"display",void 0),l(this,"thumbnail",void 0),l(this,"editedDisplay",void 0),l(this,"initRotation",void 0),l(this,"editRotation",void 0),l(this,"actionRotation",void 0),l(this,"actions",void 0),l(this,"pActions",void 0),l(this,"actionResult",void 0),l(this,"pActionResult",void 0),l(this,"isDestroyed",void 0),l(this,"annotations",void 0),l(this,"pageSize",void 0),l(this,"cropBox",void 0),l(this,"mediaBox",void 0),l(this,"resource",void 0),l(this,"editCaches",void 0),l(this,"pdfOptions",void 0),l(this,"initState",void 0),this.uid=s,this.doc=e,this.annotations=h||[],this.resolutionX=c.resolutionX,this.resolutionY=c.resolutionY,this.fileIndex=i,this.fileUid=n,this.pageSize=null!=g?g:"none",this.resource=c,"none"===this.pageSize?(this.mediaBox={...p},this.cropBox={...u}):this.pageSize,this.filter=r,this.rotation=o||0,this.initRotation=o||0,this.editRotation=o||0,this.actionRotation=0,this.isFull=!0,this.pdfOptions=d,this.raw=new xf(this),this.original=new xf(this),this.display=new xf(this),this.thumbnail=new xf(this),this.editedDisplay=new xf(this);let f={width:c.width,height:c.height};if(this.raw.updateImageDetail(f),this.initState={mediaBox:this.mediaBox,cropBox:this.cropBox,rotation:o},a){f=wf(a),this.mediaBox={left:0,top:0,width:Cn(f.width,c.resolutionX,eo.displayResolution),height:Cn(f.height,c.resolutionY,eo.displayResolution)},this.cropBox={...this.mediaBox};const t=this.quadToDisplayPPI(a);this.setQuad(t);}this.original.updateImageDetail(f),this.display.updateImageDetail(f),this.actions=[],this.pActions=[],this.actionResult=new Map,this.pActionResult=new Map;}isMediaBoxEqualCropBox(){const{mediaBox:t,cropBox:e}=this;return t.left===e.left&&t.top===e.top&&t.width===e.width&&t.height===e.height}getPageSize(){return "inherit"===this.pageSize?this.doc.pageSize:this.pageSize}copy(t,e){const i=new Af({pageSize:this.getPageSize(),fileIndex:this.fileIndex,pageUid:t,fileUid:this.fileUid,rotation:this.rotation,filter:this.filter,pdfOptions:this.pdfOptions&&As(this.pdfOptions),mediaBox:As(this.mediaBox),cropBox:As(this.cropBox),resource:As(this.resource),annotations:[]},e),s=As(this.actions);s.forEach((t=>{t.docUid=e.uid;}));const n=As(this.pActions);n.forEach((t=>{t.docUid=e.uid;})),i.actions=s,i.pActions=n,i.initRotation=this.initRotation,i.actionRotation=this.actionRotation,i.editRotation=this.editRotation,i.quad=As(this.quad),i.activeQuad=As(this.activeQuad),i.isFull=this.isFull,i.actionResult=new Map(this.actionResult),i.pActionResult=new Map(this.pActionResult);const o={width:this.mediaBox.width||this.display.width||i.raw.width,height:this.mediaBox.height||this.display.height||i.raw.height};return i.original.updateImageDetail(o),i.display.updateImageDetail(o),i}setQuad(t){const e=this.isQuadFull(t);let i=!1;if(this.isFull=e,e)this.quad&&(i=!0,this.editRotation=this.rotation),this.quad=null,this.activeQuad=null;else {const{width:e,height:s}=this.raw.getPageSize(),n=pf(t.flat(),this.rotation,e,s),o=yf(n);let r,a;this.quad&&(a=this.quadToPixelPPI(o),r=this.quadToPixelPPI(this.quad),Sf(r),Sf(a)),this.quad&&Sn(r,a)||(this.quad=o,this.activeQuad=o,i=!0),this.editRotation=this.actionRotation;}return i&&this.clearActions(),i}setActiveQuad(t){const{width:e,height:i}=this.raw.getPageSize();if(!this.isFull){const s=pf(t.flat(),this.rotation,e,i),n=yf(s);this.activeQuad=n;}}getQuadVertices(){let t;const{width:e,height:i}=this.raw.getPageSize();return t=this.isFull?[0,0,e,0,e,i,0,i]:this.activeQuad.flat(),t=gf(t,this.rotation,e,i),t}getProcessedQuad(){if(this.quad){let{width:t,height:e}=this.raw.getPageSize(),{quad:i}=this;i=this.quad.map((t=>[this.toPixelPPI(t[0],!1),this.toPixelPPI(t[1],!0)])),t=this.toPixelPPI(t,!1),e=this.toPixelPPI(e,!0);const s=gf(i.flat(),this.initRotation,t,e);return yf(s)}return null}toggleFull(){let t=!1;return this.isFull&&this.activeQuad?(this.isFull=!1,t=!0):this.isFull||(this.isFull=!0,t=!0),t}isQuadFull(t){let{width:e,height:i}=this.raw.getPageSize();const s=Math.abs((this.rotation%360+360)%360);if(90===s||270===s){const t=e;e=i,i=t;}return vf(t,e,i)}getEditResultForPixel(){const t=this.getEditResult();return {rWidth:this.toPixelPPI(t.rWidth,!1),rHeight:this.toPixelPPI(t.rHeight,!0),cropLeft:this.toPixelPPI(t.cropLeft,!1),cropTop:this.toPixelPPI(t.cropTop,!0),cropWidth:this.toPixelPPI(t.cropWidth,!1),cropHeight:this.toPixelPPI(t.cropHeight,!0),rotation:t.rotation}}getEditResult(){if(!this.actions.length){const t=Pf(this.cropBox,this.rotation,this.mediaBox.width,this.mediaBox.height);return {rWidth:t.width,rHeight:t.height,cropLeft:this.cropBox.left,cropTop:this.cropBox.top,cropWidth:this.cropBox.width,cropHeight:this.cropBox.height,rotation:this.rotation,mediaBox:{...this.mediaBox},cropBox:{...this.cropBox}}}const t=this.actions[this.actions.length-1],{rotatedCropBox:e,cropBox:i,rotation:s}=this.actionResult.get(t.actionUid).to;return {rWidth:e.width,rHeight:e.height,cropLeft:i.left,cropTop:i.top,cropWidth:i.width,cropHeight:i.height,rotation:s,mediaBox:{...this.mediaBox},cropBox:{...i}}}getEditResultForPerspective(){const t=this.raw.getPageSize(),e={left:0,top:0,width:t.width,height:t.height};if(!this.pActions.length){const i=Pf(e,this.rotation,e.width,e.height);return {rWidth:i.width,rHeight:i.height,cropLeft:0,cropTop:0,cropWidth:t.width,cropHeight:t.height,rotation:this.rotation,cropBox:{...e},mediaBox:e}}const i=this.pActions[this.pActions.length-1],{rotatedCropBox:s,cropBox:n,rotation:o}=this.pActionResult.get(i.actionUid).to;return {rWidth:s.width,rHeight:s.height,cropLeft:n.left,cropTop:n.top,cropWidth:n.width,cropHeight:n.height,rotation:o,mediaBox:e,cropBox:{...n}}}getActions(){return [...this.actions]}getPerspectiveActions(){return this.pActions}addAction(t){let e=null;if(this.actions.length){const t=this.actionResult.get(this.actions[this.actions.length-1].actionUid);e={mediaBox:{...t.to.mediaBox},cropBox:{...t.to.cropBox},rotation:t.to.rotation,rotatedCropBox:{...t.to.rotatedCropBox}};}else e={mediaBox:{...this.mediaBox},cropBox:{...this.cropBox},rotation:this.rotation,rotatedCropBox:{...this.cropBox}};if(this.actions.push(t),!this.actionResult.has(t.actionUid)){const i=function(t,e,i,s){let n={...t};const o=e.left+e.width,r=e.top+e.height;let a=i,l=Pf(t,a,o,r);if("rotate"===s.type)a+=s.angle,l=Pf(t,a,o,r);else if("crop"===s.type){const t=s.rect;l={left:t.left+l.left,top:t.top+l.top,width:t.width,height:t.height},n=function(t,e,i,s){e=(e%360+360)%360;const n={...t},{left:o,top:r,width:a,height:l}=t,h=Math.floor(e/90);return 1===h?(n.left=r,n.top=s-a-o):2===h?(n.left=i-a-o,n.top=s-l-r):3===h&&(n.left=i-l-r,n.top=o),h%2>0&&(n.width=l,n.height=a),n}(l,a,o,r);}return {rotatedCropBox:l,cropBox:n,mediaBox:e,rotation:a}}(e.cropBox,this.mediaBox,this.rotation,t);this.actionResult.set(t.actionUid,{from:e,to:i}),this.cropBox={...i.cropBox},this.mediaBox={...i.mediaBox};}if("rotate"===t.type){let e=null;const{width:i,height:s}=this.raw.getPageSize(),n={left:0,top:0,width:i,height:s};if(this.pActions.length){const t=this.pActionResult.get(this.pActions[this.pActions.length-1].actionUid);e={mediaBox:{...t.to.mediaBox},cropBox:{...t.to.cropBox},rotation:t.to.rotation,rotatedCropBox:{...t.to.rotatedCropBox}};}else e={mediaBox:{...n},cropBox:{...n},rotation:this.rotation,rotatedCropBox:{...n}};if(this.pActions.push(t),!this.pActionResult.has(t.actionUid)){const n=function(t,e,i,s){const n=i+s.angle;return {rotatedCropBox:Pf(t,n,e.left+e.width,e.top+e.height),cropBox:t,mediaBox:e,rotation:n}}({left:0,top:0,width:i,height:s},{left:0,top:0,width:i,height:s},this.rotation,t);this.pActionResult.set(t.actionUid,{from:e,to:n});}this.rotation+=t.angle;}}deleteAction(t){var e,i;if((null===(e=this.actions[this.actions.length-1])||void 0===e?void 0:e.actionUid)===t){this.actions.pop();const e=this.actionResult.get(t);this.cropBox={...e.from.cropBox},this.mediaBox={...e.from.mediaBox},this.rotation=e.from.rotation,this.actionResult.delete(t);}(null===(i=this.pActions[this.pActions.length-1])||void 0===i?void 0:i.actionUid)===t&&(this.pActions.pop(),this.pActionResult.delete(t));}clearActions(){this.actions=[];}toDisplayPPI(t,e){const{resolutionX:i,resolutionY:s}=this;return e?t/s*eo.displayResolution:t/i*eo.displayResolution}toPixelPPI(t,e){const{resolutionX:i,resolutionY:s}=this;return e?t*s/eo.displayResolution:t*i/eo.displayResolution}quadToDisplayPPI(t){const e=As(t);for(let t=0;t<4;t++)e[t][0]=this.toDisplayPPI(e[t][0],!1),e[t][1]=this.toDisplayPPI(e[t][1],!0);return e}quadToPixelPPI(t){const e=As(t);for(let t=0;t<4;t++)e[t][0]=this.toPixelPPI(e[t][0],!1),e[t][1]=this.toPixelPPI(e[t][1],!0);return e}rectToDisplayPPI(t){const e={...t};return e.left=this.toDisplayPPI(t.left,!1),e.top=this.toDisplayPPI(t.top,!0),e.width=this.toDisplayPPI(t.width,!1),e.height=this.toDisplayPPI(t.height,!0),e}rectToPixelPPI(t){const e={...t};return e.left=this.toPixelPPI(t.left,!1),e.top=this.toPixelPPI(t.top,!0),e.width=this.toPixelPPI(t.width,!1),e.height=this.toPixelPPI(t.height,!0),e}dispose(){this.raw.reset(),this.original.reset(),this.display.reset(),this.thumbnail.reset(),this.isDestroyed=!0;}getAnnotationUids(){return [...this.annotations]}}class Tf extends Tn{constructor(){super(),l(this,"uid",void 0),l(this,"emitter",void 0),l(this,"repo",void 0),l(this,"onDocumentCreated",En(this)),l(this,"onDocumentDeleted",En(this)),l(this,"onDocumentRenamed",En(this)),l(this,"onPagesAdded",En(this)),l(this,"onAddPagesToDoc",En(this)),l(this,"onBeforeDeletePagesFromDoc",En(this)),l(this,"onDeletePagesFromDoc",En(this)),l(this,"onBeforeDeleteAllPagesFromDoc",En(this)),l(this,"onDeleteAllPagesFromDoc",En(this)),l(this,"onMovePages",En(this)),l(this,"onSwitchPage",En(this)),l(this,"onReorderPages",En(this)),l(this,"onBeforeDeleteDocs",En(this)),l(this,"onAfterDeleteDocs",En(this)),l(this,"onOpenDocument",En(this)),l(this,"onCloseDocument",En(this)),this.emitter=new Fs,this.uid=_s(),this.repo=new Map;}dispose(){this.repo.forEach((t=>t.dispose())),this.repo.clear(),super.dispose();}reset(){this.repo.clear();}createDocument(){const t=new hf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});this.repo.set(t.uid,t);const e=lg.create(t.uid,t.name);return this.onDocumentCreated.emit(e),t}getDocument(t){return this.repo.get(t)}getAllDocuments(){return Array.from(this.repo.values())}renameDocument(t,e){const i=this.repo.get(t);if(!i)return !1;const s=Ig.create(t,i.name,e);return i.name=e,this.onDocumentRenamed.emit(s),!0}deleteDocuments(t){return t.forEach((t=>{const e=this.getDocument(t);e.dispose(),this.repo.delete(t);const i=lg.create(t,e.name);this.onDocumentDeleted.emit(i);})),!0}addPagesToDocument(t,e,i){const s=this.repo.get(t);if(!s)return !1;const{length:n}=e,o=[];let r=s.pages.length;Bs(i)?(s.pages.splice(i,0,...e),r=i):s.pages.push(...e);for(let t=0;t<n;t++)o.push(r+t);const a=kg.create(t,e,o,i);return this.onAddPagesToDoc.emit(a),!0}removePagesFromDocument(t,e){const i=this.getDocument(t);if(!i)return !1;const s=e.map((t=>i.pages.indexOf(t)));e.forEach((t=>{cn(i.pages,t);}));const n=gg.create(t,e,s);return this.onBeforeDeletePagesFromDoc.emit(n),this.onDeletePagesFromDoc.emit(n),!0}removeAllPagesFromDocument(t){const e=this.getDocument(t);if(!e)return !1;const i=[...e.pages.keys()],s=[...e.pages];e.pages.length=0;const n=gg.create(t,s,i);return this.onBeforeDeleteAllPagesFromDoc.emit(n),this.onDeleteAllPagesFromDoc.emit(n),!0}movePages(t,e,i){const s=this.repo.get(t);if(!s)return !1;un(s.pages,e,i);const n=Eg.create(t,e,i);return this.onMovePages.emit(n),!0}swapPages(t,e,i){const s=this.repo.get(t);if(!s)return !1;pn(s.pages,e,i);const n=Mg.create(t,e,i);return this.onSwitchPage.emit(n),!0}reorderPages(t,e){const i=this.repo.get(t);if(!i)return !1;gn(i.pages,e);const s=Rg.create(t,e);return this.onReorderPages.emit(s),!0}}class kf{on(t,e){}emit(t){}}(new kf).on("debug",(function(){}));class Df{constructor(){l(this,"undoStack",void 0),l(this,"redoStack",void 0),this.undoStack=[],this.redoStack=[];}getOperation(){return {undo:this.undoStack.length,redo:this.redoStack.length}}execute(t){return !!t.execute()&&(this.undoStack.push(t),this.redoStack.length>0&&(this.redoStack.forEach((t=>{t.dispose();})),this.redoStack.length=0),!0)}undo(){const t=this.undoStack.pop();return t&&(t.undo(),this.redoStack.push(t)),!!t}redo(){const t=this.redoStack.pop();return t&&(t.execute(),this.undoStack.push(t)),!!t}removeUidsFromCommand(t){this.removeFromStack(this.undoStack,t),this.removeFromStack(this.redoStack,t);}removeFromStack(t,e){t.slice().forEach((e=>{if(!e.isValid){const i=t.indexOf(e);t.splice(i,1),e.dispose();}}));}reset(){this.undoStack.forEach((t=>{t.dispose();})),this.redoStack.forEach((t=>{t.dispose();})),this.undoStack=[],this.redoStack=[];}}class Ef extends Tn{constructor(){super(),l(this,"invokers",void 0),l(this,"onOperationsChanged",En(this)),l(this,"onBeforeRefreshCommands",En(this)),l(this,"onRefreshCommands",En(this)),this.invokers=new Map;}createInvoker(t){if(!this.invokers.has(t)){const e=new Df;this.invokers.set(t,e);}}deleteInvokers(t){t.forEach((t=>{if(this.invokers.has(t)){const e=this.invokers.get(t);null==e||e.reset(),this.invokers.delete(t);}}));}execute(t,e){const i=this.invokers.get(e);!(null==i||!i.execute(t))&&this.emitOperationsChanged(e);}undo(t){const e=this.invokers.get(t),i=!(null==e||!e.undo());return i&&this.emitOperationsChanged(t),i}redo(t){const e=this.invokers.get(t),i=!(null==e||!e.redo());return i&&this.emitOperationsChanged(t),i}saveOperations(t){const e=this.invokers.get(t);return !!e&&(e.reset(),this.emitOperationsChanged(t),!0)}getOperationState(t){return this.invokers.get(t).getOperation()}removePageFromCommand(t,e){this.onBeforeRefreshCommands.emit({docUid:t,pageUids:e});this.invokers.get(t).removeUidsFromCommand(e),this.emitOperationsChanged(t);}emitOperationsChanged(t){const e=this.invokers.get(t);let i=0,s=0;if(e){const t=e.getOperation();i=t.undo,s=t.redo;}const n=Zg.create(t,i,s);this.onOperationsChanged.emit(n);}dispose(){this.invokers.clear(),super.dispose();}reset(){this.invokers.forEach((t=>{t.reset();})),this.invokers.clear();}}class If extends Tn{constructor(){super(),l(this,"files",void 0),l(this,"onDeleteFileData",void 0),this.files=new Map,this.onDeleteFileData=En(this);}dispose(){this.files.clear(),super.dispose();}reset(){this.files.clear();}addFile(t,e,i){const s=new uf({uid:t,mime:e,pageCount:i});this.files.set(t,s);}getByUid(t){return this.files.get(t)}addUser(t,e,i){const s=this.getByUid(t);return null==s?void 0:s.addUser(e,i)}addUsersByParsedPages(t,e){e.forEach((e=>{this.addUser(t,e.fileIndex,e.pageUid);}));}deleteUser(t,e,i){const s=this.getByUid(t);return s&&(s.deleteUser(e,i),s.count||(this.onDeleteFileData.emit(t),this.files.delete(t))),!1}}class Rf extends Tn{constructor(t){super(),l(this,"pages",void 0),l(this,"core",void 0),l(this,"onUpdatePage",En(this)),l(this,"onCreatePage",En(this)),l(this,"onCopyPage",En(this)),l(this,"onDeletePages",En(this)),l(this,"onBeforeDeletePages",En(this)),l(this,"onAfterDeletePages",En(this)),l(this,"onBeforeCopyPages",En(this)),l(this,"onCopyPages",En(this)),this.core=t,this.pages=new Map;}handlePagePreloadChange(t){let{viewerUid:e,viewerMode:i,docUid:s,changes:n}=t;n.forEach((t=>{let{pageUid:n,from:o,to:r}=t;const a=this.getPage(n),l={viewerUid:e,docUid:s,pageUid:n},{autoReleaseBlob:h,autoReleaseImg:d}=eo;o&&!r?(a.raw.deleteUser(l),a.raw.hasUser()||(this.core.imageLoadService.cancelLoadRawImage(n),this.core.parserService.cancelGetPage(a.fileUid,a.fileIndex),h&&a.raw.resetBlob(),d&&a.raw.resetImg()),i!==vp.DEFAULT&&i!==vp.THUMBNAIL||(a.original.deleteUser(l),a.original.hasUser()||(this.core.imageLoadService.cancelLoadOriginalImage(n),h&&a.original.resetBlob(),d&&a.original.resetImg()),a.display.deleteUser(l),a.display.hasUser()||(this.core.imageLoadService.cancelLoadDisplayImage(n),h&&a.display.resetBlob(),d&&a.display.resetImg())),i===vp.THUMBNAIL&&(a.thumbnail.deleteUser(l),a.thumbnail.hasUser()||(this.core.imageLoadService.cancelLoadThumbnailImage(n),h&&a.thumbnail.resetBlob(),d&&a.thumbnail.resetImg())),a.raw.hasUser()||this.core.parserService.cancelGetPage(a.fileUid,a.fileIndex)):(a.raw.addUser(l),i!==vp.DEFAULT&&i!==vp.THUMBNAIL||(a.original.addUser(l),a.display.addUser(l)),i===vp.THUMBNAIL&&a.thumbnail.addUser(l));}));}dispose(){this.pages.clear(),super.dispose();}reset(){this.pages.clear();}getPage(t){return this.pages.get(t)}createPagesByParsedPages(t,e,i,s){t.forEach(((t,n)=>{this.createPage({...t,fileUid:i,annotations:e[n]},s);}));}createPage(t,e){const i=new Af(t,e);this.pages.set(i.uid,i);const s=Dg.create(t.pageUid,t.fileUid,t.fileIndex);return this.onCreatePage.emit(s),i}copyPage(t,e,i){const s=i.copy(t,e);return this.pages.set(s.uid,s),of.create(t,s.fileUid,s.fileIndex,i.annotations.slice()),s}deletePages(t){const e=qg.create(t);this.onBeforeDeletePages.emit(e),t.forEach((t=>{const e=this.pages.get(t);e&&e.dispose(),this.pages.delete(t);})),this.onDeletePages.emit(e),this.onAfterDeletePages.emit(e);}updatePage(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.pages.get(t);if(s){const{doc:n,customData:o}=s;s.dispose();const r=new Af({...i,pageUid:t},n);r.customData=o,this.pages.set(t,r);const a=Bg.create(n.uid,t,e);this.onUpdatePage.emit(a);}}getPageCount(){return this.pages.size}}var Mf=new WeakSet;class Bf{constructor(t){a(this,Mf),l(this,"core",void 0),l(this,"annotationMapper",void 0),this.core=t,this.annotationMapper=new Yd;}reset(){}async saveToPng(t,i){const s=this.core.pageService.getPage(t);if(!s)return Promise.resolve(null);const n=await this.core.getPageData(t,{display:!0,renderAnnotation:!(null==i||!i.saveAnnotation)});if((null==i||!i.saveAnnotation)&&n.fileData&&"image/png"===n.fileData.type&&!e(Mf,this,Lf).call(this,s))return n.fileData;const o=this.core.saverService.getSaver("image/png");try{return await o.save(n.display.data,{outputType:3})}finally{o.destroy();}}async saveToJpeg(t,i){const s=this.core.pageService.getPage(t);if(!s)return Promise.resolve(null);const n=await this.core.getPageData(t,{display:!0,renderAnnotation:!(null==i||!i.saveAnnotation)});if((null==i||!i.saveAnnotation)&&n.fileData&&"image/jpeg"===n.fileData.type&&!e(Mf,this,Lf).call(this,s))return n.fileData;const o=this.core.saverService.getSaver("image/jpeg");try{return await o.save(n.display.data,{outputType:1,jpegQuality:null==i?void 0:i.quality})}finally{o.destroy();}}async saveToTiff(t,e){const i=this.core.saverService.getSaver("image/tiff"),s=!(null==e||!e.saveAnnotation);try{await i.init(e);for(let e=0;e<t.length;e++){const n=t[e];if(!this.core.pageService.getPage(n))break;const o=await this.core.getPageData(n,{display:!0,renderAnnotation:s});await i.appendPage(o.display.data);}return await i.getTiff()}finally{i.destroy();}}async saveToPdf(t,e){null!=e&&e.creationDate&&(e.creationDate=lf(e.creationDate)),null!=e&&e.modifiedDate&&(e.modifiedDate=lf(e.modifiedDate)),!e||"annotation"!==e.saveAnnotation&&"flatten"!==e.saveAnnotation||Hu.makeSureAnnotationLicenseExist();const i=this.core.saverService.getSaver("application/pdf");try{await i.init(e);const l=new Map,h=e&&e.pageType&&e.pageType!==co.PAGE_DEFAULT;let d=0;for(let c=0;c<t.length;c++){var s,n;const u=t[c],p=this.core.pageService.getPage(u);if(!p)break;const g=await this.core.getPageData(u,{raw:!0,display:!0,renderAnnotation:"image"===(null==e?void 0:e.saveAnnotation)}),f=await this.core.imageDataService.getNotRotatedDisplay(u,"image"===(null==e?void 0:e.saveAnnotation)),m=h||(null===(s=p.pdfOptions)||void 0===s?void 0:s.convertMode)===Uh.CM_IMAGEONLY||(null===(n=p.pdfOptions)||void 0===n?void 0:n.renderOptions.renderGrayscale),y=[],v=[];if(g.fileData&&"application/pdf"===g.fileData.type&&!m)for(let i=c;i<t.length;i++){var o,r;const s=t[i],n=this.core.pageService.getPage(s);if(!n)break;if(n.fileUid!==p.fileUid)break;if(!n.isFull)break;if("image"===(null==e?void 0:e.saveAnnotation)&&n.annotations.length>0)break;if((null===(o=n.pdfOptions)||void 0===o?void 0:o.convertMode)===Uh.CM_IMAGEONLY||null!==(r=n.pdfOptions)&&void 0!==r&&r.renderOptions.renderGrayscale)break;let a=!1;n.filter&&"none"!==n.filter&&(a=!0);const h=n.getActions(),u=n.getPerspectiveActions();h.every((t=>"rotate"===t.type||"crop"===t.type))&&u.every((t=>"rotate"===t.type||"crop"===t.type))||(a=!0);let g=!1;if(a){this.core.getAnnotationsByPageUid(t[c]).forEach((t=>{t.oriIndex>=0&&!t.modified&&(g=!0);}));}if(a&&!g)break;l.set(d+y.length,{mediaBox:n.mediaBox,cropBox:n.cropBox,rotation:n.rotation}),y.push(n.fileIndex),g&&v.push({pageUid:s,pageIndex:i});}if(y.length>0){var a;const t=null===(a=(await this.core.sourceStore.get(p.fileUid)).loadOptions)||void 0===a?void 0:a.password;await i.appendRawPdfPages(g.fileData,t,y),c+=y.length-1,d+=y.length;for(let t=0;t<v.length;t++){const s=await this.core.imageDataService.getNotRotatedDisplay(v[t].pageUid,"image"===(null==e?void 0:e.saveAnnotation));await i.changePageImage(v[t].pageIndex,s.data,{cropBox:p.cropBox,mediaBox:p.mediaBox,rotation:p.rotation,width:f.width,height:f.height});}}else await i.appendImagePage(f.data,{cropBox:p.cropBox,mediaBox:p.mediaBox,rotation:p.rotation,width:f.width,height:f.height}),d+=1;}l.size>0&&await i.setPageInfo(l);const c=[];for(let s=0;s<t.length;s++)if(!e||"annotation"!==e.saveAnnotation&&"flatten"!==e.saveAnnotation)await i.removePageAnnotations(s);else {const n=this.core.pageService.getPage(t[s]);if(!n)continue;const o=n.pdfOptions&&n.pdfOptions.convertMode===Uh.CM_RENDERALL&&n.pdfOptions.renderOptions.renderAnnotations===Oh.RENDER_ANNOTATIONS,r=this.core.getAnnotationsByPageUid(t[s]);if(!r.length){o||await i.removePageAnnotations(s);continue}r.forEach((t=>{!["textBox","textTypewriter"].includes(t.type)||!t.modified&&Bs(null==t?void 0:t.oriIndex)||t.style.textContents.forEach((t=>{c.push({family:t.fontFamily,isBlob:"bold"===t.fontWeight,isItalic:"italic"===t.fontStyle});}));}));const a=await this.annotationMapper.getOriginalAnnotations(r,{width:n.mediaBox.left+n.mediaBox.width,height:2*n.mediaBox.top+n.mediaBox.height});await i.setPageAnnotations(s,a,o),"flatten"===e.saveAnnotation&&await i.flattenPage(s);}if(c.length){await i.ifFontsExist(c)||zc.warning(zc.WASM_FONT_LOSS);}return await i.getPdf(Hn.RT_BINARY)}finally{i.destroy();}}}function Lf(t){if(!t.isFull)return !0;if(t.filter&&"none"!==t.filter)return !0;if(t.getActions().some((t=>"rotate"!==t.type)))return !0;return !!t.getPerspectiveActions().some((t=>"rotate"!==t.type))||0!==t.rotation}const Uf=t=>{const e=new Set(t);return Array.from(e.values())};class Of extends Tn{constructor(){super(),l(this,"observer",void 0),l(this,"onResizeObserver",En(this)),this.observer=new ResizeObserver((t=>{t.forEach((t=>{this.onResizeObserver.emit(t);}));}));}observe(t){this.observer.observe(t);}unobserve(t){this.observer.unobserve(t);}reset(){this.observer.disconnect();}dispose(){this.observer.disconnect(),this.observer=null,super.dispose();}}class _f{constructor(){l(this,"canvas",void 0),l(this,"renderer",void 0),l(this,"root",void 0);document.createElement("canvas").getContext("2d",{willReadFrequently:!0}),this.renderer=new bl,this.canvas=new il({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement,(new sd).init(this.canvas);}render(t,e,i){this.root.children.slice().forEach((t=>{this.root.removeChild(t);})),this.root.appendChild(t),this.canvas.resize(e||t.width,i||t.height),this.canvas.render();}reset(){this.root.children.slice().forEach((t=>{this.root.removeChild(t);})),this.root.sortable.sorted=[];}getCanvas(){return this.canvas.contextService.getDomElement()}}let Nf;function Wf(t){let e=-1;Nf||(Nf=function(){const t=new Int32Array(256);for(let e=0;e<256;e++){let i=e;for(let t=0;t<8;t++)i=1&i?3988292384^i>>>1:i>>>1;t[e]=i;}return t}());for(let i=0;i<t.length;i++)e=Nf[255&(e^t[i])]^e>>>8;return ~e}const Ff="image/png",Hf="image/jpeg",Vf="p".charCodeAt(0),zf="H".charCodeAt(0),jf="Y".charCodeAt(0),$f="s".charCodeAt(0);function Gf(t,e){const i=t.slice(0,33);return new Promise(((s,n)=>{const o=new FileReader;o.onload=()=>{const i=new Uint8Array(o.result),n=t.slice(33),r=function(t,e,i,s){if(i===Hf)return t[13]=1,t[14]=e>>8,t[15]=255&e,t[16]=e>>8,t[17]=255&e,t;if(i===Ff){const i=new Uint8Array(13);e*=39.3701,i[0]=Vf,i[1]=zf,i[2]=jf,i[3]=$f,i[4]=e>>>24,i[5]=e>>>16,i[6]=e>>>8,i[7]=255&e,[i[8],i[9],i[10],i[11]]=[i[4],i[5],i[6],i[7]],i[12]=1;const n=Wf(i),o=new Uint8Array(4);if(o[0]=n>>>24,o[1]=n>>>16,o[2]=n>>>8,o[3]=255&n,s){const e=function(t){for(let e=t.length-1;e>=4;e--)if(9===t[e-4]&&t[e-3]===Vf&&t[e-2]===zf&&t[e-1]===jf&&t[e]===$f)return e-3;return -1}(t);return t.set(i,e),t.set(o,e+13),t}const r=new Uint8Array(4);r[0]=0,r[1]=0,r[2]=0,r[3]=9;const a=new Uint8Array(54);return a.set(t,0),a.set(r,33),a.set(i,37),a.set(o,50),a}throw new Error(`The format ${i} is not supported.`)}(i,e,t.type),a=new Blob([r,n],{type:t.type});s(a);},o.onerror=t=>{n(t);},o.readAsArrayBuffer(i);}))}class Xf{constructor(t){l(this,"core",void 0),this.core=t;}async getRaw(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.raw.isAvailable)return i.raw.getImageDetail();const{fileUid:s,fileIndex:n}=i,o=await this.core.sourceStore.get(s);let r;r=this.core.parserService.getCustomParserClasses(o.fileData.type)?o.fileData.type:await bn(o.fileData),r||zc.throw(zc.FILE_NOT_SUPPORT);const a=await this.core.parserService.getPage(o.fileData,r,s,n);if(!a)return null;let{raw:l}=i;return e||(l=new xf(i)),l.updateImageDetail(a.resource),l.getImageDetail()}catch(t){return zc.error(t),null}}async getOriginal(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;const{original:s}=i;if(s.isAvailable)return s.getImageDetail();const n=await this.getRaw(t);if(!n)return null;const o=await this.handlePerspectiveQuad(t,n);return e&&o&&i.original.updateImageDetail(o),o}async handlePerspectiveQuad(t,e){const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;let s=e;const n=i.getProcessedQuad();if(n&&(s=await this.core.perspectiveService.perspective({data:e.data,type:Wn.JPEG},n,{angle:i.initRotation}),!s))return null;const o=new xf(i);return o.updateImageDetail(s),o.getImageDetail()}async getDisplay(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.display.isAvailable)return i.display.getImageDetail();const s=await this.getOriginal(t);if(!s)return null;const{filter:n}=i,o=await this.handleFilter(t,s);return i.filter!==n?this.getDisplay(t):(e&&o&&i.display.updateImageDetail(o),o)}async handleFilter(t,e){const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;const s=e,{filter:n}=i;if(n&&"none"!==n){const t=await this.core.filterService.applyFilter({data:e.data,type:Wn.JPEG,width:e.width,height:e.height},n);if(!t)return null;s.data=t;}const o=new xf(i);return o.updateImageDetail(s),o.getImageDetail()}async getEditedDisplay(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=this.core.pageService.getPage(t);if(!s||s.isDestroyed)return null;const n=await this.getDisplay(t,!1);if(s.getActions().length||0!==s.rotation||!s.isMediaBoxEqualCropBox()||e&&s.annotations.length){const n=await this.applyEditToDisplay(t,e,i),o=new xf(s);return o.updateImageDetail(n),o.getImageDetail()}return n}async getNotRotatedDisplay(t,e){const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;const s=await this.getOriginal(t);if(!s)return null;const n=await this.handleFilter(t,s);if(e&&i.annotations.length){const s=await this.applyEditToDisplay(t,e,!1,!1),n=new xf(i);return n.updateImageDetail(s),n.getImageDetail()}return n}async getThumbnail(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.core.pageService.getPage(t);if(!i||i.isDestroyed)return null;if(i.thumbnail.isAvailable)return i.thumbnail.getImageDetail();const s=await this.getDisplay(t,!0);if(!s)return null;const n=await this.displayToThumbnail(s.data);return n?(e&&i.thumbnail.updateImageDetail(n),n):null}async displayToThumbnail(t){return t}async applyEditToDisplay(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=await this.core.imageLoadService.loadDisplayImage(t),o=this.core.pageService.getPage(t),r=await this.getDisplay(t,!1);let a;if(s)a=o.getEditResultForPixel();else {const[t,e]=Cn([o.initState.mediaBox.width,o.initState.mediaBox.height],eo.displayResolution,o.resource.resolutionX);a={rWidth:t,rHeight:e,cropLeft:0,cropTop:0,cropWidth:t,cropHeight:e,rotation:0};}const l={width:Math.round(a.rWidth),height:Math.round(a.rHeight),data:null},h=new ya({style:{x:-a.cropLeft,y:-a.cropTop,img:n,width:r.width,height:r.height}}),d=new Aa({style:{x:-(a.cropWidth-a.rWidth)/2,y:-(a.cropHeight-a.rHeight)/2,width:a.cropWidth,height:a.cropHeight}});if(d.appendChild(h),d.setLocalAngle(a.rotation),this.core.annotationService&&o.annotations.length&&e){const e=new Aa({style:{x:-a.cropLeft,y:-a.cropTop,width:o.original.pageWidth,height:o.original.pageHeight}});await this.applyAnnotationToPage(e,t,i),d.appendChild(e);}this.core.commonCanvas.render(d,a.rWidth,a.rHeight),this.core.commonCanvas.reset();const c=this.core.commonCanvas.getCanvas();return new Promise(((t,e)=>{c.toBlob((async e=>{e=await Gf(e,o.resolutionX||eo.displayResolution),l.data=e,t(l);}),"image/jpeg",1);}))}async applyAnnotationToPage(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=this.core.pageService.getPage(e),n=[];s.annotations.forEach((t=>{const e=this.core.annotationService.getAnnotationByUid(t);n.push(e);})),n.sort(((t,e)=>t.layer-e.layer));for(let e=0;e<n.length;e++){if(i&&!n[e].flags.includes("print"))continue;if("stamp"===n[e].type&&n[e].style.imageData&&(!Bs(n[e].style.width)||!Bs(n[e].style.height))){const t=new Yn,i=await t.readImageInfo({fileSource:n[e].style.imageData});let s=i.imageWidth,o=i.imageHeight;if(s>400||o>400){const t=Math.max(s/400,o/400);s/=t,o/=t;}n[e].style.width=s,n[e].style.height=o;}const o=this.core.annotationService.createAnnotationShape(n[e],s);o instanceof vh&&o.style.imageData&&o.style.img instanceof HTMLImageElement&&await new Promise((t=>{o.style.img.onload=()=>{t();};})),o&&t.appendChild(o);}}}class Yf{constructor(t){l(this,"name",void 0),this.name=t||"Guest";}getUser(){return this.name}setUser(t){this.name=t;}}class Jf extends tg{static create(t){return new Jf(t)}constructor(t){super("setExternalHandler"),l(this,"handlerType",void 0),this.handlerType=t;}}class qf{static makeSureSourcesTypeSupported(t,e,i,s){const n=[];if(Ss(t))t.forEach(((t,i)=>{if(!t||0===t.length){const t=jc("Source[]",e,`[${i}].fileData`,!0);n.push(`${t}: ${zc.FILE_NOT_SUPPORT.message}`);}}));else if(!t||0===t.length){const t=jc("Source",e,"fileData");n.push(`${t}: ${zc.FILE_NOT_SUPPORT.message}`);}n.length>0&&zc.throw({...zc.FILE_NOT_SUPPORT,details:n},i,s);}}const Zf=new Map,Qf=[];let Kf=class t extends Tn{constructor(t,e,i,s,n){super(),l(this,"parserService",void 0),l(this,"saverService",void 0),l(this,"perspectiveService",void 0),l(this,"filterService",void 0),l(this,"detectorService",void 0),l(this,"viewerService",void 0),l(this,"editService",void 0),l(this,"annotationService",void 0),l(this,"documentService",void 0),l(this,"trackerService",void 0),l(this,"imageLoadService",void 0),l(this,"optimizationService",void 0),l(this,"processService",void 0),l(this,"commandService",void 0),l(this,"fileSaveService",void 0),l(this,"fileService",void 0),l(this,"pageService",void 0),l(this,"resizeService",void 0),l(this,"imageDataService",void 0),l(this,"userService",void 0),l(this,"sourceStore",void 0),l(this,"commonCanvas",void 0),l(this,"onBeforeLoadSource",void 0),l(this,"onSetExternalHandler",void 0),l(this,"onAfterPerspective",void 0),l(this,"onFilterChanged",void 0),l(this,"onUnload",void 0),this.parserService=t,this.saverService=e,this.perspectiveService=i,this.filterService=s,this.detectorService=n,this.onBeforeLoadSource=En(this),this.onSetExternalHandler=En(this),this.onUnload=En(this),this.onAfterPerspective=En(this),this.onFilterChanged=En(this),this.commonCanvas=new _f,this.sourceStore=new xp,this.trackerService=new kf,this.documentService=new Tf,this.fileService=new If,this.pageService=new Rf(this),this.imageLoadService=new Yp(this),this.optimizationService=new Qp,this.processService=new Kp,this.commandService=new Ef,this.fileSaveService=new Bf(this),this.resizeService=new Of,this.imageDataService=new Xf(this),this.userService=new Yf("Guest"),Qf.forEach((t=>{var e;null===(e=t.apply)||void 0===e||e.call(t,this);})),this.initServiceEvent();}initServiceEvent(){const{documentService:t,commandService:e,pageService:i,viewerService:s,fileService:n,parserService:o}=this;t.onDocumentCreated.on((t=>{e.createInvoker(t.docUid);}),e),t.onDocumentDeleted.on((t=>{e.deleteInvokers([t.docUid]);}),e),s.onPagePreloadChanged.on((t=>{i.handlePagePreloadChange(t);}),i),n.onDeleteFileData.on((t=>{this.sourceStore.remove(t);})),n.onDeleteFileData.on((t=>{o.freeParserByFileUid(t);}),o);}static getClass(t){return Zf.get(t)}static setClass(t,e){Zf.set(t,e);}static registerPlugin(e){Qf.includes(e)||Qf.push(e),e.install&&e.install(t);}getClass(t){return Zf.get(t)}createAsyncRepository(){return new xp}createViewer(e){const i=t.getClass("Viewer"),s={...e,core:this,groupUid:e.groupUid||_s()},n=this.viewerService.createViewer(i,s);return n.context.isInitialized=!0,n}removeViewer(t){this.viewerService.removeViewer(t.uid);}getViewer(t){return this.viewerService.getViewer(t)}getViewers(){return this.viewerService.getAllViewers()}getFileParserDefaultOptions(t){return this.parserService.getDefaultParserOptions(t)}setFileParserDefaultOptions(t,e){return this.parserService.setDefaultParserOptions(t,e)}setFileParser(t,e){this.parserService.registerCustomParser(t,e);}getSourceParseOptions(t,e){if("application/pdf"===e){var i;const e=t;return e.convertMode=null!==(i=e.convertMode)&&void 0!==i?i:Uh.CM_AUTO,As(e)}if("width"in t){return As(t)}}async loadSource(t,e,i){Ss(t)||(t=[t]);const s=this.documentService.getDocument(e);if(!s)return [];const n=Bs(i)?{insertBeforeIndex:i}:{...i},o="ignore"===n.exception,r=await this.getSourcesMimeTypes(t);o||qf.makeSureSourcesTypeSupported(r,"sources");const a=async(t,i)=>{const a=r[i];o&&qf.makeSureSourcesTypeSupported(a,`sources[${i}]`);const l=[],h=_s(),d=this.getSourceParseOptions(t,a),{fileData:c}=t,{pageCount:u,batchSize:p}=await this.parserService.getParseInfo(c,a,h,d);this.sourceStore.set(h,{fileData:a===c.type?c:c.slice(0,c.size,a),loadOptions:d}),this.fileService.addFile(h,a,u);const g=this.getBatchIndices(p,u);for(const i of g){var f;const o=await this.parserService.parse(c,a,h,i,d).catch((t=>{throw t}));null===(f=t.extraPageData)||void 0===f||f.forEach((t=>{const e=o.find((e=>e.fileIndex===t.index));if(e){const i={...t};delete i.index,Bs(e.rotation)&&Bs(i.rotation)&&(i.rotation+=e.rotation),Ts(i.filter)||(e.filter=i.filter),Ts(i.rotation)||(e.rotation=i.rotation),Ts(i.perspectiveQuad)||(e.perspectiveQuad=i.perspectiveQuad),Ts(i.index)||(e.index=i.index);}}));const r=o.map((t=>{var e;const i=_s();return t.pageUid=i,null!==(e=t.filter)&&void 0!==e||(t.filter=this.filterService.getDefaultFilterType()||"none"),i}));this.fileService.addUsersByParsedPages(h,o);const u=this.annotationService.createAnnotationsByParsedPages(e,o);this.pageService.createPagesByParsedPages(o,u,h,s),this.documentService.addPagesToDocument(e,r,n.insertBeforeIndex),Ts(n.insertBeforeIndex)||(n.insertBeforeIndex+=o.length),l.push(...r);}return l};this.onBeforeLoadSource.emit({docUid:e});const l=[];for(const[e,i]of t.entries())try{const t=await a(i,e);l.push(...t);}catch(t){if(!o)throw t;zc.warning(t);}return this.documentService.onPagesAdded.emit(pg.create(e,l.map((t=>s.pages.indexOf(t))),l)),l}async getSourcesMimeTypes(t){const e=[];for(const i of t){const t=this.parserService.getCustomParserClasses(i.fileData.type)?i.fileData.type:await bn(i.fileData);e.push(t);}return e}getAnnotationsByPageUid(t){const e=this.pageService.getPage(t);return e?e.annotations.map((t=>this.annotationService.getAnnotationByUid(t))):[]}getBatchIndices(t,e){const i=[];for(let s=0;s<e;){const n=t>0?Math.min(t,e-s):e;i.push(Array.from({length:n},((t,e)=>s+e))),s+=n;}return i}async getPageData(t,e){var i;null!==(i=e)&&void 0!==i||(e={raw:!0,display:!0,thumbnail:!0,renderAnnotation:!1,isGetPrintPageData:!1});const s=this.pageService.getPage(t);if(!s)return null;const n=await this.sourceStore.get(s.fileUid);let{quad:o}=s;o&&(o=s.quadToPixelPPI(o),Sf(o));const r={uid:s.uid,fileData:"application/ddv-blank-image"!==n.fileData.type?n.fileData:null,fileIndex:s.fileIndex,perspectiveQuad:o,rotation:s.rotation,filter:s.filter,mediaBox:{...s.mediaBox},cropBox:{...s.cropBox}};if(e.raw){const e=await this.imageDataService.getRaw(t);r.raw={...e};}if(e.display){const i=await this.imageDataService.getEditedDisplay(t,e.renderAnnotation,e.isGetPrintPageData);r.display={...i};}if(e.thumbnail){const i=await this.imageDataService.getEditedDisplay(t,e.renderAnnotation,e.isGetPrintPageData);r.thumbnail={...i};}return r}async setCustomData(t,e){const i=this.pageService.getPage(t);return i?(i.customData=As(e),!0):Promise.reject()}async getCustomData(t){const e=this.pageService.getPage(t);if(!e)return Promise.reject();return As(e.customData)}async updatePage(t,e){var i,s;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=this.pageService.getPage(t);if(!o)return !1;const r=_s(),a=this.parserService.getCustomParserClasses(e.type)?e.type:await bn(e);qf.makeSureSourcesTypeSupported([a],"data");const l=this.getSourceParseOptions({fileData:e},a),{pageCount:h}=await this.parserService.getParseInfo(e,a,r,l);if(Bs(n.fileIndex)&&(n.fileIndex>=h||n.fileIndex<0))return zc.reject(zc.PARAM_OUT_OF_RANGE,"IDocument.updatePage","updatePageOptions.fileIndex");this.sourceStore.set(r,{fileData:e,loadOptions:l}),this.fileService.addFile(r,a,h);const[d]=await this.parserService.parse(e,a,r,[n.fileIndex||0],l).catch((t=>{throw t}));d.pageUid=t,null!==(i=d.filter)&&void 0!==i||(d.filter=this.filterService.getDefaultFilterType()||"none");const c=this.annotationService.createAnnotationsByParsedPages(o.doc.uid,[d]);return this.commandService.removePageFromCommand(o.doc.uid,[t]),this.fileService.addUser(r,n.fileIndex,t),this.fileService.deleteUser(o.fileUid,o.fileIndex,t),null===(s=this.annotationService)||void 0===s||s.deleteAnnotations(o.annotations,!1),this.pageService.updatePage(t,e,{...d,...n,fileUid:r,annotations:c[0]}),!0}async getPerspectivePreviewData(t,e,i){const s=this.pageService.getPage(t),n=await this.imageDataService.getRaw(t);if(!s||!n)return null;let{quad:o}=s;o||(o=[[0,0],[n.width,0],[n.width,n.height],[0,n.height]]);const r=await this.processService.perspectivePreview(n.data,4,o,{width:n.width,height:n.height},{...e,...i});return Promise.resolve(r)}createDocument(t){return this.documentService.createDocument(t)}getDocument(t){return this.documentService.getDocument(t)}deleteDocuments(t){const{documentService:e,pageService:i}=this;if(t.map((t=>e.getDocument(t))).includes(void 0))return !1;const s=tf.create(t);e.onBeforeDeleteDocs.emit(s),t.forEach((t=>{const s=e.getDocument(t);var n;s&&(s.pages.forEach((t=>{const e=i.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t);})),null===(n=this.annotationService)||void 0===n||n.deleteAnnotationPages([...s.pages]),i.deletePages(s.pages));}));const n=e.deleteDocuments(t);return e.onAfterDeleteDocs.emit(s),n}renameDocument(t,e){this.documentService.renameDocument(t,e);}transferDocument(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{documentService:s}=this,n=s.getDocument(t),o=s.getDocument(e);if(!n||!o)return !1;if(t===e&&!i.copy)return !i.sourceIndices||this.movePages(t,i.sourceIndices,i.insertBeforeIndex);let r=[];if(null!=i&&i.sourceIndices){r=Uf(i.sourceIndices).map((t=>n.pages[t]));}else r=[...n.pages];if(!r.length)return !0;i.copy?r.forEach(((t,e,s)=>{const n=this.pageService.getPage(t),r=_s();if(this.fileService.addUser(n.fileUid,n.fileIndex,r),this.pageService.copyPage(r,o,n),!1!==(null==i?void 0:i.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(r);const t=n.annotations.map((t=>({...this.annotationService.getAnnotationByUid(t).getConfig(),docUid:o.uid,pageUid:r,uid:_s()})));t.length&&this.annotationService.annotationApp.createAnnotations(t);}s[e]=r;})):(s.removePagesFromDocument(n.uid,r),r.forEach((t=>{const e=this.pageService.getPage(t);var s;(e.doc=o,!1===(null==i?void 0:i.includeAnnotations))&&(null===(s=this.annotationService)||void 0===s||s.deleteAnnotations(e.annotations),e.annotations=[]);}))),s.addPagesToDocument(o.uid,r,i.insertBeforeIndex);const a=r.map((t=>o.pages.indexOf(t)));return s.onPagesAdded.emit(pg.create(o.uid,a,r)),!0}mergeDocuments(t,e){const{documentService:i}=this,s=i.createDocument(e);if(!t.length)return s;t=Uf(t);const n=[];if(t.forEach((t=>{const e=i.getDocument(t);n.push(...e.pages);})),null!=e&&e.deleteOriginal?(i.deleteDocuments(t),n.forEach((t=>{const i=this.pageService.getPage(t);var n;(i.doc=s,!1===(null==e?void 0:e.includeAnnotations))&&(null===(n=this.annotationService)||void 0===n||n.deleteAnnotations(i.annotations),i.annotations=[]);}))):n.forEach(((t,i,n)=>{const o=this.pageService.getPage(t),r=_s();if(this.fileService.addUser(o.fileUid,o.fileIndex,r),this.pageService.copyPage(r,s,o),!1!==(null==e?void 0:e.includeAnnotations)&&this.annotationService){this.annotationService.annotationApp.createAnnotationPage(r);const t=o.annotations.map((t=>({...this.annotationService.getAnnotationByUid(t).getConfig(),docUid:s.uid,pageUid:r,uid:_s()})));t.length&&this.annotationService.annotationApp.createAnnotations(t);}n[i]=r;})),n.length){i.addPagesToDocument(s.uid,n);const t=n.map((t=>s.pages.indexOf(t)));i.onPagesAdded.emit(pg.create(s.uid,t,n));}return s}openDocument(t,e){return this.openOrCloseDocument(t,e)}closeDocument(t,e){return this.openOrCloseDocument(t,e,!0)}openOrCloseDocument(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=this.documentService.getDocument(t);if(!s||!this.viewerService.hasViewer(e))return !1;const n=this.viewerService.getViewer(e);return i?this.documentService.onCloseDocument.emit(Hg.create(s,e,n.groupUid)):this.documentService.onOpenDocument.emit(Fg.create(s,e,n.groupUid)),this.commandService.emitOperationsChanged(t),!0}deletePages(t,e){var i;return e=Uf(e),this.commandService.removePageFromCommand(t,[...e]),e.forEach((t=>{const e=this.pageService.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t);})),null===(i=this.annotationService)||void 0===i||i.deleteAnnotationPages(e),this.documentService.removePagesFromDocument(t,[...e]),this.pageService.deletePages(e),!0}deleteAllPages(t){var e;const i=this.documentService.getDocument(t),s=[...i.pages];return this.commandService.removePageFromCommand(t,s),i.pages.forEach((t=>{const e=this.pageService.getPage(t);this.fileService.deleteUser(e.fileUid,e.fileIndex,t);})),null===(e=this.annotationService)||void 0===e||e.deleteAnnotationPages(i.pages),this.documentService.removeAllPagesFromDocument(t),this.pageService.deletePages(s),!0}movePages(t,e,i){return e=Uf(e),this.documentService.movePages(t,e,i)}swapPages(t,e,i){return this.documentService.swapPages(t,e,i)}reorderPages(t,e){return e=Uf(e),this.documentService.reorderPages(t,e)}async printPages(t,e,i){const s=this.documentService.getDocument(t);if(!s)return Promise.reject(zc.DOC_NOT_EXIST);const n=e||Array.from(Array(s.pages.length).keys()),o=[];for(let t=0;t<n.length;t++){var r;const e=await this.getPageData(s.pages[n[t]],{raw:!1,display:!0,thumbnail:!1,renderAnnotation:null===(r=null==i?void 0:i.printAnnotation)||void 0===r||r,isGetPrintPageData:!0});o.push(e);}if(0===o.length)return Promise.reject();const a=[];return o.forEach((t=>{a.push({data:t.display.data,width:t.display.width,height:t.display.height});})),function(t){let e,i,s="";t.forEach(((t,n)=>{let o=1120,r=850;const a=r/t.width,l=o/t.height;a<l?o=Math.floor(t.height*a):a>l&&(r=Math.floor(t.width*l)),s+=`<div class="imageContainer"><img id="DDV_Image${n}" src='${Ns(t.data).data}' referrerpolicy='strict-origin-when-cross-origin'"/></div>`,e+=r,i+=o;}));const n=`alwaysRaised=yes, z-look=yes, top=0, left=0, toolbar=no, menubar=no, location=no, status=no,width=${e}, height=${i}`,o=window.open("about:blank","_blank",n),r=`<html><head>\n                    <style>\n                        @page {\n                            margin: 0mm;\n                        }\n                        @media print {\n                            body, html {\n                                margin: 0;\n                                padding: 0;\n                                width: 100%;\n                                height: 100%;\n                            }\n\n                            .imageContainer {\n                                break-after: page;\n                                position: relative;\n                                width: 100%;\n                                height: 100%;\n                                display: flex;\n                                align-items: center;\n                                justify-content: center\n                            }\n\n                            img {\n                                width: 100%;\n                                max-width: 100%;\n                                max-height: 100%;\n                            }\n                        }\n                    </style>\n                </head><body id='DDV_body'>${s}</body></html>`;if(o){o.document.write(r),o.document.close(),o.focus();const t=o.document.getElementById("DDV_body");t&&(t.onload=()=>{o&&o.print();});}}(a),!0}setDetectHandler(t,e){this.onSetExternalHandler.emit(Jf.create("detect")),this.detectorService.setDetector(e);}setImageFilterHandler(t){this.onSetExternalHandler.emit(Jf.create("filter")),this.filterService.setImageFilter(t);}clearExternalHandler(t){if(Ls(t))switch(t){case"documentBoundariesDetect":this.setDetectHandler(t,null);break;case"imageFilter":this.setImageFilterHandler(null);}}unload(){var t;this.viewerService.reset(),this.commonCanvas.reset(),this.sourceStore.reset(),this.documentService.reset(),this.fileService.reset(),this.pageService.reset(),this.commandService.reset(),this.resizeService.reset(),this.processService.reset(),this.detectorService.reset(),this.parserService.reset(),this.fileSaveService.reset(),null===(t=this.annotationService)||void 0===t||t.reset(),Hu.reset(),Mn.unload();}preloadModule(t){Mn.preloadModule(t);}async perspectivePage(t,e,i){let s;const n=this.pageService.getPage(e);if(n.setQuad(i)){if(this.annotationService.deleteAnnotations(n.annotations),this.commandService.removePageFromCommand(t,[e]),n.quad){const{width:t,height:e}=wf(n.quad);n.original.updateImageDetail({width:t,height:e}),n.display.updateImageDetail({width:t,height:e});}this.imageLoadService.cancelLoadOriginalImage(e),n.original.reset(),s=await this.imageDataService.getOriginal(e),this.imageLoadService.cancelLoadDisplayImage(e),this.imageLoadService.cancelLoadThumbnailImage(e),n.display.reset(),n.thumbnail.reset();const{width:o,height:r}=n.original.getPageSize();n.isFull?(n.mediaBox={...n.initState.mediaBox},n.cropBox={...n.initState.cropBox}):(n.mediaBox={left:0,top:0,width:o,height:r},n.cropBox={...n.mediaBox}),this.onAfterPerspective.emit(Qg.create(t,e,i,o,r));}return s||this.imageDataService.getOriginal(e)}async filterPages(t,e,i){e.forEach((t=>{const e=this.pageService.getPage(t);e.filter!==i&&(e.filter=i,e.display.reset(),e.thumbnail.reset());}));const s=$g.create(t,e,i);return this.onFilterChanged.emit(s),!0}insertBlankPage(t,e,i,s,n,o){const r=this.documentService.getDocument(t);if(!r)return "";this.onBeforeLoadSource.emit({docUid:t});const a=_s(),l={fileData:new Blob([""],{type:"application/ddv-blank-image"}),width:null!=e?e:816,height:null!=i?i:1056,resolutionX:null!=s?s:96,resolutionY:null!=n?n:96},h=this.getSourceParseOptions(l,"application/ddv-blank-image");this.sourceStore.set(a,{fileData:l.fileData,loadOptions:h}),this.fileService.addFile(a,"application/ddv-blank-image",1),this.parserService.parse(l.fileData,"application/ddv-blank-image",a,[0],h);const{displayResolution:d}=eo,c=_s();this.fileService.addUser(a,0,c);const u={resource:{data:l.fileData,width:l.width,height:l.height,resolutionX:l.resolutionX,resolutionY:l.resolutionY},mediaBox:{left:0,top:0,width:l.width/l.resolutionX*d,height:l.height/l.resolutionY*d},cropBox:{left:0,top:0,width:l.width/l.resolutionX*d,height:l.height/l.resolutionY*d},annotations:[],fileIndex:0,pageUid:c,fileUid:a};return this.pageService.createPage(u,r),this.annotationService.createAnnotationsByParsedPages(t,[u]),this.documentService.addPagesToDocument(t,[c],o),this.documentService.onPagesAdded.emit(pg.create(t,[r.pages.indexOf(c)],[c])),c}};function tm(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const{tag:i,style:s,id:n,className:o,children:r}=t,a=document.createElement(i);return n&&(a.id=n+e),o&&(a.className=o),s&&function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ls(e))t.style.cssText=e;else if(i){let i="";Object.keys(e).forEach((t=>{i+=`${t}:${e[t]};`;})),t.style.cssText=i;}else Object.keys(e).forEach((i=>{t.style[i]=e[i];}));}(a,s),r&&r.forEach((t=>{const i=tm(t,e);a.appendChild(i);})),a}function em(t){t&&(t.style.display="none");}function im(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&(t.style.display=e);}const sm=t=>parseFloat(Number(t).toFixed(4));class nm extends Tn{constructor(){super(),l(this,"uid",void 0),l(this,"type",void 0),l(this,"action",void 0),l(this,"isValid",void 0),this.isValid=!0,this.uid=_s();}execute(){return null}undo(){return null}}new class extends Tn{constructor(){super(...arguments),l(this,"docCreated",En(this)),l(this,"docDeleted",En(this)),l(this,"pageAdded",En(this)),l(this,"pageDeleted",En(this)),l(this,"annotationCreated",En(this)),l(this,"annotationDeleted",En(this)),l(this,"annotationUpdated",En(this)),l(this,"replyToAnnotation",En(this)),l(this,"commentDeleted",En(this)),l(this,"commentUpdated",En(this));}};const om={canvasStyle:{cursor:"default"},currentPageStyle:{border:""},pageStyle:{border:"2px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"2px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"2px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{width:24,height:24,left:"50%",top:"",right:"",bottom:"0px",translateX:"-50%",translateY:0,border:"0px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",onPage:!1,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle"},checkboxStyle:{width:24,height:24,left:0,top:0,right:"",bottom:"",translateX:0,translateY:0,border:"1px solid #000",borderRadius:0,background:"#fff",opacity:1,visibility:"visible",visibleByHover:!0,checkMarkColor:"#000",checkMarkLineWidth:2},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",border:"1px solid #515151",borderRadius:"50%",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},quadSelectionStyle:{border:"1px dashed #fe8e14",ctrlBorderRadius:0,ctrlBorder:"1px dashed #fe8e14",ctrlWidth:10,ctrlHeight:10,invalidCtrlBorderColor:"#fe8e14",invalidBorderColor:"#fe8e14"},enableDragPage:!0,dragThreshold:3,dragStartTimeThreshold:500,enablePanX:!0,enablePanY:!0,panThreshold:3,enableZoom:!0,enableZoomWithCtrl:!0,enableZoomWithTouch:!0,zoom:1,minZoom:.02,maxZoom:8,wheelZoomFactor:1.2,tapZoomFactor:1.2,zoomOrigin:{x:"center",y:"center"},enableZoomInCropMode:!0,enableZoomInPanMode:!0,enableZoomInAnnotationMode:!0,enableSlide:!0,startSlideThreshold:20,slideThreshold:.2,startSlideThresholdForPerspective:30,slideThresholdForPerspective:.2,multiselectMode:!1,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0,scrollDirection:"vertical",displayMode:"single",fitMode:"window",margin:10,rows:4,columns:1,maxRows:20,maxColumns:20,visibility:"visible",viewerMode:vp.DEFAULT,toolMode:"pan",annotationMode:"select",enableMultiTab:!1,scrollToLatest:!1,autoScroll:!0,autoChangeIndex:!0,enableFillColor:!0,blankFillColor:"#fff",maxOptimizationSize:7e3,enableOptimizePage:!1,enableAnnotationUi:!1,enableAnnotationInteraction:!0,enableSelectAnnotation:!0,enableRotateAnnotation:!0,enableMoveAnnotation:!0,enableResizeAnnotation:!0,enableKeyboardInteraction:!0,enableZoomInWidthKeyboard:!0,enableZoomOutWidthKeyboard:!0,enableUndoWidthKeyboard:!0,enableRedoWidthKeyboard:!0,enableDeleteWidthKeyboard:!0,enableSelectAllWidthKeyboard:!0,enableMoveAnnotationWidthKeyboard:!0,enableSaveWidthKeyboard:!0,enableLoadSourceWidthKeyboard:!0,enablePrintWidthKeyboard:!0,enableSelectPageWidthKeyboard:!0,enableCopyCutPasteWidthKeyboard:!0,moveAnnotationStepSize:2,moveAnnotationAcceleration:1};class rm extends pa{constructor(){super({name:"Checkbox"}),l(this,"shapeType","checkbox"),l(this,"checkboxStyle",void 0),l(this,"parsedCheckboxStyle",void 0),l(this,"isChecked",!1);}get checked(){return this.isChecked}set checked(t){this.isChecked=t;}updateStyle(t){Object.assign(this.style,t);}}class am extends pa{constructor(){super({name:"PageNumber"}),l(this,"shapeType","pageNumber"),l(this,"text",void 0),l(this,"parsedPageNumberStyle",void 0),this.text="0";}updateText(t){this.text=t;}updateStyle(t){Object.assign(this.style,t);}}class lm extends Aa{constructor(t){super({...t,name:"TabPage"}),l(this,"uid",void 0),l(this,"tab",void 0),l(this,"isSelected",!1),l(this,"isHovered",!1),l(this,"isDragging",!1),l(this,"isLoading",!1),l(this,"isPreload",!1),l(this,"isLoaded",!1),l(this,"rWidth",void 0),l(this,"rHeight",void 0),l(this,"rotation",0),l(this,"cropLeft",void 0),l(this,"cropTop",void 0),l(this,"cropWidth",void 0),l(this,"cropHeight",void 0),l(this,"mediaBoxRect",void 0),l(this,"cropBoxRect",void 0),l(this,"isOptimized",!1),l(this,"optimizedUid","1"),l(this,"optimizationUid","2"),l(this,"editUid",void 0),l(this,"editedUid",void 0),l(this,"zoom",1),l(this,"image",void 0),l(this,"borderBox",void 0),l(this,"checkbox",void 0),l(this,"pageNumber",void 0),l(this,"curBox",void 0),l(this,"mediaBox",void 0),l(this,"cropBox",void 0),l(this,"realTimeBox",void 0),this.tab=t.tab,this.uid=t.uid,this.rWidth=t.style.width,this.rHeight=t.style.height,this.initSubShapes(t);}initSubShapes(t){this.updateStyle({visibility:"hidden"});const e=new ya({name:"pageImage",id:this.uid,style:{x:0,y:0,zIndex:-99999}}),i=new Aa({name:"pageOptimizedBox",style:{x:0,y:0}}),s=new Aa({name:"pageCropBox"});s.clippable=!0;const n=new Aa({name:"pageMediaBox"}),o=new Aa({name:"pageBorderBox",style:{...t.style,...t.formattedPageStyle}}),r=new Aa({name:"currentStyleBox",style:{visibility:"hidden"}}),a=new rm,l=new am;n.appendChild(e),s.appendChild(n),o.appendChild(i),o.appendChild(s),o.appendChild(r),o.appendChild(a),this.appendChild(l),this.appendChild(o),this.image=e,this.borderBox=o,this.realTimeBox=i,this.pageNumber=l,this.checkbox=a,this.curBox=r,this.cropBox=s,this.mediaBox=n;}getRect(){const t=this.realTimeBox.getPosition();return {left:t.x,top:t.y,width:this.rWidth,height:this.rHeight}}setImgDom(t){this.image.style.img=t;}getImgDom(){return this.image.style.img}clearOptimization(){this.isOptimized=!1,this.realTimeBox.imageData=null,this.image.updateStyle({visibility:"visible"}),this.optimizationUid=_s();}destroy(){this.image.style.img=null,this.image=null,this.realTimeBox=null;}setPage(t,e,i,s){this.updateStyle({x:t,y:e,width:i,height:s});}setBorderBox(t,e,i,s,n){Ts(n)?this.borderBox.updateStyle({x:t,y:e,width:i,height:s}):this.borderBox.updateStyle({x:t,y:e,width:i,height:s,borderWidth:n});}setCropBox(t,e,i,s,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.cropBox.setLocalScale(1),this.cropBox.updateStyle({x:t,y:e,width:i,height:s}),this.cropBox.setLocalScale(n),this.cropBox.setLocalAngle(o),180===this.cropBox.getAngle()&&this.cropBox.setLocalAngle(179.9);}setRealTimeBox(t,e,i,s,n){this.realTimeBox.setLocalScale(1),this.realTimeBox.updateStyle({x:t,y:e,width:i,height:s}),this.realTimeBox.setLocalScale(n,n,1);}setMediaBox(t,e,i,s){this.mediaBox.updateStyle({x:t,y:e,width:i,height:s});}setCurBox(t,e,i,s){this.curBox.updateStyle({x:t,y:e,width:i,height:s});}setImage(t,e,i,s){this.image.updateStyle({x:t,y:e,width:i,height:s});}}function hm(t){const{borderWidth:e,borderColor:i,borderStyle:s}=hn(t),n=parseInt(e||"0px",10);let o=[0,0];return "dashed"===s&&(o=[2*n,n]),{borderWidth:n,borderStyle:o,borderColor:i||"",lineDash:o}}const dm=t=>{const{border:e}=t;if(!e)return 0;const i=e.match(/[0-9]+/g)[0];return parseInt(i||"0",10)};function cm(t,e){if(Ts(t)||""===t)return null;const i=ar(t);return "%"===i.unit?e*i.value/100:i.value}function um(t,e,i){t.style.width=`${e}px`,t.style.height=`${i}px`;}function pm(t){const e=devicePixelRatio;return Bs(t)&&t>0?(t=Math.floor(t*e)/e)||(t=1/e):t=0,t}function gm(t){const e=devicePixelRatio;return Bs(t)?(t=Math.round(t*e)/e)||(t=1/e):t=0,t}function fm(t){return gm(t)}const mm=()=>{const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e};class ym{constructor(t,e){l(this,"tab",void 0),l(this,"viewerContext",void 0),l(this,"viewportWidth",600),l(this,"viewportHeight",800),l(this,"currentViewportWidth",0),l(this,"currentViewportHeight",0),l(this,"currentLayoutWidth",0),l(this,"currentLayoutHeight",0),l(this,"placeholderPages",[]),l(this,"scrollLeft",0),l(this,"scrollTop",0),l(this,"maxScrollLeft",0),l(this,"maxScrollTop",0),l(this,"startRow",0),l(this,"endRow",0),l(this,"startColumn",0),l(this,"endColumn",0),l(this,"preloadCount",1),l(this,"pagePreloadChanges",[]),l(this,"direction","vertical"),l(this,"displayMode",void 0),l(this,"fitMode",void 0),l(this,"rows",void 0),l(this,"columns",void 0),l(this,"zoom",void 0),l(this,"defaultReference",void 0),l(this,"zoomReference",void 0),l(this,"resizeReference",void 0),l(this,"oldZoom",void 0),l(this,"isZoomChanged",void 0),l(this,"isOutOfBounds",void 0),l(this,"isScrollbarResized",!0),l(this,"scrollbarWidthCache",void 0),l(this,"defaultWidth",void 0),l(this,"defaultHeight",void 0),this.tab=t,this.viewerContext=e;const{viewerConfig:i}=e;this.rows=i.rows,this.columns=i.columns,this.zoom=i.zoom,this.oldZoom=i.zoom,this.displayMode=i.displayMode,this.fitMode=i.fitMode,this.direction=i.scrollDirection,this.isZoomChanged=!1,this.isOutOfBounds=!1;}get isVertical(){return "vertical"===this.direction}get isContinuousDisplay(){return "continuous"===this.displayMode}get isSingleDisplay(){return "single"===this.displayMode}get scrollbarWidth(){if(!this.isScrollbarResized&&this.scrollbarWidthCache)return this.scrollbarWidthCache;const t=mm();return this.scrollbarWidthCache=t,this.isScrollbarResized=!1,t}getRealRowAndColumnContinuous(){const{rows:t,columns:e,isVertical:i}=this,{total:s}=this.tab;let n=t,o=e;return i?(n=Math.ceil(s/e),s<=e&&(o=Math.max(1,s),n=1)):(o=Math.ceil(s/t),s<=t&&(n=Math.max(1,s),o=1)),{realRow:n,realColumn:o}}getRealRowAndColumnThumbnail(){const{total:t}=this.tab,{rows:e,columns:i,isVertical:s}=this,n=s?i:Math.ceil(t/e);return {realRow:s?Math.ceil(t/i):e,realColumn:n}}getZoomOriginCord(){const{zoomOrigin:t}=this.viewerContext.viewerConfig,e={start:0,center:.5,end:1};return {originX:this.currentViewportWidth*e[t.x],originY:this.currentViewportHeight*e[t.y]}}getMargin(){return this.formatMarginAndGap(this.viewerContext.viewerConfig.margin)}getPageBorderWidth(){const{styleService:t}=this.viewerContext,{borderWidth:e}=t.getParsedPageStyle();return {borderWidth:e,selectedBorderWidth:t.getParsedSelectedPageStyle().borderWidth,hoveredBorderWidth:t.getParsedHoveredPageStyle().borderWidth}}getPages(){return this.tab.pages}getParsedPageNumberStyle(t,e){return this.viewerContext.styleService.getParsedPageNumberStyle({width:t,height:e})}getPageNumberStyle(){return this.viewerContext.viewerConfig.pageNumberStyle}getParsedCheckboxStyle(t,e){return this.viewerContext.styleService.getParsedCheckboxStyle({width:t,height:e})}getParsedPageStyle(){return this.viewerContext.styleService.getParsedPageStyle()}getParsedCurrentPageStyle(){return this.viewerContext.styleService.getParsedCurrentPageStyle()}getParsedSelectedPageStyle(){return this.viewerContext.styleService.getParsedSelectedPageStyle()}getParsedHoveredPageStyle(){return this.viewerContext.styleService.getParsedHoveredPageStyle()}getParsedPlaceholderStyle(){return this.viewerContext.styleService.getParsedPlaceholderStyle()}getParsedCanvasStyle(){return this.viewerContext.styleService.getParsedCanvasStyle()}formatMarginAndGap(t){if(Ls(t)){if(/px/.test(t)){const[e]=t.match(/(\d+)/);return parseInt(e,10)}const e=this.viewerContext.rendererService.getCanvasDom();if(/%/.test(t)){const i=e.width/ln(),[s]=t.match(/(\d+)/);return i*parseInt(s,10)/100}if(/em/.test(t)){const i=getComputedStyle(e).fontSize,[s]=i.match(/(\d+)/),[n]=t.match(/(\d+)/);return parseInt(s,10)*parseInt(n,10)}}return Bs(t)?t:parseInt(t,10)}setZoom(t){this.oldZoom=this.zoom,this.zoom=t,this.tab.pages.forEach((e=>{e.zoom=t;}));}getTabOffset(){const{maxScrollLeft:t,maxScrollTop:e,currentLayoutWidth:i,currentLayoutHeight:s,currentViewportWidth:n,currentViewportHeight:o,scrollLeft:r,scrollTop:a}=this;let l=0,h=0;const d=this.getParsedCanvasStyle().borderWidth||0;return l=t>0?-r:(n-(i-2*d))/2,h=e>0?-a:(o-(s-2*d))/2,{offsetX:l,offsetY:h}}parseReferenceDefault(){const{tab:t,maxScrollLeft:e,maxScrollTop:i}=this,s=t.current,n=this.placeholderPages[s];if(!n)return {scrollLeft:0,scrollTop:0};const o=this.getMargin();let r=n.x-o,a=n.y-o;return this.isContinuousDisplay&&(r=n.pageX-o,a=n.pageY-o),r=Us(r,0,e),a=Us(a,0,i),{scrollLeft:r,scrollTop:a}}parseReferenceZoom(t,e,i){if(Ts(t)&&(t=this.zoomReference),Ts(e)||Ts(i)){const{originX:t,originY:s}=this.getZoomOriginCord();e=t,i=s;}let{scrollLeft:s,scrollTop:n}=this.parseReference(t,e,i);const{maxScrollLeft:o,maxScrollTop:r}=this;return s=Us(s,0,o),n=Us(n,0,r),{scrollLeft:s,scrollTop:n}}parseReferenceResize(){const{resizeReference:t}=this;let{scrollLeft:e,scrollTop:i}=this.parseReference(t,0,0);const{maxScrollLeft:s,maxScrollTop:n}=this;return e=Math.min(e,s),i=Math.min(i,n),{scrollLeft:e,scrollTop:i}}updateReference(){const{currentViewportWidth:t,currentViewportHeight:e}=this,i=this.generateReference(0,0),s=this.generateReference(t/2,e/2),{originX:n,originY:o}=this.getZoomOriginCord(),r=this.generateReference(n,o);this.defaultReference=s,this.resizeReference=i,this.zoomReference=r;}generateReference(t,e){let i,s,n,o,r=null,a=Number.MAX_VALUE;const{offsetX:l,offsetY:h}=this.getTabOffset(),{zoom:d}=this;this.placeholderPages.forEach((c=>{if(c&&("single"===this.displayMode&&c.uid===this.tab.currentUid||"continuous"===this.displayMode)){const u=c.x+l,p=c.y+h,g=new Gs(u+c.width/2,p+c.height/2).distanceTo({x:t,y:e});g<a&&(a=g,r=c.uid,t<u?(i="start",n=u-t):t>u+c.width?(i="end",n=t-(u+c.width)):(i="center",n=(t-u)/d),e<p?(s="start",o=p-e):e>p+c.height?(s="end",o=e-(p+c.height)):(s="center",o=(e-p)/d));}}));return {pageX:n,pageY:o,positionX:i,positionY:s,pageUid:r}}parseReference(t,e,i){const{pageX:s,pageY:n,positionX:o,positionY:r,pageUid:a}=t,l=this.placeholderPages.find((t=>t.uid===a)),{zoom:h}=this;let d,c,u=0,p=0;return l&&("start"===o?d=l.x-s:"center"===o?d=l.x+s*h:"end"===o&&(d=l.x+l.width+s),"start"===r?c=l.y-n:"center"===r?c=l.y+n*h:"end"===r&&(c=l.y+l.height+n)),u=d-e,p=c-i,{scrollLeft:u,scrollTop:p}}getScrollValuesByCurrentChanged(){const{placeholderPages:t,currentViewportWidth:e,currentViewportHeight:i,startRow:s,endRow:n,startColumn:o,endColumn:r,isVertical:a}=this,{current:l}=this.tab,h=this.getMargin(),{realRow:d,realColumn:c}=this.getRealRowAndColumnThumbnail();let u=l,p=l;a?(u=s*c+o,p=n*c+r):(u=o*d+s,p=r*d+r);let g=Us(this.scrollLeft,0,this.maxScrollLeft),f=Us(this.scrollTop,0,this.maxScrollTop);if(l>=u&&l<=p)return {scrollLeft:g,scrollTop:f};const m=t[l];return m&&(a?(g=0,l<u?f=m.y-h:l>p&&(f=m.y+m.height+h-i)):(f=0,l<u?g=m.x-h:l>p&&(g=m.x+m.width+h-e))),g=Us(g,0,this.maxScrollLeft),f=Us(f,0,this.maxScrollTop),{scrollLeft:g,scrollTop:f}}getCurrentByScroll(){let t=this.tab.current;const{placeholderPages:e,currentViewportWidth:i,currentViewportHeight:s,startRow:n,endRow:o,startColumn:r,endColumn:a,isVertical:l}=this,{realRow:h,realColumn:d}=this.getRealRowAndColumnContinuous(),c=i/2,u=s/2,{offsetX:p,offsetY:g}=this.getTabOffset(),{current:f}=this.tab;let m=Number.MAX_VALUE,y=Number.MAX_VALUE,v=l?Math.floor(f/d):f%h,x=l?f%d:Math.floor(f/h);for(let t=n;t<=o;t++){const i=e[t*d];if(!i)continue;const{y:s,height:n}=i,o=s+g,r=o-u,a=u-o-n;if(r<=0&&a<=0){v=t;break}r>0&&r<y?(y=r,v=t):a>0&&a<y&&(y=a,v=t);}for(let t=r;t<=a;t++){const i=e[r];if(!i)continue;const{x:s,width:n}=i,o=s+p,a=o-c,l=c-o-n;if(a<=0&&l<=0){x=t;break}a>0&&a<m?(m=a,x=t):l>0&&l<m&&(m=l,x=t);}return t=v*d+x,t===this.tab.current?null:t}setTabScrollValue(t,e){this.scrollLeft=t,this.scrollTop=e;const{offsetX:i,offsetY:s}=this.getTabOffset();this.tab.setPosition({x:i,y:s});}}class vm extends pa{constructor(t,e){super({name:"DocTab"}),l(this,"uid",void 0),l(this,"docType",void 0),l(this,"docName",void 0),l(this,"doc",void 0),l(this,"isActive",!1),l(this,"currentUid",void 0),l(this,"total",void 0),l(this,"selected",void 0),l(this,"context",void 0),l(this,"viewerContext",void 0),l(this,"shiftReference",void 0),l(this,"oldCurrentUid",void 0),l(this,"oldCurrent",void 0),this.doc=t,this.uid=t.uid,this.docName=t.name,this.docType=t.type,this.total=0,this.selected=[],this.viewerContext=e,this.context=new ym(this,e),this.oldCurrent=-1,this.oldCurrentUid=void 0,t.pages.forEach((t=>{const e=this.createPage(t);this.appendChild(e);})),this.total=t.pages.length,this.total>0&&(this.updateOldInfo(),this.currentUid=this.pages[this.scrollToLatest?this.total-1:0].uid);}get scrollToLatest(){let{scrollToLatest:t}=this.viewerContext.viewer.group.config;return Ts(t)&&(t=this.viewerContext.viewerConfig.scrollToLatest),t}get pages(){return this.childNodes}get current(){return this.currentUid?this.uidToIndex(this.currentUid):-1}get isDocType(){return "document"===this.docType}createPage(t){const{pageStyle:e,pageNumberStyle:i,checkboxStyle:s,removeBtnStyle:n,blankFillColor:o}=this.viewerContext.viewerConfig,r=function(t){const{border:e,background:i}=t;let s={};e&&(s=hm(e));return {background:i,...s}}(e),{width:a,height:l}=this.viewerContext.getPageRenderSize(t);return new lm({tab:this,uid:t,formattedPageStyle:r,pageNumberStyle:i,checkboxStyle:s,removeBtnStyle:n,blankFillColor:o,style:{pointerEvents:"auto",width:a,height:l}})}updateOldInfo(){this.oldCurrentUid=this.currentUid,this.oldCurrent=this.current;}updateViewportSize(t,e){this.context.viewportWidth=t,this.context.viewportHeight=e;}rename(t){this.docName=t;}getCurrentPage(){return this.getPageByUid(this.currentUid)}getAllPageUids(){return this.pages.map((t=>t.uid))}appendPages(t,e,i){const s=t.length;if(!s)return;const n=Bs(i);if(t.forEach(((t,e)=>{const s=this.createPage(t);this.appendChild(s,n?i+e:void 0);})),this.total=this.pages.length,e)this.currentUid=this.indexToUid(n?i+s-1:this.total-1),this.updateDefaultReference();else if(!this.currentUid){var o;this.currentUid=null===(o=this.pages[0])||void 0===o?void 0:o.uid,this.updateDefaultReference();}}deletePages(t){this.updateOldInfo();const e=[...t],i=t.includes(this.currentUid);if(i){const i=t.indexOf(this.currentUid);e.splice(i,1),e.push(this.currentUid);}e.forEach((t=>{const e=this.getPageByUid(t);if(i&&e.uid===this.currentUid){if(1===this.total)this.currentUid=null;else {const{current:t}=this,e=t===this.total-1?-1:1;this.currentUid=this.indexToUid(t+e);}this.updateDefaultReference();}cn(this.selected,t),this.removeChild(e),this.total-=1;}));}deleteAllPages(){this.updateOldInfo();[...this.pages].forEach((t=>{this.removeChild(t);})),this.currentUid=null,this.selected=[],this.total=0;}movePages(t,e){return this.updateOldInfo(),un(this.pages,t,e)}switchPage(t,e){return this.updateOldInfo(),pn(this.pages,t,e)}reorderPages(t){return (!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.updateOldInfo(),gn(this.pages,t)}gotoPage(t){return 0===this.total?-1:(this.updateOldInfo(),t!==this.current&&(t=Us(t,0,this.total-1),this.currentUid=this.indexToUid(t),this.updateDefaultReference()),this.updateShiftReference(),t)}selectPages(t){this.pages.forEach((e=>{e.isSelected=t.includes(e.uid);})),this.selected=t;}selectPagesByIndices(t){const e=this.indicesToUids(t);this.selectPages(e);}getSelected(){return this.selected.slice()}getSelectedIndices(){return this.selected.map((t=>this.uidToIndex(t)))}getPageByIndex(t){return this.pages[t]}getPageByUid(t){return this.pages.find((e=>e.uid===t))}getPageIndex(t){return this.pages.findIndex((e=>e.uid===t.uid))}uidToIndex(t){return this.pages.findIndex((e=>e.uid===t))}uidsToIndices(t){return t.map((t=>this.uidToIndex(t)))}indexToUid(t){var e;return null===(e=this.pages[t])||void 0===e?void 0:e.uid}indicesToUids(t){return t.map((t=>this.indexToUid(t)))}updateShiftReference(){this.shiftReference=this.currentUid;}updateDefaultReference(){this.context.defaultReference={pageUid:this.currentUid};}destroy(){super.destroy(),this.deleteAllPages(),this.isActive=!1,this.doc=null,this.context=null,this.viewerContext=null,this.isDestroyed=!0;}}class xm extends Tn{constructor(t){super(),l(this,"tabActivationStack",void 0),l(this,"tabs",void 0),l(this,"activeTabUid",void 0),l(this,"context",void 0),this.tabActivationStack=[],this.tabs=new Map,this.context=t;}dispose(){this.clearTabs(),this.tabActivationStack.length=0,super.dispose();}updateViewportSize(t,e){const i=this.getActiveTab();null!=i&&i.isDocType&&i.updateViewportSize(t,e);}createTab(t){if(this.tabs.has(t.uid))return this.tabs.get(t.uid);let e=null;return "document"===t.type&&(e=new vm(t,this.context)),this.context.viewerConfig.enableMultiTab||this.clearTabs(),this.tabs.set(e.uid,e),e}closeTab(t){if(!this.tabs.has(t))return !1;const{tabActivationStack:e}=this;if(e.includes(t)){const i=e.indexOf(t);e.splice(i,1);}return this.getTab(t).isActive=!1,this.tabs.delete(t),this.activeTabUid===t&&(this.activeTabUid=e[e.length-1]),!0}getTab(t){return this.tabs.get(t)}getDocTab(t){const e=this.getTab(t);return null!=e&&e.isDocType?e:null}hasTab(t){return this.tabs.has(t)}getActiveTab(){return this.tabs.get(this.activeTabUid)}getActiveTabUid(){return this.activeTabUid}getAllTabs(){return Array.from(this.tabs.values())}activateTab(t){if(!this.tabs.has(t))return !1;const{tabActivationStack:e}=this;if(this.context.viewerConfig.enableMultiTab){if(e.includes(t)){const i=e.indexOf(t);e.splice(i,1);}}else e.length=0;return e.push(t),this.activeTabUid=t,this.tabs.forEach((e=>{e.isActive=e.uid===t;})),!0}clearTabs(){this.getAllTabs().forEach((t=>{t.destroy();})),this.tabs.clear();}resizeScrollbar(){this.tabs.forEach((t=>{t.context.isScrollbarResized=!0;}));}}class wm{constructor(t){l(this,"parsedPageStyleCache",void 0),l(this,"parsedCurrentPageStyleCache",void 0),l(this,"parsedSelectedPageStyleCache",void 0),l(this,"parsedHoveredPageStyleCache",void 0),l(this,"parsedPlaceholderStyleCache",void 0),l(this,"parsedCheckboxStyleCache",void 0),l(this,"parsedPageNumberStyleCache",void 0),l(this,"parsedQuadSelectionStyleCache",void 0),l(this,"parsedCanvasStyleCache",void 0),l(this,"context",void 0),l(this,"isPageStyleChanged",void 0),l(this,"isCurrentPageStyleChanged",void 0),l(this,"isSelectedPageStyleChanged",void 0),l(this,"isHoveredPageStyleChanged",void 0),l(this,"isPlaceholderStyleChanged",void 0),l(this,"isCheckboxStyleChanged",void 0),l(this,"isPageNumberStyleChanged",void 0),l(this,"isQuadSelectionStyleChanged",void 0),l(this,"isCanvasStyleChanged",void 0),this.context=t;}getParsedCanvasStyle(){return !this.isCanvasStyleChanged&&this.parsedCanvasStyleCache||(this.parsedCanvasStyleCache=bm(this.context.viewerConfig.canvasStyle),this.isCanvasStyleChanged=!1),this.parsedCanvasStyleCache}getParsedCheckboxStyle(t){return !this.isCheckboxStyleChanged&&this.parsedCheckboxStyleCache||(this.parsedCheckboxStyleCache=bm(this.context.viewerConfig.checkboxStyle,t),this.isCheckboxStyleChanged=!1),this.parsedCheckboxStyleCache}getParsedPageNumberStyle(t){return !this.isPageNumberStyleChanged&&this.parsedPageNumberStyleCache||(this.parsedPageNumberStyleCache=bm(this.context.viewerConfig.pageNumberStyle,t),this.isPageStyleChanged=!1),this.parsedPageNumberStyleCache}getParsedPageStyle(){return !this.isPageStyleChanged&&this.parsedPageStyleCache||(this.parsedPageStyleCache=bm(this.context.viewerConfig.pageStyle),this.isPageStyleChanged=!1),this.parsedPageStyleCache}getParsedCurrentPageStyle(){return !this.isCurrentPageStyleChanged&&this.parsedCurrentPageStyleCache||(this.parsedCurrentPageStyleCache=bm(this.context.viewerConfig.currentPageStyle),this.isCurrentPageStyleChanged=!1),this.parsedCurrentPageStyleCache}getParsedSelectedPageStyle(){return !this.isSelectedPageStyleChanged&&this.parsedSelectedPageStyleCache||(this.parsedSelectedPageStyleCache=bm(this.context.viewerConfig.selectedPageStyle),this.isSelectedPageStyleChanged=!1),this.parsedSelectedPageStyleCache}getParsedHoveredPageStyle(){return !this.isHoveredPageStyleChanged&&this.parsedHoveredPageStyleCache||(this.parsedHoveredPageStyleCache=bm(this.context.viewerConfig.hoveredPageStyle),this.isHoveredPageStyleChanged=!1),this.parsedHoveredPageStyleCache}getParsedPlaceholderStyle(){return !this.isPlaceholderStyleChanged&&this.parsedPlaceholderStyleCache||(this.parsedPlaceholderStyleCache=bm(this.context.viewerConfig.placeholderStyle),this.isPlaceholderStyleChanged=!1),this.parsedPlaceholderStyleCache}getParsedQuadSelectionStyle(){return !this.isQuadSelectionStyleChanged&&this.parsedQuadSelectionStyleCache||(this.parsedQuadSelectionStyleCache=bm(this.context.viewerConfig.quadSelectionStyle),this.isQuadSelectionStyleChanged=!1),this.parsedQuadSelectionStyleCache}isBorderWidthEqualHovered(){const{viewerConfig:t}=this.context;return dm(t.pageStyle)===dm(t.hoveredPageStyle)}isSelectedBorderWidthEqualHovered(){const{viewerConfig:t}=this.context;return dm(t.selectedPageStyle)===dm(t.hoveredPageStyle)}isSelectedBorderWidthEqualNormal(){const{viewerConfig:t}=this.context;return dm(t.pageStyle)===dm(t.selectedPageStyle)}}function bm(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{width:0,height:0};const i={};if(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{border:i,ctrlBorder:s}=t;if(!Ts(i)){const t=hm(i);Object.assign(e,t);}if(!Ts(s)){const t=hm(s);Object.assign(e,{ctrlBorderWidth:t.borderWidth,ctrlBorderColor:t.borderColor,ctrlBorderStyle:t.borderStyle});}}(t,i),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Cm.forEach((i=>{Ts(t[i])||(e[i]=rr(t[i]).value||0);}));}(t,i),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Sm.forEach((i=>{Ts(t[i])||(e[i]=t[i]);}));}(t,i),function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!Ts(t.width)&&(i.width=cm(t.width,e.width),Ts(t.translateX)||(i.translateX=cm(t.translateX,i.width)),!Ts(t.borderRadius))){const e=cm(t.borderRadius,i.width);i.borderRadiusX=Math.max(0,Math.min(e,i.width/2));}if(!Ts(t.height)&&(i.height=cm(t.height,e.height),Ts(t.translateY)||(i.translateY=cm(t.translateY,i.height)),!Ts(t.borderRadius))){const e=cm(t.borderRadius,i.height);i.borderRadiusY=Math.max(0,Math.min(e,i.height/2));}if(!Ts(t.borderRadius)){const s=cm(t.borderRadius,e.width);i.borderRadius=Math.max(0,Math.min(s,e.height/2,e.width/2));}if(!Ts(t.ctrlBorderRadius)){const e=cm(t.ctrlBorderRadius,i.ctrlWidth);i.ctrlBorderRadius=Math.max(0,Math.min(e,i.ctrlWidth/2,i.ctrlHeight/2));}Pm.forEach((s=>{const n=["left","right"].includes(s)?e.width:e.height,o=ar(t[s]);let r=o.value;"%"===o.unit&&(r=n*o.value/100),i[s]=r;}));}(t,e,i),t.left||t.right||t.bottom||t.top){const{left:s,top:n,right:o,bottom:r,width:a,height:l,translateX:h,translateY:d}=i;""!==t.left?i.x=s+h||0:""!==t.right&&Bs(a)?i.x=e.width-a-o+h||0:i.x=0,""!==t.top?i.y=n+d||0:""!==t.bottom&&Bs(l)?i.y=e.height-l-r+d||0:i.y=0;}return i}const Cm=["borderWidth","ctrlBorderWidth","checkMarkLineWidth","fontSize","ctrlWidth","ctrlHeight"],Sm=["background","maskColor","color","borderColor","borderStyle","invalidBorderColor","ctrlBorderColor","ctrlBackground","ctrlBorderStyle","invalidCtrlBorderColor","checkMarkColor","onPage","opacity","visibility","visibleByHover","fontFamily","textAlign","textBaseline","lineJoin","lineCap"],Pm=["left","top","right","bottom"];const Am="visible",Tm="hidden";class km{constructor(t){l(this,"context",void 0),this.context=t;}handleVisibility(t){if(this.context.isDestroyed||t.isDestroyed||!t.total||!t.isActive)return;const{context:e}=this;if(e.isDefaultViewer?t.context.isContinuousDisplay?this.continuousVisibility(t):t.context.isSingleDisplay&&this.singleVisibility(t):e.isThumbnailViewer?this.thumbnailVisibility(t):e.isPerspectiveViewer&&t.context.isSingleDisplay&&this.singleVisibility(t),t.context.pagePreloadChanges.length){t.context.pagePreloadChanges.forEach((e=>{if(e.from&&!e.to){const i=t.getPageByUid(e.pageUid);i&&(i.isLoaded=!1);}}));const i=ef.create(t.uid,e.uid,e.viewerConfig.viewerMode,t.context.pagePreloadChanges);e.core.viewerService.onPagePreloadChanged.emit(i);}}thumbnailVisibility(t){const{total:e}=t;if(!e)return;const i=t.context;if(i.isOutOfBounds)return void t.pages.forEach((t=>{t.updateStyle({visibility:"hidden"});}));const{rows:s,columns:n,placeholderPages:o,preloadCount:r,isVertical:a}=i,{width:l,height:h}=o[0],d=i.getParsedPageStyle(),c=i.getParsedCurrentPageStyle(),u=i.getParsedSelectedPageStyle(),p=i.getParsedHoveredPageStyle(),g=i.getParsedPlaceholderStyle(),f=i.getParsedPageNumberStyle(l,h),m=i.getParsedCheckboxStyle(l,h),{visibility:y,top:v,bottom:x,onPage:w,height:b}=f;let C=0;const S="visible"===y,P=i.getPageNumberStyle();if(S){const t=""!==P.top?v:x||0;w||(C=""!==P.top?b+t:0);}const{realColumn:A,realRow:T}=i.getRealRowAndColumnThumbnail(),{startRow:k,endRow:D}=this.getVisibleRow(t,T,A),{startColumn:E,endColumn:I}=this.getVisibleColumn(t,T,A);t.context.startRow=k,t.context.endRow=D,t.context.startColumn=E,t.context.endColumn=I;const R=pm(c.borderWidth),M=[];t.pages.forEach(((e,i)=>{const o=a?Math.floor(i/n):i%s,l=a?i%n:Math.floor(i/s),h=o>=k-r&&o<=D+r&&l>=E-r&&l<=I+r,y=o>=k&&o<=D&&l>=E&&l<=I?Am:Tm;e.isPreload!==h&&M.push({from:e.isPreload,to:h,pageUid:e.uid,index:i});let v={borderWidth:0,background:"#ffffff00"};e.isDragging&&(v=g);let x=d;e.isHovered&&(x=p),e.isSelected&&(x=u);const b=pm(x.borderWidth);if(e.isPreload=h,e.updateStyle({visibility:y,...v}),e.borderBox.updateStyle({...x,visibility:y,borderWidth:b}),S){let t=f.y;w||(t=""!==P.top?-C:f.y+f.bottom),e.pageNumber.parsedPageNumberStyle={...f,y:t},e.pageNumber.updateText((i+1).toString());}e.pageNumber.updateStyle({visibility:f.visibility,zIndex:f.onPage?1:0});let A=m.visibility;m.visibleByHover&&(A=e.isHovered||e.isSelected?m.visibility:"hidden"),e.checkbox.parsedCheckboxStyle={...m},e.checkbox.updateStyle({visibility:A}),e.checkbox.checked=e.isSelected,e.curBox.updateStyle({...c,visibility:e.uid===t.currentUid?Am:Tm,borderWidth:R});})),t.context.pagePreloadChanges=M;}continuousVisibility(t){const{preloadCount:e,isVertical:i}=t.context,{pages:s}=t,n=t.context.getParsedPageStyle(),o=t.context.getParsedCurrentPageStyle(),{realRow:r,realColumn:a}=t.context.getRealRowAndColumnContinuous(),{startRow:l,endRow:h}=this.getVisibleRow(t,r,a),{startColumn:d,endColumn:c}=this.getVisibleColumn(t,r,a);t.context.startRow=l,t.context.endRow=h,t.context.startColumn=d,t.context.endColumn=c;const u=pm(n.borderWidth),p=pm(o.borderWidth),g=[];s.forEach(((s,f)=>{const m=i?Math.floor(f/a):f%r,y=i?f%a:Math.floor(f/r),v=m>=l&&m<=h&&y>=d&&y<=c,x=m>=l-e&&m<=h+e&&y>=d-e&&y<=c+e;s.isPreload!==x&&g.push({from:s.isPreload,to:x,pageUid:s.uid,index:f}),s.checkbox.updateStyle({visibility:Tm}),s.pageNumber.updateStyle({visibility:Tm}),s.curBox.updateStyle({...o,visibility:s.uid===t.currentUid?Am:Tm,borderWidth:p}),s.borderBox.updateStyle({...n,borderWidth:u}),s.updateStyle({visibility:v?Am:Tm}),s.isPreload=x;})),t.context.pagePreloadChanges=g;}singleVisibility(t){const{preloadCount:e}=t.context,{current:i,total:s,pages:n}=t,o=t.getCurrentPage(),r=t.context.getParsedPageStyle(),a=Math.max(i-e,0),l=Math.min(i+e,s-1);o.checkbox.updateStyle({visibility:Tm}),o.pageNumber.updateStyle({visibility:Tm});const h=pm(r.borderWidth),d=[];n.forEach(((t,e)=>{const i=e>=a&&e<=l,s=t.uid===o.uid;t.isPreload!==i&&d.push({from:t.isPreload,to:i,pageUid:t.uid,index:e}),t.borderBox.updateStyle({...r,borderWidth:h}),t.updateStyle({visibility:s?Am:Tm}),t.isPreload=i,t.curBox.updateStyle({visibility:Tm});})),t.context.pagePreloadChanges=d;}getVisibleColumn(t,e,i){const{scrollLeft:s,placeholderPages:n,currentViewportWidth:o,isVertical:r}=t.context;let a=0,l=i-1;if(r&&this.context.isThumbnailViewer)return {startColumn:a,endColumn:l};let h=Number.MAX_VALUE,d=Number.MAX_VALUE,c=null,u=null;for(let t=0;t<i;t++){const i=n[r?t:t*e];if(!i)continue;const{width:p,x:g}=i;if(null===c){const e=g-s;e<=0&&s-(g+p)<-1?(c=t,a=t):e>0&&e<h&&(h=e,a=t);}if(null===u){const e=s+o,i=e-(g+p);g-e<-1&&i<=0?(u=t,l=t):i>0&&i<d&&(d=i,l=t);}if(null!==c&&null!==u)break}return {startColumn:a,endColumn:l}}getVisibleRow(t,e,i){const{scrollTop:s,placeholderPages:n,currentViewportHeight:o,isVertical:r}=t.context;let a=0,l=e-1;if(!r&&this.context.isThumbnailViewer)return {startRow:a,endRow:l};let h=Number.MAX_VALUE,d=Number.MAX_VALUE,c=null,u=null;for(let t=0;t<e;t++){const e=n[r?t*i:t];if(!e)continue;const{y:p,height:g}=e;if(null===c){const e=p-s;e<=0&&s-(p+g)<-1?(c=t,a=t):e>0&&e<h&&(h=e,a=t);}if(null===u){const e=s+o,i=e-(p+g);p-e<-1&&i<=0?(u=t,l=t):i>0&&i<d&&(d=i,l=t);}if(null!==c&&null!==u)break}return {startRow:a,endRow:l}}}function Dm(t,e,i,s){const n={isOver:!1,pointerX:-1,pointerY:-1,page:t};if(t&&s){const{x:s,y:o}=t.getPosition(),{width:r,height:a}=t;n.isOver=e>=s&&i>=o&&e<=s+r&&i<=o+a;const l=t.getScale();n.pointerX=(e-s)/l.x,n.pointerY=(i-o)/l.y;}return n}const Em={tag:"div",id:"ddv-thumbnail-container",className:"ddv-thumbnail-container"},Im={tag:"div",id:"ddv-main-container",className:"ddv-main-container",children:[{tag:"div",id:"ddv-scroller-and-canvas",className:"ddv-scroller-and-canvas",children:[{tag:"div",id:"ddv-scroll-container",className:"ddv-scroll-container",children:[{tag:"div",id:"ddv-scroll-content",className:"ddv-scroll-content"}]},{tag:"div",id:"ddv-canvas-container",className:"ddv-canvas-container",children:[]}]}]},Rm={tag:"div",id:"ddv-video-container",className:"ddv-video-container"},Mm={tag:"div",id:"ddv-audio-container",className:"ddv-audio-container"},Bm={tag:"div",id:"ddv-main-and-thumbnail",className:"ddv-main-and-thumbnail"},Lm={tag:"div",id:"ddv-core",className:"ddv-core"};class Um extends Tn{constructor(t,e){super(),l(this,"container",void 0),l(this,"defaultDom",void 0),l(this,"mainAndThbContainer",void 0),l(this,"thumbnailContainer",void 0),l(this,"mainContainer",void 0),l(this,"scrollerAndCanvasContainer",void 0),l(this,"scrollContainer",void 0),l(this,"scrollContent",void 0),l(this,"canvasContainer",void 0),l(this,"videoContainer",void 0),l(this,"audioContainer",void 0),l(this,"rootDom",void 0),l(this,"hooks",void 0),l(this,"isBindContainer",!1),l(this,"viewportWidth",void 0),l(this,"viewportHeight",void 0),l(this,"context",void 0),l(this,"dpr",ln()),l(this,"hasScrollbarX",!1),l(this,"hasScrollbarY",!1),this.context=t,this.hooks=e;const i=tm(Lm,t.postfix);this.defaultDom=i;}dispose(){var t,e;null===(t=this.rootDom)||void 0===t||t.remove(),null===(e=this.thumbnailContainer)||void 0===e||e.remove(),this.defaultDom=null,this.rootDom=null,this.thumbnailContainer=null,this.context=null,this.dpr=null,super.dispose();}createMainAndThbContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainAndThbContainer){const e=tm(Bm,t);this.mainAndThbContainer=e,this.defaultDom.appendChild(e);}}createMainContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.mainContainer){const e=tm(Im,t);this.mainContainer=e,this.mainAndThbContainer.appendChild(e);const i=e.querySelector(`#ddv-scroller-and-canvas${t}`),s=e.querySelector(`#ddv-canvas-container${t}`),n=e.querySelector(`#ddv-scroll-container${t}`),o=e.querySelector(`#ddv-scroll-content${t}`);this.scrollerAndCanvasContainer=i,this.canvasContainer=s,this.scrollContainer=n,this.scrollContent=o;const r=t=>{t.target===e&&this.isBindContainer&&this.context.isInitialized&&this.context.resize();},{resizeService:a}=this.context.core;a.observe(e),a.onResizeObserver.on(r,this),this.context.hooks.destroy.on((()=>{a.unobserve(e);}));}}createThumbnailContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.thumbnailContainer){const e=tm(Em,t);this.thumbnailContainer=e,this.mainAndThbContainer.insertBefore(e,this.mainContainer);}}createVideoContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.videoContainer){const e=tm(Rm,t);this.mainContainer.appendChild(e);}}createAudioContainer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!this.audioContainer){const e=tm(Mm,t);this.mainContainer.appendChild(e);}}getViewportSize(){if(!this.mainContainer)return {width:0,height:0};const{offsetWidth:t,offsetHeight:e}=this.getElSize(this.mainContainer),i=this.getCanvasBorderSize();return {width:t-2*i,height:e-2*i}}resetViewport(){const{scrollContent:t,canvasContainer:e}=this;um(e,0,0),um(t,0,0);const{width:i,height:s}=this.getViewportSize();this.viewportWidth=i,this.viewportHeight=s,this.updateCanvasContainerSize();}resizeViewport(){const{canvasContainer:t,scrollContainer:e}=this;um(t,0,0);const{offsetWidth:i,offsetHeight:s}=this.getElSize(e);this.viewportWidth=i,this.viewportHeight=s,this.updateCanvasContainerSize();}checkIsRound(t){const e=getComputedStyle(t);return {roundWidth:parseFloat(e.width)%1>=.5,roundHeight:parseFloat(e.height)%1>=.5}}getElSize(t){const{roundWidth:e,roundHeight:i}=this.checkIsRound(t);let{clientWidth:s,clientHeight:n,offsetWidth:o,offsetHeight:r}=t;return e&&(s-=1,o-=1),i&&(n-=1,r-=1),{clientWidth:s,clientHeight:n,offsetWidth:o,offsetHeight:r}}getMaxScrollValue(){const{scrollContainer:t}=this;return {scrollLeft:t.scrollWidth-t.clientWidth,scrollTop:t.scrollHeight-t.clientHeight}}isViewerResized(){return this.scrollContainer.offsetWidth!==this.viewportWidth||this.scrollContainer.offsetHeight!==this.viewportHeight}isDPRChanged(){const t=ln();return this.dpr!==t&&(this.dpr=t,!0)}isScrollbarAppeared(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight}bindContainer(t){let e=t;return t&&Ls(t)&&(e=document.querySelector(`#${t}`)),e instanceof HTMLElement&&(e.appendChild(this.defaultDom),this.container=e,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0)}unbindContainer(){if(!this.container||0===this.container.children.length)return !1;for(let t=0;t<this.container.children.length;t++)if(this.container.children[t]===this.rootDom){this.container.removeChild(this.rootDom);break}return this.isBindContainer=!1,!0}scrollTo(t,e){const{scrollContainer:i}=this;i.scrollTo?i.scrollTo(t,e):(i.scrollLeft=t,i.scrollTop=e);}scrollBy(t,e){const{scrollContainer:i}=this;i.scrollBy?i.scrollBy(t,e):(i.scrollLeft+=t,i.scrollTop+=e);}updateScrollerContentSize(t){const{currentLayoutWidth:e,currentLayoutHeight:i}=t.context,{scrollContent:s,canvasContainer:n,scrollContainer:o}=this;um(n,10,10),um(s,e,i);const r=o.scrollWidth-o.clientWidth,a=o.scrollHeight-o.clientHeight;t.context.maxScrollLeft=r,t.context.maxScrollTop=a;const l=r>0,h=a>0;let d=!1;l!==this.hasScrollbarX&&(this.hasScrollbarX=l,d=!0),h!==this.hasScrollbarY&&(this.hasScrollbarY=h,d=!0),d&&this.context.clearCurrentTabOptimization(),this.updateCanvasContainerSize();}updateCanvasContainerSize(){const{scrollContainer:t,canvasContainer:e}=this,{width:i,height:s}=getComputedStyle(this.scrollContainer);let n,o=parseFloat(i),r=parseFloat(s);t.offsetWidth!==t.clientWidth&&(Bs(n)||(n=mm()),o-=n),t.offsetHeight!==t.clientHeight&&(Bs(n)||(n=mm()),r-=n),um(e,o,r);}getCanvasBorderSize(){const{canvasContainer:t}=this;return (t.offsetWidth-t.clientWidth)/2}}class Om{constructor(){l(this,"canvasDom",void 0),l(this,"canvas",void 0),l(this,"renderer",void 0),l(this,"isInitialized",!1),l(this,"canvasWidth",0),l(this,"canvasHeight",0);}clear(){var t;const e=null===(t=this.canvas)||void 0===t?void 0:t.document.documentElement;if(!e)return;e.children.slice().forEach((t=>{e.removeChild(t);})),e.sortable.sorted=[];}render(t){var e;const i=null===(e=this.canvas)||void 0===e?void 0:e.document.documentElement;if(i){if(t)if(0===i.children.length)i.appendChild(t);else {i.children.indexOf(t)<0&&i.replaceChild(t,i.children[0]);}else {const t=[...i.children];for(let e=t.length;e>=0;e--)i.removeChild(t[e]);}this.canvas.render();}}initCanvas(t){let{container:e,width:i,height:s}=t;const n=new bl({}),o=new il({renderer:n,container:e,width:i,height:s});this.canvasWidth=i,this.canvasHeight=s,this.renderer=n,this.canvas=o,this.canvasDom=o.contextService.getDomElement(),this.canvasDom.style.width="100%",this.canvasDom.style.height="100%",this.canvasDom.style.touchAction="none",this.isInitialized=!0;}registerShapeRenderer(t,e){this.canvas.contextService.registerShapeRenderer(t,e);}getCanvasPosition(){const t=this.canvasDom.getBoundingClientRect(),{scrollX:e,scrollY:i}={scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};return {x:t.left+e,y:t.top+i}}resize(t,e){const i=ln();this.canvas.setDPR(i),this.canvasWidth=t,this.canvasHeight=e,this.canvas.resize(t,e);}}class _m{render(t,e){const{opacity:i,visibility:s}=t.parsedCheckboxStyle;0!==i&&"hidden"!==s&&(e.save(),e.globalAlpha=i,this.renderBox(t,e,"out"),e.clip(),this.renderBox(t,e,"in"),this.fill(t,e),this.renderBox(t,e,"center"),this.stroke(t,e),this.renderCheckMark(t,e),e.restore());}renderBox(t,e,i){const{x:s,y:n,width:o,height:r,borderWidth:a,borderRadiusX:l,borderRadiusY:h}=t.parsedCheckboxStyle;let d=0;"center"===i?d=a/2:"in"===i&&(d=a);const c=[{x:s+l,y:n+h,start:Math.PI,end:3*Math.PI/2},{x:s+o-l,y:n+h,start:3*Math.PI/2,end:2*Math.PI},{x:s+o-l,y:n+r-h,start:0,end:Math.PI/2},{x:s+l,y:n+r-h,start:Math.PI/2,end:Math.PI}],u=Math.max(l-d,0),p=Math.max(h-d,0);if(e.beginPath(),e.ellipse&&u&&p)for(let t=0;t<4;t++){const{x:i,y:s,start:n,end:o}=c[t];e.ellipse(i,s,u,p,0,n,o);}else e.rect(s,n,o,r);e.closePath();}fill(t,e){const{background:i}=t.parsedCheckboxStyle;i&&""!==i&&(e.fillStyle=i,e.fill());}stroke(t,e){const{borderColor:i,borderWidth:s,borderStyle:n}=t.parsedCheckboxStyle;e.setLineDash(n),e.strokeStyle=i,e.lineWidth=s,s>0&&i&&""!==i&&e.stroke();}renderCheckMark(t,e){if(!t.checked)return;const{x:i,y:s,width:n,height:o,borderWidth:r,checkMarkLineWidth:a,checkMarkColor:l}=t.parsedCheckboxStyle,h=Math.max(Math.min(n-2*r,o-2*r),0);let d=i,c=s;0!==h&&(n<o?(d+=r,c=c+r+(o-n)/2):(d=d+r+(n-o)/2,c+=r),e.setLineDash([0,0]),e.lineWidth=a,e.strokeStyle=l,e.beginPath(),e.moveTo(d+.15*h,c+.5*h),e.lineTo(d+.4*h,c+.8*h),e.lineTo(d+.85*h,c+.2*h),e.stroke());}}class Nm{render(t,e){const{opacity:i,visibility:s}=t.parsedPageNumberStyle;0!==i&&"hidden"!==s&&(e.save(),e.globalAlpha=i,this.renderBox(t,e,"out"),e.clip(),this.renderBox(t,e,"in"),this.fill(t,e),this.renderBox(t,e,"center"),this.stroke(t,e),this.renderFont(t,e),e.restore());}renderBox(t,e,i){const{x:s,y:n,width:o,height:r,borderWidth:a,borderRadiusX:l,borderRadiusY:h}=t.parsedPageNumberStyle;let d=0;"center"===i?d=a/2:"in"===i&&(d=a);const c=[{x:s+l,y:n+h,start:Math.PI,end:3*Math.PI/2},{x:s+o-l,y:n+h,start:3*Math.PI/2,end:2*Math.PI},{x:s+o-l,y:n+r-h,start:0,end:Math.PI/2},{x:s+l,y:n+r-h,start:Math.PI/2,end:Math.PI}],u=Math.max(l-d,0),p=Math.max(h-d,0);if(e.beginPath(),e.ellipse&&u&&p)for(let t=0;t<4;t++){const{x:i,y:s,start:n,end:o}=c[t];e.ellipse(i,s,u,p,0,n,o);}else e.rect(s,n,o,r);e.closePath();}renderFont(t,e){const{x:i,y:s,width:n,height:o,fontSize:r,color:a,fontFamily:l}=t.parsedPageNumberStyle;e.fillStyle=a,e.textAlign="center",e.textBaseline="middle",l.includes(" ")?e.font=`${r}px '${l}'`:e.font=`${r}px ${l}`,e.fillText(t.text,i+n/2,s+o/2+r/8,n);}fill(t,e){const{background:i}=t.parsedPageNumberStyle;i&&""!==i&&(e.fillStyle=i,e.fill());}stroke(t,e){const{borderColor:i,borderWidth:s,borderStyle:n}=t.parsedPageNumberStyle;e.setLineDash(n),e.strokeStyle=i,e.lineWidth=s,s>0&&i&&""!==i&&e.stroke();}}class Wm extends Tn{constructor(t,e){super(),l(this,"context",void 0),l(this,"docRenderer",void 0),l(this,"hooks",void 0),this.context=t,this.hooks=e,this.docRenderer=new Om;}dispose(){super.dispose(),this.context=null,this.docRenderer=null,this.hooks=null;}initRenderer(t,e,i){this.docRenderer.isInitialized||(Object.assign(t.style,this.context.viewerConfig.canvasStyle),this.docRenderer.initCanvas({container:t,width:e,height:i}),this.docRenderer.registerShapeRenderer("checkbox",new _m),this.docRenderer.registerShapeRenderer("pageNumber",new Nm));}getCanvasDom(){return this.docRenderer.canvasDom}clearCanvas(){const t=this.getCanvasDom();if(!t)return;t.getContext("2d").clearRect(0,0,t.width,t.height);}resize(t,e){this.docRenderer&&this.docRenderer.resize(t,e);}updateCanvasSize(){if(this.docRenderer){const t=this.getCanvasDom();if(!t)return;const{clientWidth:e,clientHeight:i}=t;this.docRenderer.resize(e,i);}}render(t){t.isDestroyed||(this.hooks.beforeRender.emit(t),this.docRenderer.render(t),this.hooks.afterRender.emit(t),t.pages.forEach(((t,e)=>{if(t.isVisible&&t.isLoaded){const i=ug.create(e,t.uid);this.context.emit("pageRendered",i);}})));}getCanvasPosition(){const t=this.docRenderer.canvasDom.getBoundingClientRect(),{scrollX:e,scrollY:i}=window;return {x:t.left+e,y:t.top+i}}}function Fm(t){const e=t.getPages(),i=e.length;if(!i)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);let{viewportWidth:s,viewportHeight:n}=t;const{rows:o,columns:r,scrollbarWidth:a,tab:l,isVertical:h}=t,d=t.getMargin();r*o<i&&(h?s-=a:n-=a);let c=0,u=0;h?(c=(s-(r+1)*d)/r,u=(n-(o+1)*d)/o):(u=(n-(o+1)*d)/o,c=(s-(r+1)*d)/r);let p=!1;(c<0||u<0)&&(p=!0,c=Math.max(0,c),u=Math.max(0,u));const g=h?Math.max(o,Math.ceil(i/r)):o,f=h?r:Math.max(r,Math.ceil(i/o)),m=c*f+(f+1)*d,y=u*g+(g+1)*d,v=l.pages.map((t=>({uid:t.uid,x:0,y:0,width:c,height:u}))),x=t.getParsedPageStyle(),w=t.getParsedSelectedPageStyle(),b=t.getParsedHoveredPageStyle(),C=t.getParsedPageNumberStyle(c,u),{visibility:S,top:P,bottom:A,onPage:T,height:k}=C;let D=c,E=u;const I=c;let R=u,M=0;const B="visible"===S,L=t.getPageNumberStyle();if(B){const t=""!==L.top?P:A||0;T||(E=u-k-t,R=u-k-t,M=""!==L.top?k+t:0);}E<0&&(p=!0,E=Math.max(0,E)),(D-2*x.borderWidth<0||E-2*x.borderWidth<0)&&(p=!0);const U=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=p?0:m+2*U,t.currentLayoutHeight=p?0:y+2*U,t.currentViewportWidth=p?t.viewportWidth:s,t.currentViewportHeight=p?t.viewportHeight:n,t.isOutOfBounds=p,p||(D=fm(D),E=fm(E),e.forEach(((e,i)=>{let s=x.borderWidth;e.isHovered&&(s=b.borderWidth),e.isSelected&&(s=w.borderWidth),s=pm(s);const n=h?i%r:Math.floor(i/o),a=h?Math.floor(i/r):i%o,l=d+n*(d+c),p=d+a*(d+u);v[i].x=l,v[i].y=p;let g=D-2*s,f=E-2*s;g=Math.max(g,0),f=Math.max(f,0);const m=e.rWidth,y=e.rHeight;let C=m,S=y,P=1;(m>g||y>f)&&(m/y>g/f?(P=g/m,C=g,S=y*P):(P=f/y,S=f,C=m*P)),e.zoom=P;const A=gm(l),T=gm(p+M);let k=s+(g-C)/2,B=s+(f-S)/2;k=gm(k),B=gm(B);const L=fm(m),U=fm(y),O=m*(1-P)/2,_=y*(1-P)/2,N=e.cropWidth,W=e.cropHeight,F=k-O-(N-L)/2,H=B-_-(W-U)/2,V=k-O,z=B-_,j=L,$=U,G=k,X=B,Y=fm(C),J=fm(S);e.setPage(A,T,I,R),e.setBorderBox(0,0,D,E,s),e.setCropBox(F,H,N,W,P,e.rotation),e.setRealTimeBox(V,z,j,$,P);const{width:q,height:Z}=t.viewerContext.getPageRenderSize(e.uid);e.setMediaBox(-e.cropLeft,-e.cropTop,q,Z),e.setImage(0,0,q,Z),e.setCurBox(G,X,Y,J);})),t.placeholderPages=v);}function Hm(t){const{tab:e}=t,i=e.getCurrentPage();if(!i)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);const{viewportWidth:s,viewportHeight:n,scrollbarWidth:o,fitMode:r}=t,a=t.getMargin(),l=t.getParsedPageStyle(),{borderWidth:h=0}=l,d=2*h,c=i.rWidth,u=i.rHeight,p=2*a,g=d+p,f=d+p,m=s-g,y=n-f;let{zoom:v}=t;const x=zm(r,{zoom:v,validLayoutWidth:c,validLayoutHeight:u,scrollbarWidth:o,fitViewportWidth:m,fitViewportHeight:y,isZoomChanged:t.isZoomChanged},Vm);t.isZoomChanged=!1;const{zoomedLayoutWidth:w,zoomedLayoutHeight:b,zoomedViewportWidth:C,zoomedViewportHeight:S,newFitMode:P}=x;if(v=x.zoom,P&&r!==P){t.fitMode=P,t.viewerContext.viewerConfig.fitMode=P;const e=hg.create(r,P);t.viewerContext.hooks.fitModeChanged.emit(e);}t.setZoom(v);const A=w+g,T=b+f,k=C+g,D=S+f,E=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=A+2*E,t.currentLayoutHeight=T+2*E,t.currentViewportWidth=k,t.currentViewportHeight=D,i.zoom=v,t.tab.setPosition({x:-0,y:-0});const I=e.pages.map((t=>{let{uid:e}=t;return {uid:e,x:a,y:a,width:w+d,height:b+d}}));t.placeholderPages=I;const R=fm(w+d),M=fm(b+d),B=gm(a),L=B,U=pm(h),O=U,_=fm(c),N=fm(u),W=c*(1-v)/2,F=u*(1-v)/2,H=i.cropWidth,V=i.cropHeight,z=U-W-(H-_)/2,j=O-F-(V-N)/2,$=U-W,G=O-F,X=_,Y=N;i.setPage(B,L,R,M),i.setBorderBox(0,0,R,M),i.setCropBox(z,j,H,V,v,i.rotation),i.setRealTimeBox($,G,X,Y,v);const{width:J,height:q}=t.viewerContext.getPageRenderSize(i.uid);i.setMediaBox(-i.cropLeft,-i.cropTop,J,q),i.setImage(0,0,J,q);}function Vm(t,e){let{zoom:i,validLayoutWidth:s,validLayoutHeight:n,scrollbarWidth:o,fitViewportWidth:r,fitViewportHeight:a}=e;return "none"===t||"actualSize"===t?("actualSize"===t&&(i=1),Math.floor(s*i)>r&&(a-=o),Math.floor(n*i)>a&&(r-=o)):"width"===t||"window"===t&&s/r>=n/a?(i=r/s,n*i>a&&(r-=o,i=r/s)):(i=a/n,s*i>r&&(a-=o,i=a/n)),{zoom:i,zoomedLayoutWidth:s*i,zoomedLayoutHeight:n*i,zoomedViewportWidth:r,zoomedViewportHeight:a}}function zm(t,e,i){const{zoom:s,isZoomChanged:n}=e;let o={};if(n){let n;const r=sm(s);if(1===s)n="actualSize",o=i("actualSize",e);else {o=i("width",e);if(sm(o.zoom)===r)n="width","window"===t&&(n="window");else {o=i("height",e);r===sm(o.zoom)&&(n="height","window"===t&&(n="window"));}}n?o.newFitMode=n:(o=i("none",e),o.newFitMode="none");}else o=i(t,e);return o}function jm(t,e){let{zoom:i,fitWidth:s,fitHeight:n,validLayoutWidth:o,validLayoutHeight:r,scrollbarWidth:a,isVertical:l,fitViewportWidth:h,fitViewportHeight:d}=e;return "none"===t||"actualSize"===t?("actualSize"===t&&(i=1),Math.floor(o*i)>h&&(d-=a),Math.floor(r*i)>d&&(h-=a)):"width"===t||"window"===t&&s/h>=n/d?(i=h/s,l?r*i>d&&(h-=a,i=h/s):(o*i>h&&(d-=a),n*i>d&&(h-=a,i=h/s))):(i=d/n,l?(r*i>d&&(h-=a),s*i>h&&(d-=a,i=d/n)):o*i>h&&(d-=a,i=d/n)),{zoom:i,zoomedLayoutWidth:o*i,zoomedLayoutHeight:r*i,zoomedViewportWidth:h,zoomedViewportHeight:d}}const $m=t=>{const e=t.getPages();if(!e.length)return;const{tab:i}=t,s=i.current,n=e[s-1],o=e[s+1];n&&Gm(t,n,-1),o&&Gm(t,o,1);};function Gm(t,e,i){const{viewportWidth:s,viewportHeight:n}=t,o=t.getParsedPageStyle(),{borderWidth:r=0}=o,a=t.getMargin(),{rWidth:l,rHeight:h}=e,d=s-2*a-2*r,c=n-2*a-2*r;let u=0,p=0,g=1;l/h>d/c?(u=d,g=d/l,p=h*g):(p=c,g=c/h,u=l*g);let f=(d-u)/2+a,m=(c-p)/2+a;f=Math.max(a,f),m=Math.max(a,m);const{x:y,y:v}=t.tab.getPosition();-1===i?(f=-s+f-y,m-=v):1===i&&(f=s+f-y,m-=v);const x=l*(1-g)/2,w=h*(1-g)/2,b=r,C=r,S=l,P=h,A=e.cropWidth,T=e.cropHeight,k=b-x-(A-S)/2,D=C-w-(T-P)/2,E="visible",I="hidden";e.updateStyle({visibility:E,x:f,y:m,width:u+2*r,height:p+2*r}),e.borderBox.updateStyle({x:0,y:0,width:u+2*r,height:p+2*r,...o,background:"#ffffff00",visibility:E}),e.cropBox.setLocalScale(1),e.cropBox.updateStyle({x:k,y:D,width:A,height:T}),e.cropBox.setLocalScale(g,g,1),e.cropBox.setLocalAngle(e.rotation);const{width:R,height:M}=t.viewerContext.getPageRenderSize(e.uid);e.mediaBox.updateStyle({x:-e.cropLeft,y:-e.cropTop,width:R,height:M}),e.zoom=g,e.checkbox.updateStyle({visibility:I}),e.pageNumber.updateStyle({visibility:I}),e.setImage(0,0,R,M);}function Xm(t){const{displayMode:e}=t;"single"===e?Hm(t):"continuous"===e?function(t){const e=t.getPages();if(!e.length)return t.currentLayoutWidth=0,void(t.currentLayoutHeight=0);let{zoom:i}=t;const{viewportWidth:s,viewportHeight:n,tab:o,fitMode:r,scrollbarWidth:a,isVertical:l}=t,h=t.getParsedPageStyle(),{borderWidth:d}=h,c=2*d,u=t.getMargin(),{realRow:p,realColumn:g}=t.getRealRowAndColumnContinuous(),f=new Array(g).fill(0),m=new Array(p).fill(0);let y=0,v=0;e.forEach(((t,e)=>{const i=l?Math.floor(e/g):e%p,s=l?e%g:Math.floor(e/p),n=t.rWidth+c,o=t.rHeight+c;f[s]=Math.max(f[s],n),m[i]=Math.max(m[i],o),y=Math.max(f[s],y),v=Math.max(m[i],v);}));let x=f.reduce(((t,e)=>t+e),0),w=m.reduce(((t,e)=>t+e),0);const b=(g+1)*u,C=(p+1)*u,S=g*c+b,P=p*c+C;x+=b,w+=C;const A=x-S,T=w-P;let k=0,D=0,E=0,I=0;l?(k=s-S,D=n-2*u-c,E=f.reduce(((t,e)=>t+e-c),0),I=v-c):(k=s-2*u-c,D=n-P,E=y-c,I=m.reduce(((t,e)=>t+e-c),0));const R=zm(r,{zoom:i,fitWidth:E,fitHeight:I,validLayoutWidth:A,validLayoutHeight:T,scrollbarWidth:a,isVertical:l,fitViewportWidth:k,fitViewportHeight:D,isZoomChanged:t.isZoomChanged},jm);t.isZoomChanged=!1;const{zoomedLayoutWidth:M,zoomedLayoutHeight:B,zoomedViewportWidth:L,zoomedViewportHeight:U,newFitMode:O}=R;if(i=R.zoom,O&&r!==O){t.fitMode=O,t.viewerContext.viewerConfig.fitMode=O;const e=hg.create(r,O);t.viewerContext.hooks.fitModeChanged.emit(e);}t.setZoom(i);const _=M+S,N=B+P;let W=0,F=0;l?(W=L+(g+1)*u+g*c,F=U+2*u+c):(W=L+2*u+c,F=U+(p+1)*u+p*c);const H=t.viewerContext.viewService.getCanvasBorderSize();t.currentLayoutWidth=_+2*H,t.currentLayoutHeight=N+2*H,t.currentViewportWidth=W,t.currentViewportHeight=F,t.tab.setPosition({x:-0,y:-0});const V=o.pages.map((t=>({uid:t.uid,x:0,y:0,width:0,height:0,pageX:0,pageY:0})));e.forEach(((e,s)=>{const n=l?Math.floor(s/g):s%p,o=l?s%g:Math.floor(s/p),r=(f[o]-c)*i+c,a=(m[n]-c)*i+c,h=e.rWidth,y=e.rHeight;let v=0,x=0;if(0===o)v=u;else {const t=V[l?s-1:(o-1)*p+n];v=t.x+t.width+u;}if(0===n)x=u;else {const t=V[l?(n-1)*g+o:s-1];x=t.y+t.height+u;}const w=V[s];w.width=r,w.height=a,w.x=v,w.y=x,e.zoom=i;const b=h*i,C=y*i,S=x+(a-C)/2-d,P=gm(v+(r-b)/2-d),A=gm(S);w.pageX=P,w.pageY=A;let T=b+c,k=C+c;T=fm(T),k=fm(k);const D=gm(d),E=D,I=fm(h),R=fm(y),M=h*(1-i)/2,B=y*(1-i)/2,L=D,U=D,O=fm(b),_=fm(C),N=e.cropWidth,W=e.cropHeight,F=D-M-(N-I)/2,H=E-B-(W-R)/2,z=D-M,j=E-B,$=I,G=R;e.setPage(P,A,T,k),e.setBorderBox(0,0,T,k),e.setCropBox(F,H,N,W,i,e.rotation),e.setRealTimeBox(z,j,$,G,i);const{width:X,height:Y}=t.viewerContext.getPageRenderSize(e.uid);e.setMediaBox(-e.cropLeft,-e.cropTop,X,Y),e.setImage(e.mediaBoxRect.left,e.mediaBoxRect.top,X,Y),e.setCurBox(L,U,O,_);})),t.placeholderPages=V;}(t):"slide"===e&&$m(t);}class Ym{constructor(t,e){l(this,"context",void 0),l(this,"hooks",void 0),this.context=t,this.hooks=e;}layout(t){if(t.isDestroyed||!t.isActive)return;let e;if(this.context.isDefaultViewer)e=Xm;else if(this.context.isThumbnailViewer)e=Fm;else if(this.context.isPerspectiveViewer){const{displayMode:i}=t.context;"single"===i?e=Hm:"slide"===i&&(e=$m);}e&&(this.hooks.beforeLayout.emit(t),e(t.context),this.hooks.afterLayout.emit(t));}}const Jm=["viewerMode","displayMode","toolMode","annotationMode","fitMode","visibility","zoom","zoomOrigin","minZoom","maxZoom","multiselectMode","canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle","quadSelectionStyle","rows","columns","maxColumns","maxRows","margin"];class qm extends Tn{constructor(t){super(),l(this,"context",void 0),l(this,"handlers",{}),this.context=t;}dispose(){this.context=null,this.handlers={},super.dispose();}updateConfig(t){for(const[e,i]of Object.entries(t))Jm.includes(e)&&this[e](i);}registerHandler(t,e){return !this[t]&&(this[t]=e,!0)}viewerMode(t){const{context:e}=this;e.viewerConfig.viewerMode=t,vp.CAPTURE;}toolMode(t){const{context:e}=this,i=e.viewerConfig.toolMode;t!==i&&(e.viewerConfig.toolMode=t,e.hooks.toolModeChanged.emit(wg.create(i,t)));}annotationMode(t){const{context:e}=this,i=e.viewerConfig.annotationMode;t!==i&&(e.viewerConfig.annotationMode=t),e.hooks.annotationModeChanged.emit(Ag.create(i,t));}fitMode(t){const{context:e}=this,i=e.getActiveTab();if(!i){const i=e.viewerConfig.fitMode;if(i===t)return;return e.viewerConfig.fitMode=t,void e.hooks.fitModeChanged.emit(hg.create(i,t))}const s=i.context.fitMode;s!==t&&(i.context.fitMode=t,"none"!==t&&(e.showTab(i,!0),e.hooks.fitModeChanged.emit(hg.create(s,t))));}displayMode(t){const{context:e}=this,i=e.getActiveTab();let s;if(i){if(s=i.context.displayMode,t===s)return;i.context.displayMode=t,e.showTab(i,!0);}else {if(s=e.viewerConfig.displayMode,t===s)return;e.viewerConfig.displayMode=t;}if("slide"!==s&&"slide"!==t){const i=ag.create(s,t);e.viewer.hooks.displayModeChanged.emit(i);}}margin(t){const{context:e}=this;e.viewerConfig.margin!==t&&(e.viewerConfig.margin=t,e.showCurrentTab(!0));}rows(t){const{context:e}=this,i=e.getActiveTab();i?t!==i.context.rows&&(e.styleService.isCheckboxStyleChanged=!0,e.styleService.isPageNumberStyleChanged=!0,i.context.rows=t,this.context.showTab(i,!0)):e.viewerConfig.rows=t;}columns(t){const{context:e}=this,i=e.getActiveTab();i?t!==i.context.columns&&(e.styleService.isCheckboxStyleChanged=!0,e.styleService.isPageNumberStyleChanged=!0,i.context.columns=t,this.context.showTab(i,!0)):e.viewerConfig.columns=t;}maxColumns(t){t=Math.max(1,t);const{context:e}=this;e.viewerConfig.maxColumns=t;const i=e.getActiveTab();i&&i.context.columns>t&&this.columns(t);}maxRows(t){t=Math.max(1,t);const{context:e}=this;e.viewerConfig.maxRows=t;const i=e.getActiveTab();i&&i.context.rows>t&&this.rows(t);}zoom(t){const{context:e}=this;e.getActiveTab()&&e.zoomTo(t);}visibility(t){const{context:e}=this;if(t===e.viewerConfig.visibility)return;const{rootDom:i,defaultDom:s,thumbnailContainer:n}=e.viewService;if(!i)return;const{ui:o}=e.viewer,r=!n&&o.container.classList.contains("ddv-thumbnail-container"),a=e.viewerConfig.visibility;e.viewerConfig.visibility=t,"visible"===t?(i.style.display="flex",s.style.display="flex",r?(o.container.style.display="flex",e.core.viewerService.onResize.emit()):e.core.viewerService.onResize.emit()):(i.style.display="none",r&&(o.container.style.display="none",e.core.viewerService.onResize.emit()));const l=Wg.create(t,a);e.hooks.visibleChanged.emit(l);}zoomOrigin(t){const{context:e}=this;e.viewerConfig.zoomOrigin=t;}minZoom(t){const{context:e}=this;e.viewerConfig.minZoom=t;}maxZoom(t){const{context:e}=this;e.viewerConfig.maxZoom=t;}multiselectMode(t){const{context:e}=this;e.viewerConfig.multiselectMode=t;}canvasStyle(t){const{context:e}=this;if(Ps(t))if(Object.assign(e.viewerConfig.canvasStyle,t),e.isCaptureViewer){var i;const s=null===(i=e.viewer)||void 0===i||null===(i=i.cameraContext)||void 0===i?void 0:i.cameraContainer;s&&Object.assign(s.style,t);}else {const{canvasContainer:i}=e.viewService,s=e.rendererService.getCanvasDom();i&&(Object.assign(i.style,t),t.cursor&&s&&Object.assign(s.style,{cursor:t.cursor}),e.styleService.isCanvasStyleChanged=!0,t.border&&e.resize(),t.cursor&&e.hooks.canvasCursorStyleChanged.emit());}}pageStyle(t){const{context:e}=this;Ps(t)&&(Object.assign(e.viewerConfig.pageStyle,t),e.styleService.isPageStyleChanged=!0,e.showCurrentTab(!0));}selectedPageStyle(t){const{context:e}=this;Ps(t)&&(Object.assign(e.viewerConfig.selectedPageStyle,t),e.styleService.isSelectedPageStyleChanged=!0,e.showCurrentTab(!0));}hoveredPageStyle(t){const{context:e}=this;Ps(t)&&(Object.assign(e.viewerConfig.hoveredPageStyle,t),e.styleService.isHoveredPageStyleChanged=!0,e.showCurrentTab(!0));}placeholderStyle(t){const{context:e}=this;Ps&&(Object.assign(e.viewerConfig.placeholderStyle,t),e.styleService.isPlaceholderStyleChanged=!0,e.showCurrentTab());}currentPageStyle(t){const{context:e}=this;Ps&&(Object.assign(e.viewerConfig.currentPageStyle,t),e.styleService.isCurrentPageStyleChanged=!0,e.showCurrentTab());}pageNumberStyle(t){const{context:e}=this;if(Ps(t)){const{pageNumberStyle:i}=e.viewerConfig,s=(null==t?void 0:t.onPage)!==(null==i?void 0:i.onPage);Object.assign(i,t),e.styleService.isPageNumberStyleChanged=!0,e.showCurrentTab(s);}}checkboxStyle(t){const{context:e}=this;Ps(t)&&(Object.assign(e.viewerConfig.checkboxStyle,t),e.styleService.isCheckboxStyleChanged=!0,e.showCurrentTab());}quadSelectionStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{context:e}=this;Ps(t)&&(Object.assign(e.viewerConfig.quadSelectionStyle,t),e.styleService.isQuadSelectionStyleChanged=!0,e.hooks.quadSelectionStyleChanged.emit(),e.showCurrentTab());}scrollDirection(t){const{context:e}=this;e.viewerConfig.scrollDirection=t;const i=e.getActiveTab();i&&(i.context.direction=t,e.resize());}}class Zm extends Tn{constructor(t){super(),l(this,"context",void 0),this.context=t;}dispose(){super.dispose(),this.context=null;}handleExternalEvents(){const{context:t}=this,{hooks:e}=this.context;if(e.pageChanged.on((t=>{const i=this.context.getActiveTab();let s;!i||0===i.total||-1===i.current&&-1!==i.oldCurrent?s=0:-1!==i.current&&-1===i.oldCurrent&&(s=t.total),Ts(s)||e.pageExistenceChanged.emit(Kg.create(s));})),e.pageChangedAfterRender.on((i=>{const s=this.context.getActiveTab();if(!s)return;const{current:n,oldCurrent:o,currentUid:r,oldCurrentUid:a}=s;if(o!==n){const e=rg.create(o,n);t.emit("currentIndexChanged",e);}if(a!==r){const s=Sg.create(a||"",r||"");t.emit("currentPageChanged",s),e.currentPageChanged.emit(i);}})),e.displayModeChanged.on((e=>{t.emit("displayModeChanged",{...e});})),e.fitModeChanged.on((e=>{t.emit("fitModeChanged",{...e});})),e.toolModeChanged.on((e=>{t.emit("toolModeChanged",{...e});})),e.zoomChanged.on((t=>{t.oldZoomRatio!==t.newZoomRatio&&this.context.viewer.emit("zoomChanged",{...t});})),!this.context.isCaptureViewer){const e=this.context.rendererService.getCanvasDom();Dn(e,"click",this).on((e=>{const i=this.formatEvent(e);t.emit("click",i);})),Dn(e,"dblclick",this).on((e=>{const i=this.formatEvent(e);t.emit("dblclick",i);})),Dn(document.body,"dblclick",this).on((t=>{})),Dn(e,"contextmenu",this).on((e=>{e.preventDefault();const i=this.formatEvent(e);t.emit("rightclick",i);}));}}formatEvent(t){var e,i;const[s]=this.context.formatTouches(t),n=this.context.getPointerOverPageInfo(s.pageX,s.pageY),o=eo.displayResolution,r=eo.dataResolution,{pointerX:a,pointerY:l}=n.imageInfo;return bg.create(n.index,null!==(e=null===(i=n.pageInfo.page)||void 0===i?void 0:i.uid)&&void 0!==e?e:"",a<0?-1:Pn(Cn(a,o,r),2),l<0?-1:Pn(Cn(l,o,r),2),Math.floor(s.pageX),Math.floor(s.pageY),t)}}class Qm extends Tn{constructor(t){super(),l(this,"context",void 0),l(this,"offsetX",0),l(this,"offsetY",0),l(this,"startX",0),l(this,"startY",0),l(this,"isDragging",!1),l(this,"startPage",void 0),l(this,"newIndexes",void 0),l(this,"cacheChildren",void 0),l(this,"cacheSelectedIndexes",void 0),l(this,"isMousedown",!1),l(this,"starDragIndices",[]),this.context=t;}dispose(){super.dispose(),this.context=null;}startHandler(t){const{context:e}=this,{viewerConfig:i,styleService:s}=e;if("pan"!==i.toolMode)return;if(e.isLoadSource)return;const n=e.getActiveTab();if(null==n||!n.total)return;this.isMousedown=!0;const[o]=e.formatTouches(t),{page:r}=e.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;if(r&&r){this.startX=o.pageX,this.startY=o.pageY;const t=r.getPosition();this.offsetX=o.pageX-t.x,this.offsetY=o.pageY-t.y,this.startPage=r,this.cacheChildren=n.pages.slice();}}moveHandler(t){const{context:e}=this,i=e.getActiveTab();if(!i||!e.isThumbnailViewer)return;const[s]=e.formatTouches(t),n=e.getPointerOverPageInfo(s.pageX,s.pageY),{page:o}=n.pageInfo;if(this.isDragging){var r,a,l;if(o&&!o.isSelected){const t=i.selected.map((t=>i.uidToIndex(t))).sort(((t,e)=>t-e)),s=t[0],n=i.getPageIndex(o),r=i.pages.slice();t.slice().reverse().forEach((t=>{r.splice(t,1);}));let a=r.indexOf(o);n>s&&(a+=1),this.cacheSelectedIndexes.forEach(((t,e)=>{const s=i.getPageByUid(t.uid);r.splice(a+e,0,s);})),this.newIndexes=r.map((t=>i.getPageIndex(t))),i.reorderPages(this.newIndexes,!1),e.layoutService.layout(i),e.visibilityService.handleVisibility(i);}const t=e.styleService.getParsedPlaceholderStyle(),n=devicePixelRatio;let h=s.pageX-this.offsetX,d=s.pageY-this.offsetY;h=Math.round(h*n)/n,d=Math.round(d*n)/n,i.selected.forEach((e=>{const s=i.getPageByUid(e);s.isDragging=!0,s.updateStyle({...t}),s.borderBox.updateStyle({visibility:"hidden"});})),null===(r=this.startPage)||void 0===r||r.updateStyle({zIndex:1}),null===(a=this.startPage)||void 0===a||a.borderBox.updateStyle({visibility:"visible"}),null===(l=this.startPage)||void 0===l||l.borderBox.setPosition({x:h,y:d}),e.loadVisiblePages(i),e.rendererService.render(i);}else if(o&&o===this.startPage&&o.isSelected){if(((s.pageX-this.startX)**2+(s.pageY-this.startY)**2)**.5>=e.viewerConfig.dragThreshold&&this.startPage&&e.viewerConfig.enableDragPage){this.isDragging=!0,this.cacheSelectedIndexes=i.selected.map((t=>({uid:t,index:i.uidToIndex(t)}))).sort(((t,e)=>t.index-e.index));const t=i.uidsToIndices(i.selected);this.starDragIndices=[...t],e.viewer.emit("pagesDragged",dg.create(t,[...i.selected]));}}}endHandler(t){var e;if(!this.isMousedown)return;const{context:i}=this,s=i.getActiveTab();if(s){if(this.isDragging){if(this.newIndexes){const t=s.pages.map((t=>this.cacheChildren.indexOf(t)));s.childNodes=this.cacheChildren,i.viewer.reorderPages(t),this.newIndexes=null;}s.selected.forEach((t=>{const e=s.getPageByUid(t);e.borderBox.setLocalPosition({x:0,y:0}),e.isDragging=!1,e.borderBox.updateStyle({visibility:"visible"});}));const t=s.uidsToIndices(s.selected);i.viewer.emit("pagesDropped",cg.create(this.starDragIndices,t,[...s.selected]));}null===(e=this.startPage)||void 0===e||e.updateStyle({zIndex:0}),this.isDragging&&(i.scrollByCurrentChanged=!0,i.layoutService.layout(s),i.visibilityService.handleVisibility(s),i.rendererService.render(s)),this.isMousedown=!1,this.startPage=null,this.isDragging=!1;}}}class Km extends Tn{constructor(t){super(),l(this,"context",void 0),l(this,"isStart",!1),l(this,"startX",void 0),l(this,"startY",void 0),l(this,"lastX",void 0),l(this,"lastY",void 0),l(this,"startTime",void 0),l(this,"startScrollLeft",void 0),l(this,"startScrollTop",void 0),l(this,"isScrolling",void 0),l(this,"scrollTimer",void 0),l(this,"scrollDirectionX","left"),l(this,"scrollDirectionY","top"),l(this,"canvasElX",void 0),l(this,"canvasElY",void 0),this.context=t,this.isScrolling=!1;}startHandler(t){const{context:e}=this;if(e.isPanning||e.isZooming)return;const i=e.getActiveTab();if(null==i||!i.total)return;const s=e.formatTouches(t);if(s.length>1)return;this.canvasElX=t.screenX,this.canvasElY=t.screenY;const{pageX:n,pageY:o}=s[0];this.isStart=!0,this.startX=n,this.startY=o,this.lastX=n,this.lastY=o,this.startTime=(new Date).getTime();const{scrollLeft:r,scrollTop:a}=i.context;this.startScrollLeft=r,this.startScrollTop=a,this.isScrolling=!1,this.scrollTimer&&(Zs.clearTimer(this.scrollTimer),this.scrollTimer=null);}moveHandler(t){if(!this.isStart)return;t instanceof PointerEvent&&t.cancelable&&t.preventDefault();const{context:e}=this;if(e.isZooming)return;const i=e.formatTouches(t);if(i.length>1)return;const s=e.getActiveTab(),{maxScrollLeft:n,maxScrollTop:o}=s.context;let{scrollLeft:r,scrollTop:a}=s.context;if(!n&&!o)return;const{viewerConfig:l}=e,{panThreshold:h,enablePanX:d,enablePanY:c}=l,{pageX:u,pageY:p}=i[0],g=u-this.startX,f=p-this.startY,m=u-this.lastX,y=p-this.lastY;if(e.isPanning){if(!r&&!a&&m>=0&&y>=0)return;if(r===n&&a===o&&m<=0&&y<=0)return;d&&(r=this.startScrollLeft-g),c&&(a=this.startScrollTop-f),r=Us(r,0,n),a=Us(a,0,o),e.viewService.scrollTo(r,a);}else e.isPanning=d&&Math.abs(g)>=h||c&&Math.abs(f)>=h;this.lastX=u,this.lastY=p;}endHandler(t){if(!this.isStart)return;this.isStart=!1,this.context.isPanning=!1;const{context:e}=this,i=e.formatTouches(t,!0);if(i.length>1)return;if(e.isZooming)return;if("mouse"===t.pointerType)return;if(this.canvasElX===t.screenX&&this.canvasElY===t.screenY)return;const{scrollLeft:s,scrollTop:n}=this.context.viewService.getMaxScrollValue(),{scrollLeft:o,scrollTop:r}=this.context.viewService.scrollContainer;if(!this.isScrolling&&(s>0||n>0)){const t=(new Date).getTime(),e=i[0].pageX,a=i[0].pageY,l=e-this.startX,h=a-this.startY;let d=!1,c=!1;l>0?(d=0!==o,this.scrollDirectionX="right"):(d=o!==s,this.scrollDirectionX="left"),h>0?(c=0!==r,this.scrollDirectionY="bottom"):(c=r!==n,this.scrollDirectionY="top");const u=t-this.startTime;if((Math.abs(l)>10||Math.abs(h)>10)&&u>0&&u<300&&(d||c)){let t=Math.abs(l)/u,e=Math.abs(h)/u;(t>.4||e>.4)&&(t=Math.min(t,2.8),e=Math.min(e,2.8),this.scroll(t,e,-.05));}}}scroll(t,e,i){this.isScrolling=!0;const{scrollLeft:s,scrollTop:n}=this.context.viewService.scrollContainer;let o=0,r=0;this.scrollTimer=Zs.createTimer((()=>{const{scrollLeft:a,scrollTop:l}=this.context.viewService.getMaxScrollValue();if(t<=0&&e<=0||!1===this.isScrolling)return Zs.clearTimer(this.scrollTimer),this.scrollTimer=null,void(this.isScrolling=!1);t>=0&&("right"===this.scrollDirectionX?o-=40*t:o+=40*t,t+=i),e>=0&&("bottom"===this.scrollDirectionY?r-=40*e:r+=40*e,e+=i);const h=Us(s+o,0,a),d=Us(n+r,0,l);this.context.viewService.scrollTo(h,d);}),25);}}class ty extends Tn{constructor(t){super(),l(this,"context",void 0),l(this,"scrollTimer",void 0),this.context=t;}scrollHandler(t){const{context:e}=this;if(e.scrollByCurrentChanged)return void(e.scrollByCurrentChanged=!1);const i=e.getActiveTab();if(null==i||!i.total)return;const{scrollLeft:s,scrollTop:n}=t.target;i.context.setTabScrollValue(s,n),e.visibilityService.handleVisibility(i),this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout((()=>{if(!e.isDestroyed&&i.isActive){if(e.isDefaultViewer){if(i.context.updateReference(),i.context.isContinuousDisplay&&e.viewerConfig.autoChangeIndex){const t=i.context.getCurrentByScroll();null!==t&&(i.gotoPage(t),e.visibilityService.handleVisibility(i),e.emitPageChangedEvent(i),e.emitPageChangedAfterRenderEvent(i),e.core.viewerService.onCurrentChangedByScroll.emit(Gg.create(i.uid,e.groupUid,e.uid,t)));}e.loadVisiblePages(i);}else e.isThumbnailViewer&&e.loadVisiblePages(i);this.scrollTimer=null;}}),42),e.rendererService.render(i),e.hooks.scroll.emit();}wheelHandler(t){const{context:e}=this;let{wheelDelta:i}=t;if(t.deltaY&&(i=-t.deltaY),1===t.deltaMode?i*=16:2===t.deltaMode&&(i=i<0?-100:100),!t.ctrlKey){const{scrollLeft:s,scrollTop:n}=e.viewService.getMaxScrollValue();if(s>0||n>0)t.shiftKey&&s>0?(t.cancelable&&t.preventDefault(),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(-i,0)):(t.cancelable&&t.preventDefault(),e.scrollByCurrentChanged=!1,e.viewService.scrollBy(0,-i));else {const s=e.getActiveTab();if("single"===s.context.displayMode){t.cancelable&&t.preventDefault();let n=s.current;i>0&&0!==s.current?n-=1:i<0&&s.current!==s.total-1&&(n+=1),s.current!==n&&e.viewer.gotoPage(n);}}}}}class ey extends Tn{constructor(t){super(),l(this,"context",void 0),l(this,"wheelTimer",void 0),l(this,"isStart",void 0),l(this,"isZooming",void 0),l(this,"startDistance",void 0),l(this,"touchZoomTimer",void 0),l(this,"startZoom",void 0),this.context=t,this.isZooming=!1,this.isStart=!1,this.startZoom=1;}zoomTo(t,e,i){t=sm(t);const{context:s}=this;if(!s.isDefaultViewer)return;const n=s.getActiveTab();if(null==n||!n.total)return;const{viewerConfig:o}=s;if((t=Us(t,o.minZoom,o.maxZoom))===o.zoom)return;Bs(e)&&Bs(i)||({originX:e,originY:i}=n.context.getZoomOriginCord());const r=n.context.generateReference(e,i),a=n.context.zoom;n.context.setZoom(t),o.zoom=t,n.context.isZoomChanged=!0,s.layoutService.layout(n),s.viewService.updateScrollerContentSize(n),s.rendererService.updateCanvasSize();const{scrollLeft:l,scrollTop:h}=n.context.parseReferenceZoom(r,e,i);n.context.setTabScrollValue(l,h),s.viewService.scrollTo(l,h),s.visibilityService.handleVisibility(n),s.loadVisiblePages(n),s.clearCurrentTabOptimization(),s.rendererService.render(n),n.context.oldZoom=a,s.emitZoomChangedEvent(n);}wheelHandler(t){const{context:e}=this,{viewerConfig:i}=e;let{wheelDelta:s}=t;t.deltaY&&(s=-t.deltaY);const n=i.enableZoom&&i.enableZoomWithCtrl;t.ctrlKey&&!t.shiftKey&&n&&(t.cancelable&&t.preventDefault(),this.wheelTimer||(this.wheelTimer=setTimeout((()=>{clearTimeout(this.wheelTimer),this.wheelTimer=null;const n=i.wheelZoomFactor||1,o=s>0?n:1/n,{x:r,y:a}=e.rendererService.getCanvasPosition();this.zoomTo(i.zoom*o,t.pageX-r,t.pageY-a);}),40)));}touchstartHandler(t){const{context:e}=this,i=e.getActiveTab(),{displayMode:s}=i.context,n="continuous"===s||"single"===s;if(!e.viewerConfig.enableZoom||!n)return;const o=e.formatTouches(t);o.length<2||(e.isZooming=!0,this.startZoom=i.context.zoom,this.startDistance=iy(o),this.isStart=!0);}touchmoveHandler(t){if(!this.isStart)return;t.cancelable&&t.preventDefault();const{context:e}=this,i=e.formatTouches(t);if(i.length<2)return;const s=(i[0].pageX+i[1].pageX)/2,n=(i[0].pageY+i[1].pageY)/2;let o=iy(i)/this.startDistance;t.scale&&(o=t.scale);const r=e.getActiveTab();let{zoom:a}=r.context;const l=a;a=this.startZoom*o,a!==l&&(this.touchZoomTimer||(this.touchZoomTimer=setTimeout((()=>{this.zoomTo(a,s,n),clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null;}),25))),e.isZooming=!0;}touchendHandler(t){this.isStart&&(this.isStart=!1,this.startZoom=1,this.context.isZooming=!1);}tapZoomHandler(t){const{toolMode:e,enableZoom:i,tapZoomFactor:s}=this.context.viewerConfig;if(!i)return;const n="zoomIn"===e,o="zoomOut"===e;if(!n&&!o)return;const r=this.context.formatTouches(t);if(r.length>1)return;const a=(r[0].pageX+r[1].pageX)/2,l=(r[0].pageY+r[1].pageY)/2,h=this.context.getActiveTab();let{zoom:d}=h.context;n?d*=s||1:o&&(d/=s||1),this.zoomTo(d,a,l);}}function iy(t){return ((t[0].pageX-t[1].pageX)**2+(t[0].pageY-t[1].pageY)**2)**.5}class sy extends Tn{constructor(t){super(),l(this,"context",void 0),l(this,"isStart",!1),l(this,"startX",void 0),l(this,"isSliding",void 0),l(this,"slideDistance",void 0),l(this,"slideDirection",void 0),l(this,"slideRAF",void 0),l(this,"tabX",void 0),l(this,"tabY",void 0),this.context=t,this.isSliding=!1;}startHandler(t){if(!this.context.viewerConfig.enableSlide)return;if(this.isSliding)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;const{scrollLeft:i,scrollTop:s}=this.context.viewService.getMaxScrollValue();if(i||s)return;const n=this.context.formatTouches(t);if(n.length>1)return;const o=e.getPosition();this.tabX=o.x,this.tabY=o.y,this.startX=n[0].pageX,this.isStart=!0;}moveHandler(t){if(!this.isStart)return;const{context:e}=this,i=e.getActiveTab(),s=e.formatTouches(t)[0].pageX-this.startX;if(s>0?this.slideDirection="right":s<0&&(this.slideDirection="left"),this.slideDistance=Math.min(i.context.viewportWidth,Math.abs(s)),this.isSliding)"right"===this.slideDirection?i.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&i.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),e.render();else if("single"===i.context.displayMode&&"pan"===e.viewerConfig.toolMode&&e.viewerConfig.enableSlide){const{scrollLeft:t,scrollTop:i}=this.context.viewService.getMaxScrollValue();Math.abs(s)>e.viewerConfig.startSlideThreshold&&!t&&!i&&(this.isSliding=!0,this.context.isSliding=!0,e.configService.updateConfig({displayMode:"slide"}));}}endHandler(t){if(!this.isStart)return;const{context:e}=this;this.context.formatTouches(t,!0);const i=e.getActiveTab(),{displayMode:s}=i.context;"slide"===s&&this.slide(i),this.isStart=!1;}slide(t){let e,i=0,s=0,n=0,o=!1;const{viewerConfig:r}=this.context,a=t.context.viewportWidth*r.slideThresholdForPerspective;this.slideDistance>=Math.max(a,r.startSlideThreshold)?(s=t.context.viewportWidth,e=s-this.slideDistance,"left"===this.slideDirection?t.current!==t.total-1?(n=-this.slideDistance,i=-e/6):(s=0,e=this.slideDistance,o=!0,n=-this.slideDistance,i=e/6):0!==t.current?(n=this.slideDistance,i=e/6):(s=0,e=this.slideDistance,o=!0,n=this.slideDistance,i=-e/6)):(o=!0,s=0,e=this.slideDistance,"left"===this.slideDirection?(n=-this.slideDistance,i=e/6):(n=this.slideDistance,i=-e/6));const l=()=>{n+=i;const e=n>=0;if(Math.abs(n)>=s&&(n=s,e||(n*=-1)),t.setPosition({x:n+this.tabX,y:this.tabY,z:0}),Math.abs(n)===s)return o||("right"===this.slideDirection?this.context.viewer.gotoPage(t.current-1):this.context.viewer.gotoPage(t.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(l),this.context.render();};this.slideRAF=requestAnimationFrame(l);}}class ny extends Tn{constructor(t){super(),l(this,"context",void 0),this.context=t;}handleOptimizationEvents(){this.context.hooks.afterRender.on((t=>{this.optimizeTab(t);}));}dispose(){super.dispose(),this.context=null;}optimizeTab(t){this.context.viewerConfig.enableOptimizePage&&t.pages.forEach(((t,e)=>{!Ms()&&!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&setTimeout((()=>{!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&this.optimizePage(t.uid);}),500);}));}cancelOptimization(t){this.context.core.optimizationService.cancel(t);}optimizePage(t){if(!this.context)return;const{context:e}=this,{viewerConfig:i}=e;if(!i.enableOptimizePage)return;const s=e.getActiveTab();if(!s)return;const n=s.getPageByUid(t);if(!n)return;if(n.isOptimized||!n.isVisible||!n.isLoaded||n.optimizationUid===n.optimizedUid||e.isSliding||e.isDestroyed)return;const o=e.core.pageService.getPage(t);if(null==o||!o.display.img)return;const{img:r}=n.image.style;if(!r)return;const{naturalWidth:a,naturalHeight:l}=r;let h=a,d=l;const{maxOptimizationSize:c}=i;if(h>c||d>c||n.rWidth>c||n.rHeight>c)return;let u=0,p=0,g=0,f=0,m=0;({rWidth:h,rHeight:d,cropLeft:u,cropTop:p,cropWidth:g,cropHeight:f,rotation:m}=o.getEditResultForPixel());const y=Cn(o.mediaBox.left,eo.displayResolution,o.resource.resolutionX),v=Cn(o.mediaBox.top,eo.displayResolution,o.resource.resolutionX),x=new ya({style:{x:-u+y,y:-p+v,img:r,width:a,height:l}});let w="rgba(0,0,0,0)";if(i.enableFillColor)w=i.blankFillColor;else if(i.viewerMode===vp.THUMBNAIL){let t=i.pageStyle;n.isSelected?t=i.selectedPageStyle:n.isHovered&&(t=i.hoveredPageStyle),w=t.background;}const b=new Aa({style:{x:-(g-h)/2,y:-(f-d)/2,width:g,height:f,background:w}});b.appendChild(x),b.setLocalAngle(m);const{commonCanvas:C}=e.core;C.render(b,h,d),C.reset();const S=C.getCanvas(),P=devicePixelRatio,A=Math.floor(n.realTimeBox.width*P+.5)||1,T=Math.floor(n.realTimeBox.height*P+.5)||1;n.isOptimized=!0,e.core.optimizationService.optimize(S,h,d,A,T,n.optimizationUid).then((t=>{if(!e.isDestroyed&&t.taskUid===n.optimizationUid){n.isOptimized=!0,n.optimizedUid=n.optimizationUid;const i=S.getContext("2d",{willReadFrequently:!0}).createImageData(A,T);i.data.set(t.target),n.realTimeBox.imageData=i,n.image.updateStyle({visibility:"hidden"}),n.isVisible&&e.render();}})).catch((t=>{n.isOptimized=!1;}));}}class oy extends Tn{constructor(t,e,i,s,n,o){super(),l(this,"context",void 0),l(this,"panModeInteraction",void 0),l(this,"cropModeInteraction",void 0),l(this,"annotationModeInteraction",void 0),l(this,"zoomInModeInteraction",void 0),l(this,"zoomOutModeInteraction",void 0),this.context=t,this.panModeInteraction=e,this.cropModeInteraction=i,this.annotationModeInteraction=s,this.zoomInModeInteraction=n,this.zoomOutModeInteraction=o;}handleEvents(){if(this.context.isCaptureViewer)return;const t=this.context.rendererService.getCanvasDom();Dn(t,"pointerdown",this).on((t=>{if(0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointerdownHandler(t),this.cropModeInteraction.pointerdownHandler(t),this.annotationModeInteraction.pointerdownHandler(t),this.zoomInModeInteraction.startHandler(t),this.zoomOutModeInteraction.startHandler(t));})),Dn(t,"pointermove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointermoveHandler(t,!1),this.cropModeInteraction.pointermoveHandler(t),this.annotationModeInteraction.cursorHandler(t));}),{passive:!1}),Dn(t,"pointerup",this).on((t=>{if(0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&this.panModeInteraction.pointerupHandler(t);})),Dn(document,"pointerdown",this).on((t=>{})),Dn(document,"pointermove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointermoveHandler(t,!0),this.annotationModeInteraction.pointermoveHandler(t));}),{passive:!1}),Dn(document,"pointerup",this).on((t=>{if(0!==t.button)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.pointerupHandler(t),this.cropModeInteraction.pointerupHandler(t),this.annotationModeInteraction.pointerupHandler(t),this.zoomInModeInteraction.endHandler(t),this.zoomOutModeInteraction.endHandler(t));})),Dn(t,"touchstart",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.touchstartHandler(t),this.cropModeInteraction.touchstartHandler(t));}),{passive:!1}),Dn(t,"touchmove",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(t.cancelable&&t.preventDefault(),this.panModeInteraction.touchmoveHandler(t),this.cropModeInteraction.touchmoveHandler(t));}),{passive:!1}),Dn(t,"touchend",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.touchendHandler(t),this.cropModeInteraction.touchendHandler(t));})),Dn(t,"wheel",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.wheelHandler(t),this.cropModeInteraction.wheelHandler(t),this.annotationModeInteraction.wheelHandler(t));}),{passive:!1}),Dn(this.context.viewService.scrollContainer,"scroll",this).on((t=>{const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.scrollHandler(t),this.cropModeInteraction.scrollHandler(t),this.annotationModeInteraction.scrollHandler(t));})),Dn(document,"keydown",this).on((t=>{if(!this.context.isFocused||!this.context.viewerConfig.enableKeyboardInteraction)return;const e=this.context.getActiveTab();null!=e&&e.total&&(this.panModeInteraction.keydownHandler(t),this.cropModeInteraction.keydownHandler(t),this.annotationModeInteraction.keydownHandler(t),this.zoomInModeInteraction.keydownHandler(t),this.zoomOutModeInteraction.keydownHandler(t));})),Dn(document,"click",this).on((t=>{const e=this.context.rendererService.getCanvasDom();this.context.isFocused=t.target===e;}));}}class ry extends Tn{constructor(t){super(),l(this,"context",void 0),l(this,"isPointerdown",!1),l(this,"startPage",void 0),l(this,"mouseOverPage",void 0),this.context=t;}startHandler(t){const{context:e}=this,{viewerConfig:i,styleService:s}=e,n=this.context.getActiveTab();if(null==n||!n.total)return;this.isPointerdown=!0;const[o]=e.formatTouches(t),{page:r}=e.getPointerOverPageInfo(o.pageX,o.pageY).pageInfo;if(!r)return;if(this.startPage=r,t.ctrlKey)return;const a=n.getPageIndex(r),l=n.getCurrentPage(),h=t.shiftKey&&i.enableSelectWithShift;if(h&&n.selected.length){if(h&&l!==r&&n.shiftReference){const t=n.uidToIndex(n.shiftReference),i=Math.min(a,t),o=Math.max(a,t),l=[];for(let t=i;t<=o;t++)l.push(t);if(e.viewerConfig.enableOptimizePage){s.isSelectedBorderWidthEqualHovered()||e.clearOptimization([r.uid]),s.isSelectedBorderWidthEqualNormal()||l.forEach((t=>{const o=n.getPageByIndex(i+t);n.selected.includes(o.uid)||o.uid===r.uid||s.isSelectedBorderWidthEqualNormal()||e.clearOptimization([o.uid]);}));const t=n.indicesToUids(l);s.isSelectedBorderWidthEqualNormal()||n.selected.forEach((i=>{if(!t.includes(i)){const t=n.getPageByUid(i);t&&e.clearOptimization([t.uid]);}}));}a>t&&l.reverse(),e.viewer.gotoPage(a),e.viewer.selectPagesByIndices(l);}}else i.multiselectMode||(r.uid!==n.currentUid&&e.viewer.gotoPage(a),r.isSelected||(e.viewerConfig.enableOptimizePage&&(s.isSelectedBorderWidthEqualNormal()||n.selected.forEach((t=>{const i=n.getPageByUid(t);i&&e.clearOptimization([i.uid]);})),s.isSelectedBorderWidthEqualHovered()||e.clearOptimization([r.uid])),e.viewer.selectPagesByIndices([a])));}moveHandler(t){const{context:e}=this,{styleService:i}=e,s=e.getActiveTab();if(null==s||!s.total)return;const[n]=e.formatTouches(t),o=e.getPointerOverPageInfo(n.pageX,n.pageY),{page:r}=o.pageInfo,{mouseOverPage:a}=this;e.viewerConfig.enableOptimizePage&&!i.isBorderWidthEqualHovered()&&(a&&!a.isSelected&&(r&&a===r||e.clearOptimization([a.uid])),r&&!r.isSelected&&(a&&a===r||e.clearOptimization([r.uid]))),this.mouseOverPage=r;let l=!1;"mouse"===t.pointerType&&s.pages.forEach((t=>{r&&r.uid===t.uid?(t.isHovered||(l=!0),t.isHovered=!0):(t.isHovered&&(l=!0),t.isHovered=!1);})),l&&(e.layoutService.layout(s),e.visibilityService.handleVisibility(s),e.rendererService.render(s));}endHandler(t){if(!this.isPointerdown)return;const{context:e}=this,{styleService:i}=e,[s]=e.formatTouches(t,!0),n=e.getActiveTab();if(null==n||!n.total)return;const o=e.getPointerOverPageInfo(s.pageX,s.pageY).pageInfo.page;if(o&&o===this.startPage&&!t.shiftKey)if(t.ctrlKey&&e.viewerConfig.enableSelectWithCtrl||e.viewerConfig.multiselectMode){const t=n.selected.slice(),s=t.indexOf(o.uid);o.isSelected?t.splice(s,1):t.push(o.uid);const r=n.uidsToIndices(t);if(o.uid!==n.currentUid){const t=n.uidToIndex(o.uid);e.viewer.gotoPage(t);}!i.isSelectedBorderWidthEqualHovered()&&e.viewerConfig.enableOptimizePage&&e.clearOptimization([o.uid]),e.viewer.selectPagesByIndices(r);}else if(!t.ctrlKey&&!t.shiftKey){const t=n.getPageIndex(o);o.uid!==n.currentUid&&e.viewer.gotoPage(t),e.viewerConfig.enableOptimizePage&&(i.isSelectedBorderWidthEqualNormal()||n.selected.forEach((t=>{const i=n.getPageByUid(t);i&&e.clearOptimization([i.uid]);})),i.isSelectedBorderWidthEqualHovered()||e.clearOptimization([o.uid])),e.viewer.selectPagesByIndices([t]);}this.isPointerdown=!1,this.startPage=null;}keydownHandler(t){}}class ay extends Tn{constructor(t){super(),l(this,"context",void 0),this.context=t;}undoHandler(t){t.ctrlKey&&this.context.viewerConfig.enableUndoWidthKeyboard&&(t.preventDefault(),this.context.viewer.undo());}redoHandler(t){t.ctrlKey&&this.context.viewerConfig.enableUndoWidthKeyboard&&(t.preventDefault(),this.context.viewer.redo());}zoomInHandler(t){t.ctrlKey&&this.context.viewerConfig.enableZoomInWidthKeyboard&&(t.preventDefault(),this.context.viewer.zoomIn());}zoomOutHandler(t){t.ctrlKey&&this.context.viewerConfig.enableZoomOutWidthKeyboard&&(t.preventDefault(),this.context.viewer.zoomOut());}arrowLeftHandler(t){}arrowRightHandler(t){}arrowUpHandler(t){}arrowDownHandler(t){}escapeHandler(t){}enterHandler(t){}pageUpHandler(t){}pageDownHandler(t){}homeHandler(t){}endHandler(t){}scrollHandler(t){}selectPageHandler(t){}}class ly{constructor(t){l(this,"context",void 0),l(this,"isEditAnnotation",!1),l(this,"isMove",!1),l(this,"isSlide",!1),l(this,"isActivateAnnotation",!1),l(this,"isTouchstart",!1),l(this,"isPointerdown",!1),l(this,"isFirstMove",!0),l(this,"isPointerOnAnnotation",!1),l(this,"isAnnotationActive",!1),l(this,"activeShape",void 0),l(this,"pointerNum",0),l(this,"startPoint",void 0),l(this,"dragTimer",void 0),l(this,"isDragPages",!1),l(this,"isMoveForThumbnail",!1),l(this,"isMoved",!1),l(this,"keyboardHandlerMapForDefault",void 0),l(this,"keyboardHandlerMapForThumbnail",void 0),l(this,"canScroll",!0),l(this,"startX",void 0),l(this,"startY",void 0),this.context=t;}get isPanMode(){return "pan"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(this.isPointerdown||!this.isPanMode)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;if("slide"===this.context.viewerConfig.displayMode)return;const{isDefaultViewer:i,isThumbnailViewer:s,viewService:n,hasAnnotationModule:o,annotationEditService:r,selectPagesService:a,moveService:l,dragService:h,slideService:d,viewerConfig:{dragStartTimeThreshold:c,enableSlide:u,enableDragPage:p}}=this.context,{displayMode:g}=e.context;if(this.isPointerdown=!0,this.isFirstMove=!0,i){const{scrollLeft:e,scrollTop:i}=n.getMaxScrollValue();if(o){const[e]=this.context.formatTouches(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;if(this.startPoint={x:e.pageX,y:e.pageY},i){let{x:t,y:e}=i.cropBox.getPosition(),{width:s,height:n}=i.cropBox;const o=(i.rotation%360+360)%360/90;if(1===o?t-=n:2===o?(t-=s,e-=n):3===o&&(e-=s),1===o||3===o){const t=s;s=n,n=t;}r.setAnnotationContainer(i),r.setAnnotationInteractionArea({x:t,y:e,width:s,height:n});}const{isHit:s,shape:n,isHitSelected:o}=this.context.annotationEditService.isHitAnnotation(t);s&&i?(this.activeShape=n,this.isPointerOnAnnotation=!0,"touch"===t.pointerType||"pen"===t.pointerType?o?(this.isAnnotationActive=!0,this.isEditAnnotation=!0,r.startHandler(t,!1)):this.isActivateAnnotation=!0:"mouse"===t.pointerType&&(this.isAnnotationActive=!0,this.isEditAnnotation=!0,r.startHandler(t,!0)),r.hasActiveAnnotation()&&(this.canScroll=!1)):r.deactivateAnnotation();}this.isPointerOnAnnotation||(e||i?(this.isMove=!0,this.isSlide=!1,l.startHandler(t)):"single"===g&&u&&(this.isMove=!1,this.isSlide=!0,d.startHandler(t)));}else if(s){a.startHandler(t);const[e]=this.context.formatTouches(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;i&&!t.ctrlKey?"touch"===t.pointerType||"pen"===t.pointerType?(p?this.dragTimer=setTimeout((()=>{this.isMoveForThumbnail||(this.isDragPages=!0,h.startHandler(t));}),c):(this.isMoveForThumbnail=!0,l.startHandler(t)),this.startX=t.pageX,this.startY=t.pageY):"mouse"===t.pointerType&&(p?(this.isDragPages=!0,h.startHandler(t)):(this.isMoveForThumbnail=!0,l.startHandler(t))):(this.isMoveForThumbnail=!0,l.startHandler(t));}}pointermoveHandler(t,e){if(this.pointerNum>1)return;const i=this.context.getActiveTab();if(null==i||!i.total)return;const{isDefaultViewer:s,isThumbnailViewer:n,viewService:o,moveService:r,slideService:a,annotationEditService:l,dragService:h,selectPagesService:d}=this.context,{displayMode:c}=i.context;if(s&&!e&&this.isPointerdown){if(this.isPointerOnAnnotation&&!this.isAnnotationActive&&this.isFirstMove){const[e]=this.context.formatTouches(t);Js(this.startPoint,{x:e.pageX,y:e.pageY})>1&&(this.isActivateAnnotation=!1);const{scrollLeft:i,scrollTop:s}=o.getMaxScrollValue();i||s?(this.isMove=!0,this.isSlide=!1,r.startHandler(t)):"single"===c&&(this.isMove=!1,this.isSlide=!0,a.startHandler(t));}if(this.isEditAnnotation){const[e]=this.context.formatTouches(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;l.moveHandler(t,!i);}else this.isMove?r.moveHandler(t):this.isSlide&&a.moveHandler(t);this.isFirstMove=!1;}else if(n&&e)if(d.moveHandler(t),"touch"===t.pointerType){const e=Js({x:this.startX,y:this.startY},{x:t.pageX,y:t.pageY});this.isPointerdown&&this.dragTimer&&(this.isDragPages||r.startHandler(t),e>5&&(clearTimeout(this.dragTimer),this.dragTimer=null)),this.isDragPages?(this.isMoved=!0,h.moveHandler(t)):!this.isDragPages&&this.isPointerdown&&(e>5&&(this.isMoveForThumbnail=!0,r.moveHandler(t)),this.isMoved=!0);}else this.isPointerdown&&this.dragTimer&&(this.isDragPages||r.startHandler(t),clearTimeout(this.dragTimer),this.dragTimer=null),this.isDragPages?(this.isMoved=!0,h.moveHandler(t)):!this.isDragPages&&this.isPointerdown&&(this.isMoveForThumbnail=!0,r.moveHandler(t),this.isMoved=!0);}pointerupHandler(t){if(!this.isPointerdown)return;const{isDefaultViewer:e,isThumbnailViewer:i,annotationEditService:s,moveService:n,slideService:o,dragService:r,selectPagesService:a}=this.context;if(e)this.isEditAnnotation?s.endHandler(t):this.isActivateAnnotation?(s.activateAnnotation(this.activeShape,t.ctrlKey),this.context.render()):this.isMove?n.endHandler(t):this.isSlide&&o.endHandler(t);else if(i){this.dragTimer&&(clearTimeout(this.dragTimer),this.dragTimer=null);const e=Js({x:this.startX,y:this.startY},{x:t.pageX,y:t.pageY});(!this.isMoved||e<5)&&a.endHandler(t),this.isDragPages?r.endHandler(t):n.endHandler(t);}this.isPointerdown=!1,this.isFirstMove=!0,this.isEditAnnotation=!1,this.isMove=!1,this.isSlide=!1,this.isActivateAnnotation=!1,this.isPointerOnAnnotation=!1,this.isAnnotationActive=!1,this.activeShape=null,this.isMoveForThumbnail=!1,this.isDragPages=!1,this.isMoved=!1,this.canScroll=!0,this.startPoint=null;}touchstartHandler(t){if(this.pointerNum=t.targetTouches.length,this.context.isDefaultViewer){const{enableZoom:e,enableZoomInPanMode:i,enableZoomWithTouch:s}=this.context.viewerConfig;if(!this.isPanMode||2!==t.targetTouches.length||this.isTouchstart||!e||!s||!i)return;this.isTouchstart=!0,this.context.zoomService.touchstartHandler(t);}}touchmoveHandler(t){this.pointerNum=t.targetTouches.length,2===t.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(t);}touchendHandler(t){this.pointerNum=t.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(t));}wheelHandler(t){if(this.pointerNum=0,!this.isPanMode)return;if(!this.canScroll)return void t.preventDefault();const{isDefaultViewer:e,isThumbnailViewer:i,viewerConfig:{enableZoom:s,enableZoomInPanMode:n,enableZoomWithCtrl:o},zoomService:r,scrollService:a}=this.context;if(e)if(t.ctrlKey){if(!s||!n||!o)return;r.wheelHandler(t);}else a.wheelHandler(t);else i&&a.wheelHandler(t);}scrollHandler(t){this.isPanMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(t);}keydownHandler(t){if(!this.isPanMode)return;const{context:e,context:{keyboardService:i,annotationEditService:s,viewerConfig:{enableKeyboardInteraction:n,enableZoom:o,enableZoomInPanMode:r,enableZoomOutWidthKeyboard:a,enableZoomInWidthKeyboard:l,enableCopyCutPasteWidthKeyboard:h,enableUndoWidthKeyboard:d,enableRedoWidthKeyboard:c},viewerConfig:u,hasAnnotationModule:p}}=this;if(!n)return;const g=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(e.isDefaultViewer){let e=this.keyboardHandlerMapForDefault;if(e||(e={c:t=>{h&&s.copyAnnotations();},x:t=>{h&&s.cutAnnotations();},v:t=>{h&&s.pasteAnnotations();},y:t=>{c&&i.redoHandler(t);},z:t=>{d&&i.undoHandler(t);},"-":t=>{o&&r&&a&&i.zoomOutHandler(t);},"=":t=>{o&&r&&l&&i.zoomInHandler(t);},Escape:t=>{i.escapeHandler(t);},Enter:t=>{i.enterHandler(t);},PageUp:t=>{i.pageUpHandler(t);},PageDown:t=>{i.pageDownHandler(t);},Home:t=>{i.homeHandler(t);},End:t=>{i.endHandler(t);}},this.keyboardHandlerMapForDefault=e),t.ctrlKey){const n=e[t.key];n&&t.ctrlKey?n(t):g.includes(t.key)&&(p&&s.hasActiveAnnotation()?s.moveAnnotationByKeyboard(t):i.scrollHandler(t));}}else if(e.isThumbnailViewer){let s=this.keyboardHandlerMapForThumbnail;s||(s={PageUp:t=>{i.pageUpHandler(t);},PageDown:t=>{i.pageDownHandler(t);},Home:t=>{i.homeHandler(t);},End:t=>{i.endHandler(t);}},this.keyboardHandlerMapForThumbnail=s);const n=s[t.key];n?n(t):g.includes(t.key)&&e.selectPagesService.keydownHandler(t);}}}class hy{constructor(t){l(this,"context",void 0),l(this,"isEditCropBox",!1),l(this,"isPerspectiveQuad",!1),l(this,"isTouchstart",!1),l(this,"isPointerdown",!1),l(this,"pointerNum",0),l(this,"keyboardHandlerMap",void 0),this.context=t;}get isCropMode(){return "crop"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(this.isPointerdown||!this.isCropMode)return;this.isPointerdown=!0;const{context:e}=this;e.hasBoxRendererModule?e.isDefaultViewer?(this.isEditCropBox=e.cropBoxEditService.isEditCropBox(t),this.isEditCropBox?e.cropBoxEditService.startHandler(t):e.moveService.startHandler(t)):e.isPerspectiveViewer&&(this.isPerspectiveQuad=!0,e.perspectiveQuadEditService.startHandler(t)):e.isDefaultViewer&&e.moveService.startHandler(t);}pointermoveHandler(t){if(this.pointerNum>1)return;const{context:e}=this;e.isDefaultViewer?(e.cropBoxEditService.moveHandler(t),!this.isEditCropBox&&this.isPointerdown&&e.moveService.moveHandler(t)):e.isPerspectiveViewer&&e.perspectiveQuadEditService.moveHandler(t);}pointerupHandler(t){if(!this.isPointerdown)return;const{context:e}=this;e.isDefaultViewer?this.isEditCropBox?e.cropBoxEditService.endHandler(t):e.moveService.endHandler(t):e.isPerspectiveViewer&&this.isPerspectiveQuad&&e.perspectiveQuadEditService.endHandler(t),this.isPointerdown=!1,this.isEditCropBox=!1,this.isPerspectiveQuad=!1;}touchstartHandler(t){this.pointerNum=t.targetTouches.length;const{context:e,context:{viewerConfig:i}}=this;if(e.isDefaultViewer){if(!this.isCropMode||2!==t.targetTouches.length||this.isTouchstart||!i.enableZoom||!i.enableZoomWithTouch||!i.enableZoomInCropMode)return;this.isTouchstart=!0,e.zoomService.touchstartHandler(t);}}touchmoveHandler(t){this.pointerNum=t.targetTouches.length,2===t.targetTouches.length&&this.isTouchstart&&this.context.isDefaultViewer&&this.context.zoomService.touchmoveHandler(t);}touchendHandler(t){this.pointerNum=t.targetTouches.length,this.isTouchstart&&(this.isTouchstart=!1,this.context.isDefaultViewer&&this.context.zoomService.touchendHandler(t));}wheelHandler(t){if(this.pointerNum=0,!this.isCropMode)return;const{context:e,context:{viewerConfig:i}}=this;if(e.isDefaultViewer)if(t.ctrlKey){if(!i.enableZoom||!i.enableZoomInCropMode||!i.enableZoomWithCtrl)return;e.zoomService.wheelHandler(t);}else e.scrollService.wheelHandler(t);}scrollHandler(t){if(!this.isCropMode)return;const{context:e}=this;(e.isDefaultViewer||e.isThumbnailViewer)&&e.scrollService.scrollHandler(t);}keydownHandler(t){if(!this.isCropMode)return;const{keyboardService:e,isDefaultViewer:i,viewerConfig:{enableKeyboardInteraction:s,enableZoom:n,enableZoomInCropMode:o,enableZoomOutWidthKeyboard:r,enableZoomInWidthKeyboard:a,enableUndoWidthKeyboard:l,enableRedoWidthKeyboard:h}}=this.context;if(!i||!s||!t.ctrlKey)return;let d=this.keyboardHandlerMap;d||(d={y:t=>{h&&e.redoHandler(t);},z:t=>{l&&e.undoHandler(t);},"-":t=>{n&&o&&r&&e.zoomOutHandler(t);},"=":t=>{n&&o&&a&&e.zoomInHandler(t);},Escape:t=>{e.escapeHandler(t);},Enter:t=>{e.enterHandler(t);},PageUp:t=>{e.pageUpHandler(t);},PageDown:t=>{e.pageDownHandler(t);}},this.keyboardHandlerMap=d);const c=d[t.key];c?c(t):["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)&&e.scrollHandler(t);}}class dy{constructor(t){l(this,"context",void 0),l(this,"isPointerdown",!1),l(this,"pointerId",null),l(this,"keyboardHandlerMapForDefault",void 0),l(this,"canScroll",!0),this.context=t;}get isAnnotationMode(){return "annotation"===this.context.viewerConfig.toolMode}pointerdownHandler(t){if(!this.isPointerdown&&this.isAnnotationMode&&!this.pointerId&&(this.pointerId=t.pointerId,this.context.hasBoxRendererModule&&this.context.isDefaultViewer)){const[e]=this.context.formatTouches(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;if(i){let{x:t,y:e}=i.cropBox.getPosition(),{width:s,height:n}=i.cropBox;const o=360,r=(i.rotation%o+o)%o/90;if(1===r?t-=n:2===r?(t-=s,e-=n):3===r&&(e-=s),1===r||3===r){const t=s;s=n,n=t;}this.context.annotationEditService.setAnnotationContainer(i),this.context.annotationEditService.setAnnotationInteractionArea({x:t,y:e,width:s,height:n});}this.isPointerdown=!0,this.context.annotationEditService.startHandler(t,!0),this.context.annotationEditService.hasActiveAnnotation()&&(this.canScroll=!1);}}pointermoveHandler(t){if((this.pointerId===t.pointerId||"touch"!==t.pointerType)&&this.context.isDefaultViewer){const[e]=this.context.formatTouches(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;this.context.annotationEditService.moveHandler(t,!i);}}cursorHandler(t){if("mouse"===(null==t?void 0:t.pointerType)&&this.context.isDefaultViewer){const[e]=this.context.formatTouches(t),{page:i}=this.context.getPointerOverPageInfo(e.pageX,e.pageY).pageInfo;"crop"!==this.context.viewerConfig.toolMode&&this.context.annotationEditService.cursorHandler(t,!i,this.context.viewerConfig.canvasStyle.cursor);}}pointerupHandler(t){this.isPointerdown&&(this.context.isDefaultViewer&&this.context.annotationEditService.endHandler(t),this.isPointerdown=!1,this.canScroll=!0,this.pointerId=null);}wheelHandler(t){if(this.isAnnotationMode)if(this.canScroll){if(this.context.isDefaultViewer)if(t.ctrlKey){const{enableZoom:e,enableZoomInAnnotationMode:i,enableZoomWithCtrl:s}=this.context.viewerConfig;if(!(this.isAnnotationMode&&e&&i&&s))return;this.context.zoomService.wheelHandler(t);}else this.context.scrollService.wheelHandler(t);}else t.preventDefault();}scrollHandler(t){this.isAnnotationMode&&this.canScroll&&(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&this.context.scrollService.scrollHandler(t);}keydownHandler(t){if(!this.isAnnotationMode)return;const{context:e,context:{keyboardService:i,annotationEditService:s,viewerConfig:{enableKeyboardInteraction:n,enableZoom:o,enableZoomInAnnotationMode:r,enableZoomOutWidthKeyboard:a,enableZoomInWidthKeyboard:l,enableCopyCutPasteWidthKeyboard:h,enableUndoWidthKeyboard:d,enableRedoWidthKeyboard:c},hasAnnotationModule:u}}=this;if(!n)return;const p=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];if(this.context.isDefaultViewer){let e=this.keyboardHandlerMapForDefault;e||(e={c:t=>{h&&s.copyAnnotations();},x:t=>{h&&s.cutAnnotations();},v:t=>{h&&s.pasteAnnotations();},y:t=>{c&&i.redoHandler(t);},z:t=>{d&&i.undoHandler(t);},"-":t=>{o&&r&&a&&i.zoomOutHandler(t);},"=":t=>{o&&r&&l&&i.zoomInHandler(t);},Escape:t=>{i.escapeHandler(t);},Enter:t=>{i.enterHandler(t);},PageUp:t=>{i.pageUpHandler(t);},PageDown:t=>{i.pageDownHandler(t);},Home:t=>{i.homeHandler(t);},End:t=>{i.endHandler(t);}},this.keyboardHandlerMapForDefault=e);const n=e[t.key];n&&t.ctrlKey?n(t):p.includes(t.key)&&(u&&s.hasActiveAnnotation()?s.moveAnnotationByKeyboard(t):i.scrollHandler(t));}}}class cy{constructor(t){l(this,"context",void 0),l(this,"isPointerdown",!1),this.context=t;}get isZoomInMode(){return "zoomIn"===this.context.viewerConfig.toolMode}startHandler(t){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(t),this.isPointerdown=!0);}endHandler(t){this.isPointerdown&&(this.isPointerdown=!1);}keydownHandler(t){if(!this.isZoomInMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:e}}=this;e.enableKeyboardInteraction&&e.enableZoom&&e.enableZoomInWidthKeyboard&&t.ctrlKey&&"="===t.key&&this.context.keyboardService.zoomInHandler(t);}}class uy{constructor(t){l(this,"context",void 0),l(this,"isPointerdown",!1),this.context=t;}get isZoomOutMode(){return "zoomOut"===this.context.viewerConfig.toolMode}startHandler(t){!this.isPointerdown&&this.context.isDefaultViewer&&(this.context.zoomService.tapZoomHandler(t),this.isPointerdown=!0);}endHandler(t){this.isPointerdown&&(this.isPointerdown=!1);}keydownHandler(t){if(!this.isZoomOutMode||!this.context.isDefaultViewer)return;const{context:{viewerConfig:e}}=this;e.enableKeyboardInteraction&&e.enableZoom&&e.enableZoomOutWidthKeyboard&&t.ctrlKey&&"-"===t.key&&this.context.keyboardService.zoomInHandler(t);}}class py extends Tn{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),l(this,"core",void 0),l(this,"viewer",void 0),l(this,"uid",void 0),l(this,"groupUid",void 0),l(this,"hooks",void 0),l(this,"viewService",void 0),l(this,"rendererService",void 0),l(this,"tabService",void 0),l(this,"layoutService",void 0),l(this,"styleService",void 0),l(this,"configService",void 0),l(this,"visibilityService",void 0),l(this,"annotationEditService",void 0),l(this,"cropBoxEditService",void 0),l(this,"perspectiveQuadEditService",void 0),l(this,"eventsService",void 0),l(this,"dragService",void 0),l(this,"moveService",void 0),l(this,"scrollService",void 0),l(this,"zoomService",void 0),l(this,"slideService",void 0),l(this,"optimizationService",void 0),l(this,"interactionService",void 0),l(this,"selectPagesService",void 0),l(this,"keyboardService",void 0),l(this,"viewerConfig",As(om)),l(this,"postfix",void 0),l(this,"isDestroyed",!1),l(this,"viewportWidth",0),l(this,"viewportHeight",0),l(this,"scrollByCurrentChanged",!1),l(this,"isInitialized",!1),l(this,"addPagesTimer",null),l(this,"isPanning",void 0),l(this,"isZooming",void 0),l(this,"isSliding",void 0),l(this,"isLoadSource",!1),l(this,"isFocused",!1),l(this,"hasBoxRendererModule",!1),l(this,"hasAnnotationModule",!1),this.core=t,this.viewer=e,this.postfix=e.postfix,this.hooks=e.hooks,this.uid=e.uid,this.groupUid=e.groupUid,vn(i,this.viewerConfig),this.styleService=new wm(this),this.viewService=this.register(new Um(this,this.hooks)),this.rendererService=this.register(new Wm(this,this.hooks)),this.layoutService=new Ym(this,this.hooks),this.configService=this.register(new qm(this)),this.tabService=this.register(new xm(this)),this.visibilityService=new km(this),this.optimizationService=this.register(new ny(this)),this.handleViewerModeChanged(),this.eventsService=this.register(new Zm(this)),this.dragService=this.register(new Qm(this)),this.moveService=this.register(new Km(this)),this.scrollService=this.register(new ty(this)),this.zoomService=this.register(new ey(this)),this.slideService=this.register(new sy(this)),this.interactionService=this.register(new oy(this,new ly(this),new hy(this),new dy(this),new cy(this),new uy(this))),this.selectPagesService=this.register(new ry(this)),this.keyboardService=this.register(new ay(this)),this.eventsService.handleExternalEvents(),this.optimizationService.handleOptimizationEvents(),this.interactionService.handleEvents();}get isCropToolMode(){throw new Error("Method not implemented.")}get isVisible(){var t;return "visible"===(null===(t=this.viewerConfig)||void 0===t?void 0:t.visibility)}syncViewer(t){const e=t.getActiveTab();if(!e)return;const i=this.tabService.createTab(e.doc);if(i.isDocType){const{width:t,height:e}=this.viewService.getViewportSize();i.updateViewportSize(t,e);}i.currentUid=e.currentUid,i.selectPages([...e.selected]),this.tabService.activateTab(i.uid),this.hooks.syncDocument.emit(i.doc),this.emitPageChangedEvent(i),this.showTab(i),this.emitPageChangedAfterRenderEvent(i);}formatTouches(t){const e=[];let i=null;i=t instanceof MouseEvent||t instanceof PointerEvent?[t]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?t.changedTouches:t.touches;const{x:s,y:n}=this.rendererService.getCanvasPosition();for(let t=0;t<i.length;t++){const o=i[t];e.push({pageX:o.pageX-s,pageY:o.pageY-n});}return e}getPointerOverPageInfo(t,e){const i=function(t,e,i){const s={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,page:null},index:-1};if(t)for(let n=0;n<t.pages.length;n++){const o=t.pages[n],r=Dm(o,e,i,o.isVisible);if(r.isOver){s.index=n,Object.assign(s.pageInfo,r);const t=Dm(o.image,e,i,!0);return t.isOver&&Object.assign(s.imageInfo,t),s}}return s}(this.getActiveTab(),t,e);return i}resize(){if(this.tabService.resizeScrollbar(),this.isCaptureViewer)return;this.viewService.resizeViewport(),this.updateViewportSize(),this.rendererService.updateCanvasSize(),this.styleService.isCheckboxStyleChanged=!0,this.styleService.isPageNumberStyleChanged=!0;const t=this.getActiveTab();t&&this.showTab(t,!0);}updateViewportSize(){const{width:t,height:e}=this.viewService.getViewportSize();this.viewportWidth=t,this.viewportHeight=e,this.tabService.updateViewportSize(t,e);}handleViewerModeChanged(){const{postfix:t,viewService:e,isDefaultViewer:i,isPerspectiveViewer:s,isThumbnailViewer:n}=this;if(i||s||n){e.createMainAndThbContainer(t),e.createMainContainer(t),n||e.createThumbnailContainer(t),i&&(e.createVideoContainer(t),e.createAudioContainer(t)),im(e.mainAndThbContainer,"flex");const{width:s,height:o}=e.getViewportSize();this.rendererService.initRenderer(e.canvasContainer,s,o),this.rendererService.updateCanvasSize();}}loadSource(t){const e=this.getActiveTab();let i=null==e?void 0:e.uid;if(!e){const t=this.core.createDocument({name:af(),type:"document"});this.viewer.openDocument(t),i=t.uid;}return this.core.loadSource(t,i,{exception:"ignore"})}openDocument(t){const{tabService:e}=this;let i=e.getTab(t.uid);if(!i){const s=e.getActiveTab();if(s&&this.hooks.closeDocument.emit(s.doc),i=e.createTab(t),i.isDocType){const{width:t,height:e}=this.viewService.getViewportSize();i.updateViewportSize(t,e);}}i.isActive||(this.tabService.activateTab(i.uid),this.emitPageChangedEvent(i),this.showTab(i),this.hooks.openDocument.emit(t),this.emitPageChangedAfterRenderEvent(i));}closeTabs(t){const e=t.filter((t=>this.tabService.hasTab(t)));if(!e.length)return;const i=e.reduce(((t,e,i)=>{const s=this.tabService.getTab(e);return s&&t.push(s),t}),[]);i.forEach((t=>{t.isActive&&this.clearCurrentTabOptimization(),this.tabService.closeTab(t.uid),this.hooks.closeDocument.emit(t.doc);}));const s=this.tabService.getActiveTab();s?this.showTab(s):(this.rendererService.docRenderer.clear(),this.resetCanvas(),this.hooks.pageChanged.emit(Ng.create(-1,0)));}resetCanvas(){this.isCaptureViewer||(this.viewService.resetViewport(),this.rendererService.updateCanvasSize(),this.rendererService.clearCanvas());}render(){if("hidden"===this.viewerConfig.visibility)return;if(this.isDestroyed)return;const t=this.getActiveTab();t&&this.rendererService.render(t);}showCurrentTab(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=this.getActiveTab();null!=e&&e.total&&this.showTab(e,t);}showTab(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isDestroyed||t.isDestroyed||(this.tabService.activateTab(t.uid),"hidden"!==this.viewerConfig.visibility&&(this.isDefaultViewer?this.showTabDefault(t,e):this.isThumbnailViewer?this.showTabThumbnail(t,e):this.isPerspectiveViewer&&this.showTabPerspective(t)));}showTabDefault(t){const e=t;if(!e.isDocType)return;e.style.visibility="visible";const i=e.context.zoom;this.layoutService.layout(e),this.viewerConfig.zoom=e.context.zoom;const s=e.context.zoom!==i;if(this.viewService.updateScrollerContentSize(e),this.rendererService.updateCanvasSize(),!e.total)return void this.rendererService.render(e);const{scrollLeft:n,scrollTop:o}=e.context.parseReferenceDefault();e.context.setTabScrollValue(n,o),this.viewService.scrollTo(n,o),this.visibilityService.handleVisibility(e),this.loadVisiblePages(e),s&&this.clearCurrentTabOptimization(),this.rendererService.render(e),this.emitZoomChangedEvent(e);}showTabPerspective(t){const e=t;if(!e.isDocType)return;if(e.style.visibility="visible",this.layoutService.layout(e),this.viewService.updateScrollerContentSize(e),this.rendererService.updateCanvasSize(),!e.total)return void this.rendererService.render(e);const{scrollLeft:i,scrollTop:s}=e.context.parseReferenceDefault();e.context.setTabScrollValue(i,s),this.viewService.scrollTo(i,s),this.visibilityService.handleVisibility(e),this.loadVisiblePages(e),this.rendererService.render(e);}showTabThumbnail(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t.isDocType)return;if(t.style.visibility="visible",this.layoutService.layout(t),this.viewService.updateScrollerContentSize(t),this.rendererService.updateCanvasSize(),!t.total)return void this.rendererService.render(t);if(t.isActive&&this.isVisible&&this.viewerConfig.autoScroll){const{scrollLeft:e,scrollTop:i}=t.context.getScrollValuesByCurrentChanged();t.context.setTabScrollValue(e,i);}const{scrollLeft:i,scrollTop:s}=t.context;this.viewService.scrollTo(i,s),this.visibilityService.handleVisibility(t),this.loadVisiblePages(t),e&&this.clearCurrentTabOptimization(),this.rendererService.render(t);}loadPageImage(t){return this.isDefaultViewer||this.isThumbnailViewer?this.core.imageLoadService.loadDisplayImage(t):this.isPerspectiveViewer?this.core.imageLoadService.loadRawImage(t):null}loadVisiblePages(t){if(t.isDestroyed||null==t||!t.total)return;const e=[],i=[],s=t.getCurrentPage();let n=!1;t.pages.forEach((t=>{!t.isPreload||t.isLoaded||t.isLoading||(t.uid===(null==s?void 0:s.uid)?n=!0:t.isVisible?i.push(t):t.isPreload&&e.push(t));}));const o=[];n&&o.push(s),o.push(...e.reverse(),...i.reverse()),o.forEach((e=>{!e.isPreload||e.isLoaded||e.isLoading||(e.isLoading=!0,this.loadPageImage(e.uid).then((i=>{e.isLoading=!1,i&&this.renderPage(t,e,i);})).catch((t=>{e.isLoading=!1;})));}));}renderPage(t,e,i){if(!this.isDestroyed&&this.isVisible&&t.isActive&&t.pages.includes(e)&&!t.isDestroyed&&e.isPreload&&(e.isLoaded=!0,e.setImgDom(i),e.isVisible)){if(this.isDefaultViewer&&t.context.isSingleDisplay){const e=t.getCurrentPage();if(e&&!e.isLoaded)return}this.rendererService.render(t);}}emitPageChangedEvent(t){this.hooks.pageChanged.emit(Ng.create(t.current,t.total));}emitPageChangedAfterRenderEvent(t){this.hooks.pageChangedAfterRender.emit(Ng.create(t.current,t.total));}emitZoomChangedEvent(t){const{oldZoom:e,zoom:i}=t.context;this.hooks.zoomChanged.emit(Cg.create(sm(e),sm(i)));}beforeLoadSource(t){this.isLoadSource=!0;const{tabService:e}=this,i=e.getDocTab(t);i&&i.updateOldInfo();}afterLoadSource(t){this.isLoadSource=!1;const{tabService:e}=this,i=e.getDocTab(t);i&&(this.emitPageChangedEvent(i),this.emitPageChangedAfterRenderEvent(i),i.updateOldInfo());}addPages(t,e,i,s){const{tabService:n}=this,o=n.getDocTab(t);o&&(o.appendPages(e,i,s),this.emitPageChangedEvent(o),o.isActive&&!this.addPagesTimer&&(this.addPagesTimer=setTimeout((()=>{o.isActive&&(this.scrollByCurrentChanged=!0,this.showTab(o)),clearTimeout(this.addPagesTimer),this.addPagesTimer=null;}),200)));}deletePages(t,e){const{tabService:i}=this,s=i.getDocTab(t);s&&(this.clearOptimization(e),s.deletePages(e),this.hooks.deletePages.emit(qg.create(e)),this.emitEventsForTab(s));}deleteAllPages(t){const{tabService:e}=this,i=e.getDocTab(t);if(!i)return;const s=i.pages.map((t=>t.uid));this.clearOptimization(s),i.deleteAllPages(),this.hooks.deletePages.emit(qg.create(s)),this.emitEventsForTab(i);}setCurrentPage(t,e){const{tabService:i}=this,s=i.getDocTab(t);s&&s.current!==e&&(s.gotoPage(e),this.emitEventsForTab(s));}selectPages(t,e){const{tabService:i}=this,s=i.getDocTab(t);if(!s)return;const n=s.getSelected(),o=s.getSelectedIndices();let r=!1;if(o.length!==e.length)r=!0;else for(let t=0;t<e.length;t++)if(o[t]!==e[t]){r=!0;break}if(!r)return;const a=s.indicesToUids(e);if(s.selectPages(a),s.isActive){this.showTab(s);const t=vg.create(o,[...e],[...n],a);this.hooks.selectedPageChanged.emit(t),this.viewer.emit("selectedPagesChanged",t);}}movePages(t,e,i){const s=this.tabService.getDocTab(t);s&&(s.movePages(e,i),this.emitEventsForTab(s,this.isDefaultViewer));}switchPage(t,e,i){const s=this.tabService.getDocTab(t);s&&(s.switchPage(e,i),this.emitEventsForTab(s,this.isDefaultViewer));}reorderPages(t,e){const i=this.tabService.getDocTab(t);i&&(i.reorderPages(e),this.emitEventsForTab(i,this.isDefaultViewer));}emitEventsForTab(t,e){t.isActive&&(this.emitPageChangedEvent(t),this.scrollByCurrentChanged=!0,this.showTab(t,e),this.emitPageChangedAfterRenderEvent(t));}updatePage(t,e,i){const s=this.tabService.getTab(t);if(s&&s.isActive){const t=s.getPageByUid(e);t.isLoaded=!1,t.isLoading=!1,this.clearOptimization([e]),this.showTab(s);}}renameDoc(t,e){const{tabService:i}=this,s=i.getTab(t);s&&(s.rename(e),this.hooks.tabChanged.emit());}filter(t,e,i){if(this.isPerspectiveViewer||this.isCaptureViewer)return;const s=this.getActiveTab();s&&s.uid===t&&(e.forEach((t=>{const e=s.getPageByUid(t);e&&(e.isLoaded=!1);})),this.hooks.filterChanged.emit($g.create(t,e,i)),this.loadVisiblePages(s),this.clearOptimization(e),this.rendererService.render(s));}activateTab(t){const e=this.tabService.getTab(t);return !!e&&(this.showTab(e),!0)}getActiveTab(){return this.tabService.getActiveTab()}dispose(){this.tabService.getAllTabs().forEach((t=>{const e=[];if(t.pages.forEach(((t,i)=>{t.isPreload&&e.push({from:!0,to:!1,pageUid:t.uid,index:i});})),e.length){const i=ef.create(t.uid,this.uid,this.viewerConfig.viewerMode,e);this.core.viewerService.onPagePreloadChanged.emit(i);}})),this.isDestroyed=!0,this.hooks.destroy.emit(),super.dispose();}get isDefaultViewer(){return this.viewerConfig.viewerMode===vp.DEFAULT}get isThumbnailViewer(){return this.viewerConfig.viewerMode===vp.THUMBNAIL}get isPerspectiveViewer(){return this.viewerConfig.viewerMode===vp.PERSPECTIVE}get isCaptureViewer(){return this.viewerConfig.viewerMode===vp.CAPTURE}zoomTo(t,e,i){this.zoomService.zoomTo(t,e,i);}getPageRenderSize(t){const e=this.core.pageService.getPage(t);return this.isPerspectiveViewer?e.raw.getPageSize():e.mediaBox}emit(t,e){this.viewer.emit(t,e);}clearCurrentTabOptimization(){if(!this.viewerConfig.enableOptimizePage)return;const t=this.getActiveTab();if(t){const e=t.pages.map((t=>t.uid));this.clearOptimization(e);}}clearOptimization(t){const e=[],i=this.getActiveTab();i&&t.forEach((t=>{const s=i.getPageByUid(t);s&&(e.push(s.optimizationUid),s.clearOptimization());})),e.forEach((t=>{this.optimizationService.cancelOptimization(t);}));}}class gy extends Tn{constructor(t){super(),l(this,"uid",void 0),l(this,"groupUid",void 0),l(this,"group",void 0),l(this,"postfix",void 0),l(this,"context",void 0),l(this,"emitter",void 0),l(this,"hooks",void 0),l(this,"core",void 0),l(this,"isDisposed",!1),this.emitter=new Fs,t.core&&(this.core=t.core),this.uid=_s(),this.groupUid=t.groupUid,this.postfix=`-${this.uid}`,this.hooks=this.register(new wp),this.context=new py(this.core,this,t.viewerConfig),t.container&&!t.uiConfig&&this.context.viewService.bindContainer(t.container),this.listenGlobalEvents();}listenGlobalEvents(){const{documentService:t,viewerService:e}=this.core,{context:i}=this;this.core.onBeforeLoadSource.on((t=>{let{docUid:e}=t;i.beforeLoadSource(e);}),this),this.core.pageService.onUpdatePage.on((t=>{i.updatePage(t.docUid,t.pageUid,t.data),i.hooks.updatePage.emit(t);}),this),t.onPagesAdded.on((t=>{i.afterLoadSource(t.docUid),i.hooks.addPagesToDoc.emit(t);}),this),t.onAddPagesToDoc.on((t=>{const{group:e}=this;let{scrollToLatest:s}=e.config;Ts(s)&&({scrollToLatest:s}=i.viewerConfig),i.addPages(t.docUid,t.pageUids,s,t.index);}),this),t.onDeletePagesFromDoc.on((t=>{i.deletePages(t.docUid,t.pageUids);}),this),t.onDeleteAllPagesFromDoc.on((t=>{i.deleteAllPages(t.docUid);}),this),t.onMovePages.on((t=>{i.movePages(t.docUid,t.indices,t.insertBeforeIndex);}),this),t.onSwitchPage.on((t=>{i.switchPage(t.docUid,t.one,t.another);}),this),t.onReorderPages.on((t=>{i.reorderPages(t.docUid,t.indices);}),this),t.onBeforeDeleteDocs.on((t=>{i.closeTabs(t.docUids);}),this),t.onDocumentRenamed.on((t=>{i.renameDoc(t.docUid,t.newName);}),this),t.onDocumentDeleted.on((t=>{i.closeTabs([t.docUid]);}),this),t.onOpenDocument.on((t=>{i.groupUid===t.groupUid&&i.openDocument(t.doc);}),this),t.onCloseDocument.on((t=>{i.groupUid===t.groupUid&&i.closeTabs([t.doc.uid]);}),this),e.onGotoPage.on((t=>{i.groupUid===t.groupUid&&i.setCurrentPage(t.docUid,t.index);}),this),e.onSelectPages.on((t=>{i.groupUid===t.groupUid&&i.selectPages(t.docUid,t.indices);}),this),e.onResize.on((()=>{i.resize();}),this),e.onCurrentChangedByScroll.on((t=>{i.groupUid===t.groupUid&&i.uid!==t.viewerUid&&i.setCurrentPage(t.docUid,t.current);}),this),this.core.onFilterChanged.on((t=>{const e=i.getActiveTab();(null==e?void 0:e.uid)===t.docUid&&i.filter(t.docUid,t.pageUids,t.filterType);}),this),this.core.commandService.onOperationsChanged.on((t=>{const e=i.getActiveTab();e?e.uid===t.docUid&&i.hooks.operationsChanged.emit(t):this.hooks.operationsChanged.emit({docUid:t.docUid,undo:0,redo:0});}),this);}dispose(){this.isDisposed||(this.unbindContainer(),this.context.dispose(),this.context=null,this.isDisposed=!0,this.core.removeViewer(this),super.dispose());}undo(){const t=this.context.getActiveTab();return !!t&&this.core.commandService.undo(t.uid)}redo(){const t=this.context.getActiveTab();return !!t&&this.core.commandService.redo(t.uid)}getOperationState(){const t=this.context.getActiveTab();return t?this.core.commandService.getOperationState(t.uid):{undo:0,redo:0}}saveOperations(){const t=this.context.getActiveTab();return !!t&&this.core.commandService.saveOperations(t.uid)}setRowAndColumn(t,e){return this.context.configService.updateConfig({rows:t,columns:e}),!0}getRowAndColumn(){const t=this.context.getActiveTab();if(t)return {rows:t.context.rows,columns:t.context.columns};const{viewerConfig:e}=this.context;return {rows:e.rows||1,columns:e.columns||1}}on(t,e){this.emitter.on(t,e);}emit(t,e){this.emitter.emit(t,e);}off(t,e){this.emitter.off(t,e);}getViewerConfig(){return this.context.viewerConfig}updateViewerConfig(t){this.context.configService.updateConfig(t);}bindContainer(t){return this.context.viewService.bindContainer(t)}unbindContainer(){this.context.viewService.unbindContainer();}show(){this.updateViewerConfig({visibility:"visible"}),this.context.showCurrentTab();}hide(){this.updateViewerConfig({visibility:"hidden"});}render(){}resize(){this.context.resize();}indexToUid(t){const e=this.context.getActiveTab();return null==e?void 0:e.indexToUid(t)}uidToIndex(t){const e=this.context.getActiveTab();return e?e.uidToIndex(t):-1}getCurrentPageIndex(){const t=this.context.getActiveTab();return t?t.current:-1}getPageCounts(){const t=this.context.getActiveTab();return t?t.total:0}getCurrentPageUid(){var t;const e=this.context.getActiveTab();return null==e||null===(t=e.getCurrentPage())||void 0===t?void 0:t.uid}selectAllPages(){const t=this.getPageCounts();return this.selectPagesByIndices(Array.from(Array(t).keys()))}selectPagesByIndices(t){const e=this.context.getActiveTab();if(!e)return [];const i=e.indicesToUids(t);return this.core.viewerService.onSelectPages.emit(jg.create(e.uid,this.groupUid,this.uid,t)),[...i]}getSelectedPageIndices(){const t=this.context.getActiveTab();if(!t)return [];return t.getSelectedIndices()}gotoPage(t){const e=this.context.getActiveTab();return e?(t=Us(t,0,e.total-1),e.current===t||this.core.viewerService.onGotoPage.emit(Vg.create(e.uid,this.groupUid,this.uid,t)),t):-1}movePages(t,e){const i=this.context.getActiveTab();return !!i&&this.core.movePages(i.uid,t,e)}swapPages(t,e){const i=this.context.getActiveTab();return !!i&&this.core.swapPages(i.uid,t,e)}reorderPages(t){const e=this.context.getActiveTab();return !!e&&this.core.reorderPages(e.uid,t)}deletePages(t){const e=this.context.getActiveTab();if(!e)return !1;if(!t.every((t=>t>=0&&t<e.total)))return !1;const i=e.indicesToUids(t);return this.core.deletePages(e.uid,i)}deleteAllPages(){const t=this.context.getActiveTab();return !!t&&this.core.deleteAllPages(t.uid)}openDocument(t){this.core.openDocument(t.uid,this.uid);}closeDocument(t){if(!t){const e=this.context.getActiveTab();if(!e)return;t=e.uid;}this.core.closeDocument(t,this.uid);}printDocument(){}activateTab(t){var e;return (null===(e=this.context)||void 0===e?void 0:e.activateTab(t))||!1}getActiveTab(){var t;return (null===(t=this.context)||void 0===t?void 0:t.getActiveTab())||null}getAllTabs(){var t;return (null===(t=this.context)||void 0===t?void 0:t.tabService.getAllTabs())||[]}getRealPageSize(t){const e=this.context.getActiveTab();if(!e)return {width:0,height:0};Ts(t)&&(t=e.current);const i=e.getPageByIndex(t);return {width:i.rWidth,height:i.rHeight}}getRealPixelSize(t){const e=this.context.getActiveTab();if(!e)return {width:0,height:0};Ts(t)&&(t=e.current);const i=e.getPageByIndex(t),s=this.core.pageService.getPage(i.uid),{rWidth:n,rHeight:o}=s.getEditResultForPerspective();return {width:Cn(n,eo.displayResolution,s.resource.resolutionX),height:Cn(o,eo.displayResolution,s.resource.resolutionY)}}zoomIn(){const t=this.getActiveTab();if(!t||!t.isDocType)return;const{maxZoom:e}=this.getViewerConfig(),{zoom:i}=t.context;let s=fy(i,"in");(null===s||s>e)&&(s=e),this.updateViewerConfig({zoom:s});}zoomOut(){const t=this.getActiveTab();if(!t||!t.isDocType)return;const{minZoom:e}=this.getViewerConfig(),{zoom:i}=t.context;let s=fy(i,"out");(null===s||s<e)&&(s=e),this.updateViewerConfig({zoom:s});}filter(t,e){const i=this.context.getActiveTab();if(!i)return !1;const s=i.indicesToUids(t);return this.core.filterPages(i.uid,s,e),!1}async perspectivePage(t,e){const i=this.context.getActiveTab();if(!i)return null;let s=i.currentUid;Ts(e)||(s=i.indexToUid(e));t=Cn(t,this.context.core.pageService.getPage(s).resource.resolutionX,eo.displayResolution);return (await this.core.perspectivePage(i.uid,s,t)).data}perspectiveAllPage(){const t=this.context.getActiveTab();if(!t)return;const e=[],i=[],s=[];t.pages.forEach(((t,n)=>{t.isVisible?e.push(n):t.isPreload?i.push(n):s.push(n);}));const n=[...e,...i,...s],{displayResolution:o}=eo;for(let e=0;e<n.length;e++){const i=this.indexToUid(n[e]),s=this.context.core.pageService.getPage(i);if(s.isFull){let{width:e,height:n}=s.raw.getImageDetail();const r=Math.abs((s.rotation%360+360)%360);if(90===r||270===r){const t=e;e=n,n=t;}const a=[[0,0],[e,0],[e,n],[0,n]];this.context.core.perspectivePage(t.uid,i,Cn(a,s.resolutionX,o));}else if(s.activeQuad&&s.activeQuad!==s.quad){const{width:e,height:n}=s.raw.getPageSize(),o=gf(s.activeQuad.flat(),s.rotation,e,n),r=yf(o);this.context.core.perspectivePage(t.uid,i,r);}}}getPerspectivePreviewImage(t,e,i,s){const n=this.context.getActiveTab();if(!n)return null;const o=n.getPageByIndex(t);if(!o)return null;const r=o.uid,{quadSelectionStyle:a}=this.getViewerConfig(),{borderColor:l}=hn(a.border),h=function(t){const e=t=>{const e=t.toString(16);return 1===e.length?`0${e}`:e};if(t.startsWith("rgb")){const i=t.match(/(\d+)/g);if(3===i.length){const t=parseInt(i[0],10),s=parseInt(i[1],10),n=parseInt(i[2],10);return `#${e(t)}${e(s)}${e(n)}`}}if(t.startsWith("#")&&(7===t.length||4===t.length))return t;return "#FE8E14"}(l);return this.context.core.getPerspectivePreviewData(r,{width:e||200,height:i||200},{strokeColor:h.substring(1),lineWidth:s})}}function fy(t,e){const i=[.01,.0625,.125,.25,.333,.5,.667,.75,1,1.25,1.5,2,3,4,6,8,12,16,24,32,64];if("in"===e){for(let e=0;e<i.length;e++)if(i[e]>t)return i[e]}else for(let e=i.length-1;e>=0;e--)if(i[e]<t)return i[e];return null}class my extends Tn{constructor(t){super(),l(this,"isDestroyed",!1),l(this,"viewers",new Map),l(this,"groups",new Map),l(this,"onGotoPage",void 0),l(this,"onSelectPages",void 0),l(this,"onCurrentChangedByScroll",void 0),l(this,"onResize",void 0),l(this,"onPagePreloadChanged",void 0),l(this,"onViewerCreated",void 0),l(this,"core",void 0),this.core=t,this.initEventEmitter();}initEventEmitter(){this.onGotoPage=En(this),this.onSelectPages=En(this),this.onCurrentChangedByScroll=En(this),this.onResize=En(this),this.onPagePreloadChanged=En(this),this.onViewerCreated=En(this);}reset(){for(const t of this.viewers.values())t.dispose();this.viewers.clear(),this.groups.clear();}destroy(){if(!this.isDestroyed){for(const t of this.viewers.values())t.dispose();this.viewers=null,this.groups=null,this.isDestroyed=!0;}}createViewer(t,e){var i;const{groupUid:s}=e,n=this.groups.get(s)||new mp(s);var o;Ts(null===(i=e.viewerConfig)||void 0===i?void 0:i.scrollToLatest)||n.isSetScrollToLatest||(n.updateConfig({scrollToLatest:null===(o=e.viewerConfig)||void 0===o?void 0:o.scrollToLatest}),n.isSetScrollToLatest=!0);e.groupConfig&&n.updateConfig(e.groupConfig);const r=new t(e);r.group=n,n.viewerUids.add(r.uid),this.groups.set(s,n),this.viewers.set(r.uid,r);const a=this.getViewersByGroupUid(s);if(a.length>0){r.context.syncViewer(a[0]);const t=a[0].getActiveTab();t&&this.core.commandService.emitOperationsChanged(t.uid);}return this.onViewerCreated.emit(sf.create(r)),r}removeViewer(t){let e;if(e=Ls(t)?this.getViewer(t):t,!e)return !1;const{uid:i,groupUid:s}=e,n=this.groups.get(s);return n&&(n.viewerUids.delete(i),n.viewerUids.size||this.groups.delete(s)),this.viewers.delete(e.uid),e.dispose(),!0}hasViewer(t){return this.viewers.has(t)}getViewer(t){return this.viewers.get(t)}getAllViewers(){return Array.from(this.viewers.values())}getViewersByViewerUid(t){const e=this.viewers.get(t);return this.getViewersByGroupUid(e.groupUid)}getViewersByGroupUid(t){return this.groups.has(t)?this.groups.get(t).getViewerUids().map((t=>this.viewers.get(t))):[]}hasGroup(t){return this.groups.has(t)}}const yy={apply(t){t.viewerService=new my(t);},install(t){t.setClass("Viewer",gy);}},vy=/^<\/([^>]*)>/,xy=/^<([^\s>]+)[^>]*>/,wy=/^<slot>.*<\/slot>/,by=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function Cy(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{template:i,data:s,components:n,injection:o}=t,r=Sy(i,s,n,o,e),a=r.length;return a&&(r[0].cpInstance=t,r[a-1].cpInstance=t),r}function Sy(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=t.trim();const r=[];function a(t){o=o.substring(t);}function l(t){let[n,o]=t;if(o){const t=function(t){const e={},i=yn(t,by);return i?(i.forEach((t=>{let[,i,s]=t;e[i]=s;})),e):e}(n),a=e[":for"];a&&(delete e[":for"],t[":for"]=a);const l={type:"start",name:o,data:e,attrs:t};if(r.push(l),(i[o]||s.components&&s.components[o])&&(l.cpOption={Component:i[o]||s.components[o],injection:s}),"input"===o||/\/>/.test(n)){const t={type:"end",name:o,data:e,attrs:{}};r.push(t);}}}function h(t){let[,e]=t;if(e){const t={type:"end",name:e,attrs:{}};r.push(t);}}function d(t){if(t=t.trim()){const i={type:"text",name:t,attrs:{},data:e};r.push(i);}}for(;o;){const t=o.indexOf("<");let e;if(0===t){const t=o.match(vy);if(t){a(t[0].length),h(t);continue}const i=o.match(wy);if(i){a(i[0].length),r.push(...n);continue}const s=o.match(xy);if(s&&s[0]!==s.input){a(s[0].length),l(s);continue}e=o;}else e=t>0?o.substring(0,t):o;e&&(a(e.length),d(e));}return r}function Py(t){const{cpInstance:e,children:i}=t;e&&!e.isInserted&&(e.isInserted=!0,e.hooks.inserted.emit()),i.forEach((t=>{Py(t);}));}function Ay(t){const{cpInstance:e,children:i}=t;e&&e.hooks.destroyed.emit(t),i.forEach((t=>{Ay(t);}));}function Ty(t){if(t){const{el:e,children:i}=t;if(function(t){const{cpInstance:e}=t;e&&(e.dispose(),e.hooks.beforeDestroyed.emit(t));}(t),e){const i=e.parentElement;i&&i.removeChild(e),e.vNode=null,t.el=null;}return Ay(t),t.text=null,t.parent=null,i.length&&i.forEach((t=>{Ty(t);})),!0}return !1}function ky(t,e){const i=t.el,s=i.parentNode;null!==s&&(e.el=e.renderDom(),an(e.el,i,s),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;e<=i;)Ty(t[e]),e+=1;}([t]));let n=-1;const o=t.parent;return null==o||o.children.forEach(((e,i)=>{e===t&&(n=i);})),n>-1&&(o.children[n]=e,e.parent=o,t.el=null),e}class Dy{constructor(t){l(this,"el",void 0),l(this,"tagName",void 0),l(this,"sel",""),l(this,"data",void 0),l(this,"children",void 0),l(this,"text",void 0),l(this,"key",void 0),l(this,"cpInstance",void 0),l(this,"cpOptions",void 0),l(this,"parent",void 0),this.createVNode(t);}renderDom(){if(this.el)return this.el;let t;if("FRAGMENT"===this.tagName)t=document.createDocumentFragment();else if("TEXT"===this.tagName){const e=function(t){let e="";return 0===(t=String(t)).length?"":(e=t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"'),e)}(this.text);t=document.createTextNode(e);}else {t=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(const[e,i]of Object.entries(this.data))t.setAttribute(e,i);}return this.children.forEach((e=>{const i=e.renderDom();t.appendChild(i);})),t.vNode=this,this.el=t,function(t){const{cpInstance:e,el:i}=t;e&&(e.vNode=t,e.hooks.created.emit(i));}(this),t}patch(t){return ky(this,t)}destroy(){return Ty(this)}createVNode(t){const{tagName:e,data:i={},children:s=[],el:n=null,key:o,text:r="",cpOptions:a,cpInstance:l}=t;let h=e;i.id&&(h+=`#${i.id}`),i.class&&(h+=`.${i.class}`),this.sel=h,this.data=i,this.tagName=e,this.children=s,this.el=n,this.key=o,this.text=r,this.cpInstance=l,this.cpOptions=a;}}function Ey(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=[],s=[];let n=[];return t.forEach((t=>{if("start"===t.type)i.push(t),s.push(n),n=[];else if("text"===t.type)n.push({type:"text",value:t.name,data:t.data});else if(t instanceof Dy)n.push(t);else {let e=i.pop();for(;e.name!==t.name;)e=i.pop();if(e){const{name:t,cpInstance:i,attrs:o,cpOption:r,data:a}=e,l={type:"token",tagName:t,cpInstance:i,cpOption:r,attrs:o,data:a,children:n};n.forEach((t=>{t.parent=l;})),n=s.pop(),n.push(l);}}})),e?n[0]:n}const Iy=/'.+'|\\".+\\"|[\w$.]+/g,Ry=/{{([^\s@}]+)}}/;function My(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Ss(t)){const e=[];return t.forEach((t=>{e.push(...Ly(My(t)));})),e}if(t instanceof Dy)return t;if("token"===t.type){var i;const{tagName:s,attrs:n,cpInstance:o,children:r,data:a,cpOption:l}=t;if(n[":for"])return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{attrs:i,data:s}=t,n=JSON.parse(JSON.stringify(i)),o={":for":i[":for"]};delete i[":for"],By(o,{...s,...e});const r=[];return o[":for"].forEach((e=>{const i=My(t,e);r.push(...Ly(i));})),t.attrs=n,r}(t,e);const h={...a,...e},d={...n};let c;if(By(n,h),Object.prototype.hasOwnProperty.call(n,"if")&&!n.if)c=null;else if(delete n.if,l)c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{children:i,attrs:s,cpOption:n}=t,o=Uy(i,e),{Component:r,injection:a}=n,l=new r({data:s,injection:a}),h=Ey(Cy(l,o));if(!h)return null;return Ly(My(h))[0]}(t,e);else {const{key:t}=n;void 0!==t&&delete n.key;const i=Uy(r,e);c=new Dy({tagName:s.toUpperCase(),data:n,cpInstance:o,key:t,children:i});}return t.attrs=d,null===(i=c)||void 0===i||i.children.forEach((t=>{t.parent=c;})),c}return function(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{value:s}=t;const n=null===(e=t.parent)||void 0===e||null===(e=e.attrs)||void 0===e?void 0:e.html;if(s=function(t,e){const i=yn(t,Ry);i.length&&i.forEach((i=>{const s=i[1].split(".").reduce(((t,e)=>t[e]),e),n=i[0];t=t.replace(n,s);}));return t}(s.trim(),{...t.data,...i}),n){return My(Ey(Sy(s),!1))}return new Dy({tagName:"TEXT",text:s})}(t,e)}function By(t,e){for(const n of Object.keys(t)){const[,o,r]=n.match(/^(:|@)(.+)/)||[];if(!r)continue;let a=t[n];if(delete t[n],"for"===r){var i,s;let[n,o]=a.split(" in "),[r,l]=n.split(",");r=r.trim(),l=null===(i=l)||void 0===i?void 0:i.trim(),o=null===(s=o)||void 0===s?void 0:s.trim();const h=[],d=o.split(".").reduce(((t,e)=>t[e]),e);if(Ss(d))d.forEach(((t,e)=>{const i={};i[r]=t,l&&(i[l]=e),h.push(i);}));else if(Ps(d))for(const[t,e]of Object.entries(d)){const i={};i[r]=e,l&&(i[l]=t),h.push(i);}t[":for"]=h;}else {const i="this"===a?e:a.split(".").reduce(((t,e)=>null==t?void 0:t[e]),e);if(void 0!==i)"class"===r&&t[r]?t[r]=`${t[r]} ${i}`:t[r]=i;else {a=a.replace(Iy,(t=>t.includes('"')||t.includes("'")||/^(true|false|\d+|undefined|null)$/.test(t)?t:t.split(".")));try{const i=Oy(a,e);fn(i)&&(t[r]=void 0),"class"===r&&t[r]?t[r]=`${t[r]} ${i}`:t[r]=i;}catch(e){t[r]=void 0;}}"@"===o&&(t.events||(t.events={}),t.events[r]=t[r],delete t[`@${r}`]);}}}function Ly(t){return t?(Ss(t)||(t=[t]),t):[]}function Uy(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];return t.forEach((t=>{const s=My(t,e)||[];i.push(...Ly(s));})),i}function Oy(t,e){let i=null;try{const s=t.split(",");for(let t=0;t<s.length;t++){const i=s[t],n=/(\w+)(\[(\d+)\])?/,o=i.match(n);if(!o){e=null;break}{const t=o[1],i=o[3];if(!Object.prototype.hasOwnProperty.call(e,t)){e=null;break}e=e[t],void 0!==i&&Array.isArray(e)&&(e=e[i]);}}i=e;}catch(t){i=null;}return i}class _y extends Tn{constructor(t){let{data:e={},template:i="",components:s={},injection:n={}}=t;super(),l(this,"el",void 0),l(this,"vNode",null),l(this,"template",""),l(this,"data",{}),l(this,"injection",{}),l(this,"components",{}),l(this,"emitter",void 0),l(this,"uiEmitter",void 0),l(this,"isInserted",!1),l(this,"hooks",{created:Vs.create(),inserted:Vs.create(),updated:Vs.create(),beforeDestroyed:Vs.create(),destroyed:Vs.create()}),l(this,"selfEvents",[]),l(this,"globalEvents",[]),l(this,"nativeEvents",[]),this.template=i,this.emitter=Fs.create(),this.setData(e),this.setComponents(s),this.setInjects(n),this.uiEmitter=this.injection.emitter,this.hooks.created.on((t=>{this.el=t;})),this.hooks.destroyed.on((()=>{this.dispose();})),this.initEvents();}setInjects(t){Object.assign(this.injection,t);}initEvents(){var t=this;const e=(e,i)=>{this.on(e,(function(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];Ls(i)?t.$emit(i,s):Rs(i)&&i(...s);}));};for(const[t,s]of Object.entries((null===(i=this.data)||void 0===i?void 0:i.events)||{})){var i;e(t,s);}for(const[t,i]of Object.entries((null===(s=this.data)||void 0===s||null===(s=s.options)||void 0===s?void 0:s.events)||{})){var s;e(t,i);}}setData(t){Object.assign(this.data,t);}setComponents(t){Object.assign(this.components,t);}on(t,e){this.emitter.on(t,e),this.selfEvents.push([t,e]);}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];this.emitter.emit(t,...i);}unbindSelfEvents(){this.selfEvents.forEach((t=>{let[e,i]=t;this.emitter.off(e,i);})),this.selfEvents=[];}$on(t,e){var i;this.uiEmitter&&(null===(i=this.uiEmitter)||void 0===i||i.on(t,e),this.globalEvents.push([t,e]));}$emit(t){for(var e,i=arguments.length,s=new Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];null===(e=this.uiEmitter)||void 0===e||e.emit(t,...s);}unbindGlobalEvents(){this.globalEvents.forEach((t=>{let[e,i]=t;this.uiEmitter.off(e,i);})),this.globalEvents=[];}nativeOn(t,e,i){if(Ss(t))t.forEach((t=>{this.nativeOn(t,e,i);}));else {const s=((t,e,i,s)=>t?(t.addEventListener(e,i,s),()=>{t.removeEventListener(e,i);}):null)(t,e,i);s&&this.nativeEvents.push(s);}}unbindNativeEvents(){this.nativeEvents.forEach((t=>{t();})),this.nativeEvents=[];}query(t){var e;return null===(e=this.el)||void 0===e?void 0:e.querySelector(t)}queryAll(t){var e;return null===(e=this.el)||void 0===e?void 0:e.querySelectorAll(t)}parseHTML(){return My(Ey(Cy(this,[])))}reRenderVNode(){const t=function(t){const e=Cy(t);return My(Ey(e))}(this);this.vNode.patch(t);}bindEventsEmitter(){var t=this;const{options:e}=this.data;if(null!=e&&e.events)for(const[i,s]of Object.entries(e.events))this.nativeOn(this.el,i,(function(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];t.emit(i,...s);}));}dispose(){this.unbindSelfEvents(),this.unbindGlobalEvents(),this.unbindNativeEvents(),super.dispose();}}const Ny=(t,e,i,s)=>{const{id:n,tooltip:o,dataId:r,style:a,className:l}=t||{},h=(t=>{let e="";if(t)for(const[i,s]of Object.entries(t))e+=`${bs(i)}:${s};`;return e})(a);return (Ts(n)?"":` id="${n}"`)+` class="${e}${null!=i?i:""} ${l||""}"`+(Ts(s)?"":` :class="${s}"`)+(h?` style="${h}"`:"")+(Ts(o)?"":` title="${o}"`)+(Ts(r)?"":` data-id="${r}"`)};function Wy(t){if(0===Object.keys(t).length||!t)return '<MainView :options="this"></MainView>';const e=-1!==["Root","DDVRoot","Layout","DDVLayout"].indexOf(null==t?void 0:t.type);return Ls(t.type)&&!e?`<${t.type} :options="this"></${t.type}>`:'<Root :options="this"></Root>'}function Fy(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const e=As(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return null!=e&&e.children&&(e.children=e.children.map((t=>Ls(t)?{type:t}:Ps(t)?Fy(t):t))),e.children||Ss(e.children)||(e.children=[]),t.length&&e.children.push(...t),e}class Hy{constructor(t){l(this,"options",void 0),l(this,"postfix",void 0),l(this,"uiEvents",[]),l(this,"parsedUiConfig",void 0),l(this,"injection",void 0),l(this,"rootComponent",void 0),l(this,"emitter",null),l(this,"rootDom",null),l(this,"rootVNode",void 0),l(this,"container",void 0),l(this,"uiConfig",{}),l(this,"popupUiConfig",[]);const{container:e,injection:i,postfix:s,uiConfig:n,emitter:o,popupUiConfig:r}=t;this.options=t,this.injection=i,this.uiConfig=n,this.popupUiConfig=r,this.parsedUiConfig=Fy(n,r),this.emitter=o||Fs.create(),this.postfix=s||`-${_s()}`,Ls(e)?this.container=document.getElementById(e):e instanceof HTMLElement&&(this.container=e),this.init();}static registerComponent(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const[e,i]of Object.entries(t))Hy.isAlreadyRegistered(e)||(this.components[`DDV${e}`]=i,this.components[e]=i);}static isAlreadyRegistered(t){return !!this.components[t]}static getComponents(){return this.components}init(){const t=new _y({data:this.parsedUiConfig,template:Wy(this.parsedUiConfig),components:Hy.getComponents(),injection:{...this.injection,components:Hy.getComponents(),postfix:this.postfix,emitter:this.emitter}}),e=t.parseHTML();if(!e)return;const i=e.renderDom();this.rootComponent=t,this.rootVNode=e,this.rootDom=i,this.container&&(this.container.appendChild(i),Py(this.rootVNode));}updateUiConfig(t){const e=Fy(t,this.popupUiConfig),i=new _y({data:e,template:Wy(this.parsedUiConfig),components:Hy.getComponents(),injection:{...this.injection,components:Hy.getComponents(),postfix:this.postfix,emitter:this.emitter}}).parseHTML(),s=this.rootVNode.patch(i);return this.rootDom=s.el,this.rootVNode=s,this.uiConfig=t,Py(this.rootVNode),!0}bindContainer(t){let e;if(Ws(t)&&(e=t),Ls(t)){const i=document.getElementById(t);Ws(i)&&(e=i);}return !!e&&(this.container=e,e.appendChild(this.rootDom),Py(this.rootVNode),!0)}unbindContainer(){if(this.container&&0!==this.container.children.length){for(let t=0;t<this.container.children.length;t++)if(this.container.children[t]===this.rootDom)return void this.container.removeChild(this.rootDom);this.container=null;}}queryByDataId(t){var e;return null===(e=this.rootDom)||void 0===e?void 0:e.querySelector(`[data-id=${t}]`)}queryAllByDataId(t){var e;return null===(e=this.rootDom)||void 0===e?void 0:e.querySelectorAll(`[data-id=${t}]`)}getElementsByType(t,e){var i;const s=[];return (null===(i=t.cpInstance)||void 0===i||null===(i=i.constructor)||void 0===i?void 0:i.cpName)===e&&t.el&&s.push(t.el),t.children.length>0&&t.children.forEach((t=>{s.push(...this.getElementsByType(t,e));})),s}on(t,e){const i=this.emitter.on(t,e);this.uiEvents.push(i);}emit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];this.emitter.emit(t,...i);}off(t,e){this.emitter.off(t,e);}offAllEvents(){this.uiEvents.forEach((t=>{let{name:e,fn:i,context:s,once:n}=t;this.emitter.off(e,i,s,n);}));}dispose(){this.unbindContainer(),this.offAllEvents(),this.emitter=null,this.rootDom=null,this.uiConfig={},this.parsedUiConfig={},Ay(this.rootVNode);}}l(Hy,"components",{});class Vy extends _y{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(t),l(this,"defaultClass","ddv-button"),this.initTemplate(e),this.bindBaseHooks();}bindBaseHooks(){this.hooks.inserted.on((t=>{this.bindEventsEmitter();}));}initTemplate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{options:e}=this.data,i=""===t?this.defaultClass:`${this.defaultClass} ${t}`,s=`<div ${Ny(e,i)} >`+(Ts(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+"<slot></slot></div>";this.template=s;}}class zy extends _y{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";super(t),l(this,"defaultClass","ddv-layout"),l(this,"enableScroll",!1),l(this,"showScrollArrow",!0),l(this,"scrollLeftOrTopBtn",void 0),l(this,"scrollRightOrBottomBtn",void 0);const{options:i}=this.data;this.enableScroll=(null==i?void 0:i.enableScroll)||!1,this.showScrollArrow=(null==i?void 0:i.showScrollArrow)||!0,this.initTemplate((null==i?void 0:i.flexDirection)||e),this.bindHooks();}bindHooks(){this.hooks.inserted.on((()=>{jy(this),this.bindCustomScroll();})),this.hooks.updated.on((()=>{jy(this);}));}bindCustomScroll(){if(!this.enableScroll)return;this.showScrollArrow&&this.initCustomScrollButton();const t=new ResizeObserver((()=>{this.showScrollArrow&&this.updateCustomScrollButton();}));t.observe(this.el),this.hooks.destroyed.on((()=>{t.disconnect();}));}initCustomScrollButton(){const t=document.createElement("div"),e=document.createElement("div"),i=150;t.addEventListener("click",(()=>{const{scrollLeft:e,scrollTop:s}=this.el;t.classList.contains("ddv-scroll-top")?this.el.scroll(0,s-i):this.el.scroll(e-i,0);})),e.addEventListener("click",(()=>{const{scrollLeft:t,scrollTop:s}=this.el;e.classList.contains("ddv-scroll-bottom")?this.el.scroll(0,s+i):this.el.scroll(t+i,0);})),this.el.addEventListener("scroll",(t=>{this.showScrollArrow&&this.updateCustomScrollButton();})),this.el.appendChild(t),this.el.appendChild(e),this.scrollLeftOrTopBtn=t,this.scrollRightOrBottomBtn=e,this.updateCustomScrollButton();}updateCustomScrollButton(){const{vertical:t,horizontal:e}=$y(this.el),{scrollLeft:i,scrollTop:s}=this.el,{scrollRightOrBottomBtn:n,scrollLeftOrTopBtn:o}=this;if(!o||!n)return;if(!t&&!e)return o.style.display="none",void(n.style.display="none");o.className="ddv-scroll-button "+(e?"ddv-scroll-left":"ddv-scroll-top"),n.className="ddv-scroll-button "+(e?"ddv-scroll-right":"ddv-scroll-bottom");const r=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{vertical:i,horizontal:s}=$y(t);if(!i&&!s)return [!1,!1];const{scrollLeft:n,scrollTop:o,scrollHeight:r,scrollWidth:a,clientWidth:l,clientHeight:h}=t;if(s)return [n<=e,n+l-e>=a];return [o<=e,o+h-e>=r]}(this.el,0);e?(o.style.left=`${i}px`,n.style.right=-i+"px"):(o.style.top=`${s}px`,n.style.bottom=-s+"px"),o.style.display=r[0]?"none":"",n.style.display=r[1]?"none":"";}initTemplate(t){const{options:e}=this.data,i=(null==e?void 0:e.children)||[],s="row"===t?"":"-col";let n=`${this.defaultClass}${s}`;this.enableScroll&&(n+=" ddv-custom-scroll-hidden");let o=`<div ${Ny(e,n)}>`;i&&i.length&&i.forEach(((t,e)=>{if(Ps(t)){const{type:i}=t;i.trim(),i.length>0&&(o+=`<${i} :options="options.children[${e}]"></${i}>`);}})),o+="</div>",this.template=o;}}function jy(t){const{options:e}=t.data,i=t.el.children;((null==e?void 0:e.children)||[]).forEach(((e,s)=>{if(Ws(e)){const n=e;0===s?(t.el.append(n),t.el.insertBefore(n,i[0])):((t,e)=>{const i=e.parentNode;i.lastChild===e?i.appendChild(t):an(t,e.nextSibling,i);})(n,i[s-1]);}}));}function $y(t){let e=t.scrollHeight>t.clientHeight,i=t.scrollWidth>t.clientWidth;if(e&&i){t.scrollHeight-t.clientHeight>t.scrollWidth-t.clientWidth?i=!1:e=!1;}return {vertical:e,horizontal:i}}class Gy extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-root"),this.initTemplate(),this.bindHooks();}initTemplate(){const{options:t}=this.data,{children:e}=t,i="column"===t.flexDirection?`ddv-column ${this.defaultClass}`:this.defaultClass;let s=`<div ${Ny(t,i,"")} >`;e&&e.length&&e.forEach(((t,e)=>{if(Ps(t)){const{type:i}=t;i.trim(),i.length>0&&(s+=`<${i} :options="options.children[${e}]"></${i}>`);}})),s+="</div>",this.template=s;}bindHooks(){this.hooks.inserted.on((()=>{jy(this);}));}}class Xy extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-split-row"),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.inserted.on((()=>{this.updateClassName();})),this.hooks.updated.on((()=>{this.isInserted&&this.updateClassName();}));}updateClassName(){const t=this.el.parentNode,e=window.getComputedStyle(t),{flexDirection:i}=e;"column"===i&&(this.el.classList.remove(this.defaultClass),this.el.classList.add("ddv-split-column"));}initTemplate(){const{options:t}=this.data,e=Ny(t,this.defaultClass);this.template=`<div ${e}></div>`;}}const Yy={CameraResolution:"ddvCameraResolution",Capture:"ddvCapture",Flashlight:"ddvFlashlight",CameraConvert:"ddvCameraConvert",AutoDetect:"ddvAutoDetect",AutoCapture:"ddvAutoCapture",Rotate:"ddvRotate",RotateLeft:"ddvRotateLeft",RotateRight:"ddvRotateRight",Load:"ddvLoad",Delete:"ddvDelete",DeleteCurrent:"ddvDeleteCurrent",DeleteAll:"ddvDeleteAll",Zoom:"ddvZoom",ZoomIn:"ddvZoomIn",ZoomOut:"ddvZoomOut",ZoomByPercentage:"ddvZoomByPercentage",Crop:"ddvCrop",CropAll:"ddvCropAll",CropCurrent:"ddvCropCurrent",CropMode:"ddvCropMode",PerspectiveAll:"ddvPerspectiveAll",FullQuad:"ddvFullQuad",Undo:"ddvUndo",Redo:"ddvRedo",Restore:"ddvRestore",Pan:"ddvPan",Filter:"ddvFilter",Print:"ddvPrint",ThumbnailSwitch:"ddvThumbnailSwitch",DisplayMode:"ddvDisplayMode",ContinuousPage:"ddvContinuousPage",SinglePage:"ddvSinglePage",FitMode:"ddvFitMode",FitWidth:"ddvFitWidth",FitHeight:"ddvFitHeight",FitWindow:"ddvFitWindow",ActualSize:"ddvActualSize",Back:"ddvBack",Close:"ddvClose",Done:"ddvDone",Download:"ddvDownload",ImagePreview:"ddvImagePreview",FirstPage:"ddvFirstPage",LastPage:"ddvLastPage",NextPage:"ddvNextPage",PrevPage:"ddvPrevPage",FitMode_FitWidth:"ddvFitModeFitWidth",FitMode_FitHeight:"ddvFitModeFitHeight",FitMode_FitWindow:"ddvFitModeFitWindow",FitMode_ActualSize:"ddvFitModeActualSize",DisplayMode_SinglePage:"ddvDisplayModeSinglePage",DisplayMode_ContinuousPage:"ddvDisplayModeContinuousPage",Crop_CropAll:"ddvCropCropAll",Crop_CropCurrent:"ddvCropCropCurrent",Crop_CropCancel:"ddvCropCropCancel",Crop_CropApply:"ddvCropCropApply",Filter_FilterAll:"ddvFilterFilterAll",Delete_DeleteCurrent:"ddvDeleteDeleteCurrent",Delete_DeleteAll:"ddvDeleteDeleteAll",RectAnnotation:"ddvRect",EllipseAnnotation:"ddvEllipse",InkAnnotation:"ddvInk",PolygonAnnotation:"ddvPolygon",PolylineAnnotation:"ddvPolyline",LineAnnotation:"ddvLine",StampImageAnnotation:"ddvStampImage",StampIconAnnotation:"ddvStampIcon",TextTypewriterAnnotation:"ddvTypewriter",TextBoxAnnotation:"ddvTextBox",EraseAnnotation:"ddvAnnotationEraser",SelectAnnotation:"ddvAnnotationSelect",SendBackward:"ddvSendBackward",SendToBack:"ddvSendToBack",BringToFront:"ddvBringToFront",BringForward:"ddvBringForward",AnnotationSet:"ddvAnnotationSet"};function Jy(t,e,i){const s=s=>{const n=(parseFloat(s.value)-e)/(i-e)*100;t.style.backgroundSize=`${n}% 100%`;};s(t),t.oninput=e=>{s(t);},t.onchange=e=>{s(t);};}function qy(t,e){const{bottom:i,height:s}=t.parentNode.getBoundingClientRect(),{height:n}=t.getBoundingClientRect(),{bottom:o}=e.getBoundingClientRect();let r=s;return o-i<n&&(r=-n),r}function Zy(t){t.$on("ui_hidePopup",(e=>{e!==t&&Rs(null==t?void 0:t.togglePopup)&&(null==t||t.togglePopup(!1));}));}function Qy(t){t.$on("ui_cropClick",(e=>{const{viewer:i}=t.injection,s=i.getPageCounts()||0;(e||s)&&tv(t.el,e);}));}function Ky(t){t.$on("ui_toolModeRefactor",(()=>{const{viewer:e}=t.injection,i=e.getPageCounts()||0,{toolMode:s}=e.context.viewerConfig;i&&tv(t.el,"annotation"===s||"crop"===s);}));}function tv(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return;const{classList:i}=t,s=i.contains("ddv-button-disabled");e?s||t.classList.add("ddv-button-disabled"):s&&!e&&t.classList.remove("ddv-button-disabled");}function ev(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"base";if(!t)return;const{classList:s}=t;let n="ddv-button-activated";"deep"===i?n="ddv-button-activated-deep":"light"===i&&(n="ddv-button-activated-light");const o=s.contains(n);e?o||t.classList.add(n):t.classList.remove(n);}function iv(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{left:o,right:r,bottom:a}=function(t,e){const i=(e||t.parentElement).getBoundingClientRect(),s=t.getBoundingClientRect(),n=s.top-i.top,o=i.right-s.right;return {top:n,bottom:i.bottom-s.bottom,left:s.left-i.left,right:o}}(e,t),{x:l,y:h,width:d}=t.getBoundingClientRect(),{height:c,width:u}=i.getBoundingClientRect(),{x:p,y:g,width:f,height:m}=e.getBoundingClientRect(),y=rr(getComputedStyle(t).borderWidth);let v=Math.floor(p)-Math.floor(l)-y.value;v<5&&(v=0);const x=d-u,w=v-(Math.floor(u)-Math.floor(f))/2,b=w<5?"0px":`${w}px`;let C=Math.floor(g)-Math.floor(h)-y.value;i.style.left=n&&r>u/2&&o>u/2?b:d<u+5?"0px":r>u?`${v}px`:o>u?v-(Math.floor(u)-Math.floor(f))+"px":r>u/2&&o>u/2?b:x<5?"0px":`${x}px`,a>c?(s&&(C+=2),i.style.top=C+Math.floor(m)-1+"px"):(s&&(C-=4),i.style.top=C-Math.floor(c)+"px");}function sv(t,e,i){const s=aw.getTooltip(),n=aw.getDisplayTextConfig(),o=Yy;null!=i&&i.id||!(t in o)||(i.id=o[t]+e.postfix),null!=i&&i.tooltip||!(t in s)||(i.tooltip=s[t]),null!=i&&i.displayText&&(i.label=null==i?void 0:i.displayText),null!=i&&i.label||!(t in n)||(i.label=n[t]);}function nv(t){return (null==t?void 0:t.constructor.cpName)||""}function ov(t){const{value:e}=t,{fontSize:i}=getComputedStyle(t),s=document.createElement("div");s.style.position="absolute",s.style.left="-9999px",s.style.top="-9999px",s.style.visibility="hidden",s.style.fontSize=i,s.style.fontFamily="Arial, Helvetica, sans-serif",document.body.appendChild(s),s.textContent=e;const n=s.clientWidth+1;return s.remove(),n}function rv(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.uiState!==e&&t.el&&(tv(t.el,"disabled"===e),function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return;const{classList:i}=t,s=i.contains("ddv-button-focused");e?s||t.classList.add("ddv-button-focused"):t.classList.remove("ddv-button-focused");}(t.el,"focused"===e),i&&ev(t.el,"focused"===e,s?"deep":"base"),t.uiState=e);}class av extends Vy{constructor(t,e){super(t,e.class),l(this,"callback",void 0),l(this,"uiState","normal"),l(this,"isFocused",!1),l(this,"isMenuButton",!1),this.callback=e.callback,this.bindHooks(),this.isMenuButton=t.data.menu||!1,"false"!==t.data.default&&this.bindDefaultUi();}bindEvent(){this.nativeOn(this.el,"click",this.callback);}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup");}));}setUiState(t){rv(this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.isMenuButton);}bindDefaultUi(){const{viewer:t}=this.injection,e=t=>{let e=this.isFocused?"focused":"normal";(Ts(null==t?void 0:t.pageCount)?this.injection.viewer.getPageCounts():t.pageCount)||(e="disabled"),this.setUiState(e,!Ms());};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindHooks(){this.hooks.created.on((()=>{this.bindEvent(),this.bindHidePopup();})),this.hooks.updated.on((()=>{this.uiState="normal";}));}initTemplate(t){const e=this.data;e.options||(e.options={});const{options:i,id:s}=this.data;s&&(i.id=s),sv(nv(this),this.injection.viewer,i),"false"===e.default&&(i.label=void 0),super.initTemplate(t);}}class lv extends _y{constructor(t){super(t),l(this,"uiState","normal"),l(this,"defaultClass",void 0),l(this,"pullDownBox",void 0),l(this,"isFirstClick",!0),this.bindViewerResized(),this.bindPopupSwitchEvent(),this.bindDefaultUi(),this.bindViewerHooks();}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{pullDownBox:t}=this;if(!t)return;const e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:iv(i,this.el,this.pullDownBox);}),this);}bindPullDownBoxEvents(){this.nativeOn(this.el,"click",(()=>{if(this.togglePopup(),this.isFirstClick){iv(this.injection.viewer.rootDom,this.el,this.pullDownBox),this.isFirstClick=!1;}}));}bindPopupSwitchEvent(){Zy(this);}bindDefaultUi(){const t=t=>{const e=(Ts(null==t?void 0:t.pageCount)?this.injection.viewer.getPageCounts():t.pageCount)?"normal":"disabled";this.isFirstClick=!0,this.setUiState(e);};this.injection.viewer.hooks.pageExistenceChanged.on(t,this),this.hooks.inserted.on(t),this.hooks.updated.on(t);}initPullDownBox(){this.hooks.created.on((()=>{this.pullDownBox=this.query(`.${this.defaultClass}-box`),this.pullDownBox.style.display="none",this.pullDownBox.remove(),this.bindPullDownBoxEvents();})),this.hooks.updated.on((()=>{this.uiState="normal",this.pullDownBox.style.display="none",this.isFirstClick=!0;}));}bindViewerHooks(){this.injection.viewer.hooks.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1);}),this);}setUiState(t){rv(this,t);}togglePopup(t){const{pullDownBox:e}=this,{viewer:i}=this.injection;let s="none"===e.style.display;s=Ts(t)?!s:!t,s?e.remove():(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e)),ev(this.el,!s),e.style.display=s?"none":"";}}class hv extends lv{constructor(t){super(t),l(this,"lastSelectedIndex",0),l(this,"defaultClass","ddv-pdl"),l(this,"pullDownBoxClass","ddv-pull-down"),l(this,"children",[]),l(this,"hasCheckIcon",!1);const{defaultClassName:e,children:i,showCheckIcon:s}=t.data.options;e&&(this.defaultClass=e),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,this.children=i,this.hasCheckIcon=s,this.initPullDownBox(),this.initTemplate();}getChildrenTemplate(){let t="";return this.children.forEach(((e,i)=>{const{id:s,label:n}=e;e.id=void 0,e.label=void 0,t+=`<${e.type} :options="options.children[${i}]" default="false"id="${s?s+this.injection.viewer.postfix:""}" ><span>${n}</span>`+(this.hasCheckIcon?'<i class="ddv-button-ok" style="visibility: hidden"></i>':"")+`</${e.type}>`;})),t}selectChildren(t){if(!this.hasCheckIcon)return;const{pullDownBox:e}=this;if(-1!==t&&!e.childNodes[t])return;if(-1!==this.lastSelectedIndex){const t=e.children[this.lastSelectedIndex],i=t.getElementsByTagName("i")[0];t.classList.remove("ddv-pull-down-selected"),i.style.visibility="hidden";}if(-1===t)return void(this.lastSelectedIndex=-1);const i=e.children[t],s=i.getElementsByTagName("i")[0];i.classList.add("ddv-pull-down-selected"),s.style.visibility="visible",this.lastSelectedIndex=t;}initTemplate(){const t=this.data;t.options||(t.options={});const{options:e}=this.data,{pullDownBox:i}=e;sv(nv(this),this.injection.viewer,e);const s=`<div ${Ny(e,`ddv-button ${this.defaultClass}`)}>`+(Ts(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${Ny(i,this.pullDownBoxClass)}>`+`${this.getChildrenTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=s;}}class dv extends lv{constructor(t){super(t),l(this,"defaultClass","ddv-pdm"),l(this,"pullDownBoxClass","ddv-pull-down"),l(this,"children",[]);const{defaultClassName:e,children:i,enableScroll:s}=t.data.options;e&&(this.defaultClass=e),this.pullDownBoxClass=`${this.defaultClass}-box ddv-pull-down`,s&&(this.pullDownBoxClass+=Ms()?" ddv-custom-scroll-hidden":" ddv-custom-scroll"),this.children=i,this.initPullDownBox(),this.initTemplate();}getChildrenTemplate(){let t="";return this.children.forEach(((e,i)=>{t+=`<${e.type} :options="options.children[${i}]" menu="true"></${e.type}>`;})),t}initTemplate(){const t=this.data;t.options||(t.options={});const{options:e}=this.data,{pullDownBox:i}=e;sv(nv(this),this.injection.viewer,e);const s=`<div ${Ny(e,`ddv-button ${this.defaultClass}`)}>`+(Ts(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${Ny(i,this.pullDownBoxClass)}>`+`${this.getChildrenTemplate()}</div><i class="ddv-down-arrow"></i></div>`;this.template=s;}}class cv extends av{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection;Ms()&&this.el.classList.contains("ddv-button-focused")?t.updateViewerConfig({toolMode:"pan"}):(t.updateViewerConfig({toolMode:"annotation",annotationMode:e.annotationMode}),"stamp"===e.annotationMode&&t.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:null}}}));}}),l(this,"annotationMode",void 0),this.annotationMode=e.annotationMode;}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!Hu.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig();t.getPageCounts()?"annotation"!==e?this.setUiState("normal"):i===this.annotationMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}class uv extends cv{constructor(t){super(t,{class:"ddv-ellipse",annotationMode:"ellipse"});}}l(uv,"cpName","EllipseAnnotation");class pv extends cv{constructor(t){super(t,{class:"ddv-annot-eraser",annotationMode:"erase"});}}l(pv,"cpName","EraseAnnotation");class gv extends cv{constructor(t){super(t,{class:"ddv-ink",annotationMode:"ink"});}}l(gv,"cpName","InkAnnotation");class fv extends cv{constructor(t){super(t,{class:"ddv-line",annotationMode:"line"});}}l(fv,"cpName","LineAnnotation");class mv extends cv{constructor(t){super(t,{class:"ddv-polygon",annotationMode:"polygon"});}}l(mv,"cpName","PolygonAnnotation");class yv extends cv{constructor(t){super(t,{class:"ddv-polyline",annotationMode:"polyline"});}}l(yv,"cpName","PolylineAnnotation");class vv extends cv{constructor(t){super(t,{class:"ddv-rect",annotationMode:"rectangle"});}}l(vv,"cpName","RectAnnotation");class xv extends cv{constructor(t){super(t,{class:"ddv-annot-select",annotationMode:"select"});}}l(xv,"cpName","SelectAnnotation");class wv extends cv{constructor(t){super(t,{class:"ddv-stamp-icon",annotationMode:"stamp"});}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!Hu.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig(),s=t.getPageCounts(),{defaultStyleConfig:n}=t.getAnnotationConfig(),{stamp:o}=n,r=null==o?void 0:o.imageData;s?"annotation"!==e||"stamp"!==i||r?this.setUiState("normal"):this.setUiState("focused"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),t.hooks.annotationDefaultStyleChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}l(wv,"cpName","StampIconAnnotation");class bv extends av{constructor(t){super(t,{class:"ddv-stamp-image",callback:()=>{this.annotationImageLoader.value=null,delete this.annotationImageLoader.files,Ms()&&this.el.classList.contains("ddv-button-focused")?this.injection.viewer.updateViewerConfig({toolMode:"pan"}):(this.injection.viewer.updateViewerConfig({toolMode:"pan"}),this.injection.viewer.selectAnnotations([]),this.annotationImageLoader.click());}}),l(this,"annotationImageLoader",void 0);}createAnnotationImageLoaderInput(){const t=document.createElement("input");return t.accept="image/png,image/jpeg,image/bmp",t.type="file",t.addEventListener("change",(e=>{const{files:i}=t,s=new Blob([i[0]],{type:i[0].type});["image/png","image/jpeg","image/bmp"].includes(i[0].type)&&(this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{imageData:s}}}),t.value=null,t.files=null,this.injection.viewer.updateViewerConfig({toolMode:"annotation",annotationMode:"stamp"}));}),!0),t}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet");}));}bindHooks(){super.bindHooks(),this.hooks.inserted.on((()=>{const t=this.createAnnotationImageLoaderInput();t.style.display="none",this.el.appendChild(t),this.annotationImageLoader=t,this.annotationImageLoader.addEventListener("click",(t=>{t.stopPropagation();}));}));}bindDefaultUi(){const t=this.injection.viewer,e=()=>{if(!Hu.annotationLicenseModuleIsExist())return void this.setUiState("disabled");const{toolMode:e,annotationMode:i}=t.getViewerConfig(),s=t.getPageCounts(),{defaultStyleConfig:n}=t.getAnnotationConfig(),{stamp:o}=n,r=null==o?void 0:o.imageData;s?"annotation"!==e?this.setUiState("normal"):"stamp"===i&&r?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this),t.hooks.annotationDefaultStyleChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}l(bv,"cpName","StampImageAnnotation");class Cv extends cv{constructor(t){super(t,{class:"ddv-text-box",annotationMode:"textBox"});}}l(Cv,"cpName","TextBoxAnnotation");class Sv extends cv{constructor(t){super(t,{class:"ddv-typewriter",annotationMode:"textTypewriter"});}}l(Sv,"cpName","TextTypewriterAnnotation");class Pv extends dv{constructor(t){const{AnnotationSet:e}=aw.getDisplayTextConfig(),i=t.data;i.options={...i.options,children:[{type:"SelectAnnotation"},{type:"EraseAnnotation"},{type:"SeparatorLine"},{type:"TextTypewriterAnnotation"},{type:"TextBoxAnnotation"},{type:"SeparatorLine"},{type:"StampIconAnnotation"},{type:"StampImageAnnotation"},{type:"SeparatorLine"},{type:"InkAnnotation"},{type:"RectAnnotation"},{type:"EllipseAnnotation"},{type:"PolygonAnnotation"},{type:"PolylineAnnotation"},{type:"LineAnnotation"},{type:"SeparatorLine"},{type:"BringForward"},{type:"BringToFront"},{type:"SendBackward"},{type:"SendToBack"}],defaultClassName:"ddv-annotation-mode",label:e,enableScroll:!0},super(t),Qy(this);}bindDefaultUi(){Hu.annotationLicenseModuleIsExist()?(super.bindDefaultUi(),this.hooks.inserted.on((t=>{const{toolMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getPageCounts();"annotation"===e&&i>0&&this.setUiState("focused");}))):this.hooks.inserted.on((t=>{this.setUiState("disabled");}));}togglePopup(t){if((!0!==t||""!==this.pullDownBox.style.display)&&(!1!==t||"none"!==this.pullDownBox.style.display)&&(super.togglePopup(t),""===this.pullDownBox.style.display&&Av(this.pullDownBox).horizontal)){this.pullDownBox.style.justifyContent="start";let t=0;for(let e=0;e<this.pullDownBox.children.length;e++){const i=this.pullDownBox.children[e];i.classList.contains("ddv-button-focused")&&(t=i.offsetLeft+i.clientWidth/2-this.pullDownBox.clientWidth/2);}this.pullDownBox.scroll(t,0);}}bindPopupSwitchEvent(){this.$on("ui_hidePopup",(t=>{if(t===this||"viewer"===t||t===Pv.cpName)return;const{toolMode:e}=this.injection.viewer.getViewerConfig();"annotation"!==e&&this.togglePopup(!1);}));}bindViewerHooks(){if(!Hu.annotationLicenseModuleIsExist())return;const t=this.injection.viewer;t.hooks.resize.on((()=>{Av(this.pullDownBox).horizontal?this.pullDownBox.style.justifyContent="start":this.pullDownBox.style.justifyContent="";}),this),t.hooks.pageExistenceChanged.on((()=>{const{toolMode:e}=t.getViewerConfig();let i="disabled";t.getPageCounts()>0?(i="normal","annotation"===e&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0),i="focused")):this.togglePopup(!1),this.setUiState(i);}),this),t.hooks.toolModeChanged.on((e=>{if("crop"===e.newToolMode)return this.togglePopup(!1),void this.setUiState("disabled");const i="annotation"===e.newToolMode;t.getPageCounts()>0&&(this.setUiState(i?"focused":"normal"),this.$emit("ui_annotationModeClick",i),this.$emit("ui_toolModeRefactor",i),i&&(this.isFirstClick?(this.togglePopup(!1),this.el.click()):this.togglePopup(!0)));}),this);}setUiState(t){super.setUiState(t);}}function Av(t){return {vertical:t.scrollHeight>t.clientHeight,horizontal:t.scrollWidth>t.clientWidth}}l(Pv,"cpName","AnnotationSet");class Tv extends av{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection,e=t.getSelectedAnnotations();if(1!==e.length)return;const i=e[0].uid;switch(this.layerType){case"bringForward":t.bringForward(i);break;case"bringToFront":t.bringToFront(i);break;case"sendBackward":t.sendBackward(i);break;case"sendToBack":t.sendToBack(i);}}}),l(this,"layerType",void 0),this.layerType=e.layerType;}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet");}));}bindDefaultUi(){const t=this.injection.viewer,e=Hu.annotationLicenseModuleIsExist(),i=()=>{if(!e)return void this.setUiState("disabled");const{viewer:i}=this.injection,s=i.getSelectedAnnotations();t.getPageCounts()&&1===s.length?this.setUiState("normal"):this.setUiState("disabled");};t.hooks.annotationLayerStateChanged.on((i=>{let{state:s}=i;if(!e)return void this.setUiState("disabled");const n=t.getSelectedAnnotations();if(!n.length||n.length>1)return void this.setUiState("disabled");const o=t.getAnnotationObject(n[0].uid);if(o&&!o.context.isActive)return void this.setUiState("disabled");let r=!1;switch(this.layerType){case"bringForward":r=s.forward;break;case"bringToFront":r=s.front;break;case"sendBackward":r=s.backward;break;case"sendToBack":r=s.back;}this.setUiState(r?"normal":"disabled");}),this),t.hooks.pageExistenceChanged.on(i,this),this.hooks.inserted.on(i),this.hooks.updated.on(i);}}class kv extends Tv{constructor(t){super(t,{class:"ddv-bring-forward",layerType:"bringForward"});}}l(kv,"cpName","BringForward");class Dv extends Tv{constructor(t){super(t,{class:"ddv-bring-to-front",layerType:"bringToFront"});}}l(Dv,"cpName","BringToFront");class Ev extends Tv{constructor(t){super(t,{class:"ddv-send-backward",layerType:"sendBackward"});}}l(Ev,"cpName","SendBackward");class Iv extends Tv{constructor(t){super(t,{class:"ddv-send-to-back",layerType:"sendToBack"});}}l(Iv,"cpName","SendToBack");class Rv extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-annotation-toolbar"),l(this,"lastSelected",void 0),l(this,"toolbarOffset",20),this.bindHooks(),this.initTemplate(),this.bindViewerHooks();}bindHooks(){const t=t=>{this.el.style.display="none";};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{viewer:t}=this.injection,e=()=>{if(!this.lastSelected)return;const e=t.getActiveTab();if("single"===e.context.displayMode&&this.lastSelected.pageUid!==e.getCurrentPage().uid)return;const{show:i,x:s,y:n}=Mv(t.context.viewService.mainContainer,this.lastSelected,this.el,this.toolbarOffset);this.togglePopup(i,s,n);};if(t.hooks.visibleChanged.on((()=>{this.togglePopup(!1);}),this),t.hooks.pageExistenceChanged.on((t=>{0===t.pageCount&&(this.togglePopup(!1),this.lastSelected=null);}),this),t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return this.togglePopup(!1),void(this.lastSelected=null);const i=e.newAnnotationUids[0],s=t.getAnnotationObject(i);if(!s)return;const{show:n,x:o,y:r}=Mv(t.context.viewService.mainContainer,s,this.el,this.toolbarOffset);this.lastSelected=s,this.togglePopup(n,o,r);}),this),t.hooks.beforeAnnotationEdit.on((()=>{this.togglePopup(!1);}),this),t.hooks.afterAnnotationEdit.on((e=>{if(e instanceof th)return;const{show:i,x:s,y:n}=Mv(t.context.viewService.mainContainer,e,this.el,this.toolbarOffset);this.lastSelected=e,this.togglePopup(i,s,n);}),this),t.hooks.pageChanged.on((()=>{const e=t.getActiveTab();if(!e||"single"!==e.context.displayMode)return;const i=t.getSelectedAnnotations();if(1!==i.length)return;const s=i[0].pageUid===e.getCurrentPage().uid;this.togglePopup(s);}),this),t.hooks.resize.on(e,this),t.hooks.scroll.on(e,this),t.hooks.fitModeChanged.on(e,this),t.hooks.displayModeChanged.on(e,this),t.hooks.zoomChanged.on(e,this),t.hooks.annotationsUpdated.on(e,this),null!=t&&t.annotationViewerContext){const{annotationViewerContext:i}=t,{hooks:s}=i.annotationController;s.enableAnnotationTextEditMode.on(e,this),s.disableAnnotationTextEditMode.on(e,this);}}togglePopup(t,e,i){const{viewer:s}=this.injection;if(!t)return void(this.el.style.display="none");s.context.viewService.mainContainer.appendChild(this.el),this.el.style.display="",this.el.style.left=`${e||0}px`,this.el.style.top=`${i||0}px`;}initTemplate(){const{options:t}=this.data;sv(nv(this),this.injection.viewer,t);const e=`<div ${Ny(t,this.defaultClass,"")}><AnnotationPaletteButton :options="options.paletteButton"></AnnotationPaletteButton><AnnotationDeleteButton :options="options.deleteButton"></AnnotationDeleteButton></div>`;this.template=e;}}function Mv(t,e,i,s){const{width:n,height:o}=t.getBoundingClientRect(),r=e.context.getRealTimeBoundingBox(),a=getComputedStyle(i),l=rr(a.width).value,h=rr(a.height).value;if(r.right<0||r.left>n||r.top>o||r.bottom<0)return {show:!1,x:0,y:0};const d=r.left+r.width/2-l/2;let c=r.bottom+s;return c+h>o&&(c=r.top-h-s),c<0&&(c=0),{show:!0,x:d,y:c}}l(Rv,"cpName","AnnotationToolBar");class Bv extends av{constructor(t){super(t,{class:"ddv-palette",callback:()=>{this.$emit("ui_changePalette_visible");}}),Qy(this);}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet"),this.focusTexture();}));}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof Kl&&e.isEditMode&&e.focusTexture();}}}l(Bv,"cpName","AnnotationPaletteButton");class Lv extends av{constructor(t){super(t,{class:"ddv-delete-annot",callback:()=>{const{viewer:t}=this.injection,e=t.getSelectedAnnotations(),i=[];e.forEach((t=>{i.push(t.uid);})),t.deleteAnnotations(i);}}),Qy(this);}bindHidePopup(){this.nativeOn(this.el,"click",(()=>{this.$emit("ui_hidePopup","AnnotationSet");}));}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{viewer:e}=this.injection,i=e.getSelectedAnnotations();t.getPageCounts()&&i.length?this.setUiState("normal"):this.setUiState("disabled");};t.hooks.selectedAnnotationsChanged.on(e,this),t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}l(Lv,"cpName","AnnotationDeleteButton");class Uv extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-palette-color-panel"),l(this,"colorList",void 0),l(this,"enableChangeColor",void 0),l(this,"paletteType",void 0),l(this,"colorInput",void 0),l(this,"selectedColorButton",void 0),l(this,"lastUpdatedAnnotation",void 0),l(this,"lastInputColor",void 0),l(this,"lastTextContents",void 0),l(this,"lastPaletteType",void 0),l(this,"dblClickButtons",[]),this.colorList=t.data.colorList,this.enableChangeColor=t.data.enableChangeColor,this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stamp"===t?"none":"",this.paletteType=t,this.showNoFill("fill"===t),this.updateButtonSelected();}));}bindHooks(){this.hooks.inserted.on((()=>{const t=document.createElement("input");t.type="color",this.colorInput=t,this.el.appendChild(this.colorInput),this.bindEvents(),this.bindColorInputEvents();}));}bindEvents(){const t=this.el.querySelector(".ddv-palette-color-grid");t.addEventListener("click",(t=>{const e=t.target;if(!(e instanceof HTMLButtonElement))return;this.dblClickButtons.push(e),this.dblClickButtons.length>2&&this.dblClickButtons.shift();if(e.classList.contains("ddv-color-selected"))return;const i=e.value,{viewer:s}=this.injection;if(""===i)this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=e;else {const t=s.getSelectedAnnotations();1===t.length&&this.updateColorByData(t[0],i),this.updateDefaultColor(i);}})),t.addEventListener("dblclick",(t=>{if(!this.enableChangeColor)return;const e=t.target;if(!(e instanceof HTMLButtonElement))return;if(2===this.dblClickButtons.length&&this.dblClickButtons[0]!==this.dblClickButtons[1])return;const i=e.value;"transparent"!==i&&""!==i&&(this.colorInput.value=i,Ms()&&this.colorInput.focus(),this.colorInput.click(),this.selectedColorButton=e);}));}bindColorInputEvents(){this.colorInput.addEventListener("input",(t=>{const{viewer:e}=this.injection,i=this.colorInput.value;this.selectedColorButton.classList.contains("ddv-add-color")&&this.addColor();this.selectedColorButton.children[0].style.background=i,this.selectedColorButton.value=i;1===e.getSelectedAnnotations().length&&this.updateColorByShape(i),this.updateDefaultColor(i),this.selectedColor(i);})),this.colorInput.addEventListener("change",(t=>{this.lastUpdatedAnnotation&&(this.updateColorByData(this.lastUpdatedAnnotation,this.lastInputColor,this.lastPaletteType),this.lastUpdatedAnnotation=null,this.lastInputColor=null,this.lastPaletteType=null);}));}bindViewerHooks(){const t=this.injection.viewer;t.hooks.selectedAnnotationsChanged.on((()=>{this.updateButtonSelected();}),this),t.hooks.annotationsUpdated.on((()=>{this.updateButtonSelected();}),this),t.hooks.annotationModeChanged.on((()=>{this.updateButtonSelected();}),this),t.hooks.annotationDefaultStyleChanged.on((()=>{this.updateButtonSelected();}),this),t.hooks.annotationTextCharsSelected.on((t=>{const e=t.freeTextContentStyle,{color:i}=e;this.selectedColor(i);}),this);}updateColorByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if("fill"===this.paletteType)i.style.background=t;else if("stroke"===this.paletteType)i.style.borderColor=t;else if("text"===this.paletteType&&i instanceof Kl){if(i.hasSelectedChars){const e=Bl(i,{color:t});i.style.textContents=e,i.textEditEventHandler.updateTextSelection();}else {if(i.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[e[0].type]:{textContent:{color:t}}}});{const e=Ml(i,{color:t});e.length&&(i.style.textContents=e);}}this.lastTextContents=i.style.textContents;}this.lastUpdatedAnnotation=e[0],this.lastInputColor=t,this.lastPaletteType=this.paletteType,this.injection.viewer.context.render();}updateColorByData(t,e,i){const{viewer:s}=this.injection,{uid:n}=t,o={},r=this.injection.viewer.getAnnotationObject(n),a=i||this.paletteType;if("text"===a&&r instanceof Kl){if(r.hasSelectedChars){const t=Bl(r,{color:e});o.textContents=t;}else {if(r.isEditMode)return void this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[t.type]:{textContent:{color:e}}}});{const t=Ml(r,{color:e});t.length&&(o.textContents=t);}}return this.lastTextContents&&(o.textContents=this.lastTextContents,this.lastTextContents=null),s.updateAnnotation(n,{style:o},["appearanceChanged"]),void(r.hasSelectedChars&&r.textEditEventHandler.updateTextSelection())}"fill"===a?o.background="transparent"===e?"":e:"stroke"===a&&(o.borderColor=e),s.updateAnnotation(n,{style:o},["appearanceChanged"]);}updateDefaultColor(t,e){const{annotationMode:i}=this.injection.viewer.getViewerConfig(),s=this.injection.viewer.getSelectedAnnotations();let n=i;s.length&&s[0]&&(n=s[0].type);const o={};switch(e||this.paletteType){case"fill":o.background=t;break;case"stroke":o.borderColor=t;break;case"text":o.textContent={},o.textContent.color=t;}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[n]:o}});}selectedColor(t){const e=this.el.querySelector(".ddv-palette-color-grid").getElementsByTagName("button");for(let i=0;i<e.length;i++){const s=e[i];if(!s.value)continue;const n=mr(s.value),o=mr(t);n.formatted===o.formatted?s.classList.add("ddv-color-selected"):s.classList.contains("ddv-color-selected")&&s.classList.remove("ddv-color-selected");}}updateButtonSelected(){const{viewer:t}=this.injection,e=t.getSelectedAnnotations();if(1===e.length){let s=null;if("fill"===this.paletteType)s=e[0].style.background||"transparent";else if("stroke"===this.paletteType)s=e[0].style.borderColor||"transparent";else if("text"===this.paletteType){const n=t.getAnnotationObject(e[0].uid);var i;if(n instanceof Kl)s=(null===(i=e[0].style)||void 0===i||null===(i=i.textContents[0])||void 0===i?void 0:i.color)||"transparent";n instanceof Kl&&(n.isEditMode||!n.style.textContents.length)&&(s=n.freeTextContentStyle.color);}return void(s&&this.selectedColor(s))}const{toolMode:s,annotationMode:n}=t.getViewerConfig();if("annotation"===s&&"select"!==n&&"erase"!==n){const{defaultStyleConfig:e}=t.getAnnotationConfig(),{background:i,borderColor:s,textContent:l}=Nl;let h=null;var o;if("fill"===this.paletteType)h=(null===(o=e[n])||void 0===o?void 0:o.background)||i||"transparent";else if("stroke"===this.paletteType){var r;h=(null===(r=e[n])||void 0===r?void 0:r.borderColor)||s||"transparent";}else if("text"===this.paletteType){var a;h=(null===(a=e[n])||void 0===a||null===(a=a.textContent)||void 0===a?void 0:a.color)||(null==l?void 0:l.color)||"transparent";}h&&this.selectedColor(h);}}getColorTemplate(){const t=document.createElement("div");let e="<div>",i=0;for(let s=0;s<this.colorList.length;s++){const n=this.colorList[s];if(t.style.background=n,""!==t.style.background){if(i>26)break;i+=1,e+=`<button value="${n}"><div style="background:${n}"></div></button>`,0!==i&&i%7==0&&(e+="</div><div>"),t.style.background="";}}const s=i>26?0:27-i;for(let t=0;t<s;t++)e+=0===t?'<button value="" class="ddv-add-color"><div></div></button>':'<button value="" class="ddv-color-placeholder"><div></div></button>',(i+t+1)%7==0&&(e+="</div><div>");return e+='<button value="transparent" class="ddv-color-transparent"><div></div></button>',e+="</div>",t.remove(),e}showNoFill(t){this.el.querySelectorAll(".ddv-color-transparent").forEach((e=>{e.style.visibility=t?"":"hidden",e.style.pointerEvents=t?"":"none";}));}addColor(){const t=this.el.querySelector(".ddv-palette-color-grid"),e=t.querySelector(".ddv-add-color"),i=t.querySelector(".ddv-color-placeholder");e&&e.classList.remove("ddv-add-color"),i&&(i.classList.remove("ddv-color-placeholder"),i.classList.add("ddv-add-color"));}initTemplate(){const t=`<div class="${this.defaultClass}"><div class="ddv-palette-color-grid">${this.getColorTemplate()}</div></div>`;this.template=t;}}const Ov=["Arial","Courier","Helvetica","Times New Roman"],_v=eo.displayResolution/eo.dataResolution;class Nv extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-palette-font-panel"),l(this,"fontFamilyEl",void 0),l(this,"fontSizeEl",void 0),l(this,"fontList",[...Ov]),l(this,"inputIsBlur",!0),l(this,"currentFontSizeValue",void 0),l(this,"isArrowKeyPressed",!1),l(this,"maxFontSize",72),this.maxFontSize=t.data.maxFontSize,this.maxFontSize<72&&(this.maxFontSize=72),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",(t=>{"fontFamily"!==t&&this.toggleSelect("fontFamily",!1),"fontSize"!==t&&this.toggleSelect("fontSize",!1);})),this.$on("ui_changePalette_type",(t=>{this.el.style.display="text"===t?"":"none";})),this.$on("ui_addFont",(t=>{this.addFont(t);}));}updateTextStyle(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{toolMode:i,annotationMode:s}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations();if(1!==n.length||"textTypewriter"!==n[0].type&&"textBox"!==n[0].type)"annotation"!==i||"textBox"!==s&&"textTypewriter"!==s||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[s]:{textContent:t}}});else {const{uid:e,type:i}=n[0],s=this.injection.viewer.getAnnotationObject(e);if(s.isEditMode)s.hasSelectedChars&&(this.injection.viewer.updateAnnotation(e,{style:{textContents:Bl(s,t)}},["appearanceChanged"]),s.textEditEventHandler.updateTextSelection());else {const i=Ml(s,t);i.length&&this.injection.viewer.updateAnnotation(e,{style:{textContents:i}},["appearanceChanged"]);}this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[i]:{textContent:t}}});}e&&this.focusTexture();}bindHooks(){this.hooks.created.on((()=>{this.fontFamilyEl=this.el.querySelector(".ddv-palette-font-family"),this.fontSizeEl=this.el.querySelector(".ddv-palette-font-size");})),this.hooks.inserted.on((()=>{this.bindToggleEvent(),this.bindSelectEvent(),this.bindFontSizeInputEvent(),this.bindTextAlignEvents(),this.bineFontStyleEvents();}));}bindToggleEvent(){const t=this.fontSizeEl.querySelector(".ddv-down-arrow");Dn(this.fontFamilyEl,"click",this).on((t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontFamily"),this.toggleSelect("fontFamily");}),this),Dn(t,"click",this).on((t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","fontSize"),this.toggleSelect("fontSize");}),this);}bindSelectEvent(){const t=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),e=this.fontSizeEl.querySelector(".ddv-palette-font-size-select");t.addEventListener("click",(t=>{t.stopPropagation(),this.toggleSelect("fontFamily",!1);const e=t.target.value;e&&this.updateTextStyle({fontFamily:e});})),e.addEventListener("click",(t=>{t.stopPropagation(),this.toggleSelect("fontSize",!1);const e=t.target.value;e&&this.updateTextStyle({fontSize:rr(e).value*_v});}));}bindFontSizeInputEvent(){const t=this.fontSizeEl.getElementsByTagName("input")[0];t.addEventListener("keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0);})),t.addEventListener("keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){let e=Math.round(rr(t.value).value);e>this.maxFontSize&&(e=this.maxFontSize,t.value=`${this.maxFontSize}`),e<1&&(e=1,t.value="1"),this.updateTextStyle({fontSize:e*_v},!1),this.isArrowKeyPressed=!1;}})),t.addEventListener("focus",(()=>{const e=t.value,i=rr(e).value;t.value=i,t.type="number",this.inputIsBlur=!1,this.currentFontSizeValue=i,this.$emit("ui_shrinkSelectionBox");})),t.addEventListener("blur",(e=>{this.inputIsBlur=!0,"text"!==t.type&&(this.currentFontSizeValue=t.value,t.type="text",t.value+="pt",e.relatedTarget instanceof HTMLInputElement||this.focusTexture());}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="pt",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);let i=Math.round(rr(t.value).value);i>this.maxFontSize&&(i=this.maxFontSize),i<1&&(i=1),this.updateTextStyle({fontSize:i*_v});};t.addEventListener("change",e);}bindTextAlignEvents(){const t=this.el.querySelector(".ddv-align-left"),e=this.el.querySelector(".ddv-align-center"),i=this.el.querySelector(".ddv-align-right"),s=this.el.querySelector(".ddv-justify-center"),n=t=>{const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),s=this.injection.viewer.getSelectedAnnotations();1!==s.length||"textTypewriter"!==s[0].type&&"textBox"!==s[0].type?"annotation"!==e||"textBox"!==i&&"textTypewriter"!==i||this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[i]:{textAlign:t}}}):this.injection.viewer.updateAnnotation(s[0].uid,{style:{textAlign:t}},["appearanceChanged"]);};t.addEventListener("click",(()=>{n("left");})),e.addEventListener("click",(()=>{n("center");})),i.addEventListener("click",(()=>{n("right");})),s.addEventListener("click",(()=>{n("justify");}));}bineFontStyleEvents(){const t=this.el.querySelector(".ddv-bold"),e=this.el.querySelector(".ddv-italic"),i=this.el.querySelector(".ddv-underline"),s=this.el.querySelector(".ddv-line-through");t.addEventListener("click",(()=>{this.updateTextStyle({fontWeight:t.classList.contains("ddv-button-activated-light")?"normal":"bold"});})),e.addEventListener("click",(()=>{this.updateTextStyle({fontStyle:e.classList.contains("ddv-button-activated-light")?"normal":"italic"});})),i.addEventListener("click",(()=>{this.updateTextStyle({underline:!i.classList.contains("ddv-button-activated-light")});})),s.addEventListener("click",(()=>{this.updateTextStyle({lineThrough:!s.classList.contains("ddv-button-activated-light")});}));}bindViewerHooks(){const{viewer:t}=this.injection;t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];if("textTypewriter"!==i.type&&"textBox"!==i.type)return;this.showTextAlignList("textBox"===i.type),this.selectTextAlign(i.style.textAlign||"left");const{defaultStyleConfig:s}=this.injection.viewer.getAnnotationConfig(),{textContent:n}=s[i.type],o=i.style.textContents.length?i.style.textContents[0]:n,{fontFamily:r,fontSize:a,fontWeight:l,fontStyle:h,underline:d,lineThrough:c}=o;this.selectFontStyle(r,Math.round(rr(a).value/_v),"bold"===l,"italic"===h,d,c);}),this),t.hooks.annotationDefaultStyleChanged.on((t=>{const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),s=this.injection.viewer.getSelectedAnnotations();let n,o,r=!1;if("annotation"!==e||"textBox"!==i&&"textTypewriter"!==i||(r=!0,n=i),1===s.length){const t=this.injection.viewer.getAnnotationObject(s[0].uid);t instanceof Kl&&(n=s[0].type,o=s[0].style.textAlign,t.isEditMode&&!t.hasSelectedChars?r=!0:t.isEditMode||t.style.textContents.length?(this.selectTextAlign(o),r=!1):r=!0);}if(!r)return;const{textAlign:a}=t[n],{fontFamily:l,fontSize:h,fontWeight:d,fontStyle:c,underline:u,lineThrough:p}=t[n].textContent||{},{textContent:g}=Nl;this.selectTextAlign(o||a||Nl.textAlign),this.selectFontStyle(l||g.fontFamily,Math.round(rr(h||g.fontSize).value/_v),"bold"===(d||g.fontWeight),"italic"===(c||g.fontStyle),u||g.underline,p||g.lineThrough);}),this),t.hooks.annotationTextCharsSelected.on((t=>{const e=t.freeTextContentStyle,{fontFamily:i,fontSize:s,fontStyle:n,fontWeight:o,underline:r,lineThrough:a}=e;this.selectFontStyle(i,Math.round(rr(s).value/_v),"bold"===o,"italic"===n,r,a);}),this),t.hooks.annotationsUpdated.on((t=>{const{actions:e,uids:i}=t,s=this.injection.viewer.getSelectedAnnotations();if(!e.includes("appearanceChanged")||1!==s.length||!i.includes(s[0].uid))return;if("textTypewriter"!==s[0].type&&"textBox"!==s[0].type)return;this.selectTextAlign(s[0].style.textAlign||"left");if(!this.injection.viewer.getAnnotationObject(s[0].uid).isEditMode&&s[0].style.textContents.length){const{fontFamily:t,fontSize:e,fontWeight:i,fontStyle:n,underline:o,lineThrough:r}=s[0].style.textContents[0];this.selectFontStyle(t,Math.round(rr(e).value/_v),"bold"===i,"italic"===n,o,r);}}),this),t.hooks.annotationModeChanged.on((e=>{if(!t.getSelectedAnnotations().length&&["textBox","textTypewriter"].includes(e.newAnnotationMode)){this.showTextAlignList("textBox"===e.newAnnotationMode);const{defaultStyleConfig:t}=this.injection.viewer.getAnnotationConfig(),{textContent:i,textAlign:s}=t[e.newAnnotationMode],{fontFamily:n,fontSize:o,fontWeight:r,fontStyle:a,underline:l,lineThrough:h}=i;this.selectTextAlign(s),this.selectFontStyle(n,Math.round(rr(o).value/_v),"bold"===r,"italic"===a,l,h);}}),this),t.hooks.toolModeChanged.on((e=>{if("annotation"!==e.newToolMode)return;const{annotationMode:i}=t.getViewerConfig();["textBox","textTypewriter"].includes(i)&&this.showTextAlignList("textBox"===i);}),this);}toggleSelect(t,e){const i="fontFamily"===t?"ddv-palette-font-family-select":"ddv-palette-font-size-select",s="fontFamily"===t?this.fontFamilyEl:this.fontSizeEl,n=s.querySelector(`.${i}`),o=s.querySelector(".ddv-down-arrow"),r="none"!==n.style.display,a=Ts(e)?!r:e,l=this.injection.viewer.context.viewService.mainContainer;r!==a&&(a?(n.style.display="block",n.style.top=`${qy(n,l)}px`,o.style.transform="rotate(180deg)","fontSize"===t&&this.scrollFontSizeSelect()):(n.style.display="none",o.style.transform=""));}getFontFamilySelectTemplate(){let t="";for(let e=0;e<Ov.length;e++){const i=Ov[e];t+=`<button style="font-family:${i}" value="${i}">${i}</button>`;}return `<div class="ddv-palette-font-family"><span>Helvetica</span><i class="ddv-down-arrow"></i><div class="ddv-palette-font-family-select" style="display: none;">${t}</div></div>`}getFontSizeTemplate(){let t="";for(let e=1;e<=12;e++)t+=`<button value="${e}">${e}pt</button>`;for(let e=14;e<=36;e+=2)t+=`<button value="${e}">${e}pt</button>`;for(let e=40;e<=72;e+=4)t+=`<button value="${e}">${e}pt</button>`;if(this.maxFontSize>72){let e=72;for(;e+8<this.maxFontSize;)e+=8,t+=`<button value="${e}">${e}pt</button>`;t+=`<button value="${this.maxFontSize}">${this.maxFontSize}pt</button>`;}return `<div class="ddv-palette-font-size"><input type="string"/><i class="ddv-down-arrow"></i><div class="ddv-palette-font-size-select" style="display: none;">${t}</div></div>`}selectTextAlign(t){const e=this.el.querySelector(".ddv-align-left"),i=this.el.querySelector(".ddv-align-center"),s=this.el.querySelector(".ddv-align-right"),n=this.el.querySelector(".ddv-justify-center");ev(e,"left"===t,"light"),ev(i,"center"===t,"light"),ev(s,"right"===t,"light"),ev(n,"justify"===t,"light");}selectFontStyle(t,e,i,s,n,o){const r=this.fontFamilyEl.getElementsByTagName("span")[0],a=this.fontSizeEl.getElementsByTagName("input")[0],l=this.el.querySelector(".ddv-bold"),h=this.el.querySelector(".ddv-italic"),d=this.el.querySelector(".ddv-underline"),c=this.el.querySelector(".ddv-line-through");r.innerText=t,this.isArrowKeyPressed||("number"===a.type&&(a.type="text"),this.currentFontSizeValue=e,a.value=`${e}pt`),ev(l,i,"light"),ev(h,s,"light"),ev(d,n,"light"),ev(c,o,"light");}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof Kl&&e.isEditMode&&e.focusTexture();}}addFont(t){if(this.fontList.includes(t))return;this.fontList.push(t);const e=this.fontFamilyEl.querySelector(".ddv-palette-font-family-select"),i=document.createElement("button");i.style.fontFamily=t,i.value=t,i.innerText=t,e.appendChild(i);}showTextAlignList(t){const e=this.el.querySelector(".ddv-text-align-list");e&&(e.style.display=t?"":"none");}scrollFontSizeSelect(){if(!this.fontSizeEl)return;const t=this.fontSizeEl.querySelector(".ddv-palette-font-size-select"),{currentFontSizeValue:e}=this;let i=0;for(let s=0;s<t.children.length;s++){const n=t.children[s];if(!(e>=n.value))break;i=n.offsetTop;}t.scrollTo(0,i);}initTemplate(){const t=`<div class="${this.defaultClass}"><div style="display:flex; justify-content: space-between; position:relative; z-index:2">${this.getFontFamilySelectTemplate()}${this.getFontSizeTemplate()}</div><div><div class="ddv-button ddv-bold"></div><div class="ddv-button ddv-italic"></div><div class="ddv-button ddv-underline"></div><div class="ddv-button ddv-line-through"></div></div><div class="ddv-text-align-list"><div class="ddv-button ddv-align-left"></div><div class="ddv-button ddv-align-center"></div><div class="ddv-button ddv-align-right"></div><div class="ddv-button ddv-justify-center"></div></div></div>`;this.template=t;}}const Wv=["None","ClosedArrow","OpenArrow","ROpenArrow","RClosedArrow","Butt","Circle","Diamond","Square","Slash"],Fv=[[0,0],[3,3],[5,5],[7,7],[7,6,3,6],[5,4,21,4],[11,5,5,5]],Hv={None:"ddv-solid",OpenArrow:"ddv-line-open",ROpenArrow:"ddv-line-r-open",ClosedArrow:"ddv-line-closed",RClosedArrow:"ddv-line-r-closed",Butt:"ddv-line-butt",Square:"ddv-line-square",Diamond:"ddv-line-diamond",Circle:"ddv-line-circle",Slash:"ddv-line-slash"},Vv={33:"ddv-dashed-33",55:"ddv-dashed-55",77:"ddv-dashed-77",7636:"ddv-dashed-7636",54214:"ddv-dashed-54214",11555:"ddv-dashed-11555"};class zv extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-palette-line-panel"),l(this,"commonClass","ddv-palette-line-panel-common"),l(this,"LineStyleClass","ddv-palette-border-style"),l(this,"lineStyleClassSmall","ddv-palette-border-style-small"),l(this,"startLineEndingClass","ddv-palette-line-start"),l(this,"endLineEndingClass","ddv-palette-line-end"),l(this,"selectionClass","ddv-palette-line-panel-selection"),l(this,"startLineEndingSelect",void 0),l(this,"borderStyleSelect",void 0),l(this,"endLineEndingSelect",void 0),l(this,"isStrokePalette",void 0),this.bindHooks(),this.initTemplate(),this.$on("ui_shrinkSelectionBox",(t=>{"lineEndingStart"!==t&&this.toggleSelect(0,!1),"borderStyle"!==t&&this.toggleSelect(1,!1),"lineEndingEnd"!==t&&this.toggleSelect(2,!1);})),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stroke"===t?"":"none",this.isStrokePalette="stroke"===t;const{toolMode:e,annotationMode:i}=this.injection.viewer.getViewerConfig(),s=this.injection.viewer.getSelectedAnnotations();("annotation"===e&&"ink"===i||1===s.length&&"ink"===s[0].type)&&(this.el.style.display="none");}));}bindHooks(){this.hooks.inserted.on((()=>{const t=this.el.querySelectorAll(`.${this.commonClass}`);this.startLineEndingSelect=t[0],this.borderStyleSelect=t[1],this.endLineEndingSelect=t[2],this.bindViewerHooks(),this.bindToggleEvent(),this.bindSelectEvent();}));}bindSelectEvent(){const t=this.startLineEndingSelect.querySelector(`.${this.selectionClass}`),e=this.borderStyleSelect.querySelector(`.${this.selectionClass}`),i=this.endLineEndingSelect.querySelector(`.${this.selectionClass}`),s=(t,e)=>{const i=e.target,s="BUTTON"===i.tagName?i:i.parentNode;return Array.from(t.childNodes).indexOf(s)||0};t.addEventListener("click",(e=>{const i=s(t,e),n=Wv[i]||"None";this.updateLineEndingByData(!0,n),this.updateDefaultLineEnding(!0,n);})),e.addEventListener("click",(t=>{const i=s(e,t),n=Fv[i]||[0,0];this.updateLineDashByData(n),this.updateDefaultLineDash(n);})),i.addEventListener("click",(t=>{const e=s(i,t),n=Wv[e]||"None";this.updateLineEndingByData(!1,n),this.updateDefaultLineEnding(!1,n);}));}bindToggleEvent(){this.startLineEndingSelect.addEventListener("click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingStart"),this.toggleSelect(0);})),this.borderStyleSelect.addEventListener("click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","borderStyle"),this.toggleSelect(1);})),this.endLineEndingSelect.addEventListener("click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","lineEndingEnd"),this.toggleSelect(2);}));}bindViewerHooks(){const t=this.injection.viewer,e=(t,e,i,s)=>{if(this.startLineEndingSelect.style.display=t?"":"none",this.endLineEndingSelect.style.display=t?"":"none",this.borderStyleSelect.classList.remove(t?this.LineStyleClass:this.lineStyleClassSmall),this.borderStyleSelect.classList.add(t?this.lineStyleClassSmall:this.LineStyleClass),t){const[t,e]=i;this.updateLineEndingSelect(!0,Hv[t]||"ddv-solid"),this.updateLineEndingSelect(!1,Hv[e]||"ddv-solid");}this.el.style.display=s||!this.isStrokePalette?"none":"",this.updateBorderStyleSelect(e||[0,0]);};t.hooks.selectedAnnotationsChanged.on((i=>{var s,n;if(1!==i.newAnnotationUids.length)return;const o=t.getSelectedAnnotations()[0];if(!o)return;const r="line"===o.type||"polyline"===o.type;e(r,null===(s=o.style)||void 0===s?void 0:s.lineDash,null===(n=o.style)||void 0===n?void 0:n.lineEnding,"ink"===o.type||"stamp"===o.type);}),this),t.hooks.annotationModeChanged.on((t=>{const i=t.newAnnotationMode,s="polyline"===i||"line"===i,n="ink"===i;if("select"!==i&&"erase"!==i&&"stamp"!==i){var o,r;const{defaultStyleConfig:t}=this.injection.viewer.getAnnotationConfig(),a=(null===(o=t[i])||void 0===o?void 0:o.lineEnding)||(null==Nl?void 0:Nl.lineEnding),l=(null===(r=t[i])||void 0===r?void 0:r.lineDash)||(null==Nl?void 0:Nl.lineDash);e(s,l,a,n);}}),this),t.hooks.annotationDefaultStyleChanged.on((i=>{var s;const{toolMode:n,annotationMode:o}=this.injection.viewer.getViewerConfig();if("annotation"!==n)return;if("select"===o||"erase"===o||"stamp"===o)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:r}=this.injection.viewer.getAnnotationConfig(),a="line"===o||"polyline"===o,l="ink"===o,h=(null===(s=r[o])||void 0===s?void 0:s.lineEnding)||Nl.lineEnding,d=r[o].lineDash||Nl.lineDash;e(a,d,h,l);}),this),t.hooks.annotationsUpdated.on((i=>{const{actions:s,uids:n}=i,o=t.getSelectedAnnotations();if(!s.includes("appearanceChanged")||1!==o.length||!n.includes(o[0].uid))return;if("ink"===o[0].type||"stamp"===o[0].type)return;const r="line"===o[0].type||"polyline"===o[0].type,a=o[0].style.lineEnding||["None","None"],l=o[0].style.lineDash||[0,0];e(r,l,a,!1);}),this);}toggleSelect(t,e){let i=this.borderStyleSelect;0===t?i=this.startLineEndingSelect:2===t&&(i=this.endLineEndingSelect);const s=i.querySelector(`.${this.selectionClass}`),n=i.querySelector(".ddv-down-arrow"),o="none"!==s.style.display,r=Ts(e)?!o:e,a=this.injection.viewer.context.viewService.mainContainer;o!==r&&(r?(s.style.display="block",s.style.top=`${qy(s,a)}px`,n.style.transform="rotate(180deg)"):(s.style.display="none",n.style.transform=""));}updateLineEndingSelect(t,e){(t?this.startLineEndingSelect:this.endLineEndingSelect).querySelector("div").className=`ddv-button ${e}`;}updateBorderStyleSelect(t){const e=this.borderStyleSelect,i=t.join("")||"0",s=e.querySelector("div");let n="ddv-solid";((function(t){if(0===t.length)return !0;if(1===t.length)return 0===t[0];t.length%2!=0&&(t=t.concat(t));for(let e=1;e<t.length;e+=2)if(0!==t[e])return !1;return !0}))(t)||(n=Vv[i]||"ddv-dashed-33"),s.className=`ddv-button ${n}`;}updateLineDashByData(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;(e[0].style.lineDash||[0,0]).toString()!==t.toString()&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{lineDash:t}},["appearanceChanged"]);}updateLineEndingByData(t,e){const i=this.injection.viewer.getSelectedAnnotations();if(1!==i.length)return;const s=i[0].style.lineEnding||["None","None"];t&&e===s[0]||!t&&e===s[1]||this.injection.viewer.updateAnnotation(i[0].uid,{style:{lineEnding:t?[e,s[1]]:[s[0],e]}},["appearanceChanged"]);}updateDefaultLineEnding(t,e){var i;const{annotationMode:s}=this.injection.viewer.getViewerConfig(),n=this.injection.viewer.getSelectedAnnotations(),{defaultStyleConfig:o}=this.injection.viewer.getAnnotationConfig();let r=(null===(i=o[s])||void 0===i?void 0:i.lineEnding)||Nl.lineEnding,a=s;n.length&&n[0]&&(r=n[0].style.lineEnding,a=n[0].type);const l=[...r];t?l[0]=e:l[1]=e,this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[a]:{lineEnding:l}}});}updateDefaultLineDash(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let s=e;i.length&&i[0]&&(s=i[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[s]:{lineDash:t}}});}getBaseLineDashTemplate(){const t=["ddv-solid","ddv-dashed-33","ddv-dashed-55","ddv-dashed-77","ddv-dashed-7636","ddv-dashed-54214","ddv-dashed-11555"];let e="";for(let i=0;i<t.length;i++){e+=`<button><i class="ddv-button ${t[i]}"></i></button>`;}return `<div class="${this.commonClass} ${this.lineStyleClassSmall}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${e}</div></div>`}getLineEndingTemplate(t){const e=["ddv-solid","ddv-line-closed","ddv-line-open","ddv-line-r-open","ddv-line-r-closed","ddv-line-butt","ddv-line-circle","ddv-line-diamond","ddv-line-square","ddv-line-slash"];let i="";for(let t=0;t<e.length;t++){i+=`<button><i class="ddv-button ${e[t]}"></i></button>`;}const s=t?this.startLineEndingClass:this.endLineEndingClass;return `<div class="${this.commonClass} ${s}"><div class="ddv-button ddv-solid"></div><i class="ddv-down-arrow"></i><div style="display:none;" class="${this.selectionClass}" >${i}</div></div>`}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div style="margin-top:10px">${this.getLineEndingTemplate(!0)}${this.getBaseLineDashTemplate()}${this.getLineEndingTemplate(!1)}</div></div>`;this.template=e;}}class jv extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-palette-opacity-panel"),l(this,"isPointerDown",!1),l(this,"lastPointerValue",void 0),l(this,"range",void 0),l(this,"input",void 0),l(this,"inputIsBlur",!0),l(this,"isArrowKeyPressed",!1),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.inserted.on((()=>{this.range=this.el.querySelector(".ddv-palette-opacity-range"),this.input=this.el.querySelector(".ddv-palette-opacity-input"),Jy(this.range,0,100),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent();}));}bineInputEvent(){const{input:t}=this;t.addEventListener("keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0);})),t.addEventListener("keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){const e=ar(t.value).value;e>100&&(t.value=100),e<0&&(t.value=0);let i=parseInt(t.value,10);Bs(i)||(i=100,this.updateInput(100)),this.updateDefaultOpacity(i),this.updateOpacityByData(i),this.isArrowKeyPressed=!1;}})),t.addEventListener("focus",(()=>{const e=t.value,i=ar(e).value;t.value=i,t.type="number",this.inputIsBlur=!1;})),t.addEventListener("blur",(e=>{this.inputIsBlur=!0,e.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==t.type&&(t.type="text",t.value+="%");}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="%",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);const i=ar(t.value).value;i>100&&(t.value=100),i<0&&(t.value=0);let s=parseInt(t.value,10);Bs(s)||(s=100,this.updateInput(100)),this.updateDefaultOpacity(s),this.updateOpacityByData(s);};t.addEventListener("change",e);}bindRangeEvent(){const{range:t}=this,e=()=>{const e=parseInt(t.value,10);this.updateOpacityByShape(e),this.input.value=`${e}%`;const{toolMode:i,annotationMode:s}=this.injection.viewer.getViewerConfig();"annotation"===i&&"select"!==s&&"erase"!==s&&this.updateInput(e);};t.addEventListener("click",(()=>{const e=parseInt(t.value,10);e!==this.lastPointerValue&&(this.updateOpacityByData(e),this.updateDefaultOpacity(e));})),t.addEventListener("pointerdown",(t=>{t.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox"),e();})),t.addEventListener("pointermove",(()=>{this.isPointerDown&&e();})),t.addEventListener("pointerup",(()=>{if(this.isPointerDown){const e=parseInt(t.value,10);this.lastPointerValue=e,this.updateOpacityByData(e),this.updateDefaultOpacity(e);}this.isPointerDown=!1;})),t.addEventListener("keydown",(t=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&e();})),t.addEventListener("keyup",(e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){const e=parseInt(t.value,10);this.updateOpacityByData(e),this.updateDefaultOpacity(e);}}));}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{annotationMode:t}=this.injection.viewer.getViewerConfig();if("select"===t||"erase"===t)return;const{defaultStyleConfig:e}=this.injection.viewer.getAnnotationConfig(),i=Bs(e[t].opacity)?e[t].opacity:Nl.opacity;this.updateInput(Math.round(100*i));};t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];i&&this.updateInput(Math.round(100*i.style.opacity));}),this),t.hooks.annotationsUpdated.on((e=>{const{actions:i,uids:s}=e,n=t.getSelectedAnnotations();i.includes("appearanceChanged")&&1===n.length&&s.includes(n[0].uid)&&this.updateInput(Math.round(100*n[0].style.opacity));}),this),t.hooks.annotationModeChanged.on((t=>{e();}),this),t.hooks.toolModeChanged.on((t=>{"annotation"===t.newToolMode&&e();}),this),t.hooks.annotationDefaultStyleChanged.on((e=>{const{toolMode:i,annotationMode:s}=this.injection.viewer.getViewerConfig();if("annotation"!==i)return;if("select"===s||"erase"===s)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:n}=this.injection.viewer.getAnnotationConfig(),o=Bs(n[s].opacity)?n[s].opacity:Nl.opacity;this.updateInput(100*o);}),this);}updateInput(t){let e=t;t>100&&(e=100),t<0&&(e=0),e=Math.round(e),this.range.value=`${e}`,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?e:`${e}%`;}updateOpacityByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if(!i)return;const s=100*i.style.opacity;(t=Math.round(t))!==s&&(i.style.opacity=t/100,this.injection.viewer.context.render());}updateOpacityByData(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=100*e[0].style.opacity;(t=Math.round(t))!==i&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{opacity:t/100}},["appearanceChanged"]);}updateDefaultOpacity(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let s=e;i.length&&i[0]&&(s=i[0].type),t=Math.round(t),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[s]:{opacity:t/100}}});}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof Kl&&e.isEditMode&&e.focusTexture();}}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div class="ddv-palette-opacity-range-container"><input class="ddv-palette-opacity-range" type="range" min="0" max="100" value="100"/><input class="ddv-palette-opacity-input" type="string" value="100%"/></div></div>`;this.template=e;}}const $v=[Ul.DRAFT,Ul.FINAL,Ul.VOID,Ul.REJECTED,Ul.ACCEPTED,Ul.APPROVED,Ul.NOT_APPROVED,Ul.COMPLETED,Ul.CONFIDENTIAL,Ul.INITIAL_HERE,Ul.SIGN_HERE,Ul.WITNESS];class Gv extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-palette-stamp-panel"),l(this,"select",void 0),l(this,"selectBox",void 0),l(this,"iconName",Ul.DRAFT),this.initTemplate(),this.bindHooks(),this.bindViewerHooks(),this.$on("ui_shrinkSelectionBox",(t=>{"stampIcon"!==t&&this.toggleSelect(!1);}));}bindHooks(){this.hooks.inserted.on((()=>{this.select=this.el.querySelector(".ddv-palette-stamp-icon"),this.selectBox=this.el.querySelector(".ddv-palette-stamp-icon-select"),this.bindToggleEvent(),this.bindSelectEvent();}));}bindToggleEvent(){this.select.addEventListener("click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox","stampIcon"),this.toggleSelect();}));}bindSelectEvent(){this.selectBox.addEventListener("click",(t=>{const e=t.target.value;this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{stamp:{stampIcon:e}}});}));}bindViewerHooks(){const t=this.injection.viewer,e=()=>{var e;const{toolMode:i,annotationMode:s}=t.getViewerConfig(),n=t.getAnnotationConfig();"annotation"!==i||"stamp"!==s||null!==(e=n.defaultStyleConfig)&&void 0!==e&&null!==(e=e.stamp)&&void 0!==e&&e.imageData?this.el.style.display="none":this.el.style.display="";};this.hooks.inserted.on((()=>{e();const{defaultStyleConfig:i}=t.getAnnotationConfig(),{stamp:s}=i,n=(null==s?void 0:s.stampIcon)||(null==Nl?void 0:Nl.stampIcon);this.updateStampSpan(n);})),t.hooks.annotationDefaultStyleChanged.on((t=>{e();const{stamp:i}=t,s=(null==i?void 0:i.stampIcon)||(null==Nl?void 0:Nl.stampIcon);s!==this.iconName&&this.updateStampSpan(s);}),this),t.hooks.toolModeChanged.on(e,this),t.hooks.annotationModeChanged.on(e,this);}toggleSelect(t){const e=this.select.querySelector(".ddv-down-arrow"),i="none"!==this.selectBox.style.display,s=Ts(t)?!i:t,n=this.injection.viewer.context.viewService.mainContainer;i!==s&&(s?(this.selectBox.style.display="block",this.selectBox.style.top=`${qy(this.selectBox,n)}px`,e.style.transform="rotate(180deg)"):(this.selectBox.style.display="none",e.style.transform=""));}updateStampSpan(t){this.el.getElementsByTagName("span")[1].innerText=t.slice(2),this.iconName=t;}getStampIconSelectTemplate(){let t="";for(let e=0;e<$v.length;e++){const i=$v[e];t+=`<button value="${i}">${i.slice(2)}</button>`;}return `<div class="ddv-palette-stamp-icon"><span>${Ul.DRAFT.slice(2)}</span><i class="ddv-down-arrow"></i><div class="ddv-palette-stamp-icon-select" style="display: none;">${t}</div></div>`}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span>${this.getStampIconSelectTemplate()}</div>`;this.template=e;}}const Xv=eo.displayResolution/eo.dataResolution;class Yv extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-palette-stroke-panel"),l(this,"isPointerDown",!1),l(this,"lastPointerValue",void 0),l(this,"range",void 0),l(this,"input",void 0),l(this,"inputIsBlur",!0),l(this,"isArrowKeyPressed",!1),l(this,"maxBorderWidth",20),this.maxBorderWidth=t.data.maxBorderWidth,this.maxBorderWidth<20&&(this.maxBorderWidth=20),this.initTemplate(),this.bindHooks(),this.$on("ui_changePalette_type",(t=>{this.el.style.display="stroke"===t?"":"none";}));}bindHooks(){this.hooks.inserted.on((()=>{this.range=this.el.querySelector(".ddv-palette-stroke-range"),this.input=this.el.querySelector(".ddv-palette-stroke-input"),Jy(this.range,0,this.maxBorderWidth),this.bindViewerHooks(),this.bindRangeEvent(),this.bineInputEvent();}));}bineInputEvent(){const{input:t}=this;t.addEventListener("keydown",(t=>{t.stopPropagation(),"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.isArrowKeyPressed=!0);})),t.addEventListener("keyup",(e=>{if(e.stopPropagation(),this.isArrowKeyPressed){const e=rr(t.value).value;e>this.maxBorderWidth&&(t.value=this.maxBorderWidth),e<0&&(t.value=0);let i=parseInt(t.value,10);Bs(i)||(i=1,this.updateInput(1*Xv)),this.updateDefaultBorderWidth(i),this.updateBorderWidthByData(i),this.isArrowKeyPressed=!1;}})),t.addEventListener("focus",(()=>{const e=t.value,i=parseFloat(e);t.value=i,t.type="number",this.inputIsBlur=!1;})),t.addEventListener("blur",(e=>{this.inputIsBlur=!0,e.relatedTarget instanceof HTMLInputElement||this.focusTexture(),"text"!==t.type&&(t.type="text",t.value+="pt");}));const e=()=>{if(this.inputIsBlur||this.isArrowKeyPressed)return;t.type="text",t.value+="pt",t.removeEventListener("change",e),t.blur(),t.addEventListener("change",e);const i=rr(t.value).value;i>this.maxBorderWidth&&(t.value=this.maxBorderWidth),i<0&&(t.value=0);let s=parseInt(t.value,10);Bs(s)||(s=1,this.updateInput(1*Xv)),this.updateDefaultBorderWidth(s),this.updateBorderWidthByData(s);};t.addEventListener("change",e);}bindRangeEvent(){const{range:t}=this,e=()=>{const e=rr(t.value).value;this.updateBorderWidthByShape(e),this.input.value=`${e}pt`;const{toolMode:i,annotationMode:s}=this.injection.viewer.getViewerConfig();"annotation"===i&&"select"!==s&&"erase"!==s&&this.updateInput(e*Xv);};t.addEventListener("click",(()=>{const e=rr(t.value).value;e!==this.lastPointerValue&&(this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e));})),t.addEventListener("pointerdown",(t=>{t.stopPropagation(),this.isPointerDown=!0,this.$emit("ui_shrinkSelectionBox"),e();})),t.addEventListener("pointermove",(()=>{this.isPointerDown&&e();})),t.addEventListener("pointerup",(()=>{if(this.isPointerDown){const e=rr(t.value).value;this.lastPointerValue=e,this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e);}this.isPointerDown=!1;})),t.addEventListener("keydown",(t=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&e();})),t.addEventListener("keyup",(e=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){const e=rr(t.value).value;this.updateBorderWidthByData(e),this.updateDefaultBorderWidth(e);}}));}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{annotationMode:t}=this.injection.viewer.getViewerConfig();if("select"===t||"erase"===t)return;const{defaultStyleConfig:e}=this.injection.viewer.getAnnotationConfig(),i=Bs(e[t].borderWidth)?e[t].borderWidth:Nl.borderWidth;this.updateInput(i);};t.hooks.selectedAnnotationsChanged.on((e=>{if(1!==e.newAnnotationUids.length)return;const i=t.getSelectedAnnotations()[0];i&&this.updateInput(rr(i.style.borderWidth).value,!0);}),this),t.hooks.annotationsUpdated.on((e=>{const{actions:i,uids:s}=e,n=t.getSelectedAnnotations();i.includes("appearanceChanged")&&1===n.length&&s.includes(n[0].uid)&&this.updateInput(rr(n[0].style.borderWidth).value);}),this),t.hooks.annotationModeChanged.on((t=>{e();}),this),t.hooks.toolModeChanged.on((t=>{"annotation"===t.newToolMode&&e();}),this),t.hooks.annotationDefaultStyleChanged.on((e=>{const{toolMode:i,annotationMode:s}=this.injection.viewer.getViewerConfig();if("annotation"!==i)return;if("select"===s||"erase"===s||"stamp"===s)return;if(t.getSelectedAnnotations().length)return;const{defaultStyleConfig:n}=this.injection.viewer.getAnnotationConfig(),o=Bs(n[s].borderWidth)?n[s].borderWidth:Nl.borderWidth;this.updateInput(o);}),this);}updateInput(t,e){let i=t/Xv;this.isPointerDown||e?i=Math.round(i):(i=i.toFixed(1),i.endsWith(".0")&&(i=parseInt(i,10))),this.range.value=i,this.range.dispatchEvent(new Event("change")),this.input.value="number"===this.input.type?parseFloat(i):`${i}pt`;}updateBorderWidthByShape(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=this.injection.viewer.getAnnotationObject(e[0].uid);if(!i)return;const s=t*Xv,{borderWidth:n}=i.style;n!==s&&(i.style.borderWidth=s,this.injection.viewer.context.render());}updateBorderWidthByData(t){const e=this.injection.viewer.getSelectedAnnotations();if(1!==e.length)return;const i=t*Xv,{borderWidth:s}=e[0].style;s!==i&&this.injection.viewer.updateAnnotation(e[0].uid,{style:{borderWidth:i}},["appearanceChanged"]);}updateDefaultBorderWidth(t){const{annotationMode:e}=this.injection.viewer.getViewerConfig(),i=this.injection.viewer.getSelectedAnnotations();let s=e;i.length&&i[0]&&(s=i[0].type),this.injection.viewer.updateAnnotationConfig({defaultStyleConfig:{[s]:{borderWidth:t*Xv}}});}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof Kl&&e.isEditMode&&e.focusTexture();}}initTemplate(){const{label:t}=this.data,e=`<div class="${this.defaultClass}"><span>${t}</span><div><input class="ddv-palette-stroke-range" type="range" min="0" max="${this.maxBorderWidth}" value="0"/><input class="ddv-palette-stroke-input" type="string" value="0pt"/></div></div>`;this.template=e;}}class Jv extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-palette-box"),l(this,"header",void 0),l(this,"fillSpan",void 0),l(this,"textSpan",void 0),l(this,"strokeSpan",void 0),l(this,"thumbnail",void 0),Hy.registerComponent({ColorPanel:Uv,FontPanel:Nv,LinePanel:zv,StampPanel:Gv,OpacityPanel:jv,StrokePanel:Yv}),this.bindHooks(),this.initTemplate(),this.bindViewerHooks(),this.$on("ui_changePalette_visible",(t=>{this.togglePopup(t);}));}bindHooks(){const t=t=>{this.header=this.el.querySelector(`.${this.defaultClass}-header`);const e=this.header.getElementsByTagName("span");this.textSpan=e[0],this.strokeSpan=e[1],this.fillSpan=e[2],this.bindEvents();this.injection.viewer.context.viewService.mainContainer.appendChild(this.el);const{enableDrag:i}=this.data.options;this.el.dataset.enableDrag=`${i}`,function(t){let e,i,s=!1;function n(n){if(!s)return;const o=n.clientX-e,r=n.clientY-i;t.style.left=`${t.offsetLeft+o}px`,t.style.top=`${t.offsetTop+r}px`,e=n.clientX,i=n.clientY;}function o(){s=!1,document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",o);}t.addEventListener("pointerdown",(function(r){const a=r.target;a.classList.contains("ddv-button")||"false"===t.dataset.enableDrag||a instanceof HTMLInputElement||a instanceof HTMLButtonElement||(s=!0,e=r.clientX,i=r.clientY,document.addEventListener("pointermove",n),document.addEventListener("pointerup",o));}));}(this.el);};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindEvents(){this.el.addEventListener("click",(t=>{t.stopPropagation(),this.$emit("ui_shrinkSelectionBox",t);})),this.el.addEventListener("pointerup",(t=>{t.target instanceof HTMLInputElement&&!(t.target instanceof HTMLInputElement&&"range"===t.target.type)||this.focusTexture();})),this.textSpan.addEventListener("click",(t=>{this.setPaletteType("text");})),this.fillSpan.addEventListener("click",(t=>{this.setPaletteType("fill");})),this.strokeSpan.addEventListener("click",(t=>{this.setPaletteType("stroke");}));}bindViewerHooks(){const t=this.injection.viewer,e=()=>{const{toolMode:e,annotationMode:i}=t.getViewerConfig(),s=t.getSelectedAnnotations();return !t.getPageCounts()||("annotation"!==e&&!s.length||"annotation"===e&&("select"===i||"erase"===i))},i=t=>{"stamp"===t?this.setPaletteType("stamp"):"text"===t?(this.textSpan.style.display="",this.setPaletteType("text")):(this.textSpan.style.display="none",this.setPaletteType("stroke"));};this.hooks.inserted.on((()=>{e()&&this.togglePopup(!1);})),t.hooks.beforeAnnotationEdit.on((()=>{this.togglePopup(!1);}),this),t.hooks.beforeAnnotationDraw.on((()=>{this.togglePopup(!1);}),this),t.hooks.pageChanged.on((e=>{e.total||this.togglePopup(!1);const i=t.getActiveTab();if(!i||"single"!==i.context.displayMode)return;1===t.getSelectedAnnotations().length&&this.togglePopup(!1);}),this),t.hooks.toolModeChanged.on((s=>{if(e())return void this.togglePopup(!1);const{annotationMode:n}=t.getViewerConfig();if("annotation"===s.newToolMode&&"select"!==n&&"erase"!==n&&!Ms()){const t=["textBox","textTypewriter"].includes(n);i("stamp"===n?"stamp":t?"text":"common"),this.togglePopup(!0);}}),this),t.hooks.selectedAnnotationsChanged.on((s=>{e()&&this.togglePopup(!1);const n=t.getSelectedAnnotations();if(1!==n.length)return;const o=n[0],r=["textBox","textTypewriter"].includes(o.type),a="stamp"===o.type?"stamp":r?"text":"common";i(a),("text"===a&&"textTypewriter"===o.type||"ink"===o.type)&&(this.header.style.display="none");}),this),t.hooks.annotationModeChanged.on((e=>{if(t.getSelectedAnnotations().length)return;const s=e.newAnnotationMode;if(["erase","select"].includes(s))return void this.togglePopup(!1);const n=["textBox","textTypewriter"].includes(s),o="stamp"===s?"stamp":n?"text":"common";i(o),("text"===o&&"textTypewriter"===s||"ink"===s)&&(this.header.style.display="none");const{toolMode:r}=this.injection.viewer.getViewerConfig(),a=this.injection.viewer.getPageCounts();Ms()&&"stamp"!==o?this.togglePopup(!1):this.togglePopup(a>0&&"annotation"===r);}),this);}setPaletteType(t){const{header:e,textSpan:i,strokeSpan:s,fillSpan:n}=this;if(this.$emit("ui_changePalette_type",t),"stamp"===t)return void(e.style.display="none");const{backgroundColor:o}=getComputedStyle(this.el);e.style.display="";const r=(e,i,s)=>{e.style.background=t===i?s:"",e.style.borderBottom=t===i?"none":"";};r(i,"text",o),r(s,"stroke",o),r(n,"fill",o);}togglePopup(t,e,i){const s="none"!==this.el.style.display,n=Ts(t)?!s:t;if(s===n)return;const{options:o}=this.data;n?(this.el.style.display="",null!=o&&o.positionRocked&&(this.el.style.left="",this.el.style.top="")):(this.el.style.display="none",this.$emit("ui_shrinkSelectionBox")),Ts(e)||(this.el.style.right=`${e||0}px`),Ts(i)||(this.el.style.top=`${i||0}px`),this.injection.viewer.emit("annotationPaletteToggle",n),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;if("none"===t.style.display||!t.parentElement)return !1;const i=t.getBoundingClientRect(),s=t.parentElement.getBoundingClientRect(),n=i.right-e<s.left||i.left+e>s.right,o=i.bottom-e<s.top||i.top+e>s.bottom;return n||o}(this.el)&&(this.el.style.left="",this.el.style.top="");}focusTexture(){const t=this.injection.viewer.getSelectedAnnotations();if(1===t.length){const e=this.injection.viewer.getAnnotationObject(t[0].uid);e instanceof Kl&&e.isEditMode&&e.focusTexture();}}initTemplate(){const{options:t}=this.data;sv(nv(this),this.injection.viewer,t),null!=t&&t.labels||(t.labels={}),t.labels={text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"Standard Business",...t.labels},t.style={...t.style,display:"none"};const e=`<div ${Ny(t,this.defaultClass,"")}><div class="${this.defaultClass}-header"><span>${t.labels.text}</span><span>${t.labels.stroke}</span><span>${t.labels.fill}</span></div><FontPanel :maxFontSize="options.maxFontSize"></FontPanel><ColorPanel :enableChangeColor="options.enableChangeColor" :colorList="options.colorList"></ColorPanel><StampPanel label="${t.labels.standardBusiness}"></StampPanel><OpacityPanel label="${t.labels.opacity}"></OpacityPanel><StrokePanel :maxBorderWidth="options.maxBorderWidth" label="${t.labels.stroke}"></StrokePanel><LinePanel label="${t.labels.style}"></LinePanel></div>`;this.template=e;}}l(Jv,"cpName","AnnotationPalette");class qv extends av{constructor(t){super(t,{class:"ddv-auto-capture",callback:()=>{const{viewer:t}=this.injection,{viewerMode:e}=t.getViewerConfig(),{enableAutoCapture:i}=t.getCameraConfig();e===vp.CAPTURE&&t.updateCameraConfig({enableAutoCapture:!i});}}),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()?t.getCameraConfig().enableAutoCapture?this.setUiState("focused",!Ms()):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.autoCaptureChanged.on((t=>{const e=t.enableAutoCapture?"focused":"normal";this.setUiState(e,!Ms());}),this),t.cameraPlayed.on((()=>{const{enableAutoCapture:t}=this.injection.viewer.getCameraConfig();this.setUiState(t?"focused":"normal",!Ms());}),this),t.cameraClosed.on((()=>{this.setUiState("disabled");}),this);}}l(qv,"cpName","AutoCapture");class Zv extends av{constructor(t){super(t,{class:"ddv-auto-detect",callback:()=>{const{viewer:t}=this.injection,{viewerMode:e}=t.getViewerConfig(),{enableAutoDetect:i}=t.getCameraConfig();e===vp.CAPTURE&&t.updateCameraConfig({enableAutoDetect:!i});}}),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()&&t.context.core.detectorService.enableDetect?t.getCameraConfig().enableAutoDetect?this.setUiState("focused",!Ms()):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.autoDetectChanged.on((t=>{const e=t.enableAutoDetect?"focused":"normal";this.setUiState(e,!Ms());}),this),t.cameraPlayed.on((()=>{const{core:t}=this.injection.viewer.context;if(!t.detectorService.enableDetect)return;const{enableAutoDetect:e}=this.injection.viewer.getCameraConfig();this.setUiState(e?"focused":"normal",!Ms());}),this),t.cameraClosed.on((()=>{this.setUiState("disabled");}),this);}}l(Zv,"cpName","AutoDetect");class Qv extends av{constructor(t){super(t,{class:"ddv-capture-image",callback:()=>{if(this.isCapturing)return;const t=this.injection.viewer;this.isCapturing=!0,this.setUiState("disabled"),t.capture().finally((()=>{this.isCapturing=!1,this.setUiState("normal");}));}}),l(this,"isCapturing",!1),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{this.setUiState(this.injection.viewer.isVideoPlaying()?"normal":"disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.cameraPlayed.on((()=>{this.setUiState("normal");}),this),t.cameraClosed.on((()=>{this.setUiState("disabled");}),this);}}l(Qv,"cpName","Capture");class Kv extends av{constructor(t){super(t,{class:"ddv-camera-flashlight",callback:()=>{const{viewer:t}=this.injection;t.cameraContext.turnOnTheTorch?t.turnOffTorch():t.turnOnTorch();}}),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{const{viewer:t}=this.injection;t.isVideoPlaying()&&t.cameraContext.torchSupported?t.cameraContext.turnOnTheTorch?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){this.injection.viewer.hooks.torchChanged.on((t=>{switch(t.torchState){case"supported":case"off":this.setUiState("normal");break;case"on":this.setUiState("focused",!Ms());break;default:this.setUiState("disabled");}}),this);}}l(Kv,"cpName","Flashlight");class tx extends av{constructor(t){super(t,{class:"ddv-camera-convert",callback:()=>{const{viewer:t}=this.injection;t.cameraContext.convertCamera();}}),this.bindViewerHooks();}bindDefaultUi(){const t=()=>{const t=this.injection.viewer;t.isVideoPlaying()?this.setUiState(t.cameraContext.canFrontCamera?"normal":"disabled"):this.setUiState("disabled");};this.hooks.inserted.on(t),this.hooks.updated.on(t);}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.cameraPlayed.on((()=>{const t=this.injection.viewer.cameraContext.canFrontCamera;this.setUiState(t?"normal":"disabled");}),this),t.cameraClosed.on((()=>{this.setUiState("disabled");}),this);}}l(tx,"cpName","CameraConvert");const ex=[{label:" 720P",value:{width:1280,height:720}},{label:" 1080P",value:{width:1920,height:1080}},{label:" 1440P",value:{width:2560,height:1440}},{label:" 2160P",value:{width:3840,height:2160}}];class ix extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-resolution"),l(this,"cssPrefix",`${this.defaultClass}-`),l(this,"checkedClassName",`${this.cssPrefix}checkbox-checked`),l(this,"resolutionOptions",[]),l(this,"isFirstClick",!0),l(this,"fakeResolution",!1),l(this,"lastCheckIndex",0),l(this,"box",void 0),this.bindHooks(),this.initTemplate(),Zy(this);}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}box`),this.box.style.display="none",this.box.remove(),this.updateResolution(),this.bindEvents(),this.bindViewerHooks(),this.bindEventsEmitter(),tv(this.el,!0);})),this.hooks.updated.on((()=>{this.box.style.display="none",this.isFirstClick=!0,this.injection.viewer.isVideoPlaying()||tv(this.el,!0);}));}bindEvents(){const t=this.box.getElementsByTagName("ul")[0];this.nativeOn(this.el,"click",(()=>{const t=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(iv(t,this.el,this.box),this.isFirstClick=!1);})),this.ulEvent(t);}ulEvent(t){t&&this.nativeOn(t,"click",(t=>{const e=this.injection.viewer,i=t.target,s=i.parentNode;if("LI"===i.tagName||"LI"===s.tagName){const t="LI"===i.tagName?i.value:s.value;if(t===this.lastCheckIndex)return;const{width:n,height:o}=this.resolutionOptions[t].value;this.fakeResolution=!0,e.setResolution(n,o),this.updateChecked(n,o);}this.togglePopup(!1);}));}bindViewerHooks(){const{viewer:t}=this.injection,{hooks:e}=t;e.cameraPlayed.on((t=>{if(tv(this.el,!1),this.fakeResolution)return;const{width:e,height:i}=t.resolution;this.updateChecked(e,i),this.fakeResolution=!1;}),this),e.cameraClosed.on((()=>{tv(this.el,!0);}),this),e.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1);}),this);}updateChecked(t,e){const i=function(t,e){let i=-1;const s=e.width*e.height;for(let e=0;e<t.length;e++){const{value:n}=t[e],o=n.width*n.height;if(0===e&&s<=o)return 0;if(e===t.length&&s>=o)return t.length-1;s>o&&(i=e+1);}return i}(this.resolutionOptions,{width:t,height:e}),{box:s,checkedClassName:n}=this,o=s.getElementsByClassName(`${this.cssPrefix}checkbox`)[i],r=s.getElementsByClassName(n)[0];o!==r&&(this.lastCheckIndex=i,null==o||o.classList.add(n),null==r||r.classList.remove(n));}initTemplate(){const{options:t}=this.data,{popupBox:e}=t;sv(nv(this),this.injection.viewer,t);const i=`<div ${Ny(t,`${this.defaultClass} ddv-button`)}>`+(Ts(null==t?void 0:t.label)?"":`<span>${t.label}</span>`)+'<i class="ddv-down-arrow"></i>'+`<div ${Ny(e,this.cssPrefix,"box")}><ul></ul></div></div>`;this.template=i;}getOptionTemplate(){const{options:t}=this.data;let e=ex;if(Ss(null==t?void 0:t.valueList))e=t.valueList;else {const{CameraResolution_720P:t,CameraResolution_1080P:i,CameraResolution_1440P:s,CameraResolution_2160P:n}=aw.getDisplayTextConfig(),o=[t,i,s,n];e.forEach(((t,e)=>{o[e]&&(t.label=o[e]);}));}let i="";return e.forEach(((t,e)=>{const{width:s,height:n}=t.value;Bs(s)&&Bs(n)&&(i+=[`<li value="${e}">`,`<i class="${this.cssPrefix}checkbox"></i>`,`<span>${(null==t?void 0:t.label)||""}</span>`,"</li>"].join(""));})),this.resolutionOptions=e,i}updateResolution(){const t=this.getOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=t;}togglePopup(t){const{box:e}=this,{viewer:i}=this.injection;let s="none"!==e.style.display;s=Ts(t)?!s:t,s?(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e)):e.remove(),ev(this.el,s),e.style.display=s?"":"none";}}l(ix,"cpName","CameraResolution");class sx extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-image-preview"),l(this,"cssPrefix",`${this.defaultClass}-`),l(this,"uiState",void 0),l(this,"image",void 0),l(this,"counter",void 0),l(this,"imagePageUid",void 0),l(this,"hasTask",!1),l(this,"isUpdateTask",!1),l(this,"lastPageUid",void 0),l(this,"pageTaskUids",[]),l(this,"currentTimer",void 0),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.created.on((t=>{this.setState("disabled"),this.bindViewerHooks(),this.bindEventsEmitter();})),this.hooks.inserted.on((t=>{this.image=this.el.getElementsByTagName("img")[0],this.counter=this.query(`.${this.cssPrefix}counter`);})),this.hooks.destroyed.on((()=>{clearTimeout(this.currentTimer),this.image.src&&URL.revokeObjectURL(this.image.src);}));}bindViewerHooks(){const t=this.injection.viewer,e=Ms()?10:4;t.hooks.updatePage.on((async i=>{if(i.pageUid!==this.lastPageUid)return;if(this.hasTask)return this.pageTaskUids.push(i.pageUid),void(this.isUpdateTask=!0);this.hasTask=!0;const s=t.getPageCounts(),n=await t.getPerspectivePreviewImage(s-1,400,400,e);n&&(this.image.src&&URL.revokeObjectURL(this.image.src),this.image.src=Ns(n.data).data),this.hasTask=!1,this.pageTaskUids.length>0&&this.createTask();}),this),t.hooks.pageChanged.on((async e=>{if(0===e.total)return this.image.src="",this.setState("disabled"),this.imagePageUid=void 0,void(this.lastPageUid=void 0);if(null==this||!this.counter)return;this.counter.innerText=`${e.total}`;const i=t.getActiveTab();if(!i)return;const s=i.pages[e.total-1].uid;this.pageTaskUids.push(s),this.hasTask||s!==this.lastPageUid&&this.createTask();}),this);}async createTask(){this.hasTask||(this.hasTask=!0,await this.updateImage(),this.currentTimer=setTimeout((()=>{this.hasTask=!1,0!==this.pageTaskUids.length&&this.createTask();}),300));}async updateImage(){const t=this.injection.viewer;if(!t||!t.context)return;const e=t.getActiveTab(),i=Ms()?10:4;if(!e)return;const s=e.pages.length;if(!s)return;const n=this.pageTaskUids[this.pageTaskUids.length-1],o=e.pages[s-1].uid;if(this.pageTaskUids.length=0,this.lastPageUid=e.pages[s-1].uid,this.lastPageUid===n&&this.imagePageUid===n&&!this.isUpdateTask)return;let r;this.isUpdateTask&&(this.isUpdateTask=!1);try{r=await t.getPerspectivePreviewImage(s-1,400,400,i);}catch(t){}r&&!t.isDestroy&&t.getActiveTab()&&(this.image.src&&URL.revokeObjectURL(this.image.src),this.image.src=Ns(r.data).data,this.imagePageUid=o,this.setState(s>0?"normal":"disabled"));}setState(t){this.uiState!==t&&this.el&&("normal"===t?(this.el.style.visibility="",this.el.style.pointerEvents=""):(this.el.style.visibility="hidden",this.el.style.pointerEvents="none"),this.uiState=t);}initTemplate(){const{options:t}=this.data,{imageCounter:e}=t,i=this.injection.viewer.getPageCounts();sv(nv(this),this.injection.viewer,t);const s=`<div ${Ny(t,this.defaultClass)}> <img src=""></img><div ${Ny(e,this.cssPrefix,"counter")}>${i}</div></div>`;this.template=s;}}l(sx,"cpName","ImagePreview");class nx extends av{constructor(t){super(t,{class:"ddv-load-image",callback:()=>{this.fileLoader.value=null,delete this.fileLoader.files,this.fileLoader.click();}}),l(this,"fileLoader",void 0),this.$on("ui_cropClick",(t=>{const{viewer:e}=this.injection;0!==(e.getPageCounts()||0)&&this.setUiState(t?"disabled":"normal");}));}createFileInput(){const t=document.createElement("input");return t.accept="image/png,image/jpeg,image/bmp,image/tiff,application/pdf",t.type="file",t.multiple=!0,t.addEventListener("change",(e=>{const{files:i}=t,s=i.length,n=[];for(let t=0;t<s;t++){const e=new Blob([i[t]],{type:i[t].type});if("application/pdf"===i[t].type){const t=Hu.annotationLicenseModuleIsExist();n.push({fileData:e,convertMode:Uh.CM_AUTO,renderOptions:{renderAnnotations:t?Oh.LOAD_ANNOTATIONS:Oh.NO_ANNOTATIONS}});}else n.push({fileData:e});}this.injection.viewer.context.loadSource(n),t.value=null,t.files=null;}),!0),t}bindHooks(){super.bindHooks(),this.hooks.inserted.on((()=>{const t=this.createFileInput();t.style.display="none",this.el.appendChild(t),this.fileLoader=t,this.fileLoader.addEventListener("click",(t=>{t.stopPropagation();}));}));}bindDefaultUi(){this.injection.viewer.hooks.pageExistenceChanged.on((t=>{null!=t&&t.pageCount||this.setUiState("normal");}),this);}}l(nx,"cpName","Load");class ox extends av{constructor(t){super(t,{class:"ddv-delete-all",callback:()=>{this.injection.viewer.deleteAllPages();}}),Ky(this);}}l(ox,"cpName","DeleteAll");class rx extends av{constructor(t){super(t,{class:"ddv-delete-current",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.deletePages([e]);}}),Ky(this);}}function ax(t){try{t.dispatchEvent(new MouseEvent("click"));}catch(e){const i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(i);}}function lx(t,e,i){if("download"in HTMLAnchorElement.prototype){const i=document.createElementNS("http://www.w3.org/1999/xhtml","a");e=e||t.name||"download",i.download=e,i.rel="noopener","string"==typeof t?(i.href=t,i.origin!==location.origin?function(t){const e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send();}catch(t){}return e.status>=200&&e.status<=299}(i.href)?function(t,e){const i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){lx(i.response,e);},i.onerror=function(){},i.send();}(t,e):ax(i,i.target="_blank"):ax(i)):(i.href=URL.createObjectURL(t),setTimeout((()=>{URL.revokeObjectURL(i.href);}),4e4),setTimeout((()=>{ax(i);}),0));}}l(rx,"cpName","DeleteCurrent");class hx extends av{constructor(t){super(t,{class:"ddv-button-download",callback:()=>{const t=this.injection.viewer,e=t.getActiveTab();t.context.core.fileSaveService.saveToPdf(e.doc.pages,{mimeType:"application/octet-stream",saveAnnotation:Hu.annotationLicenseModuleIsExist()?"annotation":"none"}).then((t=>{lx(t,`${e.docName}.pdf`);}));}}),Qy(this);}}l(hx,"cpName","Download");class dx extends hv{constructor(t){const{Delete_DeleteCurrent:e,Delete_DeleteAll:i}=aw.getDisplayTextConfig(),{Delete_DeleteCurrent:s,Delete_DeleteAll:n}=Yy;t.data.options={...t.data.options,children:[{type:"DeleteCurrent",label:e,id:s},{type:"DeleteAll",label:i,id:n}],defaultClassName:"ddv-delete-btn",showCheckIcon:!1},super(t),Ky(this);}}l(dx,"cpName","Delete");class cx extends av{constructor(t){super(t,{class:"ddv-print-page",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex(),i=t.getActiveTab(),{displayMode:s}=i.context;"single"===s?t.context.core.printPages(i.uid,[e]):t.context.core.printPages(i.uid);}}),Qy(this);}}l(cx,"cpName","Print");class ux extends av{constructor(t){super(t,{class:"ddv-crop-current",callback:()=>{this.cropEvent();}});}bindDefaultUi(){px(this);}cropEvent(){const t=this.injection.viewer,e=t.getRectBox(),i=t.getCurrentPageIndex();e&&t.cropPages(e,[i]);}}function px(t){const e=t.injection.viewer,i=i=>{const s=Ts(null==i?void 0:i.pageCount)?e.getPageCounts():i.pageCount,n=e.getRectBox();s&&n?t.setUiState("normal"):t.setUiState("disabled");};t.hooks.inserted.on(i),t.hooks.updated.on(i),e.hooks.pageExistenceChanged.on(i,t),e.hooks.cropRectDrawn.on((e=>{t.setUiState("normal");}),t),e.hooks.cropRectDeleted.on((e=>{t.setUiState("disabled");}),t);}l(ux,"cpName","CropCurrent");class gx extends av{constructor(t){super(t,{class:"ddv-crop-all",callback:()=>{this.cropEvent();}});}bindDefaultUi(){px(this);}cropEvent(){const{viewer:t}=this.injection,e=t.getRectBox(),i=t.getCropIndices();e&&t.cropPages(e,i);}}l(gx,"cpName","CropAll");class fx extends av{constructor(t){super(t,{class:"ddv-perspective",callback:()=>{this.perspectiveEvent();}});}perspectiveEvent(){const{viewer:t}=this.injection;t.perspectiveAllPage();}}l(fx,"cpName","PerspectiveAll");class mx extends av{constructor(t){super(t,{class:"ddv-full-quad",callback:()=>{this.toggleFull();}}),this.bindViewerHooks();}toggleFull(){const{viewer:t}=this.injection;t.toggleFullPerspective();}bindViewerHooks(){const{hooks:t}=this.injection.viewer;t.perspectiveQuadChanged.on((t=>{this.isFocused=t.isFull||!1,this.setUiState(t.isFull?"focused":"normal",!Ms());}),this);}}l(mx,"cpName","FullQuad");class yx extends av{constructor(t){super(t,{class:"ddv-redo-page",callback:()=>{this.injection.viewer.redo();}}),this.$on("ui_cropClick",(()=>{const t=this.injection.viewer.getOperationState().redo>0?"normal":"disabled";this.setUiState(t);}));}bindDefaultUi(){vx("redo",this);}}function vx(t,e){const{viewer:i}=e.injection,s=()=>{const s=i.getOperationState(),n=("redo"===t?s.redo:s.undo)>0?"normal":"disabled";e.setUiState(n);};e.hooks.inserted.on(s),e.hooks.updated.on(s);i.hooks.operationsChanged.on((i=>{let s="disabled";s="redo"===t?i.redo>0?"normal":"disabled":i.undo>0?"normal":"disabled",e.setUiState(s);}),e);}l(yx,"cpName","Redo");class xx extends av{constructor(t){super(t,{class:"ddv-restore-page",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.reset(e);}}),Ky(this);}}l(xx,"cpName","Restore");class wx extends av{constructor(t){super(t,{class:"ddv-rotate-left",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.rotatePages(-90,[e]);}}),Ky(this);}}l(wx,"cpName","RotateLeft");class bx extends av{constructor(t){super(t,{class:"ddv-rotate-right",callback:()=>{const{viewer:t}=this.injection,e=t.getCurrentPageIndex();t.rotatePages(90,[e]);}}),Ky(this);}}l(bx,"cpName","RotateRight");class Cx extends av{constructor(t){super(t,{class:"ddv-undo-page",callback:()=>{this.injection.viewer.undo();}}),this.$on("ui_cropClick",(()=>{const t=this.injection.viewer.getOperationState().undo>0?"normal":"disabled";this.setUiState(t);}));}bindDefaultUi(){vx("undo",this);}}l(Cx,"cpName","Undo");class Sx extends lv{constructor(t){super(t),this.defaultClass="ddv-crop",this.initPullDownBox(),this.initTemplate(),this.initHooks();}initHooks(){const t=this.injection.viewer;t.hooks.toolModeChanged.on((t=>{const e="crop"===t.newToolMode;this.injection.viewer.getPageCounts()>0&&(this.setUiState(e?"focused":"normal"),this.togglePopup(e),this.isFirstClick&&e&&this.el.click()),this.$emit("ui_cropClick",e),this.$emit("ui_toolModeRefactor");}),this),t.hooks.cropRectDrawn.on((()=>{tv(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!1);}),this),t.hooks.pageChanged.on((()=>{tv(this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1],!this.injection.viewer.getRenderedRectBoxCount());}),this);}bindPullDownBoxEvents(){const{viewer:t}=this.injection,e=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`),i=this.pullDownBox.getElementsByTagName("input")[1],s=this.pullDownBox.getElementsByTagName("input")[0],n=e.children[0],o=e.children[1],r=()=>{this.togglePopup(!1),t.updateViewerConfig({toolMode:"pan",canvasStyle:{cursor:"default"}});};this.nativeOn(o,"click",(()=>{const e=t.getRectBox(),i=t.getCropIndices();e&&(t.cropPages(e,i),r());})),this.nativeOn(n,"click",r),this.nativeOn(this.el,"click",(()=>{const e=t.rootDom,i=this.pullDownBox.querySelector(`.${this.defaultClass}-buttonGroup`).children[1];t.updateViewerConfig({toolMode:"crop"}),this.togglePopup(!0),this.setUiState("focused"),this.$emit("ui_cropClick",!0),this.$emit("ui_toolModeRefactor");tv(i,!t.getRectBox()),this.isFirstClick&&(iv(e,this.el,this.pullDownBox),this.isFirstClick=!1);})),this.nativeOn(i,"change",(()=>{t.cropMode="all";})),this.nativeOn(s,"change",(()=>{t.cropMode="current";}));}bindPopupSwitchEvent(){}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{toolMode:e}=t.getViewerConfig();let i="disabled";t.getPageCounts()>0?("crop"===e&&this.el.click(),i=""===this.pullDownBox.style.display?"focused":"normal"):this.togglePopup(!1),this.setUiState(i);};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){}initTemplate(){const{defaultClass:t}=this,{options:e}=this.data,{popupBox:i}=e,{postfix:s,cropMode:n}=this.injection.viewer,{Crop_CropCurrent:o,Crop_CropAll:r,Crop_CropApply:a,Crop_CropCancel:l}=aw.getDisplayTextConfig(),{Crop_CropCurrent:h,Crop_CropAll:d,Crop_CropApply:c,Crop_CropCancel:u}=Yy,p="current"===n?'checked="checked"':"",g="all"===n?'checked="checked"':"";sv(nv(this),this.injection.viewer,e);const f=`<div ${Ny(e,`ddv-button ${t}`)}>`+(Ts(null==e?void 0:e.label)?"":`<span>${e.label}</span>`)+`<div ${Ny(i,`${t}-box`)}><div>`+`<input ${p} type="radio" id="${h+s}" name="cropType" value="cropCurrent" />`+`<label for="${h+s}">${o}</label>`+`<input ${g} type="radio" id="${d+s}" name="cropType" value="cropAll" />`+`<label for="${d+s}">${r}</label></div>`+`<div class= "${t}-buttonGroup">`+`<div id="${u+s}"><span>${l}</span></div>`+`<div id="${c+s}"><span>${a}</span></div></div></div></div>`;this.template=f;}}l(Sx,"cpName","Crop");class Px extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-filter-item"),l(this,"cssPrefix",`${this.defaultClass}-`),l(this,"checkedClass",`${this.cssPrefix}checked`),this.initTemplate(),this.bindHooks();}bindHooks(){this.hooks.created.on((t=>{this.bindEvents();})),this.hooks.inserted.on((()=>{this.bindFilterEvents();}));}bindEvents(){const{el:t}=this;this.nativeOn(t,"click",(()=>{if(""===this.el.getElementsByTagName("img")[0].getAttribute("src"))return;const{itemValue:t}=this.data;this.$emit("ui_filterClick",t.type);}));}bindFilterEvents(){this.$on("ui_filterReset",(t=>{this.resetSelect(t.currentFilter);const{filterList:e}=t,{itemValue:i}=this.data,s=this.el.getElementsByTagName("img")[0];e.forEach((t=>{if(t.type===i.type){let e="";t.imageData&&(e=Ns(t.imageData).data),s.src=e;}}));})),this.$on("ui_filterLoading",(t=>{const e=this.el.getElementsByTagName("img")[0],i=this.el.getElementsByTagName("div")[0];e.style.display=t?"none":"",i.style.display=t?"":"none",this.el.style.pointerEvents=t?"none":"";})),this.injection.viewer.hooks.filterChanged.on((t=>{this.resetSelect(t.filterType);}),this);}resetSelect(t){const{itemValue:e}=this.data;t===e.type?this.el.classList.add(this.checkedClass):this.el.classList.remove(this.checkedClass);}initTemplate(){const{options:t,itemValue:e}=this.data,i=`<div ${Ny(t,this.defaultClass)}><img src=""></img><div class="ddv-filter-loading" style="display:none"></div><span>${e.label}</span></div>`;this.template=i;}}const Ax=[{type:"none",label:"Original"}];class Tx extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-filter"),l(this,"cssPrefix",`${this.defaultClass}-`),l(this,"isFirstClick",!0),l(this,"box",void 0),l(this,"applyAll",!1),l(this,"filterList",void 0),l(this,"filterUpdateStatus",!1),l(this,"enableFilter",!1),l(this,"uiState","normal"),this.bindHooks(),this.initTemplate(),this.bindDefaultUi(),Zy(this);const{filterService:e}=this.injection.viewer.context.core;e.enableFilter&&(this.enableFilter=!0,Ky(this),this.bindViewerHooks(),this.bindFilterEvents(),this.bindViewerResized()),Hy.registerComponent({FilterItem:Px});}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}list`),this.box.style.display="none",this.box.remove(),this.bindNativeEvents();})),this.hooks.updated.on((()=>{this.uiState="normal";}));}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{box:t}=this,e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:iv(i,this.el,this.box);}),this);}bindViewerHooks(){const t=this.injection.viewer;t.hooks.pageChanged.on((async e=>{if(0===e.total)return this.filterUpdateStatus=!0,void this.togglePopup(!1);const i=t.context.getActiveTab();if(!i||!this.box)return;const{currentUid:s,oldCurrentUid:n}=i;n!==s&&(this.filterUpdateStatus=!0,this.togglePopup(!1));}),this),t.hooks.updatePage.on((e=>{var i;const s=t.context.getActiveTab();s&&this.box&&(null===(i=s.getCurrentPage())||void 0===i?void 0:i.uid)===e.pageUid&&(this.filterUpdateStatus=!0,this.togglePopup(!1));}),this),t.hooks.visibleChanged.on((t=>{"hidden"===t.newVisibility&&this.togglePopup(!1);}),this);}bindNativeEvents(){const{el:t,box:e}=this,i=e.querySelector(`.${this.cssPrefix}list-header`),s=i.getElementsByTagName("span")[0],n=i.getElementsByTagName("div")[0];this.nativeOn(t,"click",(async t=>{if(this.togglePopup(),this.isFirstClick){iv(this.injection.viewer.rootDom,this.el,this.box),this.isFirstClick=!1;}})),this.nativeOn(e,"click",(t=>{t.stopPropagation();})),this.nativeOn([s,n],"click",(()=>{if(this.clickApplyToAll(),this.applyAll){const{viewer:t}=this.injection,e=t.getPageCounts(),i=t.getCurrentPageUid(),s=t.context.core.pageService.getPage(i);t.filter(Array.from(Array(e).keys()),s.filter);}}));}bindFilterEvents(){this.$on("ui_filterClick",(t=>{const{viewer:e}=this.injection,i=e.getPageCounts();if(i<1)return;let s=Array.from(Array(i).keys());if(!this.applyAll){const i=e.getCurrentPageUid();if(e.context.core.pageService.getPage(i).fileIndex===t)return;s=[e.getCurrentPageIndex()];}e.filter(s,t);}));}clickApplyToAll(t){const e=this.injection.viewer,i=Yy.Filter_FilterAll+e.postfix,s=document.getElementById(i);if(Ts(t))return this.applyAll?s.classList.remove(`${this.cssPrefix}checked`):s.classList.add(`${this.cssPrefix}checked`),void(this.applyAll=!this.applyAll);t?s.classList.add(`${this.cssPrefix}checked`):s.classList.remove(`${this.cssPrefix}checked`),this.applyAll=t;}async updateFilterPreview(){const t=this.injection.viewer,e=t.getCurrentPageUid(),i=await t.context.core.imageDataService.getOriginal(e);if(!i)return;this.$emit("ui_filterLoading",!0);const s=[],n=t.context.core.pageService.getPage(e);let o;try{o=await t.context.core.processService.resize(i.data,3,i.width,i.height,200);}catch(t){}for(let e=0;e<this.filterList.length;e++){const n=this.filterList[e];if("none"===n.type)s.push({type:"none",imageData:i.data});else {let e;try{var r;o&&null!==(r=o)&&void 0!==r&&r.data&&(e=await t.context.core.filterService.applyFilter({data:o.data,type:Wn.JPEG,width:o.width,height:o.height},n.type));}catch(t){e=null;}s.push({type:n.type,imageData:e});}}this.$emit("ui_filterLoading",!1),this.$emit("ui_filterReset",{currentFilter:n.filter||"none",filterList:s}),this.filterUpdateStatus=!1;}initTemplate(){var t;const e=this.data,{options:i}=e,{popupBox:s,filterHeader:n,filterContent:o,valueList:r}=i,{filterService:a}=this.injection.viewer.context.core,l=Yy.Filter_FilterAll+this.injection.viewer.postfix;sv(nv(this),this.injection.viewer,i);const h=(null===(t=aw.getDisplayTextConfig())||void 0===t?void 0:t.Filter_FilterAll)||"Apply to All";e.valueList=r||Ax,a.enableFilter&&(e.valueList=a.getSupportedFilters()),this.filterList=e.valueList;const d=`<div ${Ny(i,`ddv-button ${this.defaultClass}`)}>`+(Ts(null==i?void 0:i.label)?"":`<span>${i.label}</span>`)+'<i class="ddv-down-arrow"></i>'+`<div ${Ny(s,this.cssPrefix,"list")}>`+`<div id="${l}"`+`${Ny(n,this.cssPrefix,"list-header")}><div></div>`+`<span>${h}</span></div>`+`<div ${Ny(o,this.cssPrefix,"list-content")}><FilterItem :for="item in valueList":options="options.filterItem" :itemValue="item"></FilterItem></div></div></div>`;this.template=d;}async togglePopup(t){const{box:e}=this,{viewer:i}=this.injection;let s="none"===e.style.display;s=Ts(t)?!s:!t,s?e.remove():(this.$emit("ui_hidePopup",this),i.rootDom.appendChild(e),this.filterUpdateStatus&&this.updateFilterPreview()),ev(this.el,!s),e.style.display=s?"none":"";}bindDefaultUi(){const t=this.injection.viewer,e=()=>{let e="normal";0!==t.getPageCounts()&&this.enableFilter||(e="disabled"),rv(this,e);};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}l(Tx,"cpName","Filter");class kx extends av{constructor(t){super(t,{class:"ddv-button-blank",callback:()=>{}});}bindDefaultUi(){}}class Dx extends av{constructor(t){super(t,{class:"ddv-button-close",callback:()=>{}});}bindDefaultUi(){}}l(Dx,"cpName","Close");class Ex extends av{constructor(t){super(t,{class:"ddv-button-back",callback:()=>{}});}bindDefaultUi(){}}l(Ex,"cpName","Back");class Ix extends av{constructor(t){super(t,{class:"ddv-button-done",callback:()=>{}});}bindDefaultUi(){}}l(Ix,"cpName","Done");const Rx=[{displayName:"continuous",className:"ddv-continuous-mode"},{displayName:"single",className:"ddv-single-mode"}];class Mx extends hv{constructor(t){const{DisplayMode_ContinuousPage:e,DisplayMode_SinglePage:i}=aw.getDisplayTextConfig(),{DisplayMode_ContinuousPage:s,DisplayMode_SinglePage:n}=Yy;t.data.options={...t.data.options,children:[{type:"ContinuousPage",label:e,id:s},{type:"SinglePage",label:i,id:n}],defaultClassName:"ddv-display-mode",showCheckIcon:!0},super(t),Ky(this);}updateUiState(t){const{el:e}=this;Rx.forEach(((i,s)=>{t===i.displayName?(e.classList.add(i.className),this.selectChildren(s)):e.classList.remove(i.className);}));}bindDefaultUi(){super.bindDefaultUi();const t=this.injection.viewer,e=()=>{const{displayMode:e}=t.getViewerConfig();this.updateUiState(e);};t.hooks.displayModeChanged.on((t=>{this.updateUiState(t.newDisplayMode);}),this),t.hooks.openDocument.on((()=>{const e=t.context.getActiveTab();e&&this.updateUiState(e.context.displayMode);}),this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}l(Mx,"cpName","DisplayMode");class Bx extends av{constructor(t,e){super(t,{class:e.class,callback:()=>{this.injection.viewer.updateViewerConfig({displayMode:e.displayMode});}}),l(this,"displayMode",void 0),this.displayMode=e.displayMode,Ky(this);}bindDefaultUi(){const t=this.injection.viewer,e=e=>{var i;const s=t.getActiveTab(),n=(null==e?void 0:e.pageCount)||t.getPageCounts(),o=(null==s||null===(i=s.context)||void 0===i?void 0:i.displayMode)||t.getViewerConfig().displayMode;n?o===this.displayMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.displayModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}class Lx extends Bx{constructor(t){super(t,{class:"ddv-continuous-mode",displayMode:"continuous"});}}l(Lx,"cpName","ContinuousPage");class Ux extends Bx{constructor(t){super(t,{class:"ddv-multiple-mode",displayMode:"multiple"});}}l(Ux,"cpName","MultiPage");class Ox extends Bx{constructor(t){super(t,{class:"ddv-single-mode",displayMode:"single"});}}l(Ox,"cpName","SinglePage");const _x=[{displayName:"window",className:"ddv-fit-window"},{displayName:"width",className:"ddv-fit-width"},{displayName:"height",className:"ddv-fit-height"},{displayName:"actualSize",className:"ddv-fit-actual"}];class Nx extends hv{constructor(t){const{FitMode_FitWindow:e,FitMode_FitWidth:i,FitMode_FitHeight:s,FitMode_ActualSize:n}=aw.getDisplayTextConfig(),{FitMode_FitWindow:o,FitMode_FitWidth:r,FitMode_FitHeight:a,FitMode_ActualSize:l}=Yy;t.data.options={...t.data.options,children:[{type:"FitWindow",label:e,id:o},{type:"FitWidth",label:i,id:r},{type:"FitHeight",label:s,id:a},{type:"ActualSize",label:n,id:l}],defaultClassName:"ddv-fit-type",showCheckIcon:!0},super(t),Ky(this);}updateUiState(t){const{el:e}=this;"none"!==t?_x.forEach(((i,s)=>{t===i.displayName?(e.classList.add(i.className),this.selectChildren(s)):e.classList.remove(i.className);})):this.selectChildren(-1);}bindDefaultUi(){super.bindDefaultUi();const t=this.injection.viewer,e=()=>{const{fitMode:e}=t.getViewerConfig();this.updateUiState(e);};t.hooks.fitModeChanged.on((t=>{this.updateUiState(t.newFitMode);}),this),t.hooks.openDocument.on((()=>{const e=t.context.getActiveTab();e&&this.updateUiState(e.context.fitMode);}),this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}l(Nx,"cpName","FitMode");class Wx extends av{constructor(t,e){super(t,{class:e.class,callback:()=>{const{viewer:t}=this.injection;t.updateViewerConfig({fitMode:e.fitMode});}}),l(this,"fitMode",void 0),this.fitMode=e.fitMode,Ky(this);}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const e=t.getPageCounts(),i=t.getActiveTab();let{fitMode:s}=t.getViewerConfig();i&&(s=i.context.fitMode);const n=e>0&&s===this.fitMode;e>0?n?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),t.hooks.fitModeChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}}class Fx extends Wx{constructor(t){super(t,{class:"ddv-fit-height",fitMode:"height"});}}l(Fx,"cpName","FitHeight");class Hx extends Wx{constructor(t){super(t,{class:"ddv-fit-width",fitMode:"width"});}}l(Hx,"cpName","FitWidth");class Vx extends Wx{constructor(t){super(t,{class:"ddv-fit-window",fitMode:"window"});}}l(Vx,"cpName","FitWindow");class zx extends Wx{constructor(t){super(t,{class:"ddv-fit-actual",fitMode:"actualSize"});}}l(zx,"cpName","ActualSize");class jx extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-main-canvas"),this.initTemplate(),this.bindHooks();}bindHooks(){const{inserted:t}=this.hooks;t.on((()=>{var t;null===(t=this.injection.viewer)||void 0===t||t.context.viewService.bindContainer(this.el);}));}initTemplate(){const{options:t}=this.data;t.id=t.id||`ddvMainView${this.injection.viewer.postfix}`;const e=`<div ${Ny(t,this.defaultClass,"")} ><slot></slot></div>`;this.template=e;}}l(jx,"cpName","MainView");class $x extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-pagination"),l(this,"cssPrefix",`${this.defaultClass}-`),l(this,"uiState","normal"),l(this,"input",void 0),l(this,"totalSpan",void 0),this.initTemplate(),this.bindHooks(),this.bindDefaultUi();}bindHooks(){this.hooks.created.on((t=>{this.bindEvents(),this.input=this.query(`.${this.cssPrefix}goto`),this.totalSpan=this.query(`.${this.cssPrefix}total`);}));}bindEvents(){const t=this.injection.viewer,e=this.query(`.${this.cssPrefix}goto`);this.nativeOn(e,"input",(t=>{Gx(e,this.totalSpan.clientWidth);})),this.nativeOn(e,"blur",(()=>{const i=t.getPageCounts(),s=t.getCurrentPageIndex();let n=parseInt(e.value,10);Bs(n)?n<1?n=1:n>i&&(n=i):n=s+1,e.value=`${n}`,Gx(e),t.gotoPage(n-1);})),this.nativeOn(e,"keydown",(t=>{t.stopPropagation(),"Enter"===t.key&&e.blur();}));}setState(t){this.uiState!==t&&this.el&&("normal"===t?this.el.classList.remove(`${this.cssPrefix}disabled`):this.el.classList.add(`${this.cssPrefix}disabled`),this.uiState=t);}bindDefaultUi(){const t=this.injection.viewer,e=e=>{const i=Ts(null==e?void 0:e.total)?t.getPageCounts():null==e?void 0:e.total,s=Ts(null==e?void 0:e.current)?t.getCurrentPageIndex():null==e?void 0:e.current;this.setState(i>0?"normal":"disabled"),this.input.value=`${s+1}`,this.totalSpan.innerText=`${i}`,Gx(this.input,this.totalSpan.clientWidth);};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on((()=>{this.uiState="normal",e(null);}));}initTemplate(){const{options:t}=this.data,{gotoPage:e,total:i,separator:s}=t,{cssPrefix:n,injection:o,defaultClass:r}=this,{viewer:a}=o,l=a.getCurrentPageIndex()+1,h=a.getPageCounts(),d=`<div ${Ny(t,r,"")}><FirstPage :options="options.firstPage"></FirstPage><PrevPage :options="options.prevPage"></PrevPage><input ${Ny(e,n,"goto")} value="${l}" type="number" ><div ${Ny(s,n,"separator")}></div><span ${Ny(i,n,"total")} >${h}</span><NextPage :options="options.nextPage"></NextPage><LastPage :options="options.lastPage"></LastPage></div>`;this.template=d;}}function Gx(t,e){const{fontSize:i,width:s}=getComputedStyle(t);let n=function(t,e){const i=document.createElement("span");i.innerText=t,i.style.fontSize=e,i.style.position="absolute",i.style.top="0px",i.style.visibility="hidden",document.body.appendChild(i);const s=i.offsetWidth;return i.remove(),s}(t.value,i);Ts(e)||0===e||(n=Math.min(e+10,n));const o=`${n+3}px`;s!==o&&(t.style.width=o);}l($x,"cpName","Pagination");class Xx extends av{constructor(t,e){super(t,{class:e.class,callback:e.callback}),l(this,"type",void 0),this.type=e.type;}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const e=t.getPageCounts(),i=t.getCurrentPageIndex();let s=!1;switch(this.type){case"previous":case"first":s=e>0&&0!==i;break;case"last":case"next":s=i<e-1;}0===e&&(s=!1),this.setUiState(s?"normal":"disabled");};this.hooks.inserted.on(e),this.hooks.updated.on(e),t.hooks.pageChanged.on(e,this);}}class Yx extends Xx{constructor(t){super(t,{class:"ddv-first-page",type:"first",callback:()=>{this.injection.viewer.gotoPage(0);}});}}l(Yx,"cpName","FirstPage");class Jx extends Xx{constructor(t){super(t,{class:"ddv-last-page",type:"last",callback:()=>{const t=this.injection.viewer,e=t.getPageCounts();t.gotoPage(e-1);}});}}l(Jx,"cpName","LastPage");class qx extends Xx{constructor(t){super(t,{class:"ddv-next-page",type:"next",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.gotoPage(e+1);}});}}l(qx,"cpName","NextPage");class Zx extends Xx{constructor(t){super(t,{class:"ddv-prev-page",type:"previous",callback:()=>{const t=this.injection.viewer,e=t.getCurrentPageIndex();t.gotoPage(e-1);}});}}l(Zx,"cpName","PrevPage");class Qx extends av{constructor(t){super(t,{class:"ddv-thumbnail-switch",callback:()=>{const{thumbnail:t}=this;if(!t)return;const{visibility:e}=t.getViewerConfig();t.updateViewerConfig({visibility:"visible"===e?"hidden":"visible"});}}),l(this,"thumbnail",void 0),this.injection.viewer.on("thumbnailBind",(t=>{if(this.thumbnail)return;const e=this.injection.viewer.context.core.getViewer(t);e&&(this.thumbnail=e,this.bindThumbnailHooks(e));const{visibility:i}=e.getViewerConfig();this.setUiState("visible"===i?"focused":"normal",!Ms());})),this.injection.viewer.hooks.destroy.on((()=>{this.thumbnail=null;}),this);}bindThumbnailHooks(t){t.hooks.visibleChanged.on((t=>{this.setUiState("visible"===t.newVisibility?"focused":"normal",!Ms());}),this);}bindDefaultUi(){const t=()=>{if(!this.thumbnail)return;const{visibility:t}=this.thumbnail.getViewerConfig();this.setUiState("visible"===t?"focused":"normal",!Ms());};this.injection.viewer.hooks.pageExistenceChanged.on(t,this),this.hooks.updated.on(t);}}l(Qx,"cpName","ThumbnailSwitch");class Kx extends av{constructor(t,e){super(t,{class:e.class,callback:()=>{this.injection.viewer.updateViewerConfig({toolMode:e.toolMode,canvasStyle:{cursor:e.cursor}});}}),l(this,"toolMode",void 0),this.toolMode=e.toolMode,this.bindViewerHooks();}bindDefaultUi(){const t=this.injection.viewer,e=()=>{const{toolMode:e}=t.getViewerConfig();t.getPageCounts()>0?e===this.toolMode?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");};t.hooks.pageExistenceChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const t=this.injection.viewer;t.hooks.toolModeChanged.on((e=>{const i=e.newToolMode===this.toolMode;t.getPageCounts()>0?i?this.setUiState("focused"):this.setUiState("normal"):this.setUiState("disabled");}),this);}}class tw extends Kx{constructor(t){super(t,{class:"ddv-pan-mode",toolMode:"pan",cursor:"default"});}}l(tw,"cpName","Pan");l(class extends Kx{constructor(t){super(t,{class:"ddv-zoom-mode",toolMode:"zoomIn",cursor:"zoom-in"});}},"cpName","ZoomMode");class ew extends Kx{constructor(t){super(t,{class:"ddv-crop-mode",toolMode:"crop",cursor:"crosshair"});}}l(ew,"cpName","CropMode");class iw extends av{constructor(t){super(t,{class:"ddv-zoom-in",callback:()=>{this.injection.viewer.zoomIn();}}),this.bindViewerHooks(),Ky(this);}bindViewerHooks(){const t=this.injection.viewer;t.hooks.zoomChanged.on((e=>{const{maxZoom:i}=t.getViewerConfig();t.getPageCounts()<1||e.newZoomRatio>=i?this.setUiState("disabled"):this.setUiState("normal");}),this);}}l(iw,"cpName","ZoomIn");class sw extends av{constructor(t){super(t,{class:"ddv-zoom-out",callback:()=>{this.injection.viewer.zoomOut();}}),this.bindViewerHooks(),Ky(this);}bindViewerHooks(){const t=this.injection.viewer;t.hooks.zoomChanged.on((e=>{const{minZoom:i}=t.getViewerConfig();t.getPageCounts()<1||e.newZoomRatio<=i?this.setUiState("disabled"):this.setUiState("normal");}),this);}}l(sw,"cpName","ZoomOut");class nw extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-zoom-controller"),Hy.registerComponent({ZoomIn:iw,ZoomOut:sw}),this.initTemplate();}initTemplate(){const{options:t}=this.data;sv(nv(this),this.injection.viewer,t);const e=`<div ${Ny(t,this.defaultClass)}><ZoomOut :options:"options.ZoomOut"></ZoomOut><ZoomByPercentage :options:"options.ZoomByPercentage"></ZoomByPercentage><ZoomIn :options:"options.ZoomIn"></ZoomIn></div>`;this.template=e;}}l(nw,"cpName","Zoom");const ow=[10,25,50,75,100,125,150,200,400,800,1600,2400,3200,6400];class rw extends _y{constructor(t){super(t),l(this,"defaultClass","ddv-zoom-percentage"),l(this,"cssPrefix",`${this.defaultClass}-`),l(this,"isFirstClick",!0),l(this,"box",void 0),l(this,"uiState","normal"),this.initTemplate(),this.bindHooks(),this.bindDefaultUi(),this.bindViewerHooks(),this.bindViewerResized(),Ky(this),Zy(this),this.hooks.destroyed.on((()=>{this.dispose();}));}bindHooks(){this.hooks.created.on((t=>{this.box=this.query(`.${this.cssPrefix}selectbox`),this.box.style.display="none",this.box.remove(),this.bindEvents();})),this.hooks.inserted.on((()=>{const t=this.injection.viewer,{zoom:e}=t.getViewerConfig();this.updateZoom(e),this.updateZoomOption();})),this.hooks.updated.on((()=>{this.uiState="normal",this.box.style.display="none",this.isFirstClick=!0;}));}bindDefaultUi(){const t=this.injection.viewer,e=()=>{rv(this,0===t.getPageCounts()?"disabled":"normal"),this.updateZoom(t.getViewerConfig().zoom);};t.hooks.pageChanged.on(e,this),this.hooks.inserted.on(e),this.hooks.updated.on(e);}bindViewerHooks(){const{viewer:t}=this.injection,{hooks:e}=t;e.zoomChanged.on((t=>{this.updateZoom(t.newZoomRatio);}),this),e.visibleChanged.on((e=>{if("hidden"===e.newVisibility)return void this.togglePopup(!1);const{zoom:i}=t.getViewerConfig();this.updateZoom(i);}),this);}bindEvents(){const{el:t,box:e}=this,i=t.querySelector(`.${this.cssPrefix}selector`),s=t.getElementsByTagName("input")[0],n=e.getElementsByTagName("ul")[0];this.nativeOn(i,"click",(()=>{const t=this.injection.viewer.rootDom;this.togglePopup(),this.isFirstClick&&(iv(t,this.el,this.box,!0,!0),this.isFirstClick=!1);})),this.inputEvent(s),this.ulEvent(n);}bindViewerResized(){const{viewer:t}=this.injection;t.hooks.resize.on((()=>{const{box:t}=this,e="none"===t.style.display,i=this.injection.viewer.rootDom;e?this.isFirstClick=!0:iv(i,this.el,this.box,!0,!0);}),this);}inputEvent(t){const e=this.injection.viewer,{maxZoom:i,minZoom:s}=e.getViewerConfig();t.value=`${i}`;const n=ov(t);function o(){const n=t.value/100,o=Us(n,s,i);e.updateViewerConfig({zoom:o});}this.nativeOn(t,"input",(()=>{this.adaptInputWidth(n);})),this.nativeOn(t,"blur",o),this.nativeOn(t,"keydown",(t=>{t.stopPropagation();"Enter"===t.key&&o();}));}ulEvent(t){this.nativeOn(t,"click",(t=>{t.stopPropagation();const{viewer:e}=this.injection,{maxZoom:i,minZoom:s}=e.getViewerConfig(),n=t.target;if("LI"===n.tagName){const t=Us(n.value,100*s,100*i);e.updateViewerConfig({zoom:t/100});}this.togglePopup(!1);}));}getZoomOptionTemplate(){var t;const e=(null===(t=this.data.options)||void 0===t?void 0:t.valueList)||null,i=this.injection.viewer,{maxZoom:s,minZoom:n}=i.getViewerConfig(),o=Ss(e)?e:ow,r=n<1e-4?.01:parseFloat((100*n).toFixed(2)),a=Math.floor(100*s);o.push(r,a);const l=Array.from(new Set(o)).sort(((t,e)=>t-e));let h="";return l.forEach((t=>{Bs(t)&&t<=100*s&&t>=100*n&&(h+=`<li value="${t}">${t}%</li>`);})),h}updateZoomOption(){const t=this.getZoomOptionTemplate();this.box.getElementsByTagName("ul")[0].innerHTML=t;}updateZoom(t){const e=this.el.getElementsByTagName("input")[0],i=100*t;if(Number.isInteger(i))e.value=`${i}`;else {let t=i;t=t>=1e3?+t.toFixed(0).toString():t>=100?+t.toFixed(1).toString():t>=10?+t.toFixed(2).toString():+t.toFixed(3).toString(),e.value=`${t}`;}this.adaptInputWidth();}initTemplate(){const{options:t={}}=this.data,{input:e,selector:i,popupBox:s}=t,{cssPrefix:n}=this,{viewer:o}=this.injection;sv(nv(this),o,t);const r=`<div ${Ny(t,this.defaultClass)}><div style="display: flex"><div ${Ny(e,n,"input")}><input type="number"><span>%</span></div><div ${Ny(i,n,"selector")}><i></i></div></div><div ${Ny({id:`ddvZoomByPercentageSelectBox${o.postfix}`,...s},n,"selectbox")}><ul></ul></div></div>`;this.template=r;}adaptInputWidth(t){const e=this.el.getElementsByTagName("input")[0];let i=ov(e);t&&i>t&&(i=t),e.style.width=`${i}px`;}togglePopup(t){const{viewer:e}=this.injection,{box:i}=this;let s="none"!==i.style.display;s=Ts(t)?!s:t,s?(this.$emit("ui_hidePopup",this),e.rootDom.appendChild(i)):i.remove(),i.style.display=s?"":"none";}}l(rw,"cpName","ZoomByPercentage");class aw{static getTooltip(){return this.tooltip}static setTooltip(t){this.tooltip={...this.tooltip,...t};}static getDisplayTextConfig(){return this.displayTextConfig}static setDisplayTextConfig(t){this.displayTextConfig={...this.displayTextConfig,...t};}static registerAll(){Hy.registerComponent({Capture:Qv,Flashlight:Kv,CameraConvert:tx,CameraResolution:ix,AutoDetect:Zv,AutoCapture:qv,ImagePreview:sx,RotateLeft:wx,RotateRight:bx,Delete:dx,DeleteAll:ox,DeleteCurrent:rx,Zoom:nw,ZoomIn:iw,ZoomOut:sw,ZoomByPercentage:rw,PerspectiveAll:fx,FullQuad:mx,Restore:xx,Undo:Cx,Redo:yx,FitMode:Nx,FitWidth:Hx,FitHeight:Fx,FitWindow:Vx,ActualSize:zx,DisplayMode:Mx,SinglePage:Ox,MultiPage:Ux,ContinuousPage:Lx,Pan:tw,Print:cx,Filter:Tx,ThumbnailSwitch:Qx,Back:Ex,Done:Ix,Pagination:$x,FirstPage:Yx,LastPage:Jx,NextPage:qx,PrevPage:Zx,Root:Gy,Layout:zy,Button:Vy,MainView:jx,Load:nx,Download:hx,Close:Dx,Blank:kx,SeparatorLine:Xy,CropCurrent:ux,CropAll:gx,CropMode:ew,Crop:Sx,AnnotationSet:Pv,EllipseAnnotation:uv,EraseAnnotation:pv,InkAnnotation:gv,LineAnnotation:fv,PolygonAnnotation:mv,PolylineAnnotation:yv,RectAnnotation:vv,SelectAnnotation:xv,StampIconAnnotation:wv,StampImageAnnotation:bv,TextBoxAnnotation:Cv,TextTypewriterAnnotation:Sv,BasePullDownButton:lv,PullDownListButton:hv,PullDownMenuButton:dv,BringForward:kv,BringToFront:Dv,SendBackward:Ev,SendToBack:Iv,AnnotationToolBar:Rv,AnnotationDeleteButton:Lv,AnnotationPaletteButton:Bv,AnnotationPalette:Jv});}}l(aw,"tooltip",{}),l(aw,"displayTextConfig",{FitMode_FitWidth:"Fit Width",FitMode_FitHeight:"Fit Height",FitMode_FitWindow:"Fit Window",FitMode_ActualSize:"Actual Size",DisplayMode_SinglePage:"Single Page",DisplayMode_ContinuousPage:"Continuous Page",Crop_CropAll:"Crop All",Crop_CropCurrent:"Crop Current",Crop_CropCancel:"Cancel",Crop_CropApply:"Apply",Filter_FilterAll:"Apply to All",Delete_DeleteCurrent:"Delete current",Delete_DeleteAll:"Delete all",CameraResolution_720P:"720P",CameraResolution_1080P:"1080P",CameraResolution_1440P:"1440P",CameraResolution_2160P:"2160P"});const lw={install(t){const i=function(t){var i,r,h,d;return i=new WeakMap,r=new WeakMap,h=new WeakMap,d=new WeakSet,class extends t{constructor(t){super(t),a(this,d),l(this,"ui",void 0),l(this,"rootDom",void 0),n(this,i,!1),n(this,r,0),n(this,h,0),aw.registerAll();const e=t.viewerConfig.enableAnnotationUi?this.getPopupUiConfig({annotationToolBarConfig:(null==t?void 0:t.annotationToolBarConfig)||{},annotationPaletteConfig:(null==t?void 0:t.annotationPaletteConfig)||{}}):[];this.ui=new Hy({container:t.container,emitter:this.emitter,postfix:this.uid,uiConfig:t.uiConfig,popupUiConfig:e,injection:{viewer:this}}),t.container&&(t.uiConfig?(this.bindContainer(t.container),this.rootDom=this.ui.rootDom):this.rootDom=this.context.viewService.rootDom),this.listenNativeEventsForUi();}listenNativeEventsForUi(){this.on("click",(()=>{this.emit("ui_hidePopup","viewer");}));}getPopupUiConfig(t){return [{...t.annotationToolBarConfig,type:"AnnotationToolBar"},{colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#FFFFFF","#CECECE"],enableChangeColor:!0,enableDrag:!0,...t.annotationPaletteConfig,type:"AnnotationPalette"}]}addFontToUi(t){this.emit("ui_addFont",t);}getUiConfig(){return As(this.ui.uiConfig)}updateUiConfig(t){const{resizeService:s}=this.context.core;s&&(s.unobserve(this.ui.rootDom),o(i,this,!1));const n=this.ui.updateUiConfig(t);return this.rootDom=this.ui.rootDom,this.context.viewService.rootDom=this.rootDom,e(d,this,c).call(this,this.ui.rootDom),n}getElementsByType(t){return Ls(t)?this.ui.getElementsByType(this.ui.rootVNode,t):""}bindContainer(t){let i=t;return Ls(t)&&(i=document.querySelector(`#${t}`)),i instanceof HTMLElement&&(e(d,this,c).call(this,this.ui.rootDom),this.ui.bindContainer(i),this.context.viewService.container=i,this.context.viewService.rootDom=this.ui.rootDom,this.rootDom=this.ui.rootDom,"hidden"===this.context.viewerConfig.visibility&&(this.context.viewService.rootDom.style.display="none"),this.context.viewService.isBindContainer=!0,!0)}unbindContainer(){this.rootDom&&this.ui.container&&(this.ui.unbindContainer(),this.context.viewService.container=null,this.context.viewService.isBindContainer=!1);}dispose(){var t;super.dispose(),null===(t=this.ui)||void 0===t||t.dispose();}};function c(t){if(s(i,this))return;const{resizeService:e}=this.context.core;e.observe(t),this.register(e.onResizeObserver.on((e=>{if(e.target===t){var i;let n=0,a=0;if((null===(i=e.borderBoxSize)||void 0===i?void 0:i.length)>0){const t=e.borderBoxSize[0];n=t.inlineSize,a=t.blockSize;}else n=t.offsetWidth,a=t.offsetHeight;const l=yg.create(s(r,this),s(h,this),n,a);o(r,this,n),o(h,this,a),this.hooks.resize.emit(l),this.emit("resized",{oldWidth:l.oldWidth,oldHeight:l.oldHeight,newWidth:l.newWidth,newHeight:l.newHeight});}}))),this.hooks.destroy.on((()=>{e.unobserve(t);})),o(i,this,!0);}}(t.getClass("Viewer"));t.setClass("Viewer",i);}};function hw(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)}function dw(t,e,i,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===s?n.call(t,i):n?n.value=i:e.set(t,i),i}"function"==typeof SuppressedError&&SuppressedError;const cw="undefined"==typeof self;let uw,pw,gw,fw,mw;function yw(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return "m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)}function vw(t,e,i,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return "a"===s?n.call(t,i):n?n.value=i:e.set(t,i),i}"undefined"!=typeof navigator&&(uw=navigator,pw=uw.userAgent,gw=uw.platform,fw=uw.mediaDevices),function(){if(!cw){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:uw.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:gw,search:"Win"},Mac:{str:gw},Linux:{str:gw}};let i="unknownBrowser",s=0,n="unknownOS";for(let e in t){const n=t[e]||{};let o=n.str||pw,r=n.search||e,a=n.verStr||pw,l=n.verSearch||e;if(l instanceof Array||(l=[l]),-1!=o.indexOf(r)){i=e;for(let t of l){let e=a.indexOf(t);if(-1!=e){s=parseFloat(a.substring(e+t.length+1));break}}break}}for(let t in e){const i=e[t]||{};let s=i.str||pw,o=i.search||t;if(-1!=s.indexOf(o)){n=t;break}}"Linux"==n&&-1!=pw.indexOf("Windows NT")&&(n="HarmonyOS"),mw={browser:i,version:s,OS:n};}cw&&(mw={browser:"ssr",version:0,OS:"ssr"});}(),fw&&fw.getUserMedia,"Chrome"===mw.browser&&mw.version>66||"Safari"===mw.browser&&mw.version>13||"OPR"===mw.browser&&mw.version>43||"Edge"===mw.browser&&mw.version,"function"==typeof SuppressedError&&SuppressedError;class xw{static multiply(t,e){const i=[];for(let s=0;s<3;s++){const n=e.slice(3*s,3*s+3);for(let e=0;e<3;e++){const s=[t[e],t[e+3],t[e+6]].reduce(((t,e,i)=>t+e*n[i]),0);i.push(s);}}return i}static identity(){return [1,0,0,0,1,0,0,0,1]}static translate(t,e,i){return xw.multiply(t,[1,0,0,0,1,0,e,i,1])}static rotate(t,e){var i=Math.cos(e),s=Math.sin(e);return xw.multiply(t,[i,-s,0,s,i,0,0,0,1])}static scale(t,e,i){return xw.multiply(t,[e,0,0,0,i,0,0,0,1])}}var ww,bw,Cw,Sw,Pw,Aw,Tw,kw,Dw;!function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra";}(ww||(ww={}));class Ew{static get version(){return "1.1.1-0"}static checkWebGLSupport(){return null===document.createElement("canvas").getContext("webgl")?(vw(Ew,bw,!1,"f",Cw),!1):(vw(Ew,bw,!0,"f",Cw),!0)}get disposed(){return yw(this,Dw,"f")}constructor(){Sw.set(this,ww.RGBA),Pw.set(this,null),Aw.set(this,null),Tw.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,kw.set(this,null),Dw.set(this,!1);}drawImage(t,e,i,s,n,o){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!s)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==yw(Ew,bw,"f",Cw)&&Ew.checkWebGLSupport(),(null==o?void 0:o.bUseWebGL)&&!yw(Ew,bw,"f",Cw))throw new Error("Your browser or machine may not support WebGL.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let r;Ew._onLog&&(r=Date.now(),Ew._onLog("drawImage(), START: "+r));let a=0,l=0,h=i,d=s,c=0,u=0,p=i,g=s;n&&(n.sx&&(a=Math.round(n.sx)),n.sy&&(l=Math.round(n.sy)),n.sWidth&&(h=Math.round(n.sWidth)),n.sHeight&&(d=Math.round(n.sHeight)),n.dx&&(c=Math.round(n.dx)),n.dy&&(u=Math.round(n.dy)),n.dWidth&&(p=Math.round(n.dWidth)),n.dHeight&&(g=Math.round(n.dHeight)));let f,m=ww.RGBA;if((null==o?void 0:o.pixelFormat)&&(m=o.pixelFormat),(null==o?void 0:o.bufferContainer)&&(f=o.bufferContainer,f.length<4*p*g))throw new Error("Unexpected size of the 'bufferContainer'.");const y=t;if(!yw(Ew,bw,"f",Cw)||!(this.useWebGLByDefault&&null==(null==o?void 0:o.bUseWebGL)||(null==o?void 0:o.bUseWebGL))){Ew._onLog&&Ew._onLog("drawImage() in context2d."),y.ctx2d||(y.ctx2d=y.getContext("2d",{willReadFrequently:!0}));const t=y.ctx2d;if(!t)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return (y.width<c+p||y.height<u+g)&&(y.width=c+p,y.height=u+g),t.drawImage(e,a,l,h,d,c,u,p,g),Ew._onLog&&Ew._onLog("drawImage() in context2d end. Costs: "+(Date.now()-r)),{context:t,pixelFormat:ww.RGBA,bUseWebGL:!1}}Ew._onLog&&Ew._onLog("drawImage() in WebGL.");try{(y.width<c+p||y.height<u+g)&&(y.width=c+p,y.height=u+g,y.ctxWebGL&&y.ctxWebGL.viewport(0,0,c+p,u+g));const t=y.ctxWebGL||y.getContext("webgl",{antialias:!1})||y.getContext("experimental-webgl",{antialias:!1});if(!t){Ew._onLog&&Ew._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const t=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw t.name="WebGLError",t}if(!y.ctxWebGL||m!==yw(this,Sw,"f")){y.ctxWebGL=t;const e=t=>{const e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW);const i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW),{positions:e,texCoords:i}},i=t=>{const e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e},s=(t,e)=>{const i=t.createProgram();if(e.forEach((e=>t.attachShader(i,e))),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const e=new Error(`An error occured linking the program: ${t.getProgramInfoLog(i)}.`);throw e.name="WebGLError",e}return t.useProgram(i),i},n=(t,e,i)=>{const s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS)){const e=new Error(`An error occured compiling the shader: ${t.getShaderInfoLog(s)}.`);throw e.name="WebGLError",e}return s},o="\n                  attribute vec2 a_position;\n                  attribute vec2 a_texCoord;\n  \n                  uniform mat3 u_matrix;\n                  uniform mat3 u_textureMatrix;\n  \n                  varying vec2 v_texCoord;\n                  void main(void) {\n                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                  }\n              ";let r="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(m)&&(r=m.slice(0,3));const a=`\n                  precision mediump float;\n                  varying vec2 v_texCoord;\n                  uniform sampler2D u_image;\n                  uniform float uColorFactor;\n  \n                  void main() {\n                      vec4 sample = texture2D(u_image, v_texCoord);\n                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                      gl_FragColor = vec4(sample.${r} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                  }\n              `,l=s(t,[n(t,t.VERTEX_SHADER,o),n(t,t.FRAGMENT_SHADER,a)]);vw(this,Aw,{program:l,attribLocations:{vertexPosition:t.getAttribLocation(l,"a_position"),texPosition:t.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:t.getUniformLocation(l,"u_image"),uColorFactor:t.getUniformLocation(l,"uColorFactor"),uMatrix:t.getUniformLocation(l,"u_matrix"),uTextureMatrix:t.getUniformLocation(l,"u_textureMatrix")}},"f"),vw(this,Tw,e(t),"f"),vw(this,Pw,i(t),"f"),vw(this,Sw,m,"f");}const n=(t,e,i)=>{t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0);},o=(t,e,i)=>{const s=t.RGBA,n=t.RGBA,o=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,s,n,o,i);},v=(t,e,o,r)=>{t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),n(t,o.positions,e.attribLocations.vertexPosition),n(t,o.texCoords,e.attribLocations.texPosition),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.uniform1i(e.uniformLocations.uSampler,0),t.uniform1f(e.uniformLocations.uColorFactor,[ww.GREY,ww.GREY32].includes(m)?1:0);let f,y,v=xw.translate(xw.identity(),-1,-1);v=xw.scale(v,2,2),v=xw.scale(v,1/t.canvas.width,1/t.canvas.height),f=xw.translate(v,c,u),f=xw.scale(f,p,g),t.uniformMatrix3fv(e.uniformLocations.uMatrix,!1,f),y=xw.translate(xw.identity(),a/i,l/s),y=xw.scale(y,h/i,d/s),t.uniformMatrix3fv(e.uniformLocations.uTextureMatrix,!1,y),t.drawArrays(t.TRIANGLES,0,6);};o(t,yw(this,Pw,"f"),e),v(t,yw(this,Aw,"f"),yw(this,Tw,"f"),yw(this,Pw,"f"));const x=f||new Uint8Array(4*p*g);if(t.readPixels(c,u,p,g,t.RGBA,t.UNSIGNED_BYTE,x),255!==x[3]){Ew._onLog&&Ew._onLog("Incorrect WebGL drawing .");const t=new Error("WebGL error: incorrect drawing.");throw t.name="WebGLError",t}return Ew._onLog&&Ew._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-r)),{context:t,pixelFormat:m===ww.GREY?ww.GREY32:m,bUseWebGL:!0}}catch(r){if(this.forceLoseContext(),null==(null==o?void 0:o.bUseWebGL))return Ew._onLog&&Ew._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(t,e,i,s,n,Object.assign({},o,{bUseWebGL:!1}));throw r.name="WebGLError",r}}readCvsData(t,e,i){if(!(t instanceof CanvasRenderingContext2D||t instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let s,n=0,o=0,r=t.canvas.width,a=t.canvas.height;if(e&&(e.x&&(n=e.x),e.y&&(o=e.y),e.width&&(r=e.width),e.height&&(a=e.height)),(null==i?void 0:i.length)<4*r*a)throw new Error("Unexpected size of the 'bufferContainer'.");if(t instanceof WebGLRenderingContext){const e=t;i?(e.readPixels(n,o,r,a,e.RGBA,e.UNSIGNED_BYTE,i),s=new Uint8Array(i.buffer,0,4*r*a)):(s=new Uint8Array(4*r*a),e.readPixels(n,o,r,a,e.RGBA,e.UNSIGNED_BYTE,s));}else if(t instanceof CanvasRenderingContext2D){let e;e=t.getImageData(n,o,r,a),s=new Uint8Array(e.data.buffer),null==i||i.set(s);}return s}transformPixelFormat(t,e,i,s){let n,o;if(Ew._onLog&&(n=Date.now(),Ew._onLog("transformPixelFormat(), START: "+n)),e===i)return Ew._onLog&&Ew._onLog("transformPixelFormat() end. Costs: "+(Date.now()-n)),s?new Uint8Array(t):t;const r=[ww.RGBA,ww.RBGA,ww.GRBA,ww.GBRA,ww.BRGA,ww.BGRA];if(r.includes(e))if(i===ww.GREY){o=new Uint8Array(t.length/4);for(let e=0;e<t.length;e+=4){const i=.21*t[e]+.71*t[e+1]+.07*t[e+2];o[e/4]=i;}}else if(i===ww.GREY32){o=s?new Uint8Array(t):t;for(let e=0;e<t.length;e+=4){const i=.21*t[e]+.71*t[e+1]+.07*t[e+2];o[e]=i,o[e+1]=i,o[e+2]=i;}}else {if(!r.includes(i))throw new Error("Unable to transform.");if(s){o=new Uint8Array(t);const s=e.indexOf("r"),n=e.indexOf("g"),r=e.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),h=i.indexOf("b");for(let e=0;e<t.length;e+=4)o[e+a]=t[e+s],o[e+l]=t[e+n],o[e+h]=t[e+r];}else {o=t;const s=e.indexOf("r"),n=e.indexOf("g"),r=e.indexOf("b"),a=i.indexOf("r"),l=i.indexOf("g"),h=i.indexOf("b");for(let e=0;e<t.length;e+=4){let i=[t[e],t[e+1],t[e+2]];o[e+a]=i[s],o[e+l]=i[n],o[e+h]=i[r];}}}else if(e===ww.GREY){if(i!==ww.GREY32)throw new Error("Unable to transform.");o=new Uint8Array(4*t.length);for(let e=0;e<t.length;e++)o[4*e]=t[e],o[4*e+1]=t[e],o[4*e+2]=t[e],o[4*e+3]=255;}else {if(e!==ww.GREY32)throw new Error("Unable to transform.");if(i!==ww.GREY)throw new Error("Unable to transform.");o=new Uint8Array(t.length/4);for(let e=0;e<t.length;e+=4)o[e/4]=t[e];}return Ew._onLog&&Ew._onLog("transformPixelFormat() end. Costs: "+(Date.now()-n)),o}getImageData(t,e,i,s,n){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!e||!i)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(null==yw(Ew,bw,"f",Cw)&&Ew.checkWebGLSupport(),(null==n?void 0:n.bUseWebGL)&&!yw(Ew,bw,"f",Cw))throw new Error("Your browser or machine may not support WebGL.");if(s.sx>e||s.sy>i||s.sx+s.sWidth>e||s.sy+s.sHeight>i)throw new Error("Invalid position.");if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let o;Ew._onLog&&(o=Date.now(),Ew._onLog("getImageData(), START: "+o));const r=Math.round(s.sx),a=Math.round(s.sy),l=Math.round(s.sWidth),h=Math.round(s.sHeight),d=Math.round(s.dWidth),c=Math.round(s.dHeight);let u=ww.RGBA;(null==n?void 0:n.pixelFormat)&&(u=n.pixelFormat);let p,g,f,m=null;if((null==n?void 0:n.bufferContainer)&&(m=n.bufferContainer),yw(Ew,bw,"f",Cw)&&(this.useWebGLByDefault&&null==(null==n?void 0:n.bUseWebGL)||(null==n?void 0:n.bUseWebGL))){Ew._onLog&&Ew._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),p=this._reusedWebGLCvs;try{if(m)if(u===ww.GREY){if(f=new Uint8Array(4*d*c),g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},{pixelFormat:u,bUseWebGL:!0,bufferContainer:f}),f=this.transformPixelFormat(f,g.pixelFormat,u),m){if(m.length<f.length)throw new Error("Unexpected size of the 'bufferContainer'.");m.set(f);}}else g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},{pixelFormat:u,bUseWebGL:!0,bufferContainer:m}),f=new Uint8Array(m.buffer,0,4*d*c),f=this.transformPixelFormat(f,g.pixelFormat,u);else u===ww.GREY?((!yw(this,kw,"f")||yw(this,kw,"f").length<4*d*c)&&vw(this,kw,new Uint8Array(4*d*c),"f"),f=new Uint8Array(yw(this,kw,"f").buffer,0,4*d*c)):f=new Uint8Array(4*d*c),g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},{pixelFormat:u,bUseWebGL:!0,bufferContainer:f}),f=this.transformPixelFormat(f,g.pixelFormat,u);}catch(s){if("WebGLError"===s.name&&(this.forceLoseContext(),null==(null==n?void 0:n.bUseWebGL)))return Ew._onLog&&Ew._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},Object.assign({},n,{bUseWebGL:!1}));throw s}}else if(Ew._onLog&&Ew._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),p=this._reusedCvs,g=this.drawImage(p,t,e,i,{sx:r,sy:a,sWidth:l,sHeight:h,dWidth:d,dHeight:c},{pixelFormat:ww.RGBA,bUseWebGL:!1}),f=this.readCvsData(g.context,{width:d,height:c},null),f=this.transformPixelFormat(f,g.pixelFormat,u),m){if(m.length<f.length)throw new Error("Unexpected size of the 'bufferContainer'.");m.set(f);}return Ew._onLog&&Ew._onLog("getImageData() end. Costs: "+(Date.now()-o)),{data:f,pixelFormat:u,width:d,height:c,bUseWebGL:g.bUseWebGL}}convertDataToCvs(t,e,i,s){if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof e||e<=0)throw new Error("Invalid 'width'.");if("number"!=typeof i||i<=0)throw new Error("Invalid 'height'.");const n=document.createElement("canvas");let o;if(n.width=e,n.height=i,s===ww.GREY){o=new Uint8ClampedArray(4*e*i);for(let e=0;e<o.length;e+=4)o[e]=t[e/4],o[e+1]=t[e/4],o[e+2]=t[e/4],o[e+3]=255;}else o=new Uint8ClampedArray(t.buffer);const r=new ImageData(o,e,i);return n.getContext("2d").putImageData(r,0,0),n}forceLoseContext(){if(!this._reusedWebGLCvs)return;const t=this._reusedWebGLCvs.ctxWebGL;t&&!t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").loseContext(),vw(this,Pw,null,"f"),vw(this,Aw,null,"f"),vw(this,Tw,null,"f"),this._reusedWebGLCvs=null;}dispose(){this.forceLoseContext(),vw(this,Dw,!0,"f");}}bw=Ew,Sw=new WeakMap,Pw=new WeakMap,Aw=new WeakMap,Tw=new WeakMap,kw=new WeakMap,Dw=new WeakMap,Cw={value:void 0};var Iw,Rw,Mw,Bw,Lw,Uw,Ow,_w,Nw,Ww,Fw,Hw,Vw,zw,jw,$w,Gw,Xw,Yw,Jw,qw,Zw,Qw,Kw,tb,eb,ib,sb,nb,ob,rb,ab,lb,hb,db,cb,ub,pb,gb,fb,mb,yb,vb;class xb{constructor(){Iw.set(this,new Map),Rw.set(this,!1);}get disposed(){return hw(this,Rw,"f")}on(t,e){t=t.toLowerCase();const i=hw(this,Iw,"f").get(t);if(i){if(i.includes(e))return;i.push(e);}else hw(this,Iw,"f").set(t,[e]);}off(t,e){t=t.toLowerCase();const i=hw(this,Iw,"f").get(t);if(!i)return;const s=i.indexOf(e);-1!==s&&i.splice(s,1);}offAll(t){t=t.toLowerCase();const e=hw(this,Iw,"f").get(t);e&&(e.length=0);}async fire(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{async:!1,copy:!0};e||(e=[]),t=t.toLowerCase();const s=hw(this,Iw,"f").get(t);if(s&&s.length){i=Object.assign({async:!1,copy:!0},i);for(let t of s){if(!t)continue;let s=[];if(i.copy)for(let t of e){try{t=JSON.parse(JSON.stringify(t));}catch(t){}s.push(t);}else s=e;let n=!1;if(i.async)setTimeout((()=>{this.disposed||t.apply(i.target,s);}),0);else try{n=await t.apply(i.target,s);}catch(t){}if(!0===n)break}}}dispose(){dw(this,Rw,!0,"f");}}Iw=new WeakMap,Rw=new WeakMap;const wb=(t,e,i,s)=>{if(!i)return t;let n=e+Math.round((t-e)/i)*i;return s&&(n=Math.min(n,s)),n};class bb{static get version(){return "2.0.0-16"}static isStorageAvailable(t){let e;try{e=window[t];const i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length}}static findBestRearCameraInIOS(t,e){if(!t||!t.length)return null;let i=!1;if((null==e?void 0:e.getMainCamera)&&(i=!0),i){const e=["후면 카메라","背面カメラ","後置鏡頭","后置相机","กล้องด้านหลัง","बैक कैमरा","الكاميرا الخلفية","מצלמה אחורית","камера на задней панели","задня камера","задна камера","артқы камера","πίσω κάμερα","zadní fotoaparát","zadná kamera","tylny aparat","takakamera","stražnja kamera","rückkamera","kamera på baksidan","kamera belakang","kamera bak","hátsó kamera","fotocamera (posteriore)","câmera traseira","câmara traseira","cámara trasera","càmera posterior","caméra arrière","cameră spate","camera mặt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],i=t.find((t=>e.includes(t.label.toLowerCase())));return null==i?void 0:i.deviceId}{const e=["후면","背面","後置","后置","านหลัง","बैक","خلفية","אחורית","задняя","задней","задна","πίσω","zadní","zadná","tylny","trasera","traseira","taka","stražnja","spate","sau","rück","posteriore","posterior","hátsó","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"],i=["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],s=["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],n=t.filter((t=>{const i=t.label.toLowerCase();return e.some((t=>i.includes(t)))}));if(!n.length)return null;const o=n.find((t=>{const e=t.label.toLowerCase();return i.some((t=>e.includes(t)))}));if(o)return o.deviceId;const r=n.find((t=>{const e=t.label.toLowerCase();return s.some((t=>e.includes(t)))}));return r?r.deviceId:n[0].deviceId}}static findBestRearCamera(t,e){if(!t||!t.length)return null;if(["iPhone","iPad","Mac"].includes(mw.OS))return bb.findBestRearCameraInIOS(t,{getMainCamera:null==e?void 0:e.getMainCameraInIOS});const i=["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"];for(let e of t){const t=e.label.toLowerCase();if(t&&i.some((e=>t.includes(e)))&&/\b0(\b)?/.test(t))return e.deviceId}return ["Android","HarmonyOS"].includes(mw.OS)?t[t.length-1].deviceId:null}static findBestCamera(t,e,i){return t&&t.length?"environment"===e?this.findBestRearCamera(t,i):"user"===e?null:e?void 0:null:null}static async playVideo(t,e,i){if(!t)throw new Error("Invalid 'videoEl'.");if(!e)throw new Error("Invalid 'source'.");return "string"==typeof e||e instanceof String?t.src=e:t.srcObject=e,new Promise(((e,s)=>{let n;const o=()=>{t.removeEventListener("loadstart",l),t.removeEventListener("abort",h),t.removeEventListener("play",d),t.removeEventListener("error",c);},r=()=>{n&&clearTimeout(n),o(),e(t);},a=t=>{n&&clearTimeout(n),o(),s(t);},l=()=>{t.addEventListener("abort",h,{once:!0});},h=()=>{const t=new Error("Video playing was interrupted.");t.name="AbortError",a(t);},d=()=>{r();},c=()=>{a(new Error(`Video error ${t.error.code}: ${t.error.message}.`));};t.addEventListener("loadstart",l,{once:!0}),t.autoplay&&["iPhone","iPad","Mac"].includes(mw.OS)&&mw.version>=17?(t.addEventListener("play",d,{once:!0}),t.addEventListener("error",c,{once:!0})):(t.load(),t.play().then((()=>{r();})).catch((t=>{a(t);}))),i&&(n=setTimeout((()=>{o(),s(new Error("Failed to play video. Timeout."));}),i));}))}static async testCameraAccess(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))return {ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let s;try{s=t?await navigator.mediaDevices.getUserMedia(t):await navigator.mediaDevices.getUserMedia({video:!0});}catch(t){return {ok:!1,errorName:t.name,errorMessage:t.message}}finally{null==s||s.getTracks().forEach((t=>{t.stop();}));}return {ok:!0}}get state(){if(!hw(this,$w,"f"))return "closed";if("pending"===hw(this,$w,"f"))return "opening";if("fulfilled"===hw(this,$w,"f"))return "opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(t){t&&bb.isStorageAvailable("localStorage")?dw(this,Hw,!0,"f"):dw(this,Hw,!1,"f");}get ifSaveLastUsedCamera(){return hw(this,Hw,"f")}get isVideoPlaying(){return !(!hw(this,Lw,"f")||hw(this,Lw,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(t){var e,i,s;if(!(t instanceof HTMLElement)&&null!=t)throw new TypeError("Invalid 'element'.");null===(e=hw(this,Zw,"f"))||void 0===e||e.removeEventListener("click",hw(this,qw,"f")),null===(i=hw(this,Zw,"f"))||void 0===i||i.removeEventListener("touchend",hw(this,qw,"f")),null===(s=hw(this,Zw,"f"))||void 0===s||s.removeEventListener("touchmove",hw(this,Jw,"f")),dw(this,Zw,t,"f"),t&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(mw.OS)?(t.addEventListener("touchend",hw(this,qw,"f")),t.addEventListener("touchmove",hw(this,Jw,"f"))):t.addEventListener("click",hw(this,qw,"f")));}get tapFocusEventBoundEl(){return hw(this,Zw,"f")}get disposed(){return hw(this,rb,"f")}constructor(t){var e,i;Bw.add(this),Lw.set(this,null),Uw.set(this,void 0),Ow.set(this,(()=>{"opened"===this.state&&hw(this,eb,"f").fire("resumed",null,{target:this,async:!0});})),_w.set(this,(()=>{hw(this,eb,"f").fire("paused",null,{target:this,async:!1});})),Nw.set(this,void 0),Ww.set(this,void 0),this.cameraOpenTimeout=4e3,this._arrCameras=[],Fw.set(this,void 0),Hw.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Vw.set(this,void 0),zw.set(this,!0),jw.set(this,void 0),$w.set(this,void 0),Gw.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Xw.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(t,e)=>{let i,s;const n=window.getComputedStyle(hw(this,Lw,"f")).objectFit,o=this.getResolution(),r=hw(this,Lw,"f").getBoundingClientRect(),a=r.left,l=r.top,{width:h,height:d}=hw(this,Lw,"f").getBoundingClientRect();if(h<=0||d<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const c=h/d,u=o.width/o.height;let p=1;if("contain"===n)u>c?(p=h/o.width,i=(t-a)/p,s=(e-l-(d-h/u)/2)/p):(p=d/o.height,s=(e-l)/p,i=(t-a-(h-d*u)/2)/p);else {if("cover"!==n)throw new Error("Unsupported object-fit.");u>c?(p=d/o.height,s=(e-l)/p,i=(t-a+(d*u-h)/2)/p):(p=h/o.width,i=(t-a)/p,s=(e-l+(h/u-d)/2)/p);}return {x:i,y:s}},Yw.set(this,!1),Jw.set(this,(()=>{dw(this,Yw,!0,"f");})),qw.set(this,(async t=>{var e;if(hw(this,Yw,"f"))return void dw(this,Yw,!1,"f");if(!hw(this,Xw,"f"))return;if(!this.isVideoPlaying)return;if(!hw(this,Uw,"f"))return;if(!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(e=this.getCameraCapabilities())||void 0===e?void 0:e.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),1==this._focusParameters.isDoingFocus)return;let i,s;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),t instanceof MouseEvent)i=t.clientX,s=t.clientY;else {if(!(t instanceof TouchEvent))throw new Error("Unknown event type.");if(!t.changedTouches.length)return;i=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY;}const n=this.getResolution(),o=2*Math.round(Math.min(n.width,n.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let r;try{r=this.calculateCoordInVideo(i,s);}catch(t){}if(r.x<0||r.x>n.width||r.y<0||r.y>n.height)return;const a={x:r.x+"px",y:r.y+"px"},l=o+"px",h=l;let d;bb._onLog&&(d=Date.now());try{await hw(this,Bw,"m",mb).call(this,a,l,h,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance);}catch(t){if(bb._onLog)throw bb._onLog(t),t}bb._onLog&&bb._onLog(`Tap focus costs: ${Date.now()-d} ms`),this._focusParameters.taskBackToContinous=setTimeout((()=>{var t;bb._onLog&&bb._onLog("Back to continuous focus."),null===(t=hw(this,Uw,"f"))||void 0===t||t.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch((()=>{}));}),this._focusParameters.focusBackToContinousTime),hw(this,eb,"f").fire("tapfocus",null,{target:this,async:!0});})),Zw.set(this,null),Qw.set(this,1),Kw.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!hw(this,Lw,"f"))return;const t=hw(this,Qw,"f");if(t<1)throw new RangeError("Invalid scale value.");if(1===t)hw(this,Lw,"f").style.transform="";else {const e=window.getComputedStyle(hw(this,Lw,"f")).objectFit,i=hw(this,Lw,"f").videoWidth,s=hw(this,Lw,"f").videoHeight,{width:n,height:o}=hw(this,Lw,"f").getBoundingClientRect();if(n<=0||o<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const r=n/o,a=i/s;let l=1;"contain"===e?l=r<a?n/(i/t):o/(s/t):"cover"===e&&(l=a>r?o/(i/t):n/(s/t));const h=l*(1-1/t)*(i/2-hw(this,Kw,"f").x),d=l*(1-1/t)*(s/2-hw(this,Kw,"f").y);hw(this,Lw,"f").style.transform=`translate(${h}px, ${d}px) scale(${t})`;}},tb.set(this,(function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const t=document.createElement("canvas");let e;if(t.width=this.width,t.height=this.height,this.pixelFormat===ww.GREY){e=new Uint8ClampedArray(this.width*this.height*4);for(let t=0;t<e.length;t+=4)e[t]=this.data[t/4],e[t+1]=this.data[t/4],e[t+2]=this.data[t/4],e[t+3]=255;}else e=new Uint8ClampedArray(this.data.buffer);const i=new ImageData(e,this.width,this.height);return t.getContext("2d").putImageData(i,0,0),t})),eb.set(this,void 0),ib.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],sb.set(this,new Map),nb.set(this,!1),ob.set(this,(async()=>{var t,e;if("visible"===document.visibilityState){if(bb._onLog&&bb._onLog("document visible. video paused: "+(null===(t=hw(this,Lw,"f"))||void 0===t?void 0:t.paused)),hw(this,nb,"f")&&hw(this,Lw,"f")&&this.videoSrc&&"opened"===this.state)return void this.resume().catch((()=>{}));if(!this._mediaStream)return;if(this._mediaStream.active&&hw(this,Uw,"f"))if(hw(this,Uw,"f").muted&&["iPhone","iPad","Mac"].includes(mw.OS)){if(mw.version>=17)return;await hw(this,Bw,"m",cb).call(this);}else hw(this,nb,"f")&&this.resume().catch((()=>{}));else await hw(this,Bw,"m",cb).call(this);}else if("hidden"===document.visibilityState&&(bb._onLog&&bb._onLog("document hidden. video paused: "+(null===(e=hw(this,Lw,"f"))||void 0===e?void 0:e.paused)),["iPhone","iPad","Mac"].includes(mw.OS)?dw(this,nb,!0,"f"):dw(this,nb,this.isVideoPlaying,"f"),this.isVideoLoaded()&&"opened"==this.state)){if(["iPhone","iPad","Mac"].includes(mw.OS)&&mw.version>=17)return;this.pause();}})),rb.set(this,!1),(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia)||setTimeout((()=>{bb.onWarning&&bb.onWarning("The browser is too old or the page is loaded from an insecure origin.");}),0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),t instanceof HTMLVideoElement&&this.setVideoEl(t),dw(this,eb,new xb,"f"),this.imageDataGetter=new Ew,document.addEventListener("visibilitychange",hw(this,ob,"f"));}setVideoEl(t){if(!(t&&t instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");t.addEventListener("play",hw(this,Ow,"f")),t.addEventListener("pause",hw(this,_w,"f")),dw(this,Lw,t,"f");}getVideoEl(){return hw(this,Lw,"f")}releaseVideoEl(){var t,e;null===(t=hw(this,Lw,"f"))||void 0===t||t.removeEventListener("play",hw(this,Ow,"f")),null===(e=hw(this,Lw,"f"))||void 0===e||e.removeEventListener("pause",hw(this,_w,"f")),dw(this,Lw,null,"f");}isVideoLoaded(){return !!hw(this,Lw,"f")&&4==hw(this,Lw,"f").readyState}async open(){if(hw(this,jw,"f")&&!hw(this,zw,"f")){if("pending"===hw(this,$w,"f"))return hw(this,jw,"f");if("fulfilled"===hw(this,$w,"f"))return}hw(this,eb,"f").fire("before:open",null,{target:this}),await hw(this,Bw,"m",cb).call(this),hw(this,eb,"f").fire("opened",null,{target:this,async:!0}),hw(this,eb,"f").fire("played",null,{target:this,async:!0});}async close(){if("closed"===this.state)return;hw(this,eb,"f").fire("before:close",null,{target:this});const t=hw(this,jw,"f");if(hw(this,Bw,"m",pb).call(this),t&&"pending"===hw(this,$w,"f")){try{await t;}catch(t){}if(!1===hw(this,zw,"f")){const t=new Error("'close()' was interrupted.");throw t.name="AbortError",t}}dw(this,jw,null,"f"),dw(this,$w,null,"f"),hw(this,eb,"f").fire("closed",null,{target:this,async:!0});}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");hw(this,Lw,"f").pause();}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");await hw(this,Lw,"f").play();}async setCamera(t){if("string"!=typeof t)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof hw(this,Nw,"f").video&&(hw(this,Nw,"f").video={}),delete hw(this,Nw,"f").video.facingMode,hw(this,Nw,"f").video.deviceId={exact:t},!("closed"===this.state||this.videoSrc||"opening"===this.state&&hw(this,zw,"f"))){hw(this,eb,"f").fire("before:camera:change",[],{target:this,async:!1}),await hw(this,Bw,"m",ub).call(this);try{this.resetSoftwareScale();}catch(t){}return hw(this,Ww,"f")}}async switchToFrontCamera(t){if("object"!=typeof hw(this,Nw,"f").video&&(hw(this,Nw,"f").video={}),(null==t?void 0:t.resolution)&&(hw(this,Nw,"f").video.width={ideal:t.resolution.width},hw(this,Nw,"f").video.height={ideal:t.resolution.height}),delete hw(this,Nw,"f").video.deviceId,hw(this,Nw,"f").video.facingMode={exact:"user"},dw(this,Fw,null,"f"),!("closed"===this.state||this.videoSrc||"opening"===this.state&&hw(this,zw,"f"))){hw(this,eb,"f").fire("before:camera:change",[],{target:this,async:!1}),hw(this,Bw,"m",ub).call(this);try{this.resetSoftwareScale();}catch(t){}return hw(this,Ww,"f")}}getCamera(){var t;if(hw(this,Ww,"f"))return hw(this,Ww,"f");{let e=(null===(t=hw(this,Nw,"f").video)||void 0===t?void 0:t.deviceId)||"";if(e){e=e.exact||e.ideal||e;for(let t of this._arrCameras)if(t.deviceId===e)return JSON.parse(JSON.stringify(t))}return {deviceId:"",label:"",_checked:!1}}}async _getCameras(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let s;if(t){let t=await navigator.mediaDevices.getUserMedia({video:!0});s=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind)),t.getTracks().forEach((t=>{t.stop();}));}else s=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));const n=[],o=[];if(this._arrCameras)for(let t of this._arrCameras)t._checked&&o.push(t);for(let t=0;t<s.length;t++){let e,i=s[t];for(let t of o)if(i.deviceId==t.deviceId){e=t;break}e||(e={deviceId:i.deviceId,label:i.label?i.label:"camera "+t,_checked:!1}),e.deviceId&&n.push(e);}return this._arrCameras=n,bb._onLog&&bb._onLog(JSON.stringify(this._arrCameras)),n}async getCameras(){var t,e;if(!(null===(e=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===e?void 0:e.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const i=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(t,e,i){if("number"!=typeof t||t<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof e||e<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof hw(this,Nw,"f").video&&(hw(this,Nw,"f").video={}),i?(hw(this,Nw,"f").video.width={exact:t},hw(this,Nw,"f").video.height={exact:e}):(hw(this,Nw,"f").video.width={ideal:t},hw(this,Nw,"f").video.height={ideal:e}),"closed"===this.state||this.videoSrc||"opening"===this.state&&hw(this,zw,"f"))return null;hw(this,eb,"f").fire("before:resolution:change",[],{target:this,async:!1}),await hw(this,Bw,"m",ub).call(this);try{this.resetSoftwareScale();}catch(t){}const s=this.getResolution();return {width:s.width,height:s.height}}getResolution(){if("opened"===this.state&&this.videoSrc&&hw(this,Lw,"f"))return {width:hw(this,Lw,"f").videoWidth,height:hw(this,Lw,"f").videoHeight};if(hw(this,Uw,"f")){const t=hw(this,Uw,"f").getSettings();return {width:t.width,height:t.height}}if(this.isVideoLoaded())return {width:hw(this,Lw,"f").videoWidth,height:hw(this,Lw,"f").videoHeight};{const t={width:0,height:0};let e=hw(this,Nw,"f").video.width||0,i=hw(this,Nw,"f").video.height||0;return e&&(t.width=e.exact||e.ideal||e),i&&(t.height=i.exact||i.ideal||i),t}}async getResolutions(t){var e,i,s,n,o,r,a,l,h,d,c;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let u="";const p=(t,e)=>{const i=hw(this,sb,"f").get(t);if(!i||!i.length)return !1;for(let t of i)if(t.width===e.width&&t.height===e.height)return !0;return !1};if(this._mediaStream){u=null===(c=hw(this,Ww,"f"))||void 0===c?void 0:c.deviceId;let e=hw(this,sb,"f").get(u);if(e&&!t)return JSON.parse(JSON.stringify(e));e=[],hw(this,sb,"f").set(u,e),dw(this,Gw,!0,"f");try{for(let t of this.detectedResolutions){await hw(this,Uw,"f").applyConstraints({width:{ideal:t.width},height:{ideal:t.height}}),hw(this,Bw,"m",lb).call(this);const i=hw(this,Uw,"f").getSettings(),s={width:i.width,height:i.height};p(u,s)||e.push({width:s.width,height:s.height});}}catch(t){throw hw(this,Bw,"m",pb).call(this),dw(this,Gw,!1,"f"),t}try{await hw(this,Bw,"m",cb).call(this);}catch(t){if("AbortError"===t.name)return e;throw t}finally{dw(this,Gw,!1,"f");}return e}{const e=async(t,e,i)=>{const s={video:{deviceId:{exact:t},width:{ideal:e},height:{ideal:i}}};let n=null;try{n=await navigator.mediaDevices.getUserMedia(s);}catch(t){return null}if(!n)return null;const o=n.getVideoTracks();let r=null;try{const t=o[0].getSettings();r={width:t.width,height:t.height};}catch(t){const e=document.createElement("video");e.srcObject=n,r={width:e.videoWidth,height:e.videoHeight},e.srcObject=null;}return o.forEach((t=>{t.stop();})),r};let i=(null===(o=null===(n=null===(s=hw(this,Nw,"f"))||void 0===s?void 0:s.video)||void 0===n?void 0:n.deviceId)||void 0===o?void 0:o.exact)||(null===(l=null===(a=null===(r=hw(this,Nw,"f"))||void 0===r?void 0:r.video)||void 0===a?void 0:a.deviceId)||void 0===l?void 0:l.ideal)||(null===(d=null===(h=hw(this,Nw,"f"))||void 0===h?void 0:h.video)||void 0===d?void 0:d.deviceId);if(!i)return [];let c=hw(this,sb,"f").get(i);if(c&&!t)return JSON.parse(JSON.stringify(c));c=[],hw(this,sb,"f").set(i,c);for(let t of this.detectedResolutions){const s=await e(i,t.width,t.height);s&&!p(i,s)&&c.push({width:s.width,height:s.height});}return c}}async setMediaStreamConstraints(t,e){if(!(t=>{return null!==t&&"[object Object]"===(e=t,Object.prototype.toString.call(e));var e;})(t))throw new TypeError("Invalid 'mediaStreamConstraints'.");dw(this,Nw,JSON.parse(JSON.stringify(t)),"f"),dw(this,Fw,null,"f"),e&&hw(this,Bw,"m",ub).call(this);}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(hw(this,Nw,"f")))}resetMediaStreamConstraints(){dw(this,Nw,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f");}getCameraCapabilities(){if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return hw(this,Uw,"f").getCapabilities?hw(this,Uw,"f").getCapabilities():{}}getCameraSettings(){if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return hw(this,Uw,"f").getSettings()}async turnOnTorch(){if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!(null==t?void 0:t.torch))throw Error("Not supported.");await hw(this,Uw,"f").applyConstraints({advanced:[{torch:!0}]});}async turnOffTorch(){if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const t=this.getCameraCapabilities();if(!(null==t?void 0:t.torch))throw Error("Not supported.");await hw(this,Uw,"f").applyConstraints({advanced:[{torch:!1}]});}async setColorTemperature(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const s=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.colorTemperature;if(!s)throw Error("Not supported.");return e&&(t<s.min?t=s.min:t>s.max&&(t=s.max),t=wb(t,s.min,s.step,s.max)),await hw(this,Uw,"f").applyConstraints({advanced:[{colorTemperature:t,whiteBalanceMode:"manual"}]}),t}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const s=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.exposureCompensation;if(!s)throw Error("Not supported.");return e&&(t<s.min?t=s.min:t>s.max&&(t=s.max),t=wb(t,s.min,s.step,s.max)),await hw(this,Uw,"f").applyConstraints({advanced:[{exposureCompensation:t}]}),t}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");let s=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.frameRate;if(!s)throw Error("Not supported.");e&&(t<s.min?t=s.min:t>s.max&&(t=s.max));const n=this.getResolution();return await hw(this,Uw,"f").applyConstraints({width:{ideal:Math.max(n.width,n.height)},frameRate:t}),t}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(t,e){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const i=this.getCameraCapabilities(),s=null==i?void 0:i.focusMode,n=null==i?void 0:i.focusDistance;if(!s)throw Error("Not supported.");if("string"!=typeof t.mode)throw TypeError("Invalid 'mode'.");const o=t.mode.toLowerCase();if(!s.includes(o))throw Error("Unsupported focus mode.");if("manual"===o){if(!n)throw Error("Manual focus unsupported.");if(t.hasOwnProperty("distance")){let i=t.distance;e&&(i<n.min?i=n.min:i>n.max&&(i=n.max),i=wb(i,n.min,n.step,n.max)),this._focusParameters.focusArea=null,await hw(this,Uw,"f").applyConstraints({advanced:[{focusMode:o,focusDistance:i}]});}else {if(!t.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const e=t.area.centerPoint;let i=t.area.width,s=t.area.height;if(!i||!s){const t=this.getResolution();i||(i=2*Math.round(Math.min(t.width,t.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),s||(s=2*Math.round(Math.min(t.width,t.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px");}this._focusParameters.focusArea={centerPoint:{x:e.x,y:e.y},width:i,height:s},await hw(this,Bw,"m",mb).call(this,e,i,s);}}}else this._focusParameters.focusArea=null,await hw(this,Uw,"f").applyConstraints({advanced:[{focusMode:o}]});}getFocus(){const t=this.getCameraSettings(),e=t.focusMode;return e?"manual"===e?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:t.focusDistance}:{mode:e}:null}async enableTapToFocus(){dw(this,Xw,!0,"f");}disableTapToFocus(){dw(this,Xw,!1,"f");}isTapToFocusEnabled(){return hw(this,Xw,"f")}async setZoom(t){if("object"!=typeof t||Array.isArray(t)||null==t)throw new TypeError("Invalid 'settings'.");if("number"!=typeof t.factor)throw new TypeError("Illegal type of 'factor'.");if(t.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==this.state)throw new Error("Video is not playing.");t.centerPoint?hw(this,Bw,"m",yb).call(this,t.centerPoint):this.resetScaleCenter();try{if(hw(this,Bw,"m",vb).call(this,hw(this,Kw,"f"))){const e=await this.setHardwareScale(t.factor,!0);let i=this.getHardwareScale();1==i&&1!=e&&(i=e),t.factor>i?this.setSoftwareScale(t.factor/i):this.setSoftwareScale(1);}else await this.setHardwareScale(1),this.setSoftwareScale(t.factor);}catch(e){const i=e.message||e;if("Not supported."!==i&&"Camera is not open."!==i)throw e;this.setSoftwareScale(t.factor);}}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let t=1;try{t=this.getHardwareScale();}catch(t){if("Camera is not open."!==(t.message||t))throw t}return {factor:t*hw(this,Qw,"f")}}async resetZoom(){await this.setZoom({factor:1});}async setHardwareScale(t,e){var i;if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if(!hw(this,Uw,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const s=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.zoom;if(!s)throw Error("Not supported.");return e&&(t<s.min?t=s.min:t>s.max&&(t=s.max),t=wb(t,s.min,s.step,s.max)),await hw(this,Uw,"f").applyConstraints({advanced:[{zoom:t}]}),t}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(t,e){if("number"!=typeof t)throw new TypeError("Invalid 'value'.");if(t<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");e&&hw(this,Bw,"m",yb).call(this,e),dw(this,Qw,t,"f"),this.updateVideoElWhenSoftwareScaled();}getSoftwareScale(){return hw(this,Qw,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();dw(this,Kw,{x:t.width/2,y:t.height/2},"f");}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter();}getFrameData(t){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded())return null;if(hw(this,Gw,"f"))return null;const e=Date.now();bb._onLog&&bb._onLog("getFrameData() START: "+e);const i=hw(this,Lw,"f").videoWidth,s=hw(this,Lw,"f").videoHeight;let n={sx:0,sy:0,sWidth:i,sHeight:s,dWidth:i,dHeight:s};(null==t?void 0:t.position)&&(n=JSON.parse(JSON.stringify(t.position)));let o=ww.RGBA;(null==t?void 0:t.pixelFormat)&&(o=t.pixelFormat);let r=hw(this,Qw,"f");(null==t?void 0:t.scale)&&(r=t.scale);let a=hw(this,Kw,"f");if(null==t?void 0:t.scaleCenter){if("string"!=typeof t.scaleCenter.x||"string"!=typeof t.scaleCenter.y)throw new Error("Invalid scale center.");let e=0,n=0;if(t.scaleCenter.x.endsWith("px"))e=parseFloat(t.scaleCenter.x);else {if(!t.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");e=parseFloat(t.scaleCenter.x)/100*i;}if(t.scaleCenter.y.endsWith("px"))n=parseFloat(t.scaleCenter.y);else {if(!t.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(t.scaleCenter.y)/100*s;}if(isNaN(e)||isNaN(n))throw new Error("Invalid scale center.");a.x=Math.round(e),a.y=Math.round(n);}let l=null;if((null==t?void 0:t.bufferContainer)&&(l=t.bufferContainer),0==i||0==s)return null;1!==r&&(n.sWidth=Math.round(n.sWidth/r),n.sHeight=Math.round(n.sHeight/r),n.sx=Math.round((1-1/r)*a.x+n.sx/r),n.sy=Math.round((1-1/r)*a.y+n.sy/r));const h=this.imageDataGetter.getImageData(hw(this,Lw,"f"),i,s,n,{pixelFormat:o,bufferContainer:l});if(!h)return null;const d=Date.now();return bb._onLog&&bb._onLog("getFrameData() END: "+d),{data:h.data,width:h.width,height:h.height,pixelFormat:h.pixelFormat,timeSpent:d-e,timeStamp:d,toCanvas:hw(this,tb,"f")}}on(t,e){if(!hw(this,ib,"f").includes(t.toLowerCase()))throw new Error(`Event '${t}' does not exist.`);hw(this,eb,"f").on(t,e);}off(t,e){hw(this,eb,"f").off(t,e);}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),hw(this,eb,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",hw(this,ob,"f")),dw(this,rb,!0,"f");}}function Cb(t,e){Bs(e)&&(t.config.maxFrameNumber=e);}function Sb(t,e){Bs(e)&&(t.config.autoCaptureDelay=e);}function Pb(t,e){if(!Is(e))return;const{context:i}=t.viewer;i.core.detectorService.enableDetect&&(t.config.enableAutoDetect=e,t.isVideoPlaying&&(t.viewer.hooks.autoDetectChanged.emit(Ug.create(e)),e?t.loop.startLoop():t.config.enableAutoCapture?t.loop.cancelAnimation():t.loop.closeLoop()));}function Ab(t,e){Is(e)&&(t.config.enableAutoCapture=e,t.isVideoPlaying&&(t.viewer.hooks.autoCaptureChanged.emit(Lg.create(e)),e?t.loop.startLoop():t.config.enableAutoDetect||t.loop.closeLoop()));}function Tb(t,e){Bs(e)&&(t.config.acceptedPolygonConfidence=e);}function kb(t,e){return !!t.videoEl&&(t.config.fullscreen=e,t.videoEl.style.objectFit=e?"cover":"contain",t.loop.updateVideoLayout(),!0)}Lw=new WeakMap,Uw=new WeakMap,Ow=new WeakMap,_w=new WeakMap,Nw=new WeakMap,Ww=new WeakMap,Fw=new WeakMap,Hw=new WeakMap,Vw=new WeakMap,zw=new WeakMap,jw=new WeakMap,$w=new WeakMap,Gw=new WeakMap,Xw=new WeakMap,Yw=new WeakMap,Jw=new WeakMap,qw=new WeakMap,Zw=new WeakMap,Qw=new WeakMap,Kw=new WeakMap,tb=new WeakMap,eb=new WeakMap,ib=new WeakMap,sb=new WeakMap,nb=new WeakMap,ob=new WeakMap,rb=new WeakMap,Bw=new WeakSet,ab=async function(){const t=this.getMediaStreamConstraints();if("boolean"==typeof t.video&&(t.video={}),t.video.deviceId);else if(hw(this,Fw,"f"))delete t.video.facingMode,t.video.deviceId={exact:hw(this,Fw,"f")};else if(this.ifSaveLastUsedCamera&&bb.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),i=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&i&&(t.video.width=e,t.video.height=i);}else if(this.ifSkipCameraInspection);else {const e=async t=>{let e=null;return "environment"===t&&["Android","HarmonyOS","iPhone","iPad"].includes(mw.OS)?(await this._getCameras(!1),hw(this,Bw,"m",lb).call(this),e=bb.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):t||["Android","HarmonyOS","iPhone","iPad"].includes(mw.OS)||(await this._getCameras(!1),hw(this,Bw,"m",lb).call(this),e=bb.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),e};let i=t.video.facingMode;i instanceof Array&&i.length&&(i=i[0]),"object"==typeof i&&(i=i.exact||i.ideal);const s=await e(i);s&&(delete t.video.facingMode,t.video.deviceId={exact:s});}return t},lb=function(){if(hw(this,zw,"f")){const t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},hb=async function(t){var e,i;if(!(null===(i=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let s;try{bb._onLog&&bb._onLog("======try getUserMedia========");let e=[0,500],i=null;const n=async t=>{for(let n of e){n&&(await new Promise((t=>setTimeout(t,n))),hw(this,Bw,"m",lb).call(this));try{bb._onLog&&bb._onLog("ask "+JSON.stringify(t)),s=await navigator.mediaDevices.getUserMedia(t),hw(this,Bw,"m",lb).call(this);break}catch(t){if("NotFoundError"===t.name||"NotAllowedError"===t.name||"AbortError"===t.name||"OverconstrainedError"===t.name)throw t;i=t,bb._onLog&&bb._onLog(t.message||t);}}};if(await n(t),s||(bb._onLog&&bb._onLog("======try getUserMedia again========"),bb._onLog&&bb._onLog(t),await n(t)),s||(e=[1e3,2e3],await n(t)),s||await n(t),!s)throw i;return s}catch(t){throw null==s||s.getTracks().forEach((t=>{t.stop();})),"NotFoundError"===t.name&&(DOMException?t=new DOMException("No camera available, please use a device with an accessible camera.",t.name):(t=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),t}},db=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach((t=>{t.stop();})),this._mediaStream=null),dw(this,Uw,null,"f");},cb=async function(){dw(this,zw,!1,"f");const t=dw(this,Vw,Symbol(),"f");if(hw(this,jw,"f")&&"pending"===hw(this,$w,"f")){try{await hw(this,jw,"f");}catch(t){}hw(this,Bw,"m",lb).call(this);}if(t!==hw(this,Vw,"f"))return;const e=dw(this,jw,(async()=>{dw(this,$w,"pending","f");try{if(this.videoSrc){if(!hw(this,Lw,"f"))throw new Error("'videoEl' should be set.");await bb.playVideo(hw(this,Lw,"f"),this.videoSrc,this.cameraOpenTimeout),hw(this,Bw,"m",lb).call(this);}else {let t=await hw(this,Bw,"m",ab).call(this);hw(this,Bw,"m",db).call(this);let e=await hw(this,Bw,"m",hb).call(this,t);await this._getCameras(!1),hw(this,Bw,"m",lb).call(this);const i=()=>{const t=e.getVideoTracks();let i,s;if(t.length&&(i=t[0]),i){const t=i.getSettings();if(t)for(let e of this._arrCameras)if(t.deviceId===e.deviceId){e._checked=!0,e.label=i.label,s=e;break}}return s},s=hw(this,Nw,"f");if("object"==typeof s.video){let n=s.video.facingMode;if(n instanceof Array&&n.length&&(n=n[0]),"object"==typeof n&&(n=n.exact||n.ideal),!(hw(this,Fw,"f")||this.ifSaveLastUsedCamera&&bb.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||s.video.deviceId)){const s=i(),o=bb.findBestCamera(this._arrCameras,n,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});o&&o!=(null==s?void 0:s.deviceId)&&(e.getTracks().forEach((t=>{t.stop();})),t.video.deviceId={exact:o},e=await hw(this,Bw,"m",hb).call(this,t),hw(this,Bw,"m",lb).call(this));}}const n=i();(null==n?void 0:n.deviceId)&&(dw(this,Fw,n&&n.deviceId,"f"),this.ifSaveLastUsedCamera&&bb.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",hw(this,Fw,"f")),"object"==typeof t.video&&t.video.width&&t.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(t.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(t.video.height))))),hw(this,Lw,"f")&&(await bb.playVideo(hw(this,Lw,"f"),e,this.cameraOpenTimeout),hw(this,Bw,"m",lb).call(this)),this._mediaStream=e;const o=e.getVideoTracks();(null==o?void 0:o.length)&&dw(this,Uw,o[0],"f"),dw(this,Ww,n,"f");}}catch(t){throw hw(this,Bw,"m",pb).call(this),dw(this,$w,null,"f"),t}dw(this,$w,"fulfilled","f");})(),"f");return e},ub=async function(){var t;if("closed"===this.state||this.videoSrc)return;const e=null===(t=hw(this,Ww,"f"))||void 0===t?void 0:t.deviceId,i=this.getResolution();await hw(this,Bw,"m",cb).call(this);const s=this.getResolution();e&&e!==hw(this,Ww,"f").deviceId&&hw(this,eb,"f").fire("camera:changed",[hw(this,Ww,"f").deviceId,e],{target:this,async:!0}),i.width==s.width&&i.height==s.height||hw(this,eb,"f").fire("resolution:changed",[{width:s.width,height:s.height},{width:i.width,height:i.height}],{target:this,async:!0}),hw(this,eb,"f").fire("played",null,{target:this,async:!0});},pb=function(){hw(this,Bw,"m",db).call(this),dw(this,Ww,null,"f"),hw(this,Lw,"f")&&(hw(this,Lw,"f").srcObject=null,this.videoSrc&&(hw(this,Lw,"f").pause(),hw(this,Lw,"f").currentTime=0)),dw(this,zw,!0,"f");try{this.resetSoftwareScale();}catch(t){}},gb=async function t(e,i){const s=t=>{if(!hw(this,Uw,"f")||!this.isVideoPlaying||t.focusTaskId!=this._focusParameters.curFocusTaskId){hw(this,Uw,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const e=new Error(`Focus task ${t.focusTaskId} canceled.`);throw e.name="DeprecatedTaskError",e}1===this._focusParameters.isDoingFocus&&Date.now()-t.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1);};let n;i=wb(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await hw(this,Uw,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),s(e),n=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise((t=>{setTimeout(t,n);})),s(e);let o=e.focusL-e.focusW/2,r=e.focusT-e.focusH/2,a=e.focusW,l=e.focusH;const h=this.getResolution();if(o>=h.width||r>=h.height)throw new Error("Invalid area.");o+a>h.width&&(a=h.width-o),r+l>h.height&&(l=h.height-r),o=Math.round(o),r=Math.round(r),a=Math.round(a),l=Math.round(l);const d=4*h.width*h.height*this._focusParameters.defaultTempBufferContainerLenRatio,c=4*a*l;let u=this._focusParameters.tempBufferContainer;if(u){const t=u.length;d>t&&d>=c?u=new Uint8Array(d):c>t&&c>=d&&(u=new Uint8Array(c));}else u=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(d,c));if(!this.imageDataGetter.getImageData(hw(this,Lw,"f"),h.width,h.height,{sx:o,sy:r,sWidth:a,sHeight:l,dWidth:a,dHeight:l},{pixelFormat:ww.RGBA,bufferContainer:u}))return hw(this,Bw,"m",t).call(this,e,i);const p=u;let g=0;for(let t=0,e=c-8;t<e;++t){let e=p[t]-p[t+8];++t;let i=p[t]-p[t+8];++t;let s=p[t]-p[t+8];++t,g+=e*e+i*i+s*s;}return -g},fb=async function t(e,i,s,n,o,r,a){let l;if(i=wb(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),n=wb(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r?r=wb(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(r=wb(Math.sqrt((i||this._focusParameters.fds.step)*(n||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await hw(this,Bw,"m",gb).call(this,e,r)),a<=s&&a<=o?l=3:s<o&&s<a?l=1:o<s&&o<a&&(l=2),(n-i)/2<=this._focusParameters.fds.step)return 3===l||(1===l?await hw(this,Uw,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):2===l&&await hw(this,Uw,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]})),!0;if(1===l)return await hw(this,Bw,"m",t).call(this,e,i,s,r,a);if(2===l)return await hw(this,Bw,"m",t).call(this,e,r,a,n,o);if(3!==l)return s=await hw(this,Bw,"m",gb).call(this,e,i),o=await hw(this,Bw,"m",gb).call(this,e,n),await hw(this,Bw,"m",t).call(this,e,i,s,n,o);let h=wb(Math.sqrt((i||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),d=wb(Math.sqrt((n||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/h)<=Math.abs(1/this._focusParameters.oldDistance-1/d)){let l=await hw(this,Bw,"m",gb).call(this,e,h);if(l<a)return await hw(this,Bw,"m",t).call(this,e,i,s,r,a,h,l);if(l==a)return await hw(this,Bw,"m",t).call(this,e,h,l,r,a);let c=await hw(this,Bw,"m",gb).call(this,e,d);if(l>a&&a<c)return await hw(this,Bw,"m",t).call(this,e,h,l,d,c,r,a);if(a==c)return await hw(this,Bw,"m",t).call(this,e,r,a,d,c);if(a>c)return await hw(this,Bw,"m",t).call(this,e,r,a,n,o,d,c)}else {let l=await hw(this,Bw,"m",gb).call(this,e,d);if(a>l)return await hw(this,Bw,"m",t).call(this,e,r,a,n,o,d,l);if(a==l)return await hw(this,Bw,"m",t).call(this,e,r,a,d,l);let c=await hw(this,Bw,"m",gb).call(this,e,h);if(c>a&&a<l)return await hw(this,Bw,"m",t).call(this,e,h,c,d,l,r,a);if(c==a)return await hw(this,Bw,"m",t).call(this,e,h,c,r,a);if(c<a)return await hw(this,Bw,"m",t).call(this,e,i,s,r,a,h,c)}return !1},mb=async function(t,e,i,s,n){var o;if(1==this._focusParameters.isDoingFocus)return !1;if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'centerPoint'.");if(!e||"string"!=typeof e)throw new Error("Invalid 'width'.");if(!i||"string"!=typeof i)throw new Error("Invalid 'height'.");const r=this.getResolution();let a=0,l=0;if(t.x.endsWith("px"))a=parseFloat(t.x);else {if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");a=parseFloat(t.x)/100*r.width;}if(t.y.endsWith("px"))l=parseFloat(t.y);else {if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");l=parseFloat(t.y)/100*r.height;}if(isNaN(a)||isNaN(l)||a<0||a>r.width||l<0||l>r.height)throw new Error("Invalid 'centerPoint'.");let h=0;if(e.endsWith("px"))h=parseFloat(e);else {if(!e.endsWith("%"))throw new Error("Invalid 'width'.");h=parseFloat(e)/100*r.width;}if(isNaN(h)||h<0)throw new Error("Invalid 'width'.");let d=0;if(i.endsWith("px"))d=parseFloat(i);else {if(!i.endsWith("%"))throw new Error("Invalid 'height'.");d=parseFloat(i)/100*r.height;}if(isNaN(d)||d<0)throw new Error("Invalid 'height'.");if(1!==hw(this,Qw,"f")){const t=hw(this,Qw,"f"),e=hw(this,Kw,"f");h/=t,d/=t,a=(1-1/t)*e.x+a/t,l=(1-1/t)*e.y+l/t;}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(o=this.getCameraCapabilities())||void 0===o?void 0:o.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const c={focusL:a,focusT:l,focusW:h,focusH:d,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},u=async(t,e,i)=>{try{(null==e||e<this._focusParameters.fds.min)&&(e=this._focusParameters.fds.min),(null==i||i>this._focusParameters.fds.max)&&(i=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let s=wb(Math.sqrt(i*(e||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),n=wb(Math.sqrt((e||this._focusParameters.fds.step)*s),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=wb(Math.sqrt(s*i),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=await hw(this,Bw,"m",gb).call(this,t,o),a=await hw(this,Bw,"m",gb).call(this,t,n),l=await hw(this,Bw,"m",gb).call(this,t,s);if(a>l&&l<r){const e=await hw(this,Bw,"m",fb).call(this,t,n,a,o,r,s,l);return this._focusParameters.isDoingFocus=0,e}if(a<l&&a<r){let i=await hw(this,Bw,"m",gb).call(this,t,e);const o=await hw(this,Bw,"m",fb).call(this,t,e,i,s,l,n,a);return this._focusParameters.isDoingFocus=0,o}if(l>r&&a>r){let e=await hw(this,Bw,"m",gb).call(this,t,i);const n=await hw(this,Bw,"m",fb).call(this,t,s,l,i,e,o,r);return this._focusParameters.isDoingFocus=0,n}if(a==l&&l<r){const e=await hw(this,Bw,"m",fb).call(this,t,n,a,s,l);return this._focusParameters.isDoingFocus=0,e}if(l==r&&a>l){const e=await hw(this,Bw,"m",fb).call(this,t,s,l,o,r);return this._focusParameters.isDoingFocus=0,e}return u(t,e,i)}catch(t){if("DeprecatedTaskError"!==t.name)throw t}};return u(c,s,n)},yb=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");if(!t||"string"!=typeof t.x||"string"!=typeof t.y)throw new Error("Invalid 'center'.");const e=this.getResolution();let i=0,s=0;if(t.x.endsWith("px"))i=parseFloat(t.x);else {if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(t.x)/100*e.width;}if(t.y.endsWith("px"))s=parseFloat(t.y);else {if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");s=parseFloat(t.y)/100*e.height;}if(isNaN(i)||isNaN(s))throw new Error("Invalid scale center.");dw(this,Kw,{x:i,y:s},"f");},vb=function(t){if("opened"!==this.state)throw new Error("Video is not playing.");const e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},bb.browserInfo=mw,bb.onWarning=null===(Mw=null===window||void 0===window?void 0:window.console)||void 0===Mw?void 0:Mw.warn;class Db{constructor(t){l(this,"isLooping",!1),l(this,"lastDetectTime",(new Date).getTime()),l(this,"loopTimer",void 0),l(this,"autoCaptureStartTime",0),l(this,"lastRenderedQuad",void 0),l(this,"animation",void 0),l(this,"cameraContext",void 0),l(this,"videoLayout",void 0),this.cameraContext=t;}getLoopState(){const{enableAutoCapture:t,enableAutoDetect:e}=this.cameraContext.config;return t||e}clearLoopTimer(){clearTimeout(this.loopTimer),this.loopTimer=null,this.isLooping=!1,this.autoCaptureStartTime=0,this.lastDetectTime=(new Date).getTime();}loopTimeout(){if(!this.cameraContext.isVideoPlaying&&!this.getLoopState())return;const t=this.getDetectRemainTime();this.loopTimer=setTimeout((async()=>{if(!this.getLoopState()||this.isLooping)return;this.isLooping=!0;const t=await this.loopTaskDetail();this.isLooping=!1,t&&this.getLoopState()&&setTimeout((()=>{this.getLoopState()&&this.loopTimeout();}),10);}),t);}async loopTaskDetail(){if(!(this.cameraContext&&this.cameraContext.isVideoPlaying&&this.cameraContext.videoEl&&this.cameraContext.canvasEl))return !1;if(!this.getLoopState())return !1;const{viewer:t}=this.cameraContext;if(this.lastDetectTime=(new Date).getTime(),!t.context.viewService.isBindContainer)return !0;if("hidden"===t.getViewerConfig().visibility)return !1;const{config:e}=this.cameraContext,{enableDetect:i}=t.context.core.detectorService,s=this.cameraContext.getFrameData();if(!s)return !1;const n={type:1,data:s.data.buffer,height:s.height,width:s.width};let o={success:!1};var r;i&&(o=await this.getDetectResult(n),0===s.data.length&&(s.data=new Uint8Array(n.data)),e.enableAutoDetect&&this.cameraContext.isVideoPlaying&&o.success&&null!==(r=o)&&void 0!==r&&r.location?(this.lastRenderedQuad?this.createDetectAnimation(this.lastRenderedQuad,o.location):this.drawQuadrilateral(o.location),this.lastRenderedQuad=o.location):(this.clearCanvas(),this.lastRenderedQuad=null));let a=!1;var l;if(e.enableAutoCapture){if((null===(l=o)||void 0===l?void 0:l.status)===xc.AUTO_CAPTURE&&(a=!0),!i)if(this.autoCaptureStartTime<=0)this.autoCaptureStartTime=(new Date).getTime();else {(new Date).getTime()-this.autoCaptureStartTime>e.autoCaptureDelay&&(this.autoCaptureStartTime=0,a=!0);}}else this.autoCaptureStartTime=0;if(a){var h,d,c;if(null===(h=this.cameraContext.viewer)||void 0===h||!h.context)return !1;const t=await this.cameraContext.viewer.context.core.processService.resize(s.data.buffer,1,s.width,s.height,-1);if(this.cameraContext.isCapturedPages=!0,null===(d=this.cameraContext.viewer)||void 0===d||!d.context)return !1;await this.cameraContext.viewer.context.loadSource({extraPageData:[{index:0,perspectiveQuad:null===(c=o)||void 0===c?void 0:c.location}],fileData:t.data}),this.startCaptureAnimation(),await Eb(),this.closeCaptureAnimation();}return !0}getDetectRemainTime(){const t=(new Date).getTime(),{maxFrameNumber:e}=this.cameraContext.config,i=t-this.lastDetectTime;return Math.max(0,1e3/e-i)}startLoop(){this.loopTimer||(this.getLoopState()?this.loopTimeout():(this.clearLoopTimer(),this.clearCanvas()));}closeLoop(){if(!this.loopTimer)return;const{context:t}=this.cameraContext.viewer,{detectorService:e}=t.core;e.resetDetector(),this.clearLoopTimer(),this.clearCanvas(),cancelAnimationFrame(this.animation);}updateVideoLayout(){const{videoEl:t,config:e}=this.cameraContext,{fullscreen:i}=e,{videoWidth:s,videoHeight:n}=t,{width:o,height:r}=t.getBoundingClientRect(),a={zoom:1,left:0,top:0};if(i){const t=Math.max(o/s,r/n);a.zoom=t;}else {const t=Math.min(o/s,r/n),e=(o-s*t)/2,i=(r-n*t)/2;a.zoom=t,a.left=e,a.top=i;}this.videoLayout=a;}async getDetectResult(t){const{cameraContext:e}=this,{context:i}=e.viewer,{detectorService:s}=i.core;if(!s.enableDetect)return Promise.resolve({success:!1});let n=t;if(!t){const t=e.getFrameData();n={type:1,data:t.data.buffer,height:t.height,width:t.width};}const{acceptedPolygonConfidence:o,enableAutoCapture:r,autoCaptureDelay:a}=e.config,l={acceptedPolygonConfidence:o,enableAutoCapture:r,autoCaptureDelay:a},h=await s.detect(n,l);return h||Promise.resolve({success:!1})}drawQuadrilateral(t){if(!this.loopTimer)return;const{canvasEl:e,viewer:i}=this.cameraContext,{zoom:s,left:n,top:o}=this.videoLayout,r=e.getContext("2d");r.save(),r.clearRect(0,0,e.width,e.height),r.translate(n,o),r.scale(s,s),r.beginPath(),r.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)r.lineTo(t[e][0],t[e][1]);r.closePath();const{quadSelectionStyle:a}=i.getViewerConfig(),{border:l,background:h}=a,{borderWidth:d,borderColor:c,borderStyle:u}=hn(l);let p=rr(d).value/s;0===p&&(p=1);const g="solid"===u?[0,0]:[5*p,2*p];r.strokeStyle=c,r.fillStyle=h,r.lineCap="round",r.lineWidth=p,r.setLineDash(g),r.fill(),r.stroke(),r.restore();}clearCanvas(){const{canvasEl:t}=this.cameraContext;if(!t)return;t.getContext("2d").clearRect(0,0,t.width,t.height);}cancelAnimation(){this.clearCanvas(),cancelAnimationFrame(this.animation);}createDetectAnimation(t,e){let i=0;const s=()=>{this.clearCanvas();const n=t.map(((t,s)=>{const n=e[s];return [t[0]+(n[0]-t[0])*i,t[1]+(n[1]-t[1])*i]}));this.drawQuadrilateral(n),i<1&&(i+=.2,this.animation=requestAnimationFrame(s));};s();}startCaptureAnimation(){var t,e;this.cameraContext&&null!==(t=this.cameraContext)&&void 0!==t&&t.videoEl&&null!==(e=this.cameraContext)&&void 0!==e&&e.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(0%)",this.cameraContext.canvasEl.style.visibility="hidden");}closeCaptureAnimation(){var t,e;this.cameraContext&&null!==(t=this.cameraContext)&&void 0!==t&&t.videoEl&&null!==(e=this.cameraContext)&&void 0!==e&&e.canvasEl&&(this.cameraContext.videoEl.style.filter="brightness(100%)",this.cameraContext.canvasEl.style.visibility="");}}function Eb(){return new Promise((t=>{setTimeout((()=>{t("");}),50);}))}const Ib={tag:"div",id:"ddv-camera-container",className:"ddv-camera-container",children:[{tag:"video",id:"ddv-camera-video",class:"ddv-camera-camera"},{tag:"canvas",id:"ddv-camera-canvas",class:"ddv-camera-canvas"}]},Rb={enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:65,fullscreen:!1,autoCaptureDelay:1e3};class Mb{constructor(t){var e;if(l(this,"camera",void 0),l(this,"configHandler",{}),l(this,"isHttps",!0),l(this,"lastDeviceId",void 0),l(this,"userDeviceId",void 0),l(this,"isFirstPlayed",!0),l(this,"isTurningTorch",!1),l(this,"initializing",!1),l(this,"cameraContainer",void 0),l(this,"viewer",void 0),l(this,"loop",void 0),l(this,"videoEl",void 0),l(this,"canvasEl",void 0),l(this,"config",As(Rb)),l(this,"bUser",!1),l(this,"canFrontCamera",!1),l(this,"isCapturedPages",!1),l(this,"lastEnvironmentCameraId",void 0),l(this,"cameraList",[]),l(this,"turnOnTheTorch",!1),l(this,"torchSupported",!1),this.viewer=t,this.camera=new bb,this.loop=new Db(this),this.initConfigHandler(),null!==(e=navigator)&&void 0!==e&&null!==(e=e.mediaDevices)&&void 0!==e&&e.getUserMedia||(this.isHttps=!1),this.isCaptureViewer&&this.isHttps){this.initializing=!0;const t=this.getCameras().then((t=>{this.cameraList=t;})),e=this.getFrontCamera().then((t=>{this.canFrontCamera=t,this.viewer.hooks.cameraInit.emit(zg.create(t));})).catch((t=>{}));Promise.all([t,e]).finally((()=>{this.initializing=!1;}));}this.camera.setResolution(1280,720),this.bindCameraEvents(),this.initHooks(),this.handleViewerModeChanged(),this.bindNativeEvents();}initHooks(){this.bindViewerHooks(),this.bindGlobalHooks();}handleViewerModeChanged(){const{defaultDom:t,mainAndThbContainer:e}=this.viewer.context.viewService;if(this.isCaptureViewer){if(!this.cameraContainer){const e=tm(Ib,this.viewer.postfix);this.cameraContainer=e,Object.assign(e.style,this.viewer.context.viewerConfig.canvasStyle),t.appendChild(e);const i=e.getElementsByTagName("video")[0],s=e.getElementsByTagName("canvas")[0];i.setAttribute("playsinline","true"),i.setAttribute("muted","true"),i.setAttribute("disablePictureInPicture","true"),i.setAttribute("autoplay","autoplay"),i.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),i.style.transition="opacity 300ms, filter 100ms ease",this.bindCameraVideo(i),this.bindCameraCanvas(s),this.updateCameraConfig(Rb);}im(this.cameraContainer,"flex"),em(e);}else em(this.cameraContainer),im(e,"flex");}initConfigHandler(){const t={maxFrameNumber:Cb,enableAutoCapture:Ab,enableAutoDetect:Pb,acceptedPolygonConfidence:Tb,fullscreen:kb,autoCaptureDelay:Sb};this.configHandler=t;}bindViewerHooks(){this.viewer.hooks.viewerModeChanged.on((()=>{this.isCaptureViewer&&this.getFrontCamera().then((t=>{this.canFrontCamera=t,this.viewer.hooks.cameraInit.emit(zg.create(t));})),this.handleViewerModeChanged();})),this.viewer.hooks.visibleChanged.on((t=>{this.loop.closeLoop(),"visible"===t.newVisibility&&this.loop.startLoop();}));}bindGlobalHooks(){this.viewer.context.core.documentService.onAddPagesToDoc.on((t=>{if(!this.isCapturedPages)return;const e=ig.create(t.pageUids[0]);this.viewer.emit("captured",e),this.isCapturedPages=!1;}),this.viewer);}bindCameraEvents(){const{camera:t}=this;t.on("paused",(()=>{this.loop.closeLoop();})),t.on("resumed",(()=>{this.loop.closeLoop(),this.loop.startLoop();})),t.on("before:open",(()=>{this.videoEl&&(this.videoEl.style.opacity="0");})),t.on("before:resolution:change",(()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop();})),t.on("before:camera:change",(()=>{this.videoEl&&(this.videoEl.style.opacity="0"),this.loop.closeLoop(),this.lastDeviceId=this.camera.getCamera().deviceId;})),t.on("camera:changed",(()=>{const t=eg.create(this.lastDeviceId,this.camera.getCamera().deviceId);this.viewer.emit("cameraChanged",t);})),t.on("played",(()=>{if(!this.videoEl||!this.isVideoPlaying)return;this.videoEl.style.opacity="1";const{enableTorch:t}=this.config,e=this.camera.getResolution();let i="unsupported";try{const t=this.camera.getCameraCapabilities();i=null!=t&&t.torch?"supported":"unsupported";}catch(t){}this.torchSupported="supported"===i,this.emitTorchChanged(i),"supported"===i&&t&&this.turnOnTorch().catch((()=>{this.config.enableTorch=!0;})),this.viewer.hooks.cameraPlayed.emit(_g.create(e)),this.loop.updateVideoLayout(),this.loop.closeLoop(),this.loop.startLoop();})),t.on("closed",(()=>{this.isVideoPlaying||(this.loop.closeLoop(),this.viewer.hooks.cameraClosed.emit(),this.emitTorchChanged("unsupported"));}));}emitTorchChanged(t){this.viewer.hooks.torchChanged.emit(Og.create(t));}getVPointerEvent(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=0,n=0,o=0,r=0;if(e){const{left:t,top:i}=e.getBoundingClientRect();o=t,r=i;}return t instanceof PointerEvent||t instanceof MouseEvent?(s=t.offsetX,n=t.offsetY):i?(s=t.changedTouches[0].clientX-o,n=t.changedTouches[0].clientY-r):(s=t.touches[0].clientX-o,n=t.touches[0].clientY-r),bg.create(-1,"",-1,-1,Math.floor(s),Math.floor(n),t)}triggerPlayed(t){const e=fg.create(this.camera.getCamera().deviceId,t);this.viewer.emit("played",e);}bindNativeEvents(){const t=this.canvasEl;if(!t)return;const e=t=>{const e=this.getVPointerEvent(t);this.viewer.emit("click",e);},i=t=>{this.viewer.emit("dblclick",this.getVPointerEvent(t));},s=t=>{t.preventDefault();const e=this.getVPointerEvent(t);this.viewer.emit("rightclick",e);},n=()=>{setTimeout((()=>{this.resize();}),500);},o=()=>{this.isVideoPlaying&&(this.loop.closeLoop(),"visible"===document.visibilityState&&this.loop.startLoop());};t.addEventListener("click",e),t.addEventListener("dblclick",i),t.addEventListener("contextmenu",s),document.addEventListener("visibilitychange",o),window.addEventListener("orientationchange",n),this.viewer.hooks.destroy.on((()=>{t.removeEventListener("click",e),t.removeEventListener("dblclick",i),t.removeEventListener("contextmenu",s),document.removeEventListener("visibilitychange",o),window.removeEventListener("orientationchange",n);}));}get isCaptureViewer(){return this.viewer.context.viewerConfig.viewerMode===vp.CAPTURE}get isVideoPlaying(){return !!this.camera&&this.camera.isVideoPlaying}async getFrontCamera(){if(!this.isHttps)return zc.reject(zc.CAMERA_NEED_HTTPS);const t=await bb.testCameraAccess({video:{facingMode:{exact:"user"}}});return Promise.resolve(t.ok)}convertCamera(){if(!this.canFrontCamera)return Promise.reject();if("opening"===this.camera.state)return Promise.resolve();if(!this.bUser){const t=this.getCamera().deviceId;return this.camera.switchToFrontCamera().then((()=>(this.bUser=!0,this.lastEnvironmentCameraId=t,this.torchSupported&&this.emitTorchChanged("unsupported"),Promise.resolve())))}return this.setCamera(this.lastEnvironmentCameraId).then((()=>(this.bUser=!1,this.torchSupported&&this.emitTorchChanged("supported"),Promise.resolve())))}getFrameData(){if(!this.config.fullscreen)return this.camera.getFrameData();const{width:t,height:e}=this.videoEl.getBoundingClientRect(),i=this.videoEl.videoWidth,s=this.videoEl.videoHeight,n=Math.max(t/i,e/s),o=t/(i*n),r=e/(s*n),a=Math.floor((1-o)/2*i),l=Math.floor((1-r)/2*s),h=Math.floor(i*o),d=Math.floor(s*r);return this.camera.getFrameData({position:{sx:a,sy:l,sWidth:h,sHeight:d,dWidth:h,dHeight:d}})}updateCameraConfig(t){for(const[e,i]of Object.entries(t)){const t=this.configHandler[e];t&&!Ts(i)&&t(this,i);}}bindCameraVideo(t){t instanceof HTMLVideoElement&&(this.camera.setVideoEl(t),this.videoEl=t);}bindCameraCanvas(t){t instanceof HTMLCanvasElement&&(this.canvasEl=t);}async capture(){this.loop.startCaptureAnimation(),await Eb(),this.loop.closeCaptureAnimation(),zc.verbose(`[${Date.now()}][cv] start capture`);const t=this.getFrameData();if(zc.verbose(`[${Date.now()}][cv] get frame done`),!t)return null;const e={type:1,data:t.data.buffer,width:t.width,height:t.height},i=await this.loop.getDetectResult(e);zc.verbose(`[${Date.now()}][cv] get detect result done`),0===t.data.length&&(t.data=new Uint8Array(e.data));const s=await this.viewer.context.core.processService.resize(t.data.buffer,1,t.width,t.height,-1);return zc.verbose(`[${Date.now()}][cv] create image done`),this.isCapturedPages=!0,await this.viewer.context.loadSource({fileData:s.data,extraPageData:[{index:0,perspectiveQuad:i.success?i.location:void 0}]}),zc.verbose(`[${Date.now()}][cv] capture done`),s.data}async play(t){if(!this.isHttps)return Promise.reject(zc.CAMERA_NEED_HTTPS);if(!t&&this.isVideoPlaying)return Promise.resolve();const{fill:e,resolution:i}=t||{},s=this.camera.getResolution();if(Is(e)&&this.updateCameraConfig({fullscreen:e}),this.isVideoPlaying&&Bb(i)&&i[0]===s.width&&i[1]===s.height)return Promise.resolve();let n=[s.width,s.height];if(Bb(i)){if(this.isVideoPlaying)return this.camera.setResolution(i[0],i[1]).then((t=>(this.resize(),this.triggerPlayed(i),Promise.resolve()))).catch();this.camera.setResolution(i[0],i[1]),n=i;}return !this.isFirstPlayed||this.isVideoPlaying||i||"opening"===this.camera.state||(this.camera.setResolution(1280,720),n=[1280,720]),this.initializing&&await new Promise((t=>{const e=setInterval((()=>{this.initializing||(clearInterval(e),t(""));}),100);})),this.isFirstPlayed&&(this.isFirstPlayed=!1),this.camera.open().then((async()=>(this.resize(),this.triggerPlayed(n),Promise.resolve()))).catch((t=>{let e=zc.CAMERA_OCCUPIED;return "Permission denied"===t.message&&(e=zc.CAMERA_DENIED),8===t.code&&(e=zc.CAMERA_NO_CAMERA),Promise.reject(e)}))}stop(){var t;this.loop.closeLoop(),this.viewer.emit("stopped",xg.create(this.getCamera().deviceId)),null===(t=this.camera)||void 0===t||t.close();}async setCamera(t){let e="";Ps(t)?e=t.deviceId||"":Ls(t)&&(e=t);let i=!1;for(let t=0;t<this.cameraList.length;t++)this.cameraList[t].deviceId===e&&(i=!0);if(!i)return Promise.reject(zc.CAMERA_NOT_EXIST);await this.camera.setCamera(e).catch((t=>{let e=zc.CAMERA_OCCUPIED;"Permission denied"===t.message&&(e=zc.CAMERA_DENIED),8===t.code&&(e=zc.CAMERA_NO_CAMERA),Promise.reject(e);}));const s=this.camera.getResolution(),n={deviceId:e,width:s.width,height:s.height};return this.isVideoPlaying&&this.triggerPlayed([s.width,s.height]),Promise.resolve(n)}getCamera(){const t=this.camera.getCamera();return {deviceId:t.deviceId,label:t.label}}async getCameras(){const t=(await this.camera.getAllCameras()).map((t=>({deviceId:t.deviceId,label:t.label})));return Promise.resolve(t)}async setResolution(t,e){const i=this.camera.getCamera();if(!i||""===i.deviceId)return Promise.reject(zc.CAMERA_NOT_EXIST);let s;if(Bs(t))s=t;else if(Ss(t)){const[i,n]=t;s=i,e=n;}let n=this.camera.getResolution();return Bs(s)&&Bs(e)&&(this.loop.closeLoop(),n=await this.camera.setResolution(s,e).catch((t=>{}))),this.camera&&this.isVideoPlaying&&this.triggerPlayed([n.width,n.height]),Promise.resolve({deviceId:i.deviceId,...n})}getResolution(){const t=this.camera.getCamera();if(!t||""===t.deviceId)return [0,0];const e=this.camera.getResolution();return [e.width,e.height]}async getResolutions(){const t=(await this.camera.getResolutions()).map((t=>[t.width,t.height]));return Promise.resolve(t)}turnOnTorch(){const t=this.camera.getCamera();return t&&""!==t.deviceId?this.isTurningTorch?Promise.resolve():(this.isTurningTorch=!0,this.camera.turnOnTorch().then((()=>(this.isTurningTorch=!1,this.turnOnTheTorch=!0,this.config.enableTorch=!0,this.emitTorchChanged("on"),Promise.resolve()))).catch((t=>(this.isTurningTorch=!1,this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),zc.reject(zc.CAMERA_NOT_SUPPORT_TORCH))))):Promise.reject(zc.CAMERA_NO_VIDEO)}turnOffTorch(){const t=this.camera.getCamera();return t&&""!==t.deviceId?this.camera.turnOffTorch().then((()=>(this.turnOnTheTorch=!1,this.config.enableTorch=!1,this.emitTorchChanged("off"),Promise.resolve()))).catch((t=>zc.reject(zc.CAMERA_NOT_SUPPORT_TORCH))):Promise.reject(zc.CAMERA_NO_VIDEO)}resize(){const{canvasEl:t}=this,{width:e,height:i}=t.getBoundingClientRect();t.width=Math.floor(e),t.height=Math.floor(i),this.loop.updateVideoLayout();}dispose(){var t,e;this.stop(),null===(t=this.loop)||void 0===t||t.closeLoop(),null===(e=this.camera)||void 0===e||e.dispose(),this.camera=null,this.loop=null,this.videoEl=null,this.canvasEl=null;}}function Bb(t){return !!(Ss(t)&&Bs(t[0])&&Bs(t[1]))}const Lb={install(t){const e=t.getClass("Viewer"),i=(s=e,class extends s{constructor(t){if(super(t),l(this,"cameraContext",void 0),this.context.viewerConfig.viewerMode===vp.CAPTURE){this.cameraContext=new Mb(this);const e=Rb;Ps(t.viewerConfig)&&["enableTorch","enableAutoCapture","enableAutoDetect","acceptedPolygonConfidence","maxFrameNumber","autoCaptureDelay"].forEach((i=>{i in t.viewerConfig&&(e[i]=t.viewerConfig[i]);})),this.cameraContext.config={...e,defaultCameraConfig:Rb},this.on("resized",(()=>{this.cameraContext.resize();}));}}isVideoPlaying(){return this.cameraContext.isVideoPlaying}convertCamera(){return this.cameraContext.convertCamera()}getCameraConfig(){return As(this.cameraContext.config)}updateCameraConfig(t){Ps(t)&&this.cameraContext.updateCameraConfig(t);}capture(){return this.cameraContext.capture()}play(t){return this.cameraContext.play(t)}stop(){this.isVideoPlaying()?this.cameraContext.stop():zc.warning(zc.CAMERA_NO_VIDEO);}getCurrentCamera(){return this.cameraContext.getCamera()}getAllCameras(){return this.cameraContext.getCameras()}selectCamera(t){return this.cameraContext.setCamera(t)}getCurrentResolution(){return this.cameraContext.getResolution()}getResolutions(){return this.cameraContext.getResolutions()}setResolution(t,e){return this.cameraContext.setResolution(t,e)}turnOnTorch(){return this.cameraContext.turnOnTorch()}turnOffTorch(){return this.cameraContext.turnOffTorch()}dispose(){var t;this.cameraContext&&(null===(t=this.cameraContext)||void 0===t||t.dispose()),this.cameraContext=null,super.dispose();}});var s;t.setClass("Viewer",i);}};class Ub{constructor(t){l(this,"uid",void 0),l(this,"areaUid",void 0),l(this,"isRect",!0),l(this,"vertexes",[]),l(this,"midpoints",[]),l(this,"points",[]),l(this,"keepAspectRatio",!1),l(this,"isConvex",!0),l(this,"renderer",void 0),l(this,"area",void 0),l(this,"slopeRatio",[]),l(this,"selectedPart",-1),l(this,"startX",null),l(this,"startY",null),l(this,"lastX",null),l(this,"lastY",null),l(this,"lastAspectRatio",1),l(this,"b1",void 0),l(this,"b2",void 0),l(this,"k1",void 0),l(this,"k2",void 0),this.uid=_s(),Object.assign(this,t),this.initBox(t.vertexes);}initBox(t){this.vertexes=t,this.midpoints=Ob(this.vertexes),this.points=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=en(this.vertexes);}getRect(){if(!this.isRect)return null;const{minX:t,maxX:e,minY:i,maxY:s}=this.getBounds();return {left:t,top:i,width:e-t||1,height:s-i||1}}getQuad(){if(this.isRect)return null;const{points:t}=this,e=[];for(let i=0;i<4;i++)e.push([t[2*i],t[2*i+1]]);return e}getActivePartNum(t,e,i){const s=this.getSelectedCtrlPointNum(t,e,i);if(s>-1)return s;return this.isPointOnBox(t,e)?8:-1}getSelectedCtrlPointNum(t,e,i){const{points:s}=this,{width:n,height:o,zoom:r}=this.area,{ctrlWidth:a,ctrlHeight:l,ctrlRadiusMultipleMobile:h}=this.renderer.config.boxStyle;let d=l/2/r,c=a/2/r;i&&(c*=h,d*=h);const u=Us(c,0,3*c),p=Us(d,0,3*d);for(let i=0;i<8;i++){const r=s[2*i],a=s[2*i+1];if(t<=r+u&&t>=r-u&&e<=a+p&&e>=a-p&&t>=0-u&&t<=n+u&&e>=0-p&&e<=o+p&&(i<4&&this.renderer.config.enableEditCropBoxVertices||this.renderer.config.enableEditCropBoxMidpoints))return i}return -1}checkOrientation(t){if(t<0||t>7)return null;const{minX:e,maxX:i,minY:s,maxY:n}=this.getBounds(),{points:o}=this,r=o[2*t],a=o[2*t+1];let l="",h="";return r===i?l="e":r===e&&(l="w"),a===n?h="s":a===s&&(h="n"),t<4?h+l:h||l}onStartHandler(t,e,i,s){var n;if(null!==(n=i)&&void 0!==n||(i=this.getActivePartNum(t,e,s)),!(i<0)&&(this.startX=t,this.startY=e,this.lastX=t,this.lastY=e,this.selectedPart=i,!this.isRect&&i>3&&i<8)){const{points:t,slopeRatio:e}=this,s=i-4;this.k1=e[(s+1)%4],this.b1=t[(2*s+3)%8]-this.k1*t[(2*s+2)%8],this.k2=e[(s+3)%4],this.b2=t[(2*s+1)%8]-this.k2*t[(2*s+0)%8];}}onMoveHandler(t,e,i){const{selectedPart:s}=this;if(s<0)return;const n=t-this.lastX,o=e-this.lastY;if(0===n&&0===o)return;const{points:r}=this;let a=r.slice();var l;s<8?(null!==(l=i)&&void 0!==l||(i=s),this.isRect?a=this.moveRectPoint(a,i,t,e):(a=this.moveQuadPoint(a,i,t,e),this.slopeRatio=en(r).slice(0,4),this.isConvex=sn(a))):8===s&&(a=this.moveBox(a,n,o));const h=Ob(a);this.points=a.slice(0,8).concat(h),this.midpoints=h,this.lastX=t,this.lastY=e;}onEndHandler(){const{startX:t,startY:e,vertexes:i,midpoints:s,lastX:n,lastY:o,selectedPart:r}=this;if(r<0)return;this.startX=0,this.startY=0,this.selectedPart=-1;let a=this.points.slice();const l=sn(a);(t===n&&e===o||!l)&&(a=i.slice().concat(s)),this.isConvex=!0,this.vertexes=a.slice(0,8),this.midpoints=Ob(a),this.points=a.slice(0,8).concat(this.midpoints),this.slopeRatio=en(a).slice(0,4);}getBounds(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.points;return {minX:Math.min(t[0],t[2],t[4],t[6]),maxX:Math.max(t[0],t[2],t[4],t[6]),minY:Math.min(t[1],t[3],t[5],t[7]),maxY:Math.max(t[1],t[3],t[5],t[7])}}moveRectPoint(t,e,i,s){let n=0,o=0;const{enableEditCropBoxMidpoints:r,enableEditCropBoxVertices:a}=this.renderer.config;if(this.keepAspectRatio){const{minX:l,maxX:h,minY:d,maxY:c}=this.getBounds(),u=this.checkOrientation(e);let p=(h-l)/(c-d);0===p||p===1/0||p===-1/0||Number.isNaN(p)?p=this.lastAspectRatio:this.lastAspectRatio=p,n=0,o=0;let g="w",f=!1;if(e<4){if(a){if(f=!0,n=i-t[2*e],o=s-t[2*e+1],0===n||0===o)return t;g="w";}}else {const a=e-4;if(r){f=!0;const r={e:[(a+1)%4,"w"],s:[a,"h"],w:[a,"w"],n:[(a+1)%4,"h"]};if(["e","s","w","n"].includes(u)&&([e,g]=r[u]),n=i-t[2*a],o=s-t[2*a+1],0===n||0===o)return t}}if(f){const i=["ne","sw","n","w"];"h"===g?(n=o*p,i.includes(u)&&(n=-n)):(o=n/p,i.includes(u)&&(o=-o));const s=t[2*e]+n,r=t[2*e+1]+o,{width:a,height:l}=this.area;s<0?(n=0-t[2*e],o=0):s>a?(n=a-t[2*e],o=0):r<0?(o=0-t[2*e+1],n=0):r>l&&(o=l-t[2*e+1],n=0),t[2*e]+=n,t[2*e+1]+=o;const h=(e+1)%4,d=(e+3)%4;e%2?(t[2*h]+=n,t[2*d+1]+=o):(t[2*h+1]+=o,t[2*d]+=n);}}else if(e<4){if(a){if(n=i-t[2*e],o=s-t[2*e+1],0===n&&0===o)return t;t[2*e]=i,t[2*e+1]=s;const r=(e+1)%4,a=(e+3)%4;e%2?(t[2*r]=i,t[2*a+1]=s):(t[2*r+1]=s,t[2*a]=i);}}else {const n=e-4;if(r){const e=this.slopeRatio[n%4];0===e?(t[(2*n+3)%8]=s,t[(2*n+1)%8]=s):e!==1/0&&e!==-1/0||(t[(2*n+2)%8]=i,t[(2*n+0)%8]=i);}}return t}moveQuadPoint(t,e,i,s){const n=t.slice();if(e<4){const n=i-t[2*e],o=s-t[2*e+1];if(0===n&&0===o)return t;t[2*e]=i,t[2*e+1]=s;}else {const o=e-4,r=this.slopeRatio[o%4],a=s-r*i,l=-a/r,h=a,d=t[(2*o+9)%8]-r*t[(2*o+8)%8],c=-d/r,{k1:u,b1:p,k2:g,b2:f}=this;0===r?(t[(2*o+3)%8]=s,u!==1/0&&u!==-1/0&&(t[(2*o+2)%8]=(s-p)/u),t[(2*o+1)%8]=s,g!==1/0&&g!==-1/0&&(t[(2*o+0)%8]=(s-f)/g)):r===1/0||r===-1/0?(t[(2*o+2)%8]=i,t[(2*o+3)%8]=u*i+p,t[(2*o+0)%8]=i,t[(2*o+1)%8]=g*i+f):(0===u?t[(2*o+2)%8]+=l-c:u===1/0||u===-1/0?t[(2*o+3)%8]+=h-d:(t[(2*o+2)%8]=(p-a)/(r-u),t[(2*o+3)%8]=(r*p-u*a)/(r-u)),0===g?t[(2*o+0)%8]+=l-c:g===1/0||g===-1/0?t[(2*o+1)%8]+=h-d:(t[(2*o+0)%8]=(f-a)/(r-g),t[(2*o+1)%8]=(r*f-g*a)/(r-g)));for(let e=0;e<4;e++){const i=t[2*e],s=t[2*e+1];if(i<0||i>this.area.width||s<0||s>this.area.height)return n}}return t}moveBox(t,e,i){const{minX:s,maxX:n,minY:o,maxY:r}=this.getBounds(t);e=Us(e,-s,this.area.width-n),i=Us(i,-o,this.area.height-r);for(let s=0;s<4;s++)t[2*s]+=e,t[2*s+1]+=i;return t}isPointOnBox(t,e){if(this.isRect){const{minX:i,maxX:s,minY:n,maxY:o}=this.getBounds();return t>=i&&t<=s&&e>=n&&e<=o}const i=[...this.vertexes],s=[...this.midpoints],n=[];for(let t=0;t<4;t++)n.push([i[2*t],i[2*t+1]]),n.push([s[2*t],s[2*t+1]]);return function(t,e){let i,s,n,o,r=0;const a=e.length;for([n]=e,i=1;i<=a;i++)o=e[i%a],t[0]>Math.min(n[0],o[0])&&t[0]<=Math.max(n[0],o[0])&&t[1]<=Math.max(n[1],o[1])&&n[0]!==o[0]&&(s=(t[0]-n[0])*(o[1]-n[1])/(o[0]-n[0])+n[1],(n[1]===o[1]||t[1]<=s)&&(r+=1)),n=o;if(r%2==0)return !1;return !0}([t,e],n)}}function Ob(t){const e=t.slice(0,8).concat(t[0],t[1]),i=[];for(let t=0;t<4;t++){const s=(e[2*t]+e[2*(t+1)])/2,n=(e[2*t+1]+e[2*(t+1)+1])/2;i.push(s,n);}return i}class _b{constructor(t,e,i){l(this,"areaUid",void 0),l(this,"left",void 0),l(this,"top",void 0),l(this,"width",void 0),l(this,"height",void 0),l(this,"boxes",void 0),l(this,"isVisible",!0),l(this,"zoom",1),l(this,"oldRect",void 0),l(this,"oldQuad",void 0),l(this,"isModified",!1),l(this,"isDrawNewBox",!1),l(this,"activeBoxUid",void 0),l(this,"activePartNum",-1),l(this,"startX",void 0),l(this,"startY",void 0),l(this,"isMouseDown",!1),l(this,"isDrawing",!1),l(this,"renderer",void 0),this.renderer=t,this.areaUid=e,this.boxes=[],this.updateAreaRect(i);}hasActiveBox(){return !!this.activeBoxUid}getFullVertexes(){return [0,0,this.width,0,this.width,this.height,0,this.height]}isContainRect(t){return t.left>=0&&t.left<=this.width&&t.left+t.width<=this.width&&t.top>=0&&t.top<=this.height&&t.top+t.height<=this.height}isContainBox(t){const e=t.getRect();return this.isContainRect(e)}isFullBox(t){const{vertexes:e}=t;return 0===e[0]&&0===e[1]&&e[2].toFixed(2)===this.width.toFixed(2)&&0===e[3]&&e[4].toFixed(2)===this.width.toFixed(2)&&e[5].toFixed(2)===this.height.toFixed(2)&&0===e[6]&&e[7].toFixed(2)===this.height.toFixed(2)}addRectBox(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t=this.handleBoundary(t),this.addBox(t,!0,e)}updateRectBox(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=t.getRect(),n=t.getQuad();if(e=this.handleBoundary(e),t.initBox(e),i){const e={box:t};t.isRect?(e.oldRect=s,e.newRect=t.getRect()):(e.oldQuad=n,e.newQuad=t.getQuad()),this.renderer.hooks.boxModified.emit(e);}}handleBoundary(t){t=[...t];for(let e=0;e<4;e++){const i=[t[2*e],t[2*e+1]];i[0]=Us(i[0],0,this.width),i[1]=Us(i[1],0,this.height),[t[2*e],t[2*e+1]]=i;}return t}addQuadBox(t){return this.addBox(t,!1)}addBox(t){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=new Ub({isRect:!(arguments.length>1&&void 0!==arguments[1])||arguments[1],area:this,renderer:this.renderer,vertexes:[...t],keepAspectRatio:this.renderer.config.keepAspectRatio});return this.boxes.push(i),e&&this.renderer.hooks.boxCreated.emit(i),i}getBoxRects(){return this.boxes.map(((t,e)=>({index:e,...t.getRect()})))}getBoxByUid(t){return this.boxes.find((e=>e.uid===t))}deleteBoxByUid(t){const e=this.boxes.findIndex((e=>e.uid===t));e>-1&&this.boxes.splice(e,1);}clearBoxes(){this.boxes.length=0;}updateAreaRect(t){this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height;}setKeepAspectRatio(t){this.isDrawing||this.boxes.forEach((e=>{e.keepAspectRatio=t;}));}isTouchedPoint(t,e,i){return t=Us(t,0,this.width),e=Us(e,0,this.height),this.boxes.some((s=>{const n=s.getActivePartNum(t,e,i);return n>-1&&n<8}))}isTouchedBox(t,e,i){return t=Us(t,0,this.width),e=Us(e,0,this.height),this.boxes.some((s=>s.getActivePartNum(t,e,i)>-1))}onStartHandler(t,e,i){this.isMouseDown=!0,t=Us(t,0,this.width),e=Us(e,0,this.height),this.startX=t,this.startY=e;const s=this.boxes.find((s=>{const n=s.getActivePartNum(t,e,i);return n>-1&&(this.activePartNum=n),n>-1}));s&&(this.oldRect=s.getRect(),this.oldQuad=s.getQuad(),this.activeBoxUid=s.uid,s.keepAspectRatio=this.renderer.config.keepAspectRatio,s.onStartHandler(t,e,void 0,i));}onMoveHandler(t,e,i,s){if(!this.isMouseDown)return;let n;if(t=Us(t,0,this.width),e=Us(e,0,this.height),this.activeBoxUid){n=this.getBoxByUid(this.activeBoxUid);const{keepAspectRatioWithShift:s,keepAspectRatio:o,enableMoveQuad:r}=this.renderer.config;if(n.isRect)n.keepAspectRatio=!(!i||!s)||o;else if(!r&&8===this.activePartNum)return;return n.onMoveHandler(t,e),void(this.isModified=!0)}const{enableCreateBoxByPointer:o,enableMultiple:r}=this.renderer.config;if((r||!this.boxes.length)&&o){const{startX:i,startY:o}=this;let r=e-o;const a=t-i;let l=-1;const h=2/this.zoom;if(a<-h&&r<-h?l=0:a>h&&r<-h?l=1:a>h&&r>h?l=2:a<-h&&r>h&&(l=3),l>-1){const{aspectRatio:h}=this.renderer.config;h>0&&(r=a/h,l%2&&(r=-a/h));const d=[],c=l%2?[i,o,i,o+r,t,o+r,t,o]:[t,o+r,i,o+r,i,o,t,o];for(let t=0;t<4;t++)d.push(c[2*(l+t)%8]),d.push(c[(2*(l+t)+1)%8]);n=this.addRectBox(d,!1),this.isDrawNewBox=!0,n.keepAspectRatio=h>0,this.isDrawing=!0,this.activeBoxUid=n.uid,n.onStartHandler(this.startX,this.startY,l,s),n.onMoveHandler(t,e,l);}}}onEndHandler(){if(!this.isMouseDown||!this.activeBoxUid)return;this.isMouseDown=!1;const t=this.getBoxByUid(this.activeBoxUid);if(t.keepAspectRatio=this.renderer.config.keepAspectRatio,t.onEndHandler(),this.isDrawNewBox)this.isDrawNewBox=!1,this.renderer.hooks.boxCreated.emit(t);else if(this.isModified){const e={box:t};t.isRect?(e.oldRect=this.oldRect,e.newRect=t.getRect()):(e.oldQuad=this.oldQuad,e.newQuad=t.getQuad()),this.renderer.hooks.boxModified.emit(e);}this.oldRect=null,this.oldQuad=null,this.isModified=!1,this.isDrawing=!1,this.activeBoxUid=null,this.activePartNum=-1;}isPointHover(t){let[e,i]=t;return e>=0&&e<=this.width&&i>=0&&i<=this.height}getCursorInfo(t,e,i){for(let s=this.boxes.length-1;s>=0;s--){const n=this.boxes[s],o=n.getActivePartNum(t,e,i);if(o>-1){let t="move";return o<8&&(t=n.checkOrientation(o)),{part:o,position:t,isRect:n.isRect}}}return null}}const Nb={aspectRatio:0,keepAspectRatio:!1,keepAspectRatioWithShift:!0,enableMultiple:!1,enableCreateBoxByPointer:!0,enableCursor:!0,enableMask:!0,enableMagnifier:!0,moveThreshold:2,enableMoveQuad:!1,magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2},boxStyle:{borderColor:"orange",borderWidth:2,borderStyle:[5,2],background:"rgba(255,255,255,0)",ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlWidth:16,ctrlHeight:16,ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",ctrlRadiusMultipleMobile:2},defaultCursor:"default",enableEditCropBoxVertices:!0,enableEditCropBoxMidpoints:!0,enableHideEditingCropBoxVertex:!0,enableHideEditingCropBoxMidpoint:!0};class Wb{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(this,"areas",void 0),l(this,"scrollTop",0),l(this,"scrollLeft",0),l(this,"zoom",1),l(this,"config",void 0),l(this,"canvasDom",void 0),l(this,"isMousedown",!1),l(this,"isEditing",!1),l(this,"editingCursor","crosshair"),l(this,"hoveredArea",void 0),l(this,"hooks",{boxCreated:zs(),boxModified:zs(),boxDeleted:zs()}),this.areas=new Map,this.zoom=1,this.config=As(Nb),vn(t,this.config),this.setCanvasDom(t.canvas);}setCanvasDom(t){t&&(this.canvasDom=t);}updateConfig(t){vn(t,this.config);}addArea(t,e){if(this.areas.has(t)){const i=this.areas.get(t);return i.updateAreaRect(e),i}const i=new _b(this,t,e);return this.areas.set(t,i),i}deleteArea(t){if(this.areas.has(t)){this.areas.get(t).boxes.forEach((t=>{this.hooks.boxDeleted.emit(t);})),this.areas.delete(t);}}clearArea(){this.areas.forEach((t=>{t.boxes.forEach((t=>{this.hooks.boxDeleted.emit(t);}));})),this.areas.clear();}clearAreaBoxes(t){if(this.areas.has(t)){const e=this.areas.get(t);e.boxes.forEach((t=>{this.hooks.boxDeleted.emit(t);})),e.clearBoxes();}}addRectBox(t,e){return this.areas.get(e).addRectBox(t)}addQuadBox(t,e){return this.areas.get(e).addQuadBox(t)}updateOptions(t){Object.assign(this,t),Bs(t.zoom)&&this.areas.forEach((e=>{e.zoom=t.zoom;}));}getAreaByUid(t){return this.areas.get(t)}deleteAreaByUid(t){this.areas.delete(t);}getHoveredArea(t){const e=this.nativeToCanvas(t);for(const t of this.areas.values()){const i=this.canvasToArea(e,t);if(t.isPointHover(i)&&t.isVisible)return t}return null}getHoveredAreaForCursor(t){const e=dn(t),i=this.nativeToCanvas(t);for(const t of this.areas.values()){const s=this.canvasToArea(i,t),[n,o]=s,r=t.isVisible&&t.boxes.find((t=>t.getActivePartNum(n,o,e)>-1));if(t.isPointHover(s)||r)return t}return null}isControlPointTouched(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return !1;const i=this.nativeToCanvas(t),[s,n]=this.canvasToArea(i,e),o=dn(t);return e.isTouchedPoint(s,n,o)}isBoxTouched(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return !1;const i=this.nativeToCanvas(t),[s,n]=this.canvasToArea(i,e),o=dn(t);return e.isTouchedBox(s,n,o)}onStartHandler(t){const e=this.getHoveredArea(t);if(!e||!e.isVisible)return;this.hoveredArea=e,this.isMousedown=!0;const i=this.nativeToCanvas(t),[s,n]=this.canvasToArea(i,e),o=dn(t);e.onStartHandler(s,n,o);}onMoveHandler(t){if(!this.canvasDom)return;const{defaultCursor:e}=this.config,i=this.getHoveredArea(t);if(i){if(!i.isVisible)return}else this.canvasDom.style.cursor=e;const s=dn(t),n=this.nativeToCanvas(t);if(this.isMousedown){const[e,i]=this.canvasToArea(n,this.hoveredArea);this.hoveredArea.onMoveHandler(e,i,t.shiftKey,s);}if(this.config.enableCursor&&i){const t="crosshair",o="move",{canvasDom:r}=this;if(this.hasBox()){const[a,l]=this.canvasToArea(n,i),h=i.getCursorInfo(a,l,s);let d;if(null===h)d=this.config.enableMultiple?t:e;else if(h.isRect){const e=h.position===o;this.isMousedown?this.isEditing||(this.editingCursor=e?o:t,this.isEditing=!0):d=e?o:`${h.position}-resize`;}else h.part>-1&&h.part<8?this.isMousedown?this.isEditing||(this.editingCursor=t,this.isEditing=!0):d=t:d=e;this.isEditing&&(d=this.editingCursor),r.style.cursor=d;}else r.style.cursor!==t&&(r.style.cursor=t);}}hasBox(){for(const t of this.areas.values())if(t.isVisible&&t.boxes.length)return !0;return !1}onEndHandler(t){this.isMousedown&&(this.isMousedown=!1,this.isEditing=!1,this.hoveredArea.onEndHandler(),this.hoveredArea=null);}render(){if(!this.canvasDom||!this.areas.size)return;const t=this.canvasDom.getContext("2d");t.setTransform(1,0,0,1,0,0),this.areas.forEach((e=>{e.isVisible&&e.boxes.length&&this.renderArea(t,e);}));}renderArea(t,e){const{borderStyle:i,borderColor:s,borderWidth:n,ctrlBorderColor:o,ctrlBackground:r,ctrlBorderWidth:a,ctrlBorderStyle:l,background:h,maskColor:d,invalidBorderColor:c,invalidCtrlBorderColor:u,ctrlBorderRadius:p,ctrlWidth:g,ctrlHeight:f}=this.config.boxStyle,m=devicePixelRatio,y=g*m,v=f*m,x=Math.min(p*m,y/2,v/2),w=[i[0]*m,i[1]*m],b=n*m,C=a*m,S=[l[0]*m,l[1]*m];t.save(),t.beginPath(),t.rect(e.left*m,e.top*m,e.width*e.zoom*m,e.height*e.zoom*m),t.closePath(),t.clip(),this.config.enableMask&&d&&(t.save(),t.beginPath(),t.rect(e.left*m,e.top*m,e.width*e.zoom*m,e.height*e.zoom*m),e.boxes.forEach((i=>{let s=this.areaPointsToCanvas(i.points.slice(0,8),e),n=this.areaPointsToCanvas(i.midpoints.slice(0,8),e);1!==m&&(s=s.map((t=>t*m)),n=n.map((t=>t*m))),t.moveTo(s[0],s[1]);for(let e=1;e<4;e++)t.lineTo(s[2*e],s[2*e+1]);})),t.closePath(),t.clip("evenodd"),t.fillStyle=d,t.fill(),t.restore()),e.boxes.forEach((i=>{let n=this.areaPointsToCanvas(i.points.slice(0,8),e),a=this.areaPointsToCanvas(i.midpoints.slice(0,8),e);1!==m&&(n=n.map((t=>t*m)),a=a.map((t=>t*m))),t.save(),t.setLineDash(w),t.strokeStyle=i.isConvex?s:c,t.fillStyle=""===h?"transparent":h,t.lineWidth=b,t.beginPath(),t.moveTo(n[0],n[1]);for(let e=1;e<4;e++)t.lineTo(n[2*e],n[2*e+1]);t.closePath(),t.fill(),t.stroke(),t.setLineDash(S),t.strokeStyle=i.isConvex?o:u,t.fillStyle=""===r?"transparent":r,t.lineWidth=C,this.config.enableEditCropBoxVertices&&this.drawCtrlPoints(t,n,y,v,x,this.config.enableHideEditingCropBoxVertex?i.selectedPart:-1),this.config.enableEditCropBoxMidpoints&&this.drawCtrlPoints(t,a,y,v,x,this.config.enableHideEditingCropBoxMidpoint?i.selectedPart-4:-1),t.restore();})),t.restore();}drawCtrlPoints(t,e,i,s,n,o){const r=i/2,a=s/2;for(let l=0;l<4;l++){if(l===o)continue;t.beginPath();const h=e[2*l],d=e[2*l+1];if(0===n)t.rect(h-r,d-a,i,s);else {const{PI:e}=Math;t.arc(h-r+n,d-a+n,n,e,3*e/2),t.arc(h+r-n,d-a+n,n,3*e/2,2*e),t.arc(h+r-n,d+a-n,n,0,e/2),t.arc(h-r+n,d+a-n,n,e/2,e);}t.closePath(),t.fill(),t.stroke();}}areaPointsToCanvas(t,e){const i=[];for(let s=0;s<4;s++){const[n,o]=this.areaToCanvas([t[2*s],t[2*s+1]],e);i.push(n,o);}return i}canvasToArea(t,e){let[i,s]=t;const{scrollLeft:n,scrollTop:o,zoom:r}=this;return i=(i-e.left+n)/r,s=(s-e.top+o)/r,[i,s]}areaToCanvas(t,e){let[i,s]=t;const{scrollLeft:n,scrollTop:o,zoom:r}=this;return i=i*r+e.left-n,s=s*r+e.top-o,[i,s]}nativeToCanvas(t){const e=function(t){return ["touchstart","touchend","touchmove"].includes(t.type)}(t)?t.targetTouches[0]:t,i=this.canvasDom.getBoundingClientRect(),{scrollX:s,scrollY:n}=window;return [e.pageX-s-i.left,e.pageY-n-i.top]}}class Fb{constructor(t,e){l(this,"context",void 0),l(this,"core",void 0),l(this,"boxRenderer",void 0),l(this,"viewer",void 0),l(this,"isMousedown",!1),this.viewer=t,this.context=t.context,this.core=t.context.core,this.boxRenderer=e;}isEditCropBox(t){const e=this.boxRenderer.getHoveredArea(t);return !(!e||!e.isVisible||e.boxes.length&&!this.boxRenderer.isBoxTouched(t))}mousedown(t){const{context:e}=this,i=this.context.getActiveTab();if(null==i||!i.total)return;if("crop"!==this.context.viewerConfig.toolMode)return;const[s]=this.context.formatTouches(t),{page:n}=this.context.getPointerOverPageInfo(s.pageX,s.pageY).pageInfo;if(i&&n&&n.uid!==i.currentUid){const t=i.getPageIndex(n);i.gotoPage(t),this.context.emitPageChangedEvent(i),this.context.core.viewerService.onCurrentChangedByScroll.emit(Gg.create(i.uid,e.groupUid,e.uid,t)),this.context.emitPageChangedAfterRenderEvent(i);}this.isMousedown=!0,this.boxRenderer.onStartHandler(t);}mousemove(t){const e=this.context.getActiveTab();null!=e&&e.total&&"crop"===this.context.viewerConfig.toolMode&&(window.TouchEvent&&t instanceof TouchEvent&&t.cancelable&&t.preventDefault(),this.boxRenderer.onMoveHandler(t),this.isMousedown&&this.context.render());}mouseup(t){this.isMousedown&&(this.boxRenderer.onEndHandler(t),this.isMousedown=!1,this.context.render());}afterPerspective(t){let{pageUid:e,docUid:i,width:s,height:n}=t;const{context:o}=this,r=o.tabService.getTab(i);if(!r)return;const a=r.getPageByUid(e);if(a&&(a.rWidth=s,a.rHeight=n,o.clearOptimization([a.uid])),r.isActive){if("crop"===o.viewerConfig.toolMode){this.boxRenderer.areas.forEach((t=>{t.clearBoxes();}));const t=this.boxRenderer.getAreaByUid(e),i=r.getPageByUid(e).getRect();null==t||t.updateAreaRect(i);}a&&(a.isLoaded=!1),o.scrollByCurrentChanged=!0;let t=!0;this.context.isDefaultViewer?"none"===r.context.fitMode&&(t=!1):this.context.isThumbnailViewer&&(t=!1),this.context.showTab(r,t);}}afterRotatePages(t){const{context:e}=this;if("crop"!==e.viewerConfig.toolMode)return;const i=this.context.getActiveTab();null!=i&&i.total&&i.uid===t.docUid&&(this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})),t.pageUids.forEach((t=>{const e=this.boxRenderer.getAreaByUid(t),s=i.getPageByUid(t).getRect();null==e||e.updateAreaRect(s);})),this.context.render());}afterRender(t){const{context:e}=this;"crop"===e.viewerConfig.toolMode&&(t.pages.forEach((e=>{const i=this.boxRenderer.getAreaByUid(e.uid);if(i){if(e.isVisible){const t=e.getRect();i.updateAreaRect(t);}"current"===this.viewer.cropMode?i.isVisible=e.uid===t.currentUid:i.isVisible=e.isVisible;}})),this.boxRenderer.updateOptions({zoom:t.context.zoom}),this.boxRenderer.render());}toolModeChanged(t){if("crop"!==t.oldToolMode&&"crop"===t.newToolMode){const t=this.context.getActiveTab();if(!t)return;t.pages.forEach((e=>{const i=e.getRect(),s=this.boxRenderer.addArea(e.uid,i);"current"===this.viewer.cropMode?s.isVisible=e.uid===t.currentUid:s.isVisible=e.isVisible;})),this.boxRenderer.updateOptions({zoom:t.context.zoom});}else "crop"!==t.newToolMode&&"crop"===t.oldToolMode&&(this.boxRenderer.clearArea(),this.context.render());}pageChanged(t){if("crop"!==this.context.viewerConfig.toolMode)return;return this.context.getActiveTab()?0===t.total?(this.clearRedundantBoxes(),this.boxRenderer.clearArea(),void this.context.render()):void("current"===this.viewer.cropMode&&this.resetPageCropArea()):void 0}deletePages(t){t.pageUids.forEach((t=>{this.boxRenderer.deleteArea(t);}));}updatePage(t){const{context:e}=this;if("crop"!==e.viewerConfig.toolMode)return;const i=e.getActiveTab();if(i&&i.uid===t.docUid&&("current"===this.viewer.cropMode&&t.pageUid===i.currentUid&&this.resetPageCropArea(),"all"===this.viewer.cropMode)){const s=this.boxRenderer.getAreaByUid(t.pageUid),n=i.getPageByUid(t.pageUid).getRect();s.updateAreaRect(n),this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})),e.render();}}addPages(t){const e=this.context.getActiveTab();null!=e&&e.total&&e.uid===t.docUid&&(t.pageUids.forEach((t=>{const i=e.getPageByUid(t),s=i.getRect();this.boxRenderer.addArea(i.uid,s),this.boxRenderer.updateOptions({zoom:e.context.zoom});})),this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})));}resetPageCropArea(){const t=this.context.getActiveTab();this.clearRedundantBoxes();const e=t.getCurrentPage(),i=e.getRect();this.boxRenderer.addArea(e.uid,i),this.boxRenderer.updateOptions({zoom:t.context.zoom}),this.context.render();}clearRedundantBoxes(){const t=this.context.getActiveTab();t&&"current"===this.viewer.cropMode&&this.boxRenderer.areas.forEach((e=>{e.areaUid!==t.currentUid&&this.boxRenderer.clearAreaBoxes(e.areaUid);}));}}class Hb{constructor(t,e){l(this,"context",void 0),l(this,"core",void 0),l(this,"boxRenderer",void 0),l(this,"viewer",void 0),l(this,"isMousedown",!1),l(this,"canSlide",!1),l(this,"isStart",!1),l(this,"startX",void 0),l(this,"isSliding",void 0),l(this,"slideDistance",void 0),l(this,"slideDirection",void 0),l(this,"slideRAF",void 0),l(this,"tabX",void 0),l(this,"tabY",void 0),this.viewer=t,this.context=t.context,this.core=t.context.core,this.boxRenderer=e;}mousedown(t){const e=this.context.getActiveTab();if(null==e||!e.total)return;this.isMousedown=!0;!this.boxRenderer.isControlPointTouched(t)&&this.context.viewerConfig.enableSlide?(this.canSlide=!0,this.slideStart(t)):this.boxRenderer.onStartHandler(t);}mousemove(t){const e=this.context.getActiveTab();if(null==e||!e.total)return;dn(t)&&t.cancelable&&t.preventDefault(),this.canSlide?this.slideMove(t):(this.boxRenderer.onMoveHandler(t),this.isMousedown&&this.context.render());}mouseup(t){this.isMousedown&&(this.canSlide?this.slideEnd(t):this.boxRenderer.onEndHandler(t),this.canSlide=!1,this.isMousedown=!1,this.context.render());}reRender(){const{context:t}=this,e=t.getActiveTab();null!=e&&e.total&&"visible"===t.viewerConfig.visibility&&(this.updatePageQuad(e),t.render());}updatePage(t){const{context:e}=this,i=e.getActiveTab();null!=i&&i.total&&"visible"===e.viewerConfig.visibility&&i.currentUid===t.pageUid&&(this.updatePageQuad(i),e.render());}afterRender(t){if(null==t||!t.total)return;const{boxRenderer:e}=this;t.pages.forEach((t=>{const i=e.getAreaByUid(t.uid);if(i&&t.isVisible){const e=t.getRect();i.updateAreaRect(e);}})),e.updateOptions({zoom:t.context.zoom}),e.render();}pageChanged(t){if(-1===t.current&&0===t.total)return void this.boxRenderer.clearArea();const e=this.context.getActiveTab();e&&this.updatePageQuad(e);}updatePageQuad(t){const{context:e}=this,i=t.getCurrentPage();if(!i)return !1;let s=null;const n=this.boxRenderer.getAreaByUid(i.uid);n&&n.boxes[0]&&(s=n.boxes[0].getQuad());const o=e.core.pageService.getPage(t.currentUid);this.boxRenderer.clearArea();const r=i.getRect(),a=this.boxRenderer.addArea(i.uid,r);this.boxRenderer.updateOptions({zoom:t.context.zoom});const l=o.getQuadVertices(),h=a.addQuadBox(l);let d=h.getQuad();e.hooks.perspectiveQuadChanged.emit(Jg.create(h.getQuad(),o.isFull)),s&&(s=o.quadToPixelPPI(s)),d&&(d=o.quadToPixelPPI(d)),Sf(s),Sf(d);let c=!1;return s&&d&&(c=Sn(s,d)),c||e.viewer.emit("quadModified",mg.create(s,d)),h}afterRotatePages(t){const e=this.context.getActiveTab();null!=e&&e.total&&t.pageUids.includes(e.currentUid)&&(this.updatePageQuad(e),this.context.render());}afterPerspective(t){let{pageUid:e,docUid:i}=t;const{context:s}=this,n=this.context.getActiveTab();if(null==n||!n.total)return;if(n.uid!==i||n.currentUid!==e)return;const o=n.getCurrentPage();o&&(o.isLoaded=!1),this.updatePageQuad(n),s.scrollByCurrentChanged=!0,s.showTab(n,!0);}slideStart(t){if(!this.context.viewerConfig.enableSlide)return;if(this.isSliding)return;const e=this.context.getActiveTab();if(null==e||!e.total)return;const{scrollLeft:i,scrollTop:s}=this.context.viewService.getMaxScrollValue();if(i||s)return;const n=this.context.formatTouches(t);if(n.length>1)return;const o=e.getPosition();this.tabX=o.x,this.tabY=o.y,this.startX=n[0].pageX,this.isStart=!0;}slideMove(t){if(!this.isStart)return;const{context:e}=this,{viewerConfig:i}=e,s=e.getActiveTab(),n=e.formatTouches(t)[0].pageX-this.startX;if(n>0?this.slideDirection="right":n<0&&(this.slideDirection="left"),this.slideDistance=Math.min(s.context.viewportWidth,Math.abs(n)),this.isSliding)"right"===this.slideDirection?s.setPosition({x:this.slideDistance+this.tabX,y:this.tabY,z:0}):"left"===this.slideDirection&&s.setPosition({x:-this.slideDistance+this.tabX,y:this.tabY,z:0}),e.render();else if("single"===s.context.displayMode&&"crop"===i.toolMode&&i.enableSlide){const{scrollLeft:t,scrollTop:s}=this.context.viewService.getMaxScrollValue();Math.abs(n)>i.startSlideThresholdForPerspective&&!t&&!s&&(this.isSliding=!0,e.configService.updateConfig({displayMode:"slide"}));}}slideEnd(t){if(!this.isStart)return;const{context:e}=this,i=e.getActiveTab(),{displayMode:s}=i.context;"slide"===s&&this.slide(i),this.isStart=!1;}slide(t){let e,i=0,s=0,n=0,o=!1;const{viewerConfig:r}=this.context,a=t.context.viewportWidth*r.slideThresholdForPerspective;this.slideDistance>=Math.max(a,r.startSlideThresholdForPerspective)?(s=t.context.viewportWidth,e=s-this.slideDistance,"left"===this.slideDirection?t.current!==t.total-1?(n=-this.slideDistance,i=-e/6):(s=0,e=this.slideDistance,o=!0,n=-this.slideDistance,i=e/6):0!==t.current?(n=this.slideDistance,i=e/6):(s=0,e=this.slideDistance,o=!0,n=this.slideDistance,i=-e/6)):(o=!0,s=0,e=this.slideDistance,"left"===this.slideDirection?(n=-this.slideDistance,i=e/6):(n=this.slideDistance,i=-e/6));const l=()=>{n+=i;const e=n>=0;if(Math.abs(n)>=s&&(n=s,e||(n*=-1)),t.setPosition({x:n+this.tabX,y:this.tabY,z:0}),Math.abs(n)===s)return o||("right"===this.slideDirection?this.context.viewer.gotoPage(t.current-1):this.context.viewer.gotoPage(t.current+1),this.context.configService.updateConfig({fitMode:"window"})),this.isSliding=!1,this.context.configService.updateConfig({displayMode:"single"}),void cancelAnimationFrame(this.slideRAF);this.slideRAF=requestAnimationFrame(l),this.context.render();};this.slideRAF=requestAnimationFrame(l);}}class Vb{constructor(t){l(this,"service",void 0),this.service=t;}startHandler(t){this.service.mousedown(t);}moveHandler(t){this.service.mousemove(t);}endHandler(t){this.service.mouseup(t);}isEditCropBox(t){return this.service.isEditCropBox(t)}}class zb{constructor(t){l(this,"service",void 0),this.service=t;}startHandler(t){this.service.mousedown(t);}moveHandler(t){this.service.mousemove(t);}endHandler(t){this.service.mouseup(t);}}function jb(t,e){return {left:Pn(t.left,e),top:Pn(t.top,e),width:Pn(t.width,e),height:Pn(t.height,e)}}const $b={install(t){const e=t.getClass("Viewer"),i=(s=e,class extends s{constructor(t){super(t),l(this,"boxRenderer",void 0),l(this,"iCropMode","current"),l(this,"cropRectService",void 0),l(this,"perspectiveQuadService",void 0);const{isDefaultViewer:e,isPerspectiveViewer:i}=this.context;(e||i)&&this.initBoxRenderer(),this.cropRectService=new Fb(this,this.boxRenderer),this.perspectiveQuadService=new Hb(this,this.boxRenderer),this.listenDefaultViewerEventsForBox(),this.listenDefaultGlobalEventsForBox(),this.listenPerspectiveViewerEventsForBox(),this.listenPerspectiveGlobalEventsForBox(),this.context.hasBoxRendererModule=!0,this.context.cropBoxEditService=new Vb(this.cropRectService),this.context.perspectiveQuadEditService=new zb(this.perspectiveQuadService);}initBoxRenderer(){if(!this.context.isDefaultViewer&&!this.context.isPerspectiveViewer)return;const{canvasStyle:{cursor:t},enableEditCropBoxMidpoints:e,enableEditCropBoxVertices:i,enableHideEditingCropBoxMidpoint:s,enableHideEditingCropBoxVertex:n}=this.context.viewerConfig;this.boxRenderer=new Wb({defaultCursor:t,enableEditCropBoxMidpoints:e,enableEditCropBoxVertices:i,enableHideEditingCropBoxMidpoint:s,enableHideEditingCropBoxVertex:n}),this.boxRenderer.setCanvasDom(this.context.rendererService.getCanvasDom()),this.updateQuadStyle(),this.context.hooks.quadSelectionStyleChanged.on((()=>{this.updateQuadStyle();}),this),this.context.hooks.canvasCursorStyleChanged.on((()=>{this.boxRenderer.updateConfig({defaultCursor:this.context.viewerConfig.canvasStyle.cursor});}),this),this.hooks.resize.on((()=>{this.context.render();}));const{hooks:o}=this.boxRenderer;o.boxCreated.on((t=>{const e=this.context.getActiveTab();if(null!=e&&e.total&&(this.context.isDefaultViewer&&t.isRect&&"all"===this.cropMode&&this.boxRenderer.areas.forEach((e=>{e.boxes.length?e.boxes.forEach((i=>{e.isContainBox(t)?e.updateRectBox(i,[...t.vertexes]):e.clearBoxes();})):e.isContainBox(t)&&e.addRectBox([...t.vertexes]);})),t.isRect)){let e=t.getRect();e=Cn(e,eo.displayResolution,72),e=jb(e,2);const i=ng.create(e);this.hooks.cropRectDrawn.emit(i),this.emit("cropRectDrawn",i);}})),o.boxDeleted.on((t=>{const e=this.context.getActiveTab();if(null!=e&&e.total&&t.isRect){let e=t.getRect();e=Cn(e,eo.displayResolution,72),e=jb(e,2);const i=sg.create(e);this.hooks.cropRectDeleted.emit(i),this.emit("cropRectDeleted",i);}})),o.boxModified.on((t=>{const e=this.context.getActiveTab();if(null==e||!e.total)return;const{box:i}=t;if(this.context.isDefaultViewer&&i.isRect){let{oldRect:e,newRect:s}=t,n=0;if("all"===this.cropMode&&this.boxRenderer.areas.forEach((t=>{t.boxes.length?t.boxes.forEach((e=>{t.isContainBox(i)?(n+=1,t.updateRectBox(e,[...i.vertexes])):t.clearBoxes();})):t.isContainBox(i)&&t.addRectBox([...i.vertexes]);})),e&&(e=Cn(e,eo.displayResolution,72),e=jb(e,2)),s&&(s=Cn(s,eo.displayResolution,72),s=jb(s,2)),!e||!s||e.left!==s.left||e.top!==s.top||e.width!==s.width||e.height!==s.height){n=Math.max(1,n);for(let t=0;t<n;t++){const t=og.create(e,s);this.emit("cropRectModified",t);}}}if(this.context.isPerspectiveViewer&&!i.isRect){const e=this.context.core.pageService.getPage(i.area.areaUid),s=this.boxRenderer.getAreaByUid(i.area.areaUid).isFullBox(i);e.isFull=s,e.setActiveQuad(i.getQuad());let{oldQuad:n,newQuad:o}=t;n&&(n=e.quadToPixelPPI(n)),o&&(o=e.quadToPixelPPI(o)),Sf(n),Sf(o),this.hooks.perspectiveQuadChanged.emit(Jg.create(o,e.isFull));let r=!1;n&&o&&(r=Sn(o,n)),r||this.emit("quadModified",mg.create(n,o));}}));}updateQuadStyle(){const t=this.context.styleService.getParsedQuadSelectionStyle();this.boxRenderer.updateConfig({boxStyle:t});}get cropMode(){return this.iCropMode}set cropMode(t){if(this.iCropMode===t)return;const e=this.iCropMode;this.iCropMode=t;const i=this.context.getActiveTab();if(null!=i&&i.total){if("current"===e&&"all"===t){const t=this.boxRenderer.getAreaByUid(i.currentUid).boxes[0];t&&this.boxRenderer.areas.forEach((e=>{e.isContainBox(t)?e.boxes.length?e.updateRectBox(e.boxes[0],[...t.vertexes]):e.addRectBox([...t.vertexes]):e.clearBoxes();}));}this.cropRectService.clearRedundantBoxes(),this.context.render();}}toggleFullPerspective(){const{context:t}=this;if(!t.isPerspectiveViewer)return;const e=t.getActiveTab();null!=e&&e.total&&t.core.pageService.getPage(e.currentUid).toggleFull()&&(this.perspectiveQuadService.updatePageQuad(e),t.render());}listenDefaultGlobalEventsForBox(){this.context.isPerspectiveViewer||(this.context.core.editService.onAfterRotatePages.on((t=>{this.cropRectService.afterRotatePages(t);}),this),this.context.core.onAfterPerspective.on((t=>{this.cropRectService.afterPerspective(t);}),this));}listenPerspectiveGlobalEventsForBox(){this.context.isPerspectiveViewer&&(this.context.core.editService.onAfterRotatePages.on((t=>{this.perspectiveQuadService.afterRotatePages(t);}),this),this.context.core.onAfterPerspective.on((t=>{this.perspectiveQuadService.afterPerspective(t);}),this));}listenPerspectiveViewerEventsForBox(){if(!this.context.isPerspectiveViewer)return;const{perspectiveQuadService:t}=this;this.hooks.resize.on((()=>{t.reRender();})),this.hooks.visibleChanged.on((()=>{t.reRender();})),this.hooks.updatePage.on((e=>{t.updatePage(e);})),this.hooks.afterRender.on((e=>{t.afterRender(e);})),this.hooks.pageChanged.on((e=>{t.pageChanged(e);}));}listenDefaultViewerEventsForBox(){if(!this.context.isDefaultViewer)return;const{cropRectService:t}=this;this.hooks.updatePage.on((e=>{t.updatePage(e);})),this.hooks.addPagesToDoc.on((e=>{t.addPages(e);})),this.hooks.afterRender.on((e=>{t.afterRender(e);})),this.hooks.toolModeChanged.on((e=>{t.toolModeChanged(e);})),this.hooks.pageChanged.on((e=>{t.pageChanged(e);})),this.hooks.deletePages.on((e=>{t.deletePages(e);})),this.hooks.beforeCropPages.on((()=>{this.clearRectBox();}));}setRectBox(t,e){const i=this.context.getActiveTab();return !(!i||!i.total||(Ts(e)&&(e=[i.current]),i.indicesToUids(e).forEach((e=>{let i=t;i=Cn(t,eo.dataResolution,eo.displayResolution);const s=(t=>{const{left:e,top:i,width:s,height:n}=t;return [e,i,e+s,i,e+s,i+n,e,i+n]})(i),n=this.boxRenderer.areas.get(e);n.boxes.length?n.updateRectBox(n.boxes[0],s,!0):n.addRectBox(s);})),this.context.render(),0))}getRectBox(){const t=this.context.getActiveTab();if(t&&t.total){let e=null;if(t.pages.find((t=>{const i=this.boxRenderer.getAreaByUid(t.uid);return !(null==i||!i.boxes.length||(e=i,0))})),e){const t=e.boxes[0];if(null!=t&&t.isRect){let e=t.getRect();return e=Cn(e,eo.displayResolution,eo.dataResolution),e=jb(e,2),e.width=e.width||1,e.height=e.height||1,e}}}return null}getRenderedRectBoxCount(){const t=this.context.getActiveTab();let e=0;return t&&t.total&&this.boxRenderer.areas.forEach((t=>{e+=t.boxes.length;})),e}getCropIndices(){const t=this.context.getActiveTab();let e=[];if(t&&t.total)if("all"===this.iCropMode){const i=[];this.boxRenderer.areas.forEach((t=>{t.boxes.length&&i.push(t.areaUid);})),e=t.uidsToIndices(i);}else e=[t.current];return e}clearRectBox(){return this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})),!0}setQuadBox(t){const e=this.context.getActiveTab();if(!e||!e.total)return !1;const i=this.context.core.pageService.getPage(e.currentUid);let s=t;s=t.map((t=>Cn(t,i.resource.resolutionX,eo.displayResolution)));const n=this.boxRenderer.getAreaByUid(e.currentUid),{width:o,height:r}=n,a=vf(s,o,r);return i.isFull=a,i.setActiveQuad(s),this.perspectiveQuadService.updatePageQuad(e),this.hooks.perspectiveQuadChanged.emit(Jg.create(s,i.isFull)),this.context.render(),!0}getQuadBox(){const t=this.context.getActiveTab();if(t&&t.total){const e=this.boxRenderer.getAreaByUid(t.currentUid).boxes[0];if(!e.isRect){let i=e.getQuad();const s=this.context.core.pageService.getPage(t.currentUid);return i=i.map((t=>Cn(t,eo.displayResolution,s.resource.resolutionX))),Sf(i),i}}return null}resetQuadBox(t){const e=this.context.getActiveTab();if(null==e||!e.total)return !1;let i=[];return i=Ts(t)?[e.currentUid]:e.indicesToUids(t),i.forEach((t=>{const i=this.context.core.pageService.getPage(t),{quad:s}=i;s?(i.isFull&&(i.isFull=!1),i.setActiveQuad(s),this.perspectiveQuadService.updatePageQuad(e)):i.isFull||(i.isFull=!0,this.perspectiveQuadService.updatePageQuad(e)),i.uid===e.currentUid&&this.hooks.perspectiveQuadChanged.emit(Jg.create(s,i.isFull));})),this.context.render(),!0}clearQuadBox(){return this.boxRenderer.areas.forEach((t=>{t.clearBoxes();})),!0}isConvexQuad(t){return sn(t.flat())}});var s;t.setClass("Viewer",i);}};class Gb extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),this.action=t,this.core=e,this.type="rotate",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on((t=>{const{pageUids:e}=this.action;e.slice().forEach((i=>{if(t.pageUids.includes(i)){const t=e.indexOf(i);e.splice(t,1);}})),this.isValid=e.length>0;}),this);}execute(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).addAction(e);}));const i=Xg.create(e.docUid,e.angle,e.pageUids);return t.editService.onRotatePages.emit(i),t.editService.onAfterRotatePages.emit(i),!0}undo(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).deleteAction(e.actionUid);}));const i=Xg.create(e.docUid,e.angle,e.pageUids);t.editService.onRotatePages.emit(i),t.editService.onAfterRotatePages.emit(i);}}class Xb extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),this.action=t,this.core=e,this.type="crop",this.isValid=!0,this.core.commandService.onBeforeRefreshCommands.on((t=>{const{pageUids:e}=this.action;e.slice().forEach((i=>{if(t.pageUids.includes(i)){const t=e.indexOf(i);e.splice(t,1);}})),this.isValid=e.length>0;}),this);}execute(){const{core:t,action:e}=this;e.pageUids.forEach((e=>{t.pageService.getPage(e).addAction(this.action);}));const i=Yg.create(e.docUid,e.rect,e.pageUids);return t.editService.onCropPages.emit(i),!0}undo(){const{core:t,action:e}=this;e.pageUids.forEach((i=>{t.pageService.getPage(i).deleteAction(e.actionUid);}));const i=Yg.create(e.docUid,e.rect,e.pageUids);t.editService.onCropPages.emit(i);}}class Yb extends Tn{constructor(t){super(),l(this,"core",void 0),l(this,"onRotatePages",void 0),l(this,"onAfterRotatePages",void 0),l(this,"onCropPages",void 0),l(this,"onAfterCropPages",void 0),this.core=t,this.initEventEmitter();}initEventEmitter(){this.onRotatePages=En(this),this.onAfterRotatePages=En(this),this.onCropPages=En(this),this.onAfterCropPages=En(this);}rotatePages(t,e,i,s){const n={actionUid:_s(),type:"rotate",docUid:t,pageUids:[...e],angle:i,rotationType:s},{core:o}=this,r=new Gb(n,o);return o.commandService.execute(r,t),!0}cropPages(t,e,i){const s={actionUid:_s(),type:"crop",docUid:t,pageUids:[...e],rect:{...i}},{core:n}=this,o=new Xb(s,n);return n.commandService.execute(o,t),!0}}const Jb={apply(t){t.editService=new Yb(t);},install(t){const e=t.getClass("Viewer"),i=(s=e,class extends s{constructor(t){super(t),this.listenGlobalEventsForEdit(),this.listenViewerEventsForEdit();}listenGlobalEventsForEdit(){const{context:t}=this,e=e=>{let{docUid:i,pageUids:s}=e;const n=t.tabService.getTab(i);if(null!=n&&n.isActive){t.scrollByCurrentChanged=!0,t.clearOptimization(s);let e=!0;t.isDefaultViewer?"none"===n.context.fitMode&&(e=!1):t.isThumbnailViewer&&(e=!1),t.showTab(n,e);}};t.core.editService.onRotatePages.on(e,this),t.core.editService.onCropPages.on(e,this);}listenViewerEventsForEdit(){this.hooks.beforeLayout.on((t=>{const{core:{pageService:e},isDefaultViewer:i,isThumbnailViewer:s,isPerspectiveViewer:n}=this.context;(i||s||n)&&t.pages.forEach((t=>{let n=null;const o=e.getPage(t.uid);n=i||s?o.getEditResult():o.getEditResultForPerspective(),n&&(t.rWidth=n.rWidth,t.rHeight=n.rHeight,t.cropLeft=n.cropLeft,t.cropTop=n.cropTop,t.cropWidth=n.cropWidth,t.cropHeight=n.cropHeight,t.rotation=n.rotation,t.mediaBoxRect=n.mediaBox,t.cropBoxRect=n.cropBox);}));}));}rotatePages(t,e){var i;if(t%360==0)return !0;const s=this.context.getActiveTab();if(!s)return !1;null!==(i=e)&&void 0!==i||(e=[s.current]);const n=s.indicesToUids(e);return this.context.core.editService.rotatePages(s.uid,n,t,"contain")}cropPages(t,e){var i;const s=this.context.getActiveTab();if(!s)return !1;null!==(i=e)&&void 0!==i||(e=[s.current]);const n=s.indicesToUids(e);return t=Cn(t,eo.dataResolution,eo.displayResolution),this.hooks.beforeCropPages.emit(),this.context.core.editService.cropPages(s.uid,n,t)}});var s;t.setClass("Viewer",i);}};class qb extends So{static create(t){return new qb(t,t.uid)}constructor(t,e){super(e),l(this,"type",void 0),l(this,"docUid",void 0),l(this,"pageUid",void 0),l(this,"style",void 0),l(this,"transform",void 0),l(this,"flags",void 0),l(this,"comment",void 0),l(this,"layer",void 0),l(this,"creationDate",void 0),l(this,"modified",!1),l(this,"oriIndex",void 0),this.type=t.type,this.docUid=t.docUid,this.pageUid=t.pageUid,this.style=t.style,this.flags=t.flags||["print"],this.transform=t.transform,this.oriIndex=t.oriIndex,Ts(null==t?void 0:t.modified)||(this.modified=t.modified);}getConfig(){return {uid:this.uid,docUid:this.docUid,pageUid:this.pageUid,type:this.type,style:As(this.style),transform:As(this.transform),flags:As(this.flags),comment:As(this.comment),creationDate:this.comment.creationDate,modificationDate:this.comment.modificationDate,oriIndex:this.oriIndex,modified:this.modified}}clone(t,e){const i=qb.create({docUid:this.docUid,pageUid:t,type:this.type,style:As(this.style),transform:As(this.transform),flags:this.flags.slice(),comment:this.comment}),s=this.comment.clone(i.uid,e);return i.comment=s,i.layer=this.layer,i}updateStyle(t){Object.assign(this.style,t);}updateComment(t){this.comment.updateComment(t);}addReplies(t){this.comment.replies.push(...t);}deleteReplies(t){const e=this.comment.replies;t.forEach((t=>{if(e.includes(t)){const i=e.findIndex((e=>e.uid===t.uid));e.splice(i,1);}}));}updateReply(t){const e=this.comment.replies.findIndex((e=>e.uid===t.uid));this.comment.replies[e]=t;}getAllReplies(){return [...this.comment.replies]}deleteReplyReviewSate(t){const e=this.comment.getReply(t);e&&e.deleteReviewState();}setReplyReviewState(t,e){const i=this.comment.getReply(t);i&&i.setReviewState(e);}deleteReplyMarkedSate(t){const e=this.comment.getReply(t);e&&e.deleteMarkedState();}setReplyMarkedState(t,e){const i=this.comment.getReply(t);i&&i.setMarkedState(e);}}class Zb{static create(t){return new Zb(t)}constructor(t){l(this,"uid",void 0),l(this,"author",void 0),l(this,"contents",void 0),l(this,"creationDate",void 0),l(this,"state",void 0),this.uid=t.uid,this.author=t.author,this.contents=t.contents,this.creationDate=t.creationDate,this.state=t.state;}}class Qb{static create(t){return new Qb(t)}constructor(t){l(this,"uid",void 0),l(this,"author",void 0),l(this,"contents",void 0),l(this,"creationDate",void 0),l(this,"state",void 0),this.uid=t.uid,this.author=t.author,this.contents=t.contents,this.creationDate=t.creationDate,this.state=t.state;}}class Kb extends Co{static create(t,e){return new Kb(t,e)}constructor(t,e){var i,s;super(e),l(this,"annotationUid",void 0),l(this,"author",void 0),l(this,"subject",void 0),l(this,"contents",void 0),l(this,"creationDate",void 0),l(this,"modificationDate",void 0),l(this,"markedStates",void 0),l(this,"reviewStates",void 0),this.annotationUid=t.annotationUid,this.author=t.author,this.subject=t.subject,this.contents=t.contents,this.creationDate=t.creationDate,this.modificationDate=t.modificationDate,this.markedStates=[],this.reviewStates=[],null!==(i=t.markedStates)&&void 0!==i&&i.length&&t.markedStates.forEach((t=>{const e=Qb.create(t);this.markedStates.push(e);})),null!==(s=t.reviewStates)&&void 0!==s&&s.length&&t.reviewStates.forEach((t=>{const e=Zb.create(t);this.reviewStates.push(e);}));}updateReply(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t);}setMarkedState(t){const e=this.markedStates.length,i=this.markedStates[e-1];if((null==i?void 0:i.state)!==t.state||!i&&"marked"===t.state){const e=Qb.create(t);return this.markedStates.push(e),!0}return !1}deleteMarkedState(){this.markedStates.pop();}setReviewState(t){const e=Zb.create(t);this.reviewStates.push(e);}deleteReviewState(){this.reviewStates.pop();}clone(t,e){const i=Kb.create({annotationUid:t,author:this.author,subject:this.subject,contents:this.contents,creationDate:e,modificationDate:e});return this.cloneStates(i),i}cloneStates(t){this.markedStates.forEach((e=>{const i=Qb.create({...e,uid:_s()});t.markedStates.push(i);})),this.reviewStates.forEach((e=>{const i=Zb.create({...e,uid:_s()});t.reviewStates.push(i);}));}}class tC extends Kb{static create(t,e){return new tC(t,e)}constructor(t,e){super(t,e),l(this,"replies",void 0),this.replies=[];}updateComment(t){Object.assign(this,t);}getReply(t){return this.replies.find((e=>e.uid===t.uid))}clone(t,e){const i=tC.create({annotationUid:t,author:this.author,subject:this.subject,contents:this.contents,creationDate:e,modificationDate:e});return this.cloneStates(i),this.replies.forEach((s=>{i.replies.push(s.clone(t,e));})),i}}class eC extends Co{static create(t){return new eC(t)}constructor(t){super(t),l(this,"bottom",void 0),l(this,"top",void 0),l(this,"annotations",void 0),l(this,"layers",void 0),this.annotations=[],this.bottom=-1,this.top=0,this.layers=[];}clone(t){const e=eC.create(t);return e.top=this.top,e.bottom=this.bottom,e.annotations=this.annotations.slice(),e.layers=As(this.layers),e}createTop(){const{top:t}=this;return this.top+=1,t}addAnnotation(t,e){if(!this.annotations.includes(t)){this.annotations.push(t);const i={annotationUid:t,layer:e};return this.layers.push(i),Ts(e)?(i.layer=this.top,this.top+=1):this.sortLayers(),i}return null}sortLayers(){this.layers.sort(((t,e)=>t.layer-e.layer));}deleteAnnotations(t){t.forEach((t=>{const e=this.annotations.indexOf(t);e>-1&&this.annotations.splice(e,1);const i=this.layers.findIndex((e=>e.annotationUid===t));i>-1&&this.layers.splice(i,1);}));}moveAnnotation(t){const e=this.annotations.indexOf(t);if(e<0)return null;const i=this.layers.findIndex((e=>e.annotationUid===t));if(i<0)return null;const s={annotationUid:t,index:e,layerIndex:i,layer:this.layers[i].layer};return this.deleteAnnotations([t]),s}undoMoveAnnotation(t){const{annotationUid:e}=t;this.annotations.includes(e)||this.layers.find((t=>t.annotationUid===e))||(this.annotations.splice(t.index,0,e),this.layers.splice(t.layerIndex,0,{annotationUid:e,layer:t.layer}));}bringForward(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e],s=this.layers[e+1];return s&&(this.switchLayer(i,s),this.sortLayers()),{curLayer:i,forward:s}}switchLayer(t,e){const i=t.layer;t.layer=e.layer,e.layer=i;}sendBackward(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e],s=this.layers[e-1];return s&&(this.switchLayer(i,s),this.sortLayers()),{curLayer:i,backward:s}}bringToFront(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e];return e<this.layers.length-1&&(i.layer=this.top,this.top+=1,this.sortLayers()),i}sendToBack(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return null;const i=this.layers[e];return e>0&&(i.layer=this.bottom,this.bottom-=1,this.sortLayers()),i}restoreLayer(t,e){const i=this.layers.findIndex((e=>e.annotationUid===t));if(i<0)return null;return this.layers[i].layer=e,this.sortLayers(),!0}getLayerState(t){const e=this.layers.findIndex((e=>e.annotationUid===t));if(e<0)return {back:!1,front:!1,forward:!1,backward:!1};const i={back:!0,front:!0,forward:!0,backward:!0};return 0===e&&(i.back=!1,i.backward=!1),e===this.layers.length-1&&(i.front=!1,i.forward=!1),1===this.layers.length&&(i.front=!1,i.forward=!1,i.back=!1,i.backward=!1),i}getAnnotationUidListByLayer(){return this.layers.slice().sort(((t,e)=>t.layer-e.layer)).map((t=>t.annotationUid))}}const iC=new class{constructor(){l(this,"db",void 0),this.db=new Map;}findAnnotationByUid(t){return this.db.get(t)}deleteAnnotation(t){return !!this.db.has(t.uid)&&(this.db.delete(t.uid),!0)}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t);}clear(){this.db.clear();}},sC=new class{constructor(){l(this,"db",void 0),this.db=new Map;}findCommentByUid(t){return this.db.get(t)}deleteComment(t){this.db.has(t.uid)&&this.db.delete(t.uid);}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t);}clear(){this.db.clear();}},nC=new class{constructor(){l(this,"db",void 0),this.db=new Map;}findPageByUid(t){return this.db.get(t)}deletePagesByUids(t){t.forEach((t=>{this.db.delete(t);}));}has(t){return this.db.has(t.uid)}save(t){this.db.set(t.uid,t);}clear(){this.db.clear();}};const oC=new class extends Tn{constructor(){super(...arguments),l(this,"annotationCreated",En(this)),l(this,"annotationDeleted",En(this)),l(this,"annotationUpdated",En(this)),l(this,"commentDeleted",En(this)),l(this,"commentUpdated",En(this)),l(this,"replyToAnnotation",En(this)),l(this,"replyDeleted",En(this)),l(this,"replyUpdated",En(this)),l(this,"setReplyReviewState",En(this)),l(this,"deleteReplyReviewState",En(this)),l(this,"bringFroward",En(this)),l(this,"sendBackward",En(this)),l(this,"bringToFront",En(this)),l(this,"sendToBack",En(this)),l(this,"restoreLayer",En(this)),l(this,"annotationPageSwitched",En(this));}};class rC extends Po{static create(t){return new rC(t)}constructor(t){super("annotationCreatedDomainEvent"),l(this,"annotations",void 0),this.annotations=t;}}const aC=new class{constructor(t,e,i,s){l(this,"annotationRepo",void 0),l(this,"replyRepo",void 0),l(this,"annotationPageRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.annotationPageRepo=i,this.eventHooks=s;}execute(t){const e=t.map((t=>{const e=qb.create({...t}),i=this.annotationPageRepo.findPageByUid(e.pageUid).addAnnotation(e.uid,t.layer);if(i&&(e.layer=i.layer),this.annotationRepo.save(e),t.comment){var s;const i=tC.create(t.comment);e.comment=i,null!==(s=t.comment.replies)&&void 0!==s&&s.length&&t.comment.replies.forEach((t=>{const e=Kb.create(t);i.replies.push(e),this.replyRepo.save(e);}));}return e})),i=rC.create(e);return this.eventHooks.annotationCreated.emit(i),e}}(iC,sC,nC,oC);class lC extends Po{static create(t,e){return new lC(t,e)}constructor(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("annotationDeletedDomainEvent"),l(this,"annotations",void 0),l(this,"emitEvent",void 0),this.annotations=t,this.emitEvent=e;}}const hC=new class{constructor(t,e,i){l(this,"annotationRepo",void 0),l(this,"annotationPageRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHooks=i;}execute(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(const e of t){if(!this.annotationRepo.has(e))return !1}t.forEach((t=>{this.annotationRepo.deleteAnnotation(t);this.annotationPageRepo.findPageByUid(t.pageUid).deleteAnnotations([t.uid]);}));const i=lC.create(t,e);return this.eventHooks.annotationDeleted.emit(i),!0}}(iC,nC,oC);const dC=new class{constructor(t){l(this,"annotationRepo",void 0),this.annotationRepo=t;}execute(t){return this.annotationRepo.findAnnotationByUid(t)}}(iC);class cC extends Po{static create(t){return new cC(t)}constructor(t){super("replyToAnnotationDomainEvent"),l(this,"reply",void 0),this.reply=t;}}const uC=new class{constructor(t,e,i){l(this,"annotationRepo",void 0),l(this,"replyRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i;}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid),i=Kb.create({annotationUid:t.annotationUid,author:t.author,contents:t.contents,creationDate:t.creationDate,modificationDate:t.modifiedDate,subject:""});e.addReplies([i]),this.replyRepo.save(i);const s=cC.create(i);return this.eventHooks.replyToAnnotation.emit(s),!0}}(iC,sC,oC);class pC extends Po{static create(t,e,i){return new pC(t,e,i)}constructor(t,e,i){super("annotationUpdatedDomainEvent"),l(this,"updateDetails",void 0),l(this,"updatedBy",void 0),l(this,"updateActions",void 0),this.updateDetails=t,this.updatedBy=e,this.updateActions=i;}}const gC=new class{constructor(t,e){l(this,"annotationRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.eventHooks=e;}execute(t){const e=[],i=t.updateDetails.map((t=>{const i=this.annotationRepo.findAnnotationByUid(t.uid);if(!i)return null;const s=i.getConfig();t.style&&i.updateStyle(t.style),t.transform&&vn(t.transform,i.transform),t.flags&&(i.flags=[...t.flags]),i.modified=t.modified,t.comment&&Object.assign(i.comment,t.comment),this.annotationRepo.save(i);const n=i.getConfig();return e.push({annotationUid:i.uid,from:s,to:n}),i})),s=pC.create(e,t.updatedBy,t.updateActions);return this.eventHooks.annotationUpdated.emit(s),i}}(iC,oC);class fC extends Po{static create(t){return new fC(t)}constructor(t){super("replyUpdatedDomainEvent"),l(this,"reply",void 0),this.reply=t;}}const mC=new class{constructor(t,e,i){l(this,"annotationRepo",void 0),l(this,"replyRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i;}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return !1;const i=this.replyRepo.findCommentByUid(t.replyUid);if(!i)return !1;i.updateReply({author:t.author,contents:t.contents,modifiedDate:t.modifiedDate}),e.updateReply(i),this.annotationRepo.save(e),this.replyRepo.save(i);const s=fC.create(i);return this.eventHooks.replyUpdated.emit(s),!0}}(iC,sC,oC);class yC extends Po{static create(t){return new yC(t)}constructor(t){super("replyDeletedDomainEvent"),l(this,"reply",void 0),this.reply=t;}}const vC=new class{constructor(t,e,i){l(this,"annotationRepo",void 0),l(this,"replyRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i;}execute(t){if(!this.replyRepo.has(t))return !1;const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return !1;e.deleteReplies([t]),this.replyRepo.deleteComment(t);const i=yC.create(t);return this.eventHooks.replyDeleted.emit(i),!0}}(iC,sC,oC);class xC extends Po{static create(t,e,i){return new xC(t,e,i)}constructor(t,e,i){super("bringToFrontDomainEvent"),l(this,"annotationUid",void 0),l(this,"from",void 0),l(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=i;}}const wC=new class{constructor(t,e,i){l(this,"annotRepo",void 0),l(this,"annotPageRepo",void 0),l(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=i;}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return !1;const i=this.annotPageRepo.findPageByUid(e.pageUid),s=i.getAnnotationUidListByLayer(),n=i.bringToFront(t);if(!n)return !1;e.layer=n.layer;const o=i.getAnnotationUidListByLayer(),r=xC.create(t,s,o);return this.eventHooks.bringToFront.emit(r),!0}}(iC,nC,oC);class bC extends Po{static create(t,e,i){return new bC(t,e,i)}constructor(t,e,i){super("sendToBackDomainEvent"),l(this,"annotationUid",void 0),l(this,"from",void 0),l(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=i;}}const CC=new class{constructor(t,e,i){l(this,"annotRepo",void 0),l(this,"annotPageRepo",void 0),l(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=i;}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return !1;const i=this.annotPageRepo.findPageByUid(e.pageUid),s=i.getAnnotationUidListByLayer(),n=i.sendToBack(t);if(!n)return !1;e.layer=n.layer;const o=i.getAnnotationUidListByLayer(),r=bC.create(t,s,o);return this.eventHooks.sendToBack.emit(r),!0}}(iC,nC,oC);class SC extends Po{static create(t,e,i,s){return new SC(t,e,i,s)}constructor(t,e,i,s){super("bringForwardDomainEvent"),l(this,"annotationUid",void 0),l(this,"forwardUid",void 0),l(this,"from",void 0),l(this,"to",void 0),this.annotationUid=t,this.forwardUid=e,this.from=i,this.to=s;}}const PC=new class{constructor(t,e,i){l(this,"annotRepo",void 0),l(this,"annotPageRepo",void 0),l(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=i;}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return !1;const i=this.annotPageRepo.findPageByUid(e.pageUid),s=i.getAnnotationUidListByLayer(),n=i.bringForward(t);if(!n)return !1;const{curLayer:o,forward:r}=n;if(e.layer=o.layer,r){this.annotRepo.findAnnotationByUid(r.annotationUid).layer=r.layer;}const a=i.getAnnotationUidListByLayer(),l=SC.create(t,null==r?void 0:r.annotationUid,s,a);return this.eventHooks.bringFroward.emit(l),!0}}(iC,nC,oC);class AC extends Po{static create(t,e,i,s){return new AC(t,e,i,s)}constructor(t,e,i,s){super("sendBackwardDomainEvent"),l(this,"annotationUid",void 0),l(this,"backwardUid",void 0),l(this,"from",void 0),l(this,"to",void 0),this.annotationUid=t,this.backwardUid=e,this.from=i,this.to=s;}}const TC=new class{constructor(t,e,i){l(this,"annotRepo",void 0),l(this,"annotPageRepo",void 0),l(this,"eventHooks",void 0),this.annotRepo=t,this.annotPageRepo=e,this.eventHooks=i;}execute(t){const e=this.annotRepo.findAnnotationByUid(t);if(!e)return !1;const i=this.annotPageRepo.findPageByUid(e.pageUid),s=i.getAnnotationUidListByLayer(),n=i.sendBackward(t);if(!n)return !1;const{curLayer:o,backward:r}=n;if(e.layer=o.layer,r){this.annotRepo.findAnnotationByUid(r.annotationUid).layer=r.layer;}const a=i.getAnnotationUidListByLayer(),l=AC.create(t,null==r?void 0:r.annotationUid,s,a);return this.eventHooks.sendBackward.emit(l),!0}}(iC,nC,oC);class kC extends Po{static create(t){return new kC(t)}constructor(t){super("commentUpdatedDomainEvent"),l(this,"comment",void 0),this.comment=t;}}const DC=new class{constructor(t,e){l(this,"annotationRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.eventHooks=e;}execute(t){const e=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!e)return !1;e.updateComment(t);const i=kC.create(e.comment);return this.eventHooks.commentUpdated.emit(i),!0}}(iC,oC);class EC extends Po{static create(t){return new EC(t)}constructor(t){super("deleteReplyReviewStateDomainEvent"),l(this,"replyUid",void 0),this.replyUid=t;}}const IC=new class{constructor(t,e,i){l(this,"annotationRepo",void 0),l(this,"replyRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i;}execute(t){const e=this.replyRepo.findCommentByUid(t);if(!e)return !1;const i=this.annotationRepo.findAnnotationByUid(e.annotationUid);if(!i)return !1;i.deleteReplyReviewSate(e),this.annotationRepo.save(i);const s=EC.create(t);return this.eventHooks.deleteReplyReviewState.emit(s),!0}}(iC,sC,oC);class RC extends Po{static create(t){return new RC(t)}constructor(t){super("setReplyReviewStateDomainEvent"),l(this,"author",void 0),l(this,"creationDate",void 0),l(this,"contents",void 0),l(this,"state",void 0),l(this,"replyUid",void 0),this.author=t.author,this.creationDate=t.creationDate,this.contents=t.contents,this.state=t.state,this.replyUid=t.replyUid;}}const MC=new class{constructor(t,e,i){l(this,"annotationRepo",void 0),l(this,"replyRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.replyRepo=e,this.eventHooks=i;}execute(t){const e=this.replyRepo.findCommentByUid(t.replyUid);if(!e)return !1;const i=this.annotationRepo.findAnnotationByUid(e.annotationUid);if(!i)return !1;i.setReplyReviewState(e,t),this.annotationRepo.save(i);const s=RC.create(t);return this.eventHooks.setReplyReviewState.emit(s),!0}}(iC,sC,oC);const BC=new class{constructor(t){l(this,"annotationPageRepo",void 0),this.annotationPageRepo=t;}execute(t){let e=this.annotationPageRepo.findPageByUid(t);return e||(e=eC.create(t),this.annotationPageRepo.save(e)),e}}(nC);const LC=new class{constructor(t,e,i){l(this,"annotationPageRepo",void 0),l(this,"annotationRepo",void 0),l(this,"replyRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e,this.replyRepo=i;}execute(t){const e=this.annotationPageRepo.findPageByUid(t.pageUid);if(!e)return null;const i=e.clone(t.newPageUid),s=new Map;return e.annotations.forEach(((e,n)=>{const o=this.annotationRepo.findAnnotationByUid(e).clone(t.newPageUid,"");o.comment.replies.forEach((t=>{this.replyRepo.save(t);})),this.annotationRepo.save(o),i.annotations[n]=o.uid,s.set(e,o.uid);})),i.layers.forEach((t=>{t.annotationUid=s.get(t.annotationUid);})),this.annotationPageRepo.save(i),i}}(nC,iC,sC);const UC=new class{constructor(t){l(this,"annotationPageRepo",void 0),this.annotationPageRepo=t;}execute(t){this.annotationPageRepo.deletePagesByUids(t);}}(nC);const OC=new class{constructor(t,e,i){l(this,"annotationPageRepo",void 0),l(this,"annotationRepo",void 0),l(this,"replyRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e,this.replyRepo=i;}execute(t){const e=this.annotationPageRepo.findPageByUid(t.pageUid);if(!e)return null;const i=this.annotationRepo.findAnnotationByUid(t.annotationUid);if(!i)return null;const s=i.clone(t.pageUid," ");return s.comment.replies.forEach((t=>{this.replyRepo.save(t);})),e.addAnnotation(s.uid),this.annotationRepo.save(s),s}}(nC,iC,sC);class _C extends Po{static create(t,e,i){return new _C(t,As(e),As(i))}constructor(t,e,i){super("annotationPageSwitchedDomainEvent"),l(this,"annotationUid",void 0),l(this,"from",void 0),l(this,"to",void 0),this.annotationUid=t,this.from=e,this.to=i;}}const NC=new class{constructor(t,e,i){l(this,"annotationRepo",void 0),l(this,"annotationPageRepo",void 0),l(this,"eventHook",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHook=i;}execute(t){const{annotationUid:e,pageUid:i,x:s,y:n,layer:o}=t,r=this.annotationRepo.findAnnotationByUid(e);if(!r)return !1;const a=this.annotationPageRepo.findPageByUid(r.pageUid);if(!a)return !1;const l=this.annotationPageRepo.findPageByUid(i);if(!l)return !1;const h={pageUid:r.pageUid,x:r.style.x,y:r.style.y,layer:r.layer};a.deleteAnnotations([e]),l.addAnnotation(e,o),r.updateStyle({x:s,y:n}),r.layer=o,r.pageUid=i;const d=_C.create(r.uid,h,{pageUid:i,x:s,y:n,layer:o});return this.eventHook.annotationPageSwitched.emit(d),!0}}(iC,nC,oC);class WC extends Po{static create(t,e){return new WC(t,e)}constructor(t,e){super("restoreLayerDomainEvent"),l(this,"annotationUid",void 0),l(this,"layer",void 0),this.annotationUid=t,this.layer=e;}}const FC=new class{constructor(t,e,i){l(this,"annotationRepo",void 0),l(this,"annotationPageRepo",void 0),l(this,"eventHooks",void 0),this.annotationRepo=t,this.annotationPageRepo=e,this.eventHooks=i;}execute(t){let{annotationUid:e,layer:i}=t;const s=this.annotationRepo.findAnnotationByUid(e);if(!s)return !1;this.annotationPageRepo.findPageByUid(s.pageUid).restoreLayer(e,i),s.layer=i;const n=WC.create(e,i);return this.eventHooks.restoreLayer.emit(n),!0}}(iC,nC,oC);const HC=new class{constructor(t,e){l(this,"annotationPageRepo",void 0),l(this,"annotationRepo",void 0),this.annotationPageRepo=t,this.annotationRepo=e;}execute(t){let e={back:!1,front:!1,forward:!1,backward:!1};const i=this.annotationRepo.findAnnotationByUid(t);if(!i)return e;const s=this.annotationPageRepo.findPageByUid(i.pageUid);return s?(e=s.getLayerState(t),e):e}}(nC,iC);class VC extends Tn{constructor(){super(),l(this,"annotationRepo",iC),l(this,"annotationReplyRepo",sC),l(this,"annotationPageRepo",nC),l(this,"hooks",oC),this.register(oC);}dispose(){this.reset(),this.hooks.dispose(),super.dispose();}reset(){this.annotationPageRepo.clear(),this.annotationReplyRepo.clear(),this.annotationRepo.clear();}createAnnotationPage(t){return BC.execute(t)}copyAnnotationPage(t,e){return LC.execute({pageUid:t,newPageUid:e})}deleteAnnotationPage(t){return UC.execute(t)}createAnnotations(t){return aC.execute(t)}copyAnnotation(t,e){return OC.execute({annotationUid:t,pageUid:e})}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=t.map((t=>(Ls(t)&&(t=iC.findAnnotationByUid(t)),t)));return hC.execute(i,e)}updateAnnotation(t){return gC.execute(t)}switchAnnotationPage(t,e){return NC.execute({annotationUid:Ps(t)?t.uid:t,...e})}getAnnotationByUid(t){return dC.execute(t)}getAnnotationLayerState(t){return HC.execute(t)}replyToAnnotation(t){return uC.execute(t)}deleteReply(t){return Ls(t)&&(t=sC.findCommentByUid(t)),vC.execute(t)}updateReply(t){return mC.execute(t)}updateComment(t){return DC.execute(t)}deleteReplyReviewState(t){return IC.execute(t)}setReplyReviewState(t){return MC.execute(t)}bringToFront(t){return wC.execute(t)}sendToBack(t){return CC.execute(t)}bringForward(t){return PC.execute(t)}sendBackward(t){return TC.execute(t)}restoreLayer(t,e){return FC.execute({annotationUid:t,layer:e})}}const zC=["enableContinuousDrawing","controlsStyle","inkCreateDelay","showOnTopWhenSelected","defaultStyleConfig","eraserStyle","selectionStyle"];class jC extends Tn{constructor(t){super(),l(this,"context",void 0),this.context=t;}updateConfig(t){for(const[e,i]of Object.entries(t))zC.includes(e)&&this[e](i);}defaultStyleConfig(t){if(!Ps(t))return;const{annotationController:e}=this.context,{viewer:i}=this.context;e.setAnnotationInteractiveConfig({defaultStyleConfig:t}),e.updateFreeTextDefaultConfig(),i.hooks.annotationDefaultStyleChanged.emit(i.getAnnotationConfig().defaultStyleConfig),i.emit("annotationDefaultStyleChanged",i.getAnnotationConfig().defaultStyleConfig);}enableContinuousDrawing(t){const{annotationController:e}=this.context;e.interactiveConfig.enableContinuousDrawing=t;}controlsStyle(t){if(!Ps(t))return;const{annotationController:e}=this.context;e.setAnnotationInteractiveConfig({controlsStyle:t});}inkCreateDelay(t){const{annotationController:e}=this.context;e.interactiveConfig.inkCreateDelay=t;}showOnTopWhenSelected(t){const{annotationController:e}=this.context;e.interactiveConfig.showOnTopWhenSelected=t;}}const $C={arc:"annotationArc",circle:"annotationCircle",ellipse:"annotationEllipse",image:"annotationImage",ink:"annotationInk",rectangle:"annotationRect",line:"annotationLine",polyline:"annotationPolyline",polygon:"annotationPolygon",textTypewriter:"annotationFreeText",textBox:"annotationTextBox",stamp:"annotationStamp",textAssist:"annotationTextAssist",highlight:"annotationHighlight",underline:"annotationUnderline",strikeout:"annotationStrikeout",incomplete:"annotationIncomplete"},GC={annotationArc:"arc",annotationCircle:"circle",annotationEllipse:"ellipse",annotationImage:"image",annotationInk:"ink",annotationRect:"rectangle",annotationLine:"line",annotationPolyline:"polyline",annotationPolygon:"polygon",annotationFreeText:"textTypewriter",annotationTextBox:"textBox",annotationStamp:"stamp",annotationTextAssist:"textAssist",annotationHighlight:"highlight",annotationUnderline:"underline",annotationStrikeout:"strikeout"};class XC extends Tn{constructor(t){super(),l(this,"viewer",void 0),l(this,"annotationConfigService",void 0),l(this,"annotationController",void 0),l(this,"context",void 0),this.viewer=t,this.context=t.context,this.annotationConfigService=new jC(this),this.initAnnotationController(),this.listenViewerEventsForAnnotation();}initAnnotationController(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&((new sd).init(this.context.rendererService.docRenderer.canvas),this.annotationController=new Wh(this.context.rendererService.getCanvasDom()),this.listenViewerNativeEventsForAnnotation(),this.annotationController.hooks.deleteAnnotation.on((t=>{const e=new Set(t.shapes.map((t=>t.uid)));this.context.core.annotationService.deleteAnnotations([...e]);}),this),this.annotationController.hooks.selectAnnotation.on((t=>{const e=Pg.create(t.oldAnnotationsUids,t.newAnnotationUids);this.syncAnnotationLayerState(),this.viewer.hooks.selectedAnnotationsChanged.emit(e),t.emitSelected&&this.viewer.emit("selectedAnnotationsChanged",{newAnnotationUids:[...t.newAnnotationUids],oldAnnotationUids:[...t.oldAnnotationsUids]});}),this),this.annotationController.hooks.modifyAnnotation.on((t=>{const e=t.shapes.map((t=>{const e=t.shape.getAnnotationConfig();return {annotationUid:t.uid,options:{transform:As(e.transform),style:e.style}}}));this.context.core.annotationService.updateAnnotations(e,this.context.uid,t.actions);}),this),this.annotationController.hooks.addAnnotation.on((t=>{const e=this.context.getActiveTab();if(!e)return;const{annotationService:i}=this.context.core;t.shapes.forEach((t=>{const s=t.shape.getAnnotationConfig(),n=lf(),o=i.createAnnotation(e.uid,{uid:t.uid,docUid:e.uid,pageUid:t.shape.pageUid,type:GC[s.type],transform:As(s.transform),style:As(s.style),flags:["print"],comment:{annotationUid:t.uid,author:"",subject:"",contents:"",creationDate:n,modificationDate:n,markedStates:[],reviewStates:[],replies:[]}});this.annotationController.updateLayer(t.uid,o.layer);}));}),this),this.annotationController.hooks.annotationModeChanged.on((t=>{if("none"===t){"annotation"===this.viewer.getViewerConfig().toolMode&&this.viewer.updateViewerConfig({toolMode:"pan"});}})),this.annotationController.hooks.beforeAnnotationEdit.on((t=>{this.viewer.hooks.beforeAnnotationEdit.emit(t);})),this.annotationController.hooks.afterAnnotationEdit.on((t=>{this.viewer.hooks.afterAnnotationEdit.emit(t);})),this.annotationController.hooks.beforeAnnotationDraw.on((t=>{this.viewer.hooks.beforeAnnotationDraw.emit(t);})),this.annotationController.hooks.afterAnnotationDraw.on((t=>{this.viewer.hooks.afterAnnotationDraw.emit(t);})),this.annotationController.hooks.renderAnnotation.on((()=>{this.context.render();})),this.annotationController.hooks.selectAnnotationTextChars.on((t=>{this.viewer.hooks.annotationTextCharsSelected.emit(t);})));}listenViewerNativeEventsForAnnotation(){const t=this.context.rendererService.getCanvasDom();Dn(t,Ms()?"click":"pointerup",this).on((t=>{t.preventDefault(),this.annotationController.clickHandler(t);})),Dn(document,"keydown",this).on((t=>{this.annotationController.keyDownHandler(t);})),Dn(t,"dblclick",this).on((t=>{this.annotationController.dblClickHandler(t);}));}listenViewerEventsForAnnotation(){const{context:t,context:{hooks:e,tabService:i}}=this;(t.isDefaultViewer||t.isThumbnailViewer)&&(e.pageExistenceChanged.on((t=>{0===t.pageCount&&(this.annotationController.container=null,this.annotationController.containerId=null,this.context.annotationEditService.containerPage=null);})),e.toolModeChanged.on((e=>{const{annotationMode:i}=t.viewerConfig;if("annotation"!==e.newToolMode)this.annotationController.setAnnotationMode("none"),"crop"===e.newToolMode&&this.selectAnnotations([]);else {let t="draw";"select"===i?t="select":"erase"===i&&(t="erase"),this.annotationController.setAnnotationMode(t);}}),this),e.annotationModeChanged.on((e=>{const{toolMode:i}=t.viewerConfig;if("select"===e.newAnnotationMode||"erase"===e.newAnnotationMode){const t=e.newAnnotationMode;"annotation"===i&&this.annotationController.setAnnotationMode(t);}else {const t=$C[e.newAnnotationMode];this.annotationController.drawType=t,"annotation"===i&&this.annotationController.setAnnotationMode("draw");}}),this),e.addPagesToDoc.on((t=>{i.getTab(t.docUid)&&this.addAnnotationByPageUids(t.pageUids);}),this),e.openDocument.on((t=>{i.getTab(t.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(t.pages));}),this),e.closeDocument.on((t=>{t.pages.forEach((t=>{const e=this.context.core.pageService.getPage(t);this.annotationController.deleteShape(e.annotations,!1,!1);}));}),this),e.deletePages.on((t=>{t.pageUids.forEach((t=>{const e=this.context.core.pageService.getPage(t);this.annotationController.deleteShape(e.annotations,!1,!1);}));}),this),e.syncDocument.on((t=>{i.getTab(t.uid)&&(this.selectAnnotations([]),this.addAnnotationByPageUids(t.pages));}),this),e.afterRender.on((e=>{if(null==e||!e.total)return;const i=t.annotationEditService.containerPage;if(!i)return;if(!e.getPageByUid(i.uid))return;let{x:s,y:n}=i.cropBox.getPosition(),{width:o,height:r}=i.cropBox;const a=(i.rotation%360+360)%360/90;if(1===a?s-=r:2===a?(s-=o,n-=r):3===a&&(n-=o),1===a||3===a){const t=o;o=r,r=t;}this.annotationController.eventService.setEventArea({x:s,y:n,width:o,height:r});}),this));}disableTextEditMode(){const{eventService:t}=this.annotationController;null!=t&&t.activatedShape&&(null==t?void 0:t.activatedShape)instanceof Kl&&null!=t&&t.activatedShape.isEditMode&&(null==t||t.activatedShape.textEditEventHandler.disableEditMode(),this.context.render());}addAnnotationByPageUids(t){t.forEach((t=>{const e=this.context.core.pageService.getPage(t);if(e.annotations.forEach((t=>{const e=this.context.core.annotationService.annotationApp.getAnnotationByUid(t);this.addAnnotationByAnnotationData(e);})),0===e.annotations.length){const t=this.context.tabService.getTab(e.doc.uid);if(!t)return;const i=t.getPageByUid(e.uid);if(!i)return;this.annotationController.setAnnotationContainer(e.uid,i.mediaBox);}}));}addAnnotationByAnnotationData(t){if("unknown"===t.type)return !0;const e=this.context.core.pageService.getPage(t.pageUid);if(!e)return !1;const i=this.context.tabService.getTab(e.doc.uid);if(!i)return !1;const s=i.getPageByUid(t.pageUid);if(!s)return !1;const n=t.getConfig();this.annotationController.setAnnotationContainer(t.pageUid,s.mediaBox);const o=this.annotationController.addShape($C[t.type],{id:t.uid,style:{...n.style,zIndex:t.layer},transform:n.transform},!1);if(this.annotationController.setAnnotationFlags(t.uid,{enableControl:!n.flags.includes("readOnly"),isVisible:!n.flags.includes("noView")},!1),o instanceof vh&&"base"===o.stampType){const e=o.getAnnotationConfig();t.transform.position=e.transform.position,t.transform.scale=e.transform.scale,t.style=e.style;}if(o instanceof Kl&&"freeTextWriter"===o.textType){const e=o.getAnnotationConfig();t.style.width=e.style.width;}return this.syncAnnotationLayerState(),!0}updateAnnotations(t,e){if(e===this.context.uid)return !0;const i=t.reduce(((t,e)=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(e);if(i){const s=this.context.core.pageService.getPage(i.pageUid);if(s){if(this.context.tabService.getTab(s.doc.uid)){const s=i.getConfig();t.push({annotationUid:e,config:s});}}}return t}),[]);return i.length===t.length&&(i.forEach((t=>{var e,i;let{annotationUid:s,config:n}=t;this.annotationController.updateShape(s,{id:s,style:n.style,transform:n.transform},!1);const o=this.annotationController.getShape(s),r=this.context.core.annotationService.annotationApp.getAnnotationByUid(s),a=o.getAnnotationConfig();null!=a&&null!==(e=a.transform)&&void 0!==e&&e.position&&(r.transform.position=a.transform.position),null!=a&&null!==(i=a.transform)&&void 0!==i&&i.scale&&(r.transform.scale=a.transform.scale),o instanceof vh&&"stamp"===o.renderType&&(r.style.stampConfig=a.style.stampConfig),this.annotationController.setAnnotationFlags(s,{enableControl:!n.flags.includes("readOnly"),isVisible:!n.flags.includes("noView")});})),!0)}updateAnnotationPage(t,e){const i=this.context.core.annotationService.getAnnotationByUid(t);if(!i)return;const s=this.context.core.pageService.getPage(i.pageUid);if(!s)return;const n=this.context.tabService.getTab(s.doc.uid);if(!n)return;const o=n.getPageByUid(e);o&&(this.annotationController.moveShape([t],e,o.mediaBox),this.syncAnnotationLayerState());}updateLayer(t){const e=t.reduce(((t,e)=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(e);if(i){const e=this.context.core.pageService.getPage(i.pageUid);if(e){this.context.tabService.getTab(e.doc.uid)&&t.push(i);}}return t}),[]);return e.length===t.length&&(e.forEach((t=>{this.annotationController.updateLayer(t.uid,t.layer);})),this.syncAnnotationLayerState(),!0)}syncAnnotationLayerState(){let t={back:!1,front:!1,forward:!1,backward:!1};const e=this.annotationController.getSelectedShapeUids();return 1===e.length&&(t=this.context.core.annotationService.getAnnotationLayerState(e[0])),this.viewer.hooks.annotationLayerStateChanged.emit(Tg.create(t)),t}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.annotationController.deleteShape(t,!1,e),this.syncAnnotationLayerState();}selectAnnotations(t){return this.annotationController.selectShape(t)}getSelectedAnnotations(){const t=this.annotationController.getSelectedShapeUids();if(!t.length)return [];const e=[];return t.forEach((t=>{const i=this.context.core.annotationService.annotationApp.getAnnotationByUid(t);i&&e.push(i);})),e}duplicateAnnotation(t,e){throw new Error("Method not implemented.")}}class YC extends Tn{constructor(t){super(),l(this,"context",void 0),l(this,"containerPage",void 0),this.context=t;}isHitAnnotation(t){return this.context.annotationController.isHitShape(t)}startHandler(t,e){this.context.annotationController.startHandler(t,e);}cursorHandler(t,e,i){this.context.annotationController.cursorHandler(t,e,i);}moveHandler(t,e){this.context.annotationController.moveHandler(t,e);}endHandler(t){this.context.annotationController.endHandler(t);}activateAnnotation(t,e){this.context.annotationController.eventService.activateShape(t,e);}deactivateAnnotation(){this.context.annotationController.eventService.inactivateShape(!0),this.context.annotationController.eventService.defaultGroup.clear();}hasActiveAnnotation(){return this.context.annotationController.getSelectedShapeUids().length>0}moveAnnotationByKeyboard(t){}setAnnotationContainer(t){this.containerPage=t,this.context.annotationController.setAnnotationContainer(t.uid,t.mediaBox);}setAnnotationInteractionArea(t){this.context.annotationController.eventService.setEventArea(t);}copyAnnotations(){const t=this.context.annotationController.getSelectedShapeUids();0===t.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.copyAnnotations(t);}cutAnnotations(){const t=this.context.annotationController.getSelectedShapeUids();0===t.length||this.context.annotationController.isInTextEditMode()?this.context.viewer.clearAnnotationClipboard():this.context.viewer.cutAnnotations(t);}pasteAnnotations(){this.context.annotationController.isInTextEditMode()||this.context.viewer.pasteAnnotations();}dispose(){super.dispose(),this.containerPage=null;}}class JC extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),this.action=t,this.core=e,this.type="createAnnotation",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){const{action:t}=this,{annotationApp:e}=this.core.annotationService,{annotationConfig:i}=this.action;return !!e.createAnnotations([{docUid:t.docUid,uid:i.uid,pageUid:t.pageUid,type:i.type,style:i.style,transform:i.transform,flags:i.flags,comment:i.comment,layer:i.layer}])}undo(){this.core.annotationService.annotationApp.deleteAnnotations([this.action.annotationConfig.uid]);}}class qC extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),this.action=t,this.core=e,this.type="deleteAnnotation",e.commandService.onBeforeRefreshCommands.on((e=>{t.docUid===e.docUid&&(t.deleteConfigs.slice().forEach((i=>{if(e.pageUids.includes(i.pageUid)){const e=t.deleteConfigs.findIndex((t=>t.pageUid===i.pageUid));t.deleteConfigs.splice(e,1);}})),this.isValid=t.deleteConfigs.length>0);}),this);}execute(){const{action:t}=this,e=t.deleteConfigs.map((t=>t.uid));return this.core.annotationService.annotationApp.deleteAnnotations(e),!0}undo(){const{annotationApp:t}=this.core.annotationService,e=this.action.deleteConfigs.map((t=>({docUid:this.action.docUid,uid:t.uid,type:t.type,pageUid:t.pageUid,style:t.style,transform:t.transform,flags:t.flags,comment:t.comment,layer:t.layer,oriIndex:t.oriIndex,modified:t.modified})));t.createAnnotations(e);}}class ZC extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),l(this,"oldLayer",void 0),l(this,"newLayer",void 0),this.action=t,this.core=e,this.type="bringAnnotationToFront",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){const{annotationApp:t}=this.core.annotationService,{annotationUid:e}=this.action,i=t.getAnnotationByUid(e);return this.oldLayer||(this.oldLayer=i.layer),this.newLayer?t.restoreLayer(e,this.newLayer):(t.bringToFront(e),this.newLayer=i.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer);}}class QC extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),this.action=t,this.core=e,this.type="bringAnnotationForward",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){return this.core.annotationService.annotationApp.bringForward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid);}}class KC extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),this.action=t,this.core=e,this.type="sendAnnotationBackward",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){return this.core.annotationService.annotationApp.sendBackward(this.action.annotationUid)}undo(){this.core.annotationService.annotationApp.bringForward(this.action.annotationUid);}}class tS extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),l(this,"oldLayer",void 0),l(this,"newLayer",void 0),this.action=t,this.core=e,this.type="sendAnnotationToBack",this.core.commandService.onBeforeRefreshCommands.on((t=>{t.pageUids.includes(this.action.pageUid)&&(this.isValid=!1);}),this);}execute(){const{annotationApp:t}=this.core.annotationService,{annotationUid:e}=this.action,i=t.getAnnotationByUid(e);return this.oldLayer||(this.oldLayer=i.layer),this.newLayer?t.restoreLayer(e,this.newLayer):(t.sendToBack(e),this.newLayer=i.layer),!0}undo(){this.core.annotationService.annotationApp.restoreLayer(this.action.annotationUid,this.oldLayer);}}class eS extends nm{constructor(t,e,i){super(),l(this,"action",void 0),l(this,"core",void 0),l(this,"updatedBy",void 0),this.action=t,this.core=e,this.updatedBy=i,this.type="updateAnnotation",e.commandService.onBeforeRefreshCommands.on((e=>{if(t.docUid!==e.docUid)return;const{pageUid:i}=t;e.pageUids.includes(i)&&(this.isValid=!1);}),this);}execute(){return this.update(!0),this.updatedBy=null,!0}undo(){this.update(!1);}update(t){const{annotationApp:e}=this.core.annotationService,i=this.action.updateDetails.map((e=>{const i=As(t?e.to:e.from);return {uid:e.annotationUid,...i}}));e.updateAnnotation({updateDetails:i,updatedBy:this.updatedBy,updateActions:[...this.action.updateActions]});}}class iS extends nm{constructor(t,e){super(),l(this,"action",void 0),l(this,"core",void 0),this.action=t,this.core=e,this.type="switchAnnotationPage",e.commandService.onBeforeRefreshCommands.on((e=>{t.docUid===e.docUid&&t.moveConfigs.slice().every((t=>((e.pageUids.includes(t.from.pageUid)||e.pageUids.includes(t.to.pageUid))&&(this.isValid=!1),this.isValid)));}),this);}execute(){const{annotationApp:t}=this.core.annotationService;return this.action.moveConfigs.forEach((e=>{if(Ts(e.to.layer)){const i=t.annotationPageRepo.findPageByUid(e.to.pageUid).createTop();e.to.layer=i;}t.switchAnnotationPage(e.annotationUid,{...e.to});})),!0}undo(){const{annotationApp:t}=this.core.annotationService;this.action.moveConfigs.forEach((e=>{t.switchAnnotationPage(e.annotationUid,{...e.from});}));}}class sS extends Tn{constructor(t){super(),l(this,"core",void 0),l(this,"annotationApp",void 0),l(this,"hooks",void 0),l(this,"pasteConfig",{pasteComment:!1,pasteReply:!0,updateDate:!0}),l(this,"clipboard",[]),this.core=t,this.annotationApp=new VC,this.hooks=this.annotationApp.hooks;}reset(){this.annotationApp.reset();}getAnnotationByUid(t){return this.annotationApp.getAnnotationByUid(t)}deleteAnnotationPages(t){const e=t.reduce(((t,e)=>{const i=this.core.pageService.getPage(e);return i&&t.push(...i.annotations),t}),[]);this.deleteAnnotations(e,!1),this.annotationApp.annotationPageRepo.deletePagesByUids(t);}createAnnotationsByParsedPages(t,e){const i=lf();return e.reduce(((e,s)=>{var n;this.annotationApp.createAnnotationPage(s.pageUid);const o=null===(n=s.annotations)||void 0===n?void 0:n.reduce(((e,n)=>{var o,r,a,l,h;rS(n);const d={uid:n.uid,docUid:t,pageUid:s.pageUid,type:n.type,style:n.style,transform:n.transform,flags:n.flags,comment:nS(n.comment),creationDate:null!==(o=null===(r=n.comment)||void 0===r?void 0:r.creationDate)&&void 0!==o?o:i,modificationDate:null!==(a=null===(l=n.comment)||void 0===l?void 0:l.modifiedDate)&&void 0!==a?a:i,oriIndex:null===(h=n.raw)||void 0===h?void 0:h.oriIndex};return e.push(d),e}),[]);return null!=o&&o.length?(this.annotationApp.createAnnotations(o),e.push(o.map((t=>t.uid)))):e.push([]),e}),[])}createAnnotation(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(rS(e),i){const i=new JC({actionUid:_s(),type:"createAnnotation",docUid:t,pageUid:e.pageUid,annotationConfig:{uid:e.uid,type:e.type,style:e.style,transform:e.transform,flags:e.flags,comment:e.comment,layer:e.layer,modified:e.modified,oriIndex:e.oriIndex}},this.core);this.core.commandService.execute(i,t);}else this.annotationApp.createAnnotations([e]);return this.annotationApp.getAnnotationByUid(e.uid)}deleteAnnotations(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{pageService:i,commandService:s}=this.core,n=t.reduce(((t,e)=>{const s=this.annotationApp.getAnnotationByUid(e);if(s){const e=i.getPage(s.pageUid),n=t.get(e.doc.uid)||{uid:e.doc.uid,annotationConfigs:[]};t.set(n.uid,n);const o=s.getConfig();o.layer=s.layer,n.annotationConfigs.push(o);}return t}),new Map);if(e)for(const[t,e]of n){const i=e.annotationConfigs.map((t=>({uid:t.uid,type:t.type,pageUid:t.pageUid,style:t.style,transform:t.transform,flags:t.flags,comment:t.comment,layer:t.layer,oriIndex:t.oriIndex,modified:t.modified}))),n=new qC({actionUid:_s(),type:"createAnnotation",docUid:t,deleteConfigs:i},this.core);s.execute(n,e.uid);}else this.annotationApp.deleteAnnotations(t,!1);}updateAnnotations(t,e,i){let s,n;const o=t.reduce(((t,e)=>{const{annotationUid:i}=e,o=this.annotationApp.getAnnotationByUid(i);if(o){const i=this.core.pageService.getPage(o.pageUid);i&&(s=i.uid,n=i.doc.uid,t.push({annotation:o,page:i,options:e.options}));}return t}),[]);if(null==o||!o.length||o.length!==t.length)return;const r=lf(),a=o.map((t=>{let{annotation:e,page:i,options:s}=t;return s.comment||(s.comment={}),s.comment.modificationDate=r,{annotationUid:e.uid,from:{...e.getConfig(),modified:e.modified},to:{...s,modified:!0}}})),l=new eS({actionUid:_s(),type:"updateAnnotation",docUid:n,pageUid:s,updateDetails:a,updateActions:i||[]},this.core,e);this.core.commandService.execute(l,n);}switchAnnotationPage(t){const e=t.map((t=>({annotation:this.annotationApp.getAnnotationByUid(t.annotationUid),...t}))),i=this.core.pageService.getPage(e[0].annotation.pageUid);if(!i)return;const s=e.map((t=>{let{annotationUid:e,annotation:i,pageUid:s,x:n,y:o}=t;return {annotationUid:e,from:{pageUid:i.pageUid,x:i.style.x,y:i.style.y,layer:i.layer},to:{pageUid:s,x:Ts(n)?i.style.x:n,y:Ts(o)?i.style.y:o,layer:void 0}}})),n=new iS({actionUid:_s(),type:"switchAnnotationPage",docUid:i.doc.uid,moveConfigs:s},this.core);this.core.commandService.execute(n,i.doc.uid);}duplicateAnnotation(t,e){const i=this.annotationApp.getAnnotationByUid(t);if(!i)return null;const s=i.getConfig();s.uid=_s(),e&&(s.pageUid=e),s.comment.creationDate=lf(),s.comment.modificationDate=s.comment.creationDate;return this.createAnnotation(s.docUid,s)}copyAnnotations(t){t.length&&(this.clipboard=[]),t.forEach((t=>{const e=this.annotationApp.getAnnotationByUid(t);if(e){const t=e.getConfig();this.clipboard.push(t);}}));}cutAnnotations(t){this.copyAnnotations(t),this.deleteAnnotations(t);}pasteAnnotations(t,e){this.clipboard.length&&this.clipboard.forEach((i=>{const s=lf(),n=As(i),o=_s();Object.assign(n,{uid:o,docUid:t,pageUid:e,creationDate:s,modificationDate:s});const r={annotationUid:o,creationDate:s,modificationDate:s,markedStates:[],reviewStates:[],replies:[]};this.pasteConfig.pasteComment?this.pasteConfig.pasteReply||Object.assign(n.comment,r):Object.assign(n.comment,r,{contents:""}),this.createAnnotation(i.docUid,n);}));}clearAnnotationClipboard(){this.clipboard=[];}bringToFront(t){return this.handleLayer(t,"f")}bringForward(t){return this.handleLayer(t,"fw")}sendToBack(t){return this.handleLayer(t,"b")}sendBackward(t){return this.handleLayer(t,"bw")}handleLayer(t,e){const i=this.annotationApp.getAnnotationByUid(t);if(!i)return !1;const s=this.core.pageService.getPage(i.pageUid);if(!s)return !1;const n={actionUid:_s(),type:e,annotationUid:t,docUid:s.doc.uid,pageUid:s.uid},o=this.annotationApp.getAnnotationLayerState(t);let r;return "f"===e&&o.front?r=new ZC(n,this.core):"fw"===e&&o.forward?r=new QC(n,this.core):"bw"===e&&o.backward?r=new KC(n,this.core):"b"===e&&o.back&&(r=new tS(n,this.core)),r&&this.core.commandService.execute(r,s.doc.uid),!0}getAnnotationLayerState(t){return this.annotationApp.getAnnotationLayerState(t)}updateComment(){}addReply(){}deleteReply(){}updateReply(){}addReviewState(){}deleteReviewState(){}addCheckMarkState(){}deleteCheckMarkState(){}createAnnotationShape(t,e){var i,s;const{type:n,transform:o,style:r}=t.getConfig();let a=r,l=o;if("textTypewriter"===n&&(null===(i=t.transform)||void 0===i||!i.position)){const t=new Kl({style:r,transform:o},"freeTextWriter",{}).getAnnotationConfig();a=t.style,l=t.transform;}e&&function(t,e){const i=["rx","x","width","borderWidth","fontSize"],s=["ry","y","height"],n=["startPoint","endPoint"];Object.keys(t).forEach((o=>{const r=t[o];if(i.includes(o)||s.includes(o)){const i=rr(r);t[o]=e.toPixelPPI(i.value,s.includes(o));}else n.includes(o)?t[o]={x:e.toPixelPPI(r.x,!1),y:e.toPixelPPI(r.y,!0)}:"lineDash"===o?t[o]=r.map((t=>e.toPixelPPI(t,!1))):"points"===o?t[o]=r.map((t=>({x:e.toPixelPPI(t.x,!1),y:e.toPixelPPI(t.y,!0)}))):"segments"===o?t[o]=r.map((t=>t.map((t=>({x:e.toPixelPPI(t.x,!1),y:e.toPixelPPI(t.y,!0)}))))):"textContents"===o&&(t[o]=r.map((t=>({...t,fontSize:e.toPixelPPI(rr(t.fontSize).value,!1)}))));}));}(a,e),"ellipse"===n&&(a.x+=a.width/2||0,a.y+=a.height/2||0,a.rx=a.width/2||a.rx,a.ry=a.height/2||a.ry),l&&null!==(s=l)&&void 0!==s&&s.position&&(l.position={x:e.toPixelPPI(l.position.x,!1),y:e.toPixelPPI(l.position.y,!0)});const h={id:t.uid,style:a,transform:l};let d;switch(n){case"rectangle":d=new Jl(h);break;case"ellipse":d=new Gl(h);break;case"line":d=new oh(h);break;case"ink":d=new Yl(h);break;case"polygon":d=new sh(h);break;case"polyline":d=new nh(h);break;case"textTypewriter":d=new Kl(h,"freeTextWriter",{},!1);break;case"textBox":d=new Kl(h,"textBox");break;case"stamp":d=new vh(h);break;case"highlight":d=new bh(h,wh.HIGHLIGHT);break;case"underline":d=new bh(h,wh.UNDERLINE);break;case"strikeout":d=new bh(h,wh.STRIKEOUT);break;case"incomplete":d=new Ch(h);}if(d instanceof vh&&!d.style.imageData&&d.updateStampStyle({x:a.x,y:a.y,width:a.width,height:a.height}),["highlight","underline","strikeout","incomplete"].includes(n)){const{resolutionX:t,resolutionY:i}=e,{displayResolution:s}=eo,n=t/s,o=i/s;d.setOrigin(0,0),d.scaleLocal(n,o);}return d}getAnnotationUidsByLayer(t){const e=this.annotationApp.annotationPageRepo.findPageByUid(t);return null==e?void 0:e.getAnnotationUidListByLayer()}}function nS(t){return {annotationUid:t.uid,author:t.author,subject:t.subject,contents:t.contents,creationDate:t.creationDate,modificationDate:t.modifiedDate,markedStates:oS(t.markedStates||[]),reviewStates:oS(t.reviewStates||[])}}function oS(t){return t.map((t=>({uid:t.uid,author:t.author,contents:t.contents,creationDate:t.creationDate,state:t.state})))}function rS(t){if("stamp"===t.type){const e=new vh({style:t.style,transform:t.transform}).getAnnotationConfig();t.style=e.style,t.transform={...t.transform,position:e.transform.position,scale:e.transform.scale};}}const aS={install(t){const e=t.getClass("Viewer"),i=(s=e,class extends s{constructor(t){super(t),l(this,"annotationViewerContext",void 0),this.annotationViewerContext=this.register(new XC(this)),this.listenGlobalEventForAnnotation(),this.listenHooksForAnnotation(),this.listenNativeEventsForAnnotation(),this.context.hasAnnotationModule=!0,this.context.annotationEditService=this.register(new YC(this.annotationViewerContext));}listenHooksForAnnotation(){const t=()=>{const t=this.getSelectedAnnotations();if(1!==t.length)return;if(!t[0])return;const e=this.getAnnotationObject(t[0].uid);e instanceof Kl&&e.isEditMode&&e.updateCursor();};this.hooks.scroll.on((e=>{this.context.isDefaultViewer&&t();})),this.hooks.resize.on((e=>{this.context.isDefaultViewer&&t();})),this.hooks.zoomChanged.on((e=>{this.context.isDefaultViewer&&t();})),this.hooks.pageChanged.on((t=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const t=this.getActiveTab();if(null!=t&&t.total){const e=t.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(e);}t&&"single"===t.context.displayMode&&this.annotationViewerContext.disableTextEditMode();}}),this),this.hooks.currentPageChanged.on((t=>{if(this.context.isDefaultViewer||this.context.isThumbnailViewer){const t=this.getActiveTab();if(null!=t&&t.total){const e=t.getCurrentPage();this.context.annotationEditService.setAnnotationContainer(e);}}}),this);}listenGlobalEventForAnnotation(){if(!this.context.isDefaultViewer&&!this.context.isThumbnailViewer)return;const t=this.context.core.annotationService.annotationApp.hooks;t.annotationCreated.on((t=>{t.annotations.forEach((t=>{this.annotationViewerContext.addAnnotationByAnnotationData(t);})),this.context.render();}),this),t.annotationDeleted.on((t=>{this.annotationViewerContext.deleteAnnotations(t.annotations.map((t=>t.uid)),t.emitEvent),this.context.render();}),this);let e=null;t.annotationUpdated.on((t=>{const i=t.updateDetails.map((t=>t.annotationUid));this.annotationViewerContext.updateAnnotations(i,t.updatedBy),this.hooks.annotationsUpdated.emit(new nf(i,t.updateActions)),e||(e=setTimeout((()=>{var t;null===(t=this.context)||void 0===t||t.render(),e=null;}),17));}),this),t.bringFroward.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid,t.forwardUid]),this.context.render();}),this),t.bringToFront.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render();}),this),t.sendBackward.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid,t.backwardUid]),this.context.render();}),this),t.sendToBack.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render();}),this),t.restoreLayer.on((t=>{this.annotationViewerContext.updateLayer([t.annotationUid]),this.context.render();}),this),t.annotationPageSwitched.on((t=>{this.annotationViewerContext.updateAnnotationPage(t.annotationUid,t.to.pageUid),this.context.render();}),this);}listenNativeEventsForAnnotation(){(this.context.isDefaultViewer||this.context.isThumbnailViewer)&&Dn(document,"click",this).on((t=>{const e=this.getActiveTab(),i="visible"===this.context.viewerConfig.visibility;e&&i&&(this.context.viewService.mainContainer.contains(null==t?void 0:t.target)||this.annotationViewerContext.disableTextEditMode());}));}getAnnotationConfig(){return As(this.annotationViewerContext.annotationController.interactiveConfig)}updateAnnotationConfig(t){this.annotationViewerContext.annotationConfigService.updateConfig(t);}selectAnnotations(t){return this.annotationViewerContext.selectAnnotations(t)}deleteAnnotations(t){this.context.core.annotationService.deleteAnnotations(t),this.context.render();}updateAnnotation(t,e,i){this.context.core.annotationService.updateAnnotations([{annotationUid:t,options:e}],void 0,i);}getSelectedAnnotations(){return this.annotationViewerContext.getSelectedAnnotations()}bringForward(t){return this.context.core.annotationService.bringForward(t)}bringToFront(t){return this.context.core.annotationService.bringToFront(t)}sendBackward(t){return this.context.core.annotationService.sendBackward(t)}sendToBack(t){return this.context.core.annotationService.sendToBack(t)}getAnnotationObject(t){return this.annotationViewerContext.annotationController.getShape(t)}copyAnnotations(t){t||(t=this.getSelectedAnnotations().map((t=>t.uid))),t.length&&this.context.core.annotationService.copyAnnotations(t);}cutAnnotations(t){t||(t=this.getSelectedAnnotations().map((t=>t.uid))),t.length&&this.context.core.annotationService.cutAnnotations(t);}pasteAnnotations(t,e){const i=this.context.getActiveTab();if(null==i||!i.total)return;const s=i.getCurrentPage();s&&this.context.core.annotationService.pasteAnnotations(t||i.uid,e||s.uid);}clearAnnotationClipboard(){this.context.core.annotationService.clearAnnotationClipboard();}});var s;t.setClass("Viewer",i);},apply(t){const e=new sS(t);t.annotationService=e;const{documentService:i,pageService:s}=t;e.hooks.annotationCreated.on((t=>{t.annotations.forEach((t=>{const e=s.getPage(t.pageUid);e&&e.annotations.push(t.uid);}));}),s),e.hooks.annotationDeleted.on((t=>{t.annotations.forEach((t=>{const e=s.getPage(t.pageUid);if(e){const i=e.annotations.indexOf(t.uid);e.annotations.splice(i,1);}}));}),s),e.hooks.annotationPageSwitched.on((t=>{const e=s.getPage(t.from.pageUid),i=s.getPage(t.to.pageUid);if(e){const i=e.annotations.indexOf(t.annotationUid);e.annotations.splice(i,1);}i&&i.annotations.push(t.annotationUid);}),s);}};class lS{async perspective(t,e,i,s){var n;const o=new Xn,r=await o.initImage({source:t.data,isRGBA:t.type===Wn.RGBA,width:t.width,height:t.height,isBGRA:t.type===Wn.BGRA});r.srcBuffer&&(t.data=r.srcBuffer),null!=i&&i.angle&&await o.rotate({angle:i.angle}),await o.perspective(e);const a=await o.getImage({jpegQuality:null==s?void 0:s.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===Wn.RGBA,bitDepth:null==s?void 0:s.bitDepth,xDpi:null==s?void 0:s.xdpi,yDpi:null==s?void 0:s.ydpi,returnBlob:!1,returnType:Kn[null!==(n=null==s?void 0:s.outputType)&&void 0!==n?n:t.type]});await o.freeReservedData();const l={data:new Blob([a.imageData],{type:a.blobType}),width:a.imageWidth,height:a.imageHeight,resolutionX:a.imageXResolution,resolutionY:a.imageYResolution};return o.terminate(),l}}var hS=new WeakMap,dS=new WeakMap,cS=new WeakSet;function uS(t,e,i,s){return (new lS).perspective(t,e,i,s)}function pS(t){return s(hS,this).push(t),s(dS,this)||(o(dS,this,!0),e(cS,this,gS).call(this)),t.promise}async function gS(){do{if(s(hS,this).isEmpty())break;const t=s(hS,this).pop();try{let i;if("perspective"===(null==t?void 0:t.api))i=await e(cS,this,uS).apply(this,t.params);null==t||t.resolve(i);}catch(e){t.retry<1?(t.retry+=1,s(hS,this).push(t)):null==t||t.reject(e);}}while(!s(hS,this).isEmpty());o(dS,this,!1);}Kf.registerPlugin(yy),Kf.registerPlugin(Lb),Kf.registerPlugin($b),Kf.registerPlugin(Jb),Kf.registerPlugin(aS),Kf.registerPlugin(lw);const fS=new Kf(new class{constructor(){this.registerParser("image/jpeg",od),this.registerParser("image/bmp",od),this.registerParser("image/png",od),this.registerParser("image/tiff",rd),this.registerParser("image/jp2",od),this.registerParser("application/pdf",Zd),this.registerParser("image/rgba",Kd),this.registerParser("application/ddv-blank-image",vc);}dispose(){this.reset();}reset(){ec.getAllParsers().forEach((t=>t.destroy())),ec.clear(),nc.clear();}freeParserByFileUid(t){ac.execute(t);}registerParser(t,e){dc.execute({mime:t,parser:e});}unregisterParser(t){cc.execute(t);}registerCustomParser(t,e){uc.execute({mime:t,parser:e});}unregisterCustomParser(t){pc.execute(t);}getDefaultParserOptions(t){return gc.execute(t)}setDefaultParserOptions(t,e){return fc.execute({mime:t,options:e})}getCustomParserClasses(t){return mc.execute(t)}async parse(t,e,i,s,n){return hc.execute({fileData:t,mime:e,fileUid:i,indices:s,parseOptions:n})}async getPage(t,e,i,s){return lc.execute({fileData:t,mime:e,fileUid:i,fileIndex:s})}cancelGetPage(t,e){rc.execute({fileUid:t,fileIndex:e});}async getParseInfo(t,e,i,s){return yc.execute({fileData:t,mime:e,fileUid:i,options:s})}},new class{constructor(){this.registerSaver("application/pdf",xo),this.registerSaver("image/png",wo),this.registerSaver("image/jpeg",wo),this.registerSaver("image/tiff",bo);}registerSaver(t,e){ro.execute({mime:t,saverConstructor:e});}unregisterSaver(t){ao.execute(t);}getSaver(t){return oo.execute(t)}},new class{constructor(){a(this,cS),n(this,hS,new Qn),n(this,dS,!1);}dispose(){throw new Error("Method not implemented.")}perspective(t,e,i,s){return this.createTask("perspective",[t,e,i,s])}createTask(t,i){const s={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of i)s.params.push(t);return s.promise=new Promise(((t,e)=>{s.resolve=t,s.reject=e;})),e(cS,this,pS).call(this,s)}cancelTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);s(hS,this).remove(i);}},new class{constructor(){a(this,Lc),l(this,"filter",void 0),n(this,Mc,new Qn),n(this,Bc,!1);}get enableFilter(){return !!this.filter}async applyFilter(t,e,i,s){return this.createTask("filter",[t,e,i,s])}cancelFilter(t,e){}setImageFilter(t){t?this.filter=t:this.filter&&(this.filter.destroy(),this.filter=null);}getDefaultFilterType(){var t;return (null===(t=this.filter)||void 0===t?void 0:t.defaultFilterType)||wc.NONE}getSupportedFilters(){var t;return (null===(t=this.filter)||void 0===t?void 0:t.querySupported())||[]}createTask(t,i){const s={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of i)s.params.push(t);return s.promise=new Promise(((t,e)=>{s.resolve=t,s.reject=e;})),e(Lc,this,Oc).call(this,s)}cancelTask(t,e){const i={api:t,params:[],promise:void 0,resolve:void 0,reject:void 0,retry:0};for(const t of e)i.params.push(t);s(Mc,this).remove(i);}},new class{constructor(){l(this,"detector",void 0);}get enableDetect(){return this.detector&&this.detector instanceof Cc}detect(t,e){var i;return null===(i=this.detector)||void 0===i?void 0:i.detect(t,e)}setDetector(t){t?this.detector=t:this.detector&&(this.detector.destroy(),this.detector=null);}resetDetector(){this.detector&&this.detector.reset();}reset(){var t;null===(t=this.detector)||void 0===t||t.destroy(),this.detector=null;}}),mS="Layout",yS="Button",vS="Capture",xS="Flashlight",wS="CameraConvert",bS="CameraResolution",CS="AutoDetect",SS="AutoCapture",PS="ImagePreview",AS="Rotate",TS="RotateLeft",kS="RotateRight",DS="Delete",ES="DeleteCurrent",IS="DeleteAll",RS="Zoom",MS="ZoomIn",BS="ZoomOut",LS="ZoomByPercentage",US="Crop",OS="CropMode",_S="CropCurrent",NS="CropAll",WS="FullQuad",FS="PerspectiveAll",HS="Undo",VS="Redo",zS="FitMode",jS="FitWindow",$S="FitHeight",GS="FitWidth",XS="ActualSize",YS="DisplayMode",JS="SinglePage",qS="ContinuousPage",ZS="Pan",QS="Load",KS="Download",tP="Print",eP="Filter",iP="Restore",sP="ThumbnailSwitch",nP="Pagination",oP="Done",rP="Back",aP="Blank",lP="Close",hP="MainView",dP="SeparatorLine",cP="AnnotationSet",uP="EllipseAnnotation",pP="EraseAnnotation",gP="InkAnnotation",fP="LineAnnotation",mP="PolygonAnnotation",yP="PolylineAnnotation",vP="RectAnnotation",xP="SelectAnnotation",wP="StampIconAnnotation",bP="StampImageAnnotation",CP="TextBoxAnnotation",SP="TextTypewriterAnnotation",PP="BringForward",AP="BringToFront",TP="SendBackward",kP="SendToBack";function DP(t,e,i,s){return !!Ts(t)&&$c.output(e,i,s,void 0,zc.PARAM_MISS,!0)}function EP(t,e,i,s){return !!Ps(t)||$c.output(e,i,s,void 0,zc.PARAM_INVALID)}class IP{static getTooltip(){return aw.getTooltip()}static setTooltip(t){const e="Elements.setTooltip",i="tooltip";return !(DP(t,1,e,i)||!EP(t,1,e,i))&&(aw.setTooltip(t),!0)}static getDisplayTextConfig(){return aw.getDisplayTextConfig()}static setDisplayTextConfig(t){const e="Elements.displayTextConfig",i="displayTextConfig";return !(DP(t,1,e,i)||!EP(t,1,e,i))&&(aw.setDisplayTextConfig(t),!0)}static get Layout(){return mS}static get Button(){return yS}static get Capture(){return vS}static get Flashlight(){return xS}static get CameraConvert(){return wS}static get CameraResolution(){return bS}static get AutoDetect(){return CS}static get AutoCapture(){return SS}static get ImagePreview(){return PS}static get Rotate(){return AS}static get RotateLeft(){return TS}static get RotateRight(){return kS}static get Delete(){return DS}static get DeleteCurrent(){return ES}static get DeleteAll(){return IS}static get Zoom(){return RS}static get ZoomIn(){return MS}static get ZoomOut(){return BS}static get ZoomByPercentage(){return LS}static get Crop(){return US}static get CropCurrent(){return _S}static get CropAll(){return NS}static get FullQuad(){return WS}static get PerspectiveAll(){return FS}static get Undo(){return HS}static get Redo(){return VS}static get Pan(){return ZS}static get CropMode(){return OS}static get Load(){return QS}static get Download(){return KS}static get Print(){return tP}static get Filter(){return eP}static get Restore(){return iP}static get ThumbnailSwitch(){return sP}static get Pagination(){return nP}static get FitMode(){return zS}static get FitWindow(){return jS}static get FitHeight(){return $S}static get FitWidth(){return GS}static get ActualSize(){return XS}static get DisplayMode(){return YS}static get SinglePage(){return JS}static get ContinuousPage(){return qS}static get MainView(){return hP}static get SeparatorLine(){return dP}static get Done(){return oP}static get Back(){return rP}static get Blank(){return aP}static get Close(){return lP}static get AnnotationSet(){return cP}static get EllipseAnnotation(){return uP}static get EraseAnnotation(){return pP}static get InkAnnotation(){return gP}static get LineAnnotation(){return fP}static get PolygonAnnotation(){return mP}static get PolylineAnnotation(){return yP}static get RectAnnotation(){return vP}static get SelectAnnotation(){return xP}static get StampIconAnnotation(){return wP}static get StampImageAnnotation(){return bP}static get TextBoxAnnotation(){return CP}static get TextTypewriterAnnotation(){return SP}static get BringForward(){return PP}static get BringToFront(){return AP}static get SendBackward(){return TP}static get SendToBack(){return kP}}const RP={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-capture-viewer-header-mobile",children:[{type:"CameraResolution",className:"ddv-capture-viewer-resolution"},IP.Flashlight]},IP.MainView,{type:"Layout",className:"ddv-capture-viewer-footer-mobile",children:[IP.AutoDetect,IP.AutoCapture,{type:"Capture",className:"ddv-capture-viewer-captureButton"},IP.ImagePreview,IP.CameraConvert]}]},MP={type:"Layout",flexDirection:"column",className:"ddv-edit-viewer-mobile",children:[{type:"Layout",className:"ddv-edit-viewer-header-mobile",children:[IP.Blank,IP.Pagination,IP.Download]},IP.MainView,{type:"Layout",className:"ddv-edit-viewer-footer-mobile",children:[IP.DisplayMode,IP.RotateLeft,IP.Crop,IP.Filter,IP.Undo,IP.Delete,IP.Load]}]},BP={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-mobile",children:[IP.Blank,IP.Pagination,IP.PerspectiveAll]},IP.MainView,{type:"Layout",className:"ddv-perspective-viewer-footer-mobile",children:[IP.FullQuad,IP.RotateLeft,IP.RotateRight,IP.DeleteCurrent,IP.DeleteAll]}]},LP={type:"Layout",flexDirection:"column",className:"ddv-capture-viewer-desktop",children:[{type:"Layout",className:"ddv-capture-viewer-header-desktop",children:[{type:IP.CameraResolution,className:"ddv-capture-viewer-resolution-desktop"},IP.AutoDetect,{type:IP.Capture,className:"ddv-capture-viewer-capture-desktop"},IP.AutoCapture]},IP.MainView,{type:IP.ImagePreview,className:"ddv-capture-viewer-image-preview-desktop"}]},UP={type:"Layout",flexDirection:"column",children:[{type:"Layout",className:"ddv-perspective-viewer-header-desktop",children:[IP.FullQuad,IP.RotateLeft,IP.RotateRight,IP.DeleteCurrent,IP.DeleteAll,{type:IP.Pagination,className:"ddv-perspective-viewer-pagination-desktop"},{type:IP.PerspectiveAll,className:"ddv-perspective-viewer-perspective-desktop"}]},IP.MainView]},OP={type:IP.Layout,flexDirection:"column",className:"ddv-edit-viewer-desktop",children:[{type:IP.Layout,className:"ddv-edit-viewer-header-desktop",children:[{type:IP.Layout,children:[IP.ThumbnailSwitch,IP.Zoom,IP.FitMode,IP.DisplayMode,IP.RotateLeft,IP.RotateRight,IP.Crop,IP.Filter,IP.Undo,IP.Redo,IP.DeleteCurrent,IP.DeleteAll,IP.Pan]},{type:IP.Layout,children:[{type:IP.Pagination,className:"ddv-edit-viewer-pagination-desktop"},IP.Load,IP.Download,IP.Print]}]},IP.MainView]},_P={type:IP.Layout,children:[IP.MainView]},NP=As(MP);NP.children[0].children=[IP.Blank,IP.Blank,IP.Pagination,IP.AnnotationSet,IP.Download];const WP=As(OP);var FP,HP;WP.children[0].children[0].enableScroll=!0,WP.children[0].children[0].children.push(IP.SeparatorLine,IP.AnnotationSet),function(t){t.REJECTED="rejected",t.ACCEPTED="accepted",t.INITIAL_HERE="initialHere",t.SIGN_HERE="signHere",t.WITNESS="witness",t.APPROVED="approved",t.NOT_APPROVED="notApproved",t.DRAFT="draft",t.FINAL="final",t.COMPLETED="completed",t.CONFIDENTIAL="confidential",t.VOID="void";}(FP||(FP={})),function(t){t.NONE="none",t.OPEN="open",t.OPEN_REVERSE="openReverse",t.CLOSED="closed",t.CLOSED_REVERSE="closedReverse",t.BUTT="butt",t.SLASH="slash",t.SQUARE="square",t.DIAMOND="diamond",t.CIRCLE="circle";}(HP||(HP={}));const VP={background:"#e2e1de"},zP={border:"1px solid #707070",background:"#fff"},jP={border:"2px solid #fe8e14",background:"rgba(255,255,255,0)",maskColor:"rgba(128,128,128,0.6)",ctrlBorderRadius:"50%",ctrlBackground:"#fe8e14",ctrlBorder:"2px solid #fe8e14",ctrlWidth:"15px",ctrlHeight:"15px",invalidCtrlBorderColor:"red",invalidBorderColor:"red"},$P={opacity:1,borderWidth:1,borderColor:"rgb(0,0,0)",background:"",lineDash:[0,0]},GP={content:"",color:"rgb(0,0,0)",fontSize:16,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1},XP={content:"",color:"rgb(0,0,0)",fontSize:1536/72,fontFamily:"Helvetica",fontStyle:"normal",fontWeight:"normal",lineThrough:!1,underline:!1};Ms()&&($P.borderWidth=3,GP.fontSize=72);const YP={...$P,lineEnding:{start:HP.NONE,end:HP.NONE}},JP={paletteConfig:{maxFontSize:256,maxBorderWidth:40,colorList:["#F01314","#FD7C10","#FFEE5F","#07C37F","#0E68F5","#9D3BFE","#000000","#FF9494","#87440C","#B7A514","#046743","#50C9FF","#EBA3ED","#ffffff","#CECECE"],labels:{text:"Text",stroke:"Stroke",fill:"Fill",opacity:"Opacity",style:"Style",standardBusiness:"StandardBusiness"}},toolbarConfig:{},annotationSelectionStyle:{border:"1px solid #59626A",background:"",ctrlBorderRadius:"6px",ctrlWidth:"12px",ctrlHeight:"12px",ctrlBorder:"1px solid #59626A",ctrlBackground:"white"},inkCreateDelay:1e3,showOnTopWhenSelected:!1,enableContinuousDrawing:!1,defaultStyleConfig:{rectangle:{...$P},ellipse:{...$P},polygon:{...$P},polyline:{...YP},line:{...YP},ink:{opacity:1,borderWidth:Ms()?3:1,borderColor:"rgb(0,0,0)"},textBox:{...$P,textAlign:"left",textContent:{...GP}},textTypewriter:{opacity:1,textContent:{...GP}},stamp:{opacity:1,stamp:FP.DRAFT}}},qP={canvasStyle:{...VP},quadSelectionStyle:{...jP},enableAutoCapture:!1,enableAutoDetect:!1,enableTorch:!1,maxFrameNumber:10,acceptedPolygonConfidence:80};function ZP(t,e){return !!t.getActiveTab()||$c.output(e,void 0,void 0,void 0,zc.DOC_NOT_OPEN)}function QP(t,e,i,s){return !i.getActiveTab().doc.pages.length&&$c.output(s,t,e,void 0,zc.DOC_NO_IMAGE,!0)}function KP(t,e,i,s){return !!function(t){return !(!Bs(t)||Bs(t)&&!Number.isInteger(t))}(t)||$c.output(s,e,i,void 0,zc.PARAM_INVALID)}function tA(t,e,i,s,n){const o=hk.isUiConfigValid(t,s);if(o.length>0)return $c.output(n,i,s,o);const r=tk(t,e);return !r||$c.output(n,e.charAt(0).toUpperCase()+e.slice(1),r,void 0,zc.ELEMENT_UNSUPPORTED)}function eA(t,e,i,s,n,o){return (t<e||t>i)&&$c.output(s,n,o,void 0,zc.PARAM_OUT_OF_RANGE,!0)}function iA(t,e,i,s){return !!t.includes(e)||$c.output(i,s,void 0,void 0,zc.PAGE_NOT_EXIST)}function sA(t,e,i,s){return !!Rs(t)||$c.output(s,e,i,void 0,zc.PARAM_INVALID)}function nA(t,e,i,s,n){const o=$c.formatError($c.isStringAndNotEmpty(t,n));return !o||$c.output(e,i,s,void 0,o)}function oA(t,e,i,s,n,o,r){const a=hk.isNumberArrayValid(t,n,o,r);return !a.length||$c.output(e,i,s,a,zc.PARAM_INVALID)}class rA{getIsBoundContainer(t){return t.context.viewService.isBindContainer}bindContainer(t,e,i){DP(e,0,i,"container");const s=hk.isContainerParamValid(e);s&&$c.error(i,"container",void 0,s),t.bindContainer(e);}unbindContainer(t){t.unbindContainer();}getIsVisible(t){return "visible"===t.getViewerConfig().visibility}show(t){t.show();}hide(t){t.hide();}getCurrentDocument(t){var e;const i=null===(e=t.getActiveTab())||void 0===e?void 0:e.uid;return i?Sk.getDocument(i):null}openDocument(t,e,i){const s="docUid or doc";DP(t,0,i,s),function(t){if(Ls(t))return 0!==t.trim().length;return !1}(t)||Ps(t)||$c.error(i,s,void 0,zc.PARAM_INVALID);const n=Ps(t)?t.uid:t;!function(t,e,i,s,n){!!t.getDocument(e)||$c.output(i,s,n,void 0,zc.DOC_NOT_EXIST);}(fS.documentService,n,0,i,s),fS.getViewer(e)||$c.error(i,"viewerUid",void 0,zc.PARAM_INVALID),fS.openDocument(n,e);}closeDocument(t,e){return !!ZP(t,1)&&(t.closeDocument(),!0)}getStyle(t,e,i,s,n){const o="styleName";if(DP(i,1,n,o)||!nA(i,1,n,o))return null;if(!s.includes(i))return $c.warning(n,o,void 0,zc.PARAM_NOT_SUPPORT),null;if("annotationSelectionStyle"===i){return t.getAnnotationConfig().controlsStyle}const r=t.getViewerConfig();if(i in r){const t=function(t,e){const i=["border","background"],s=["left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY","opacity","visibility"],n={pageStyle:i,selectedPageStyle:i,hoveredPageStyle:i,canvasStyle:[...i,"cursor"],checkboxStyle:[...s,"checkMarkColor","checkMarkLineWidth"],pageNumberStyle:[...s,"color","fontSize","fontFamily","onPage"],quadSelectionStyle:["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"]};if(t in n){const i=n[t];return Object.fromEntries(Object.entries(e).filter((t=>{let[e,s]=t;return i.includes(e)})))}return As(e)}(i,r[i]);return "capture"===e&&"quadSelectionStyle"===i?{border:t.border,background:t.background}:t}return null}updateStyle(t,e,i,s,n){return !(DP(e,1,n,"styleName")||DP(i,1,n,"style")||!nA(e,1,n,"styleName")||!EP(i,1,n,"style")||!function(t,e,i,s,n,o){if(!nA(t,o,s,n))return !1;if(!i.includes(t))return $c.output(o,s,n,void 0,zc.PARAM_NOT_SUPPORT);const r=ok(t,e);return !r.length||$c.output(o,s,"style",r)}(e,i,s,n,"styleName",1))&&("annotationSelectionStyle"===e?(t.updateAnnotationConfig({controlsStyle:i}),!0):(t.updateViewerConfig({[e]:i}),!0))}getUiConfig(t){return t.getUiConfig()}updateUiConfig(t,e,i,s){const n="uiConfig";return !(DP(e,1,s,n)||!tA(e,i,s,n,1))&&t.updateUiConfig(e)}indexToUid(t,e,i){const s="index";if(DP(e,1,i,s)||!KP(e,i,s,1)||!ZP(t,1)||QP(void 0,void 0,t,1))return "";return eA(e,0,t.getPageCounts()-1,1,i,s)?"":t.indexToUid(e)}uidToIndex(t,e,i){if(DP(e,1,i,"uid")||!nA(e,1,i,"uid",!1)||!ZP(t,1)||QP(void 0,void 0,t,1))return -1;return iA(this.getCurrentDocument(t).pages,e,1,i)?t.uidToIndex(e):-1}getCurrentPageUid(t){return ZP(t,1)?QP(void 0,void 0,t,1)?"":t.getCurrentPageUid():""}getCurrentPageIndex(t){return ZP(t,1)?QP(void 0,void 0,t,1)?-1:t.getCurrentPageIndex():-1}getPageCount(t){return ZP(t,1)?t.getPageCounts():-1}gotoPage(t,e,i){const s="index";if(DP(e,1,i,s)||!KP(e,i,s,1)||!ZP(t,1)||QP(void 0,void 0,t,1))return -1;return eA(e,0,t.getPageCounts()-1,1,i,s)?-1:t.gotoPage(e)}rotate(t,e,i,s){if(DP(e,1,s,"angle")||!KP(e,s,"angle",1)||!function(t,e,i,s){return t%90==0||$c.output(s,e,i,void 0,zc.PARAM_NOT_SUPPORT)}(e,s,"angle",1)||!ZP(t,1)||QP(void 0,void 0,t,1))return !1;if(!Ts(i)){if(!oA(i,1,s,"indices",0,this.getPageCount(t)-1))return !1}return t.rotatePages(e,i)}saveOperation(t){return !!ZP(t,1)&&t.saveOperations()}on(t,e,i,s){!DP(i,1,e,"eventName")&&!DP(s,1,e,"listener")&&nA(i,1,e,"eventName",!1)&&sA(s,e,"listener",1)&&t.on(i,s);}off(t,e,i,s){!DP(i,1,e,"eventName")&&nA(i,1,e,"eventName",!1)&&(Ts(s)||sA(s,e,"listener",1))&&t.off(i,s);}destroy(t){t&&t.dispose();}}function aA(t,e,i,s){return !!Is(t)||$c.output(s,e,i,void 0,zc.PARAM_INVALID)}function lA(t,e,i,s,n,o){const r=$c.formatError($c.isNumberAndIsInRange(t,n,o));return !r||$c.output(e,i,s,void 0,r)}function hA(t,e,i,s,n){if(!Ps(t))return $c.output(i,s,n,void 0,zc.PARAM_INVALID);const o=[],r=["pageStyle","hoveredPageStyle","selectedPageStyle","currentPageStyle","placeholderStyle","canvasStyle","pageNumberStyle","checkboxStyle","quadSelectionStyle"];return Object.keys(t).forEach((i=>{const s=t[i];if("container"===i)o.push(...hk.isContainerKeyValid(s,n));else if("uiConfig"===i){const t=hk.isUiConfigValid(s,"option.uiConfig");if(t.length>0)o.push(...t);else {const t=tk(s,e);if(t){const i=zc.buildError(zc.ELEMENT_UNSUPPORTED,e.charAt(0).toUpperCase()+e.slice(1),t);o.push(`option.uiConfig: ${i.message}`);}}}else "viewerConfig"!==i&&"thumbnailConfig"!==i||Object.keys(s).forEach((t=>{const e=s[t];if(r.includes(t)){const s=ok(t,e);o.push(...s.map((t=>`${i}.${t}`)));}}));})),!(o.length>0)||$c.output(i,s,n,o)}const dA=["canvasStyle","quadSelectionStyle"],cA="CaptureViewer";var uA=new WeakMap,pA=new WeakMap,gA=new WeakSet;class fA{constructor(t){var i;a(this,gA),n(this,uA,void 0),n(this,pA,new rA),l(this,"uid",void 0),l(this,"groupUid",void 0),l(this,"postfix",void 0);const r=`new ${cA}`;Hu.makeSureCoreLicenseExist(),Hu.makeSureCameraLicenseExist(),Ts(t)||hA(t,"captureViewer",0,r,"option");const h=vn((null==t?void 0:t.viewerConfig)||{},As({...qP,viewerMode:vp.CAPTURE})),d=Ms()?RP:LP;o(uA,this,fS.createViewer({uiConfig:As(d),...t,viewerConfig:h})),null!=t&&null!==(i=t.viewerConfig)&&void 0!==i&&i.enableAutoDetect&&!s(uA,this).context.core.detectorService.enableDetect&&zc.warning(zc.DOC_DETECT_MISS),this.uid=s(uA,this).uid,this.groupUid=s(uA,this).groupUid,this.postfix=s(uA,this).postfix,e(gA,this,mA).call(this);}get isVisible(){return s(pA,this).getIsVisible(s(uA,this))}get isBoundContainer(){return s(pA,this).getIsBoundContainer(s(uA,this))}get currentDocument(){return s(pA,this).getCurrentDocument(s(uA,this))}get acceptedPolygonConfidence(){return s(uA,this).getCameraConfig().acceptedPolygonConfidence}set acceptedPolygonConfidence(t){const e="acceptedPolygonConfidence";lA(t,1,`${cA}.${e}`,e,0,100)&&s(uA,this).updateCameraConfig({acceptedPolygonConfidence:t});}get maxFrameNumber(){return s(uA,this).getCameraConfig().maxFrameNumber}set maxFrameNumber(t){const e="maxFrameNumber";lA(t,1,`${cA}.${e}`,e,1e-6,60)&&s(uA,this).updateCameraConfig({maxFrameNumber:t});}get enableAutoDetect(){return s(uA,this).getCameraConfig().enableAutoDetect}set enableAutoDetect(t){const e="enableAutoDetect",i=`${cA}.${e}`;aA(t,i,e,1)&&(t&&!s(uA,this).context.core.detectorService.enableDetect&&$c.warning(i,void 0,void 0,zc.DOC_DETECT_MISS),s(uA,this).updateCameraConfig({enableAutoDetect:t}));}get enableAutoCapture(){return s(uA,this).getCameraConfig().enableAutoCapture}set enableAutoCapture(t){const e="enableAutoCapture";aA(t,`${cA}.${e}`,e,1)&&s(uA,this).updateCameraConfig({enableAutoCapture:t});}bindContainer(t){s(pA,this).bindContainer(s(uA,this),t,`${cA}.bindContainer`);}unbindContainer(){s(pA,this).unbindContainer(s(uA,this));}show(){s(pA,this).show(s(uA,this));}hide(){s(pA,this).hide(s(uA,this));}getUiConfig(){return s(pA,this).getUiConfig(s(uA,this))}updateUiConfig(t){return s(pA,this).updateUiConfig(s(uA,this),t,"captureViewer",`${cA}.updateUiConfig`)}openDocument(t){s(pA,this).openDocument(t,this.uid,`${cA}.openDocument`);}closeDocument(){return s(pA,this).closeDocument(s(uA,this),`${cA}.closeDocument`)}getStyle(t){return s(pA,this).getStyle(s(uA,this),"capture",t,dA,`${cA}.getStyle`)}updateStyle(t,e){return s(pA,this).updateStyle(s(uA,this),t,e,dA,`${cA}.updateStyle`)}capture(){return s(uA,this).isVideoPlaying()?s(uA,this).context.viewService.isBindContainer?s(uA,this).capture():zc.reject(zc.CONTAINER_NO_BOUND):zc.reject(zc.CAMERA_NO_VIDEO)}play(t){const e=`${cA}.play`;if(!Ts(t)){const i=function(t,e,i,s){const n=hk.isVideoConfig(t,s);return !n.length||$c.output(e,i,s,n)}(t,2,e,"config");if(!0!==i)return i}return s(uA,this).play(t).catch((t=>zc.reject(t,e)))}stop(){s(uA,this).stop();}getCurrentCamera(){return s(uA,this).getCurrentCamera()}getAllCameras(){return s(uA,this).getAllCameras()}selectCamera(t){const e=`${cA}.selectCamera`,i="cameraObjectOrDeviceID",n=DP(t,2,e,i);if(n)return n;if(Ls(t)){const s=nA(t,2,e,i,!1);if(!0!==s)return s}else {const s=function(t,e,i,s){const n=hk.isVideoDeviceInfo(t,s);return !n.length||$c.output(e,i,s,n)}(t,2,e,i);if(!0!==s)return s}return s(uA,this).selectCamera(t).catch((t=>zc.reject(t,e,i)))}getCurrentResolution(){return s(uA,this).getCurrentResolution()}turnOnTorch(){return s(uA,this).turnOnTorch().catch((t=>zc.reject(t)))}turnOffTorch(){return s(uA,this).turnOffTorch().catch((t=>zc.reject(t)))}on(t,e){s(pA,this).on(s(uA,this),`${cA}.on`,t,e);}off(t,e){s(pA,this).off(s(uA,this),`${cA}.off`,t,e);}destroy(){s(pA,this).destroy(s(uA,this));}}function mA(){s(uA,this).hooks.destroy.on((()=>{o(uA,this,null),Object.setPrototypeOf(this,null);}));}const yA={canvasStyle:{...VP},currentPageStyle:{border:"4px solid #fe8e14"},pageStyle:{border:"6px solid rgba(0,0,0,0)",background:"rgba(255,255,255,0)"},selectedPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},hoveredPageStyle:{border:"6px solid #AAAAAA",background:"#AAAAAA"},placeholderStyle:{border:"6px solid rgba(136,136,136,0.2)",background:"rgba(136,136,136,0.2)"},pageNumberStyle:{onPage:!1,visibility:"visible",width:"32px",height:"24px",background:"rgba(255,255,255,0)",border:"0px solid #000",borderRadius:"0px",opacity:1,color:"#323234",fontSize:"14px",fontFamily:"Open Sans",left:"50%",top:"",right:"",bottom:"3px",translateX:"-50%",translateY:"0px"},checkboxStyle:{visibility:"visible",width:"16px",height:"16px",background:"#fff",border:"2px solid #999999",borderRadius:"0px",opacity:1,left:"2px",top:"2px",checkMarkColor:"#FE8E14",checkMarkLineWidth:"2px",translateX:"0px",translateY:"0px"},rows:2,columns:2,multiselectMode:!1,scrollToLatest:!1,enableDragPage:!0,scrollDirection:"vertical"},vA={...yA,visibility:"hidden",size:"180px",position:"left",rows:4,columns:1,canvasStyle:{background:"#DDDDDD"}},xA={canvasStyle:{...VP},pageStyle:{...zP},quadSelectionStyle:{...jP},currentPageStyle:{border:"",background:""},minZoom:.01,maxZoom:64,scrollDirection:"vertical",enableSlide:!0,scrollToLatest:!1},wA=["canvasStyle","pageStyle","selectedPageStyle","hoveredPageStyle","placeholderStyle","pageNumberStyle","checkboxStyle","currentPageStyle"];var bA=new WeakSet;class CA{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"BaseBrowseViewer";a(this,bA),l(this,"v",void 0),l(this,"vCommon",new rA),l(this,"uid",void 0),l(this,"groupUid",void 0),l(this,"postfix",void 0),l(this,"errorPrefix",void 0),this.errorPrefix=i;const s=`new ${this.errorPrefix}`;Hu.makeSureCoreLicenseExist(),Ts(t)||hA(t,"browseViewer",0,s,"option");const n=vn((null==t?void 0:t.viewerConfig)||{},As({...yA,viewerMode:vp.THUMBNAIL,displayMode:"multiple",toolMode:"pan",enableOptimizePage:!0}));this.v=fS.createViewer({uiConfig:As(_P),...t,viewerConfig:n}),this.uid=this.v.uid,this.groupUid=this.v.groupUid,this.postfix=this.v.postfix,e(bA,this,SA).call(this);}get isVisible(){return this.vCommon.getIsVisible(this.v)}get isBoundContainer(){return this.vCommon.getIsBoundContainer(this.v)}set multiselectMode(t){const e="multiselectMode";aA(t,`${this.errorPrefix}.${e}`,e,1)&&this.v.updateViewerConfig({multiselectMode:t});}get multiselectMode(){return this.v.getViewerConfig().multiselectMode}show(){this.vCommon.show(this.v);}hide(){this.vCommon.hide(this.v);}getUiConfig(){return this.vCommon.getUiConfig(this.v)}updateUiConfig(t){return this.vCommon.updateUiConfig(this.v,t,"browseViewer",`${this.errorPrefix}.updateUiConfig`)}getStyle(t){return this.vCommon.getStyle(this.v,"browse",t,wA,`${this.errorPrefix}.getStyle`)}updateStyle(t,e){const i=`${this.errorPrefix}.updateStyle`;return this.vCommon.updateStyle(this.v,t,e,wA,i)}getSelectedPageIndices(){return ZP(this.v,1)?this.v.getSelectedPageIndices():[]}selectAllPages(){if(!ZP(this.v,1))return [];if(0===this.v.getPageCounts()){const t=`${this.errorPrefix}.selectAllPages`;return $c.output(1,t,void 0,void 0,zc.DOC_NO_IMAGE),[]}return this.v.selectAllPages()}selectPages(t){const e=`${this.errorPrefix}.selectPages`,i="indices";if(DP(t,1,e,i)||!ZP(this.v,1))return [];return oA(t,1,e,i,0,this.v.getPageCounts()-1)?this.v.selectPagesByIndices(t):[]}setRowAndColumn(t,e){const i=`${this.errorPrefix}.setRowAndColumn`,s="row",n="column",{maxColumns:o,maxRows:r}=this.v.getViewerConfig();return !(DP(t,1,i,s)||DP(e,1,i,n)||!KP(t,i,s,1)||!KP(e,i,n,1)||eA(t,1,r,1,i,s)||eA(e,1,o,1,i,n))&&this.v.setRowAndColumn(t,e)}on(t,e){this.vCommon.on(this.v,`${this.errorPrefix}.on`,t,e);}off(t,e){this.vCommon.off(this.v,`${this.errorPrefix}.off`,t,e);}}function SA(){this.v.hooks.destroy.on((()=>{this.v=null,Object.setPrototypeOf(this,null);}));}function PA(t,e,i,s,n){const o=hk.isAnnotationOptionsValid(t,s,n);return !o.length||$c.output(e,i,s,o)}const AA={borderColor:"rgb(0,0,0)",background:"",borderWidth:1,opacity:1,lineDash:[0,0],flags:{print:!0,noView:!1,readOnly:!1},rotation:0};var TA=new WeakMap;class kA{constructor(t){l(this,"uid",null),l(this,"creationDate",""),l(this,"modificationDate",""),n(this,TA,void 0),o(TA,this,t),this.uid=_s(),this.creationDate=lf(),this.modificationDate=this.creationDate;}get type(){return null}get pageUid(){const t=fS.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}getOptions(){const t=fS.annotationService.annotationApp.getAnnotationByUid(this.uid);if(t){const e=t.getConfig(),i=IA(e,this.type);o(TA,this,{...i}),this.modificationDate=e.comment.modificationDate;}return BA(this.type,s(TA,this))}updateOptions(t){const e="Annotation.updateOptions";if(DP(t,1,e,"options"))return !1;if(!EP(t,1,e,"options"))return !1;if(!PA(t,1,e,"options",this.type))return !1;const i=this.getOptions(),n=DA(this.type,t,i);if(!["rectangle","stamp","ellipse","textBox","ink"].includes(this.type)&&n.has("rotated")&&n.delete("rotated"),!n.size)return !0;this.getOptions(),vn(t,s(TA,this));const o=EA({...s(TA,this)},this.type);return fS.annotationService.updateAnnotations([{annotationUid:this.uid,options:o}],void 0,[...n]),!0}}function DA(t,e,i){const s="moved",n="resized",o="startPoint",r="endPoint",a=new Map([[["x","y"],"moved"],[["width","height"],"resized"],[["rotation"],"rotated"],[["flags"],"flagsChanged"],[["borderWidth","borderColor","background","opacity","textAlign","lineCap","lineJoin","miterLimit","lineDash","lineEnding","textContents"],"appearanceChanged"],[["textContents","stamp"],"contentChanged"]]),l=As(e);l.flags={...i.flags,...(null==l?void 0:l.flags)||{}},["line","polyline"].includes(t)&&e.lineEnding&&(l.lineEnding={...i.lineEnding,...(null==l?void 0:l.lineEnding)||{}});const h=new Set,d=Object.keys(l);return d.forEach((e=>{if(!nk(i[e],l[e]))if("points"!==e||"ink"!==t&&"polygon"!==t&&"polyline"!==t)if(e!==o&&e!==r||"line"!==t)for(const[t,i]of a)t.includes(e)&&!h.has(i)&&h.add(i);else d.includes(o)&&d.includes(r)&&lk([i[o],i[r]],[l[o],l[r]])?h.add(s):h.add(n);else lk(i[e],l[e])?h.add(s):h.add(n);})),h}function EA(t,e){const i=As(t),s={style:i,flags:[],transform:{angle:0}},{lineEnding:n,points:o,textContents:r,stamp:a,borderWidth:l,x:h,y:d,width:c,height:u,startPoint:p,endPoint:g,lineDash:f}=i||{},m=eo.dataResolution,y=eo.displayResolution;if(o&&("ink"===e?s.style.segments=_A(o,m,y):s.style.points=OA(o,m,y)),n&&(s.style.lineEnding=RA(n,"date")),a&&(s.style.imageData=null,a instanceof Blob||Ls(a)&&ZT(a)?s.style.imageData=a:Ls(a)&&(s.style.iconName=MA(a,"date"))),Ts(l)||(s.style.borderWidth=Cn(l,m,y)),Ts(h)||(s.style.x=Cn(h,m,y)),Ts(d)||(s.style.y=Cn(d,m,y)),Ts(c)||(s.style.width=Cn(c,m,y)),Ts(u)||(s.style.height=Cn(u,m,y)),Ts(f)||(s.style.lineDash=Cn(f,m,y)),Ts(p)||(s.style.startPoint=Cn(p,m,y)),Ts(g)||(s.style.endPoint=Cn(g,m,y)),r){const t=[];r.forEach((e=>{null!=e&&e.fontSize&&(e.fontSize=Cn(e.fontSize,m,y)),Ls(e.fontFamily)&&""===(null==e?void 0:e.fontFamily.trim())&&(e.fontFamily="Helvetica"),t.push({...XP,...e});})),s.style.textContents=t;}return Bs(t.rotation)&&["rectangle","stamp","ellipse","textBox","ink"].includes(e)&&(s.transform.angle=t.rotation),t.flags&&(t.flags.print&&s.flags.push("print"),t.flags.noView&&s.flags.push("noView"),t.flags.readOnly&&s.flags.push("readOnly")),s}function IA(t,e){var i,s,n,o,r,a,l;const{lineEnding:h,iconName:d,imageData:c,segments:u,textContents:p,borderWidth:g,x:f,y:m,width:y,height:v,startPoint:x,endPoint:w,lineDash:b,points:C}=(null==t?void 0:t.style)||{},S=eo.displayResolution,P=eo.dataResolution;if(C&&(t.style.points=OA(C,S,P)),u&&"ink"===e&&(t.style.points=_A(u,S,P),delete t.style.segments),h&&(t.style.lineEnding=RA(h,"user")),(c||d)&&(t.style.stamp=c||MA(d,"user"),delete t.style.iconName,delete t.style.imageData),Ts(g)||(t.style.borderWidth=Cn(g,S,P)),Ts(f)||(t.style.x=Cn(f,S,P)),Ts(m)||(t.style.y=Cn(m,S,P)),Ts(y)||(t.style.width=Cn(y,S,P)),Ts(v)||(t.style.height=Cn(v,S,P)),Ts(x)||(t.style.startPoint=Cn(x,S,P)),Ts(w)||(t.style.endPoint=Cn(w,S,P)),Ts(b)||(t.style.lineDash=Cn(b,S,P)),p){const e=[];p.forEach((t=>{null!=t&&t.fontSize&&(t.fontSize=Cn(t.fontSize,S,P)),Ls(t.fontFamily)&&""===(null==t?void 0:t.fontFamily.trim())&&(t.fontFamily="Helvetica"),e.push({...XP,...t});})),t.style.textContents=e;}return null===(i=t.style)||void 0===i||delete i.lineJoin,null===(s=t.style)||void 0===s||delete s.lineCap,null===(n=t.style)||void 0===n||delete n.miterLimit,{...t.style,rotation:(null===(o=t.transform)||void 0===o?void 0:o.angle)||0,flags:{print:!(null===(r=t.flags)||void 0===r||!r.includes("print")),noView:!(null===(a=t.flags)||void 0===a||!a.includes("noView")),readOnly:!(null===(l=t.flags)||void 0===l||!l.includes("readOnly"))}}}function RA(t,e){const i={None:HP.NONE,OpenArrow:HP.OPEN,ROpenArrow:HP.OPEN_REVERSE,ClosedArrow:HP.CLOSED,RClosedArrow:HP.CLOSED_REVERSE,Butt:HP.BUTT,Slash:HP.SLASH,Square:HP.SQUARE,Diamond:HP.DIAMOND,Circle:HP.CIRCLE};if("user"===e){const[e,s]=t;return {start:i[e],end:i[s]}}return [sk(i,t.start)[0]||"None",sk(i,t.end)[0]||"None"]}function MA(t,e){const i={[FP.REJECTED]:Ul.REJECTED,[FP.ACCEPTED]:Ul.ACCEPTED,[FP.INITIAL_HERE]:Ul.INITIAL_HERE,[FP.SIGN_HERE]:Ul.SIGN_HERE,[FP.WITNESS]:Ul.WITNESS,[FP.APPROVED]:Ul.APPROVED,[FP.NOT_APPROVED]:Ul.NOT_APPROVED,[FP.DRAFT]:Ul.DRAFT,[FP.FINAL]:Ul.FINAL,[FP.COMPLETED]:Ul.COMPLETED,[FP.CONFIDENTIAL]:Ul.CONFIDENTIAL,[FP.VOID]:Ul.VOID};return "user"===e?sk(i,t)[0]||t:i[t]||Ul.DRAFT}function BA(t,e){const i=["opacity","flags"],s=["x","y","width","height"],n=["borderColor","borderWidth","lineDash"],o=[...i,...n,...s,"background","rotation"],r=["points","background",...n,...i],a={rectangle:o,ellipse:o,polygon:r,polyline:["lineEnding",...r],stamp:["stamp",...s,...i,"rotation"],ink:["points","borderWidth","borderColor","rotation",...i],line:["startPoint","endPoint","lineEnding","background",...n,...i],textBox:["textContents","textAlign","background","rotation",...i,...n,...s],textTypewriter:["x","y","textContents",...i]}[t];if(!a)return e;const l={};for(const i in e)if(a.includes(i)){let s=e[i];"points"!==i||"ink"!==t&&"polygon"!==t&&"polyline"!==t?"startPoint"!==i&&"endPoint"!==i||"line"!==t?"borderColor"===i||"background"===i?l[i]=UA(s,2):"opacity"===i?(s>1&&(s=1),s<0&&(s=0),l[i]=LA(s,2)):"textContents"===i?l[i]=s.map((t=>(void 0!==t.color&&(t.color=UA(t.color,2)),void 0!==t.fontSize&&(t.fontSize=LA(t.fontSize,2)),t))):"lineDash"===i?l[i]=s.map((t=>LA(t,2))):Bs(e[i])?l[i]=LA(s,2):l[i]=s:l[i]={x:LA(s.x,2),y:LA(s.y,2)}:Ss(s[0])?l[i]=s.map((t=>t.map((t=>({x:LA(t.x,2),y:LA(t.y,2)}))))):l[i]=s.map((t=>({x:LA(t.x,2),y:LA(t.y,2)})));}return l}function LA(t,e){return Number.parseFloat(t.toFixed(e))}function UA(t,e){if(t&&t.startsWith("rgb")){const i=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d.]+)\s*)?\)/,s=t.match(i);if(s){const t=parseInt(s[1],10),i=parseInt(s[2],10),n=parseInt(s[3],10);let o=void 0!==s[4]?parseFloat(s[4]):void 0;if(void 0!==o){o<0&&(o=0),o>1&&(o=1);const s=function(t,e){const i=t.toString();if(/^\d+\.\d{3,}$/.test(i))return parseFloat(t.toFixed(e));return t}(o,e);return `rgba(${t},${i},${n},${s})`}return `rgb(${t},${i},${n})`}}return t}function OA(t,e,i){return t.map((t=>({x:Cn(t.x,e,i),y:Cn(t.y,e,i)})))}function _A(t,e,i){return t.map((t=>t.map((t=>({x:Cn(t.x,e,i),y:Cn(t.y,e,i)})))))}const NA={...AA,x:10,y:10,width:100,height:100};class WA extends kA{constructor(t){super(t=vn(t||{},As(NA)));}get type(){return "rectangle"}}const FA={...AA,x:10,y:10,width:100,height:80};class HA extends kA{constructor(t){super(t=vn(t||{},As(FA)));}get type(){return "ellipse"}}const VA={...AA,points:[[{x:10,y:10},{x:110,y:80}],[{x:110,y:10},{x:10,y:80}]]};class zA extends kA{constructor(t){super(t=vn(t||{},As(VA)));}get type(){return "ink"}}const jA={...AA,startPoint:{x:10,y:10},endPoint:{x:110,y:80},lineEnding:{start:HP.NONE,end:HP.NONE}};class $A extends kA{constructor(t){super(t=vn(t||{},As(jA)));}get type(){return "line"}}const GA={...AA,points:[{x:60,y:10},{x:10,y:55},{x:30,y:110},{x:90,y:110},{x:110,y:55}]};class XA extends kA{constructor(t){super(t=vn(t||{},As(GA)));}get type(){return "polygon"}}const YA={...AA,points:[{x:10,y:40},{x:50,y:80},{x:110,y:10}],lineEnding:{start:HP.NONE,end:HP.NONE}};class JA extends kA{constructor(t){super(t=vn(t||{},As(YA)));}get type(){return "polyline"}}async function qA(t,e,i,s,n){const o=[`${n}.${s} is invalid`];let r=!1;if(Es(t)){const e=await bn(t);["image/bmp","image/jpeg","image/png"].includes(e)||(r=!0);}else r=!0;return !r||$c.output(e,i,n,o)}const ZA={x:10,y:10,stamp:FP.DRAFT,width:void 0,height:void 0,opacity:1,flags:{print:!0,noView:!1,readOnly:!1},rotation:0},QA={[FP.REJECTED]:[23.58,23.54],[FP.ACCEPTED]:[28.39,24.6],[FP.INITIAL_HERE]:[126.26,33.78],[FP.SIGN_HERE]:[126.26,33.78],[FP.WITNESS]:[126.26,33.78],[FP.APPROVED]:[211.33,59.33],[FP.NOT_APPROVED]:[284.83,59.33],[FP.DRAFT]:[144.19,59.66],[FP.FINAL]:[123.73,59.66],[FP.COMPLETED]:[227.83,59.33],[FP.CONFIDENTIAL]:[272.83,59.33],[FP.VOID]:[114.71,59.66]};var KA=new WeakMap;class tT{constructor(t){l(this,"uid",null),l(this,"creationDate",""),l(this,"modificationDate",""),n(this,KA,void 0),t=vn(t||{},As(ZA)),!Ls(t.stamp)||!QA[t.stamp]||Bs(t.width)&&Bs(t.height)||(t.width=t.width||QA[t.stamp][0],t.height=t.height||QA[t.stamp][1]),o(KA,this,t),this.uid=_s(),this.creationDate=lf(),this.modificationDate=this.creationDate;}get type(){return "stamp"}get pageUid(){const t=fS.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}getOptions(){const t=fS.annotationService.annotationApp.getAnnotationByUid(this.uid);if(t){const e=t.getConfig(),i=IA(e,this.type);o(KA,this,{...i}),this.modificationDate=e.comment.modificationDate;}return BA(this.type,s(KA,this))}async updateOptions(t){const e="Annotation.updateOptions";if(DP(t,0,e,"options"))return;if(!EP(t,0,e,"options"))return;if(!PA(t,0,e,"options",this.type))return;if(Es(t.stamp)&&!await qA(t.stamp,0,e,"stamp","options"))return;const i=this.getOptions(),n=DA(this.type,t,i);if(!n.size)return;this.getOptions(),vn(t,s(KA,this));let o=s(KA,this);null!=t&&t.stamp||(o={...s(KA,this),stamp:null});const r=EA(o,this.type);fS.annotationService.updateAnnotations([{annotationUid:this.uid,options:r}],void 0,[...n]);}}const eT={...AA,x:10,y:10,width:150,height:80,textAlign:"left",textContents:[{content:"Insert text here"}]};class iT extends kA{constructor(t){super(t=vn(t||{},As(eT)));}get type(){return "textBox"}}const sT={x:10,y:10,textContents:[{content:"Insert text here"}],opacity:1,author:"",subject:"",flags:{print:!0,noView:!1,readOnly:!1}};class nT extends kA{constructor(t){super(t=vn(t||{},As(sT)));}get type(){return "textTypewriter"}}function oT(t,e,i,s,n,o){const r=$c.formatError({isValid:Ss(t)});if(r)return $c.output(e,i,s,void 0,r);const a=[];return t.forEach(((t,e)=>{const i=$c.formatDetails(jc("Array",n,`[${e}]`,!0),$c.isStringAndNotEmpty(t,o));a.push(...i);})),!a.length||$c.output(e,i,s,a)}function rT(t,e,i,s,n){const o=[];return e.forEach(((e,i)=>{t.has(e)||o.push(`annotationUids[${i}]: The specified annotation(s) do not exist.`);})),!o.length||$c.output(i,s,n,o,zc.ANNOTATION_NOT_EXIST)}function aT(t,e,i,s,n){return !!t.has(e)||$c.output(i,s,n,void 0,zc.ANNOTATION_NOT_EXIST)}class lT{constructor(){l(this,"uid",null),l(this,"creationDate",""),l(this,"modificationDate",""),this.uid=_s(),this.creationDate=lf(),this.modificationDate=lf();}get type(){return "unknown"}get pageUid(){const t=fS.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}}var hT=new WeakMap;class dT{constructor(t){n(this,hT,void 0),l(this,"uid",null),l(this,"creationDate",""),l(this,"modificationDate",""),this.uid=_s(),this.creationDate=lf(),this.modificationDate=lf(),o(hT,this,t);}get type(){return "incomplete"}get pageUid(){const t=fS.annotationService.annotationApp.getAnnotationByUid(this.uid);return t?t.pageUid:""}get raw(){return s(hT,this)}}const cT=["annotationsAdded","annotationsDeleted","annotationsModified","annotationLayerChanged"],uT="AnnotationManager",pT=new Map;var gT=new WeakMap,fT=new WeakMap,mT=new WeakMap,yT=new WeakSet;function vT(t,e){switch(t){case"rectangle":return new WA(e);case"ellipse":return new HA(e);case"polygon":return new XA(e);case"polyline":return new JA(e);case"line":return new $A(e);case"stamp":return new tT(e);case"ink":return new zA(e);case"textBox":return new iT(e);case"textTypewriter":return new nT(e);case"unknown":return new lT;case"highlight":case"underline":case"strikeout":case"incomplete":return new dT((null==e?void 0:e.annotationRaw)||{});default:return null}}function xT(t,e){s(mT,this).emit(t,e);}const wT=new class{constructor(){a(this,yT),n(this,gT,void 0),n(this,fT,void 0),n(this,mT,void 0),o(gT,this,fS),o(fT,this,pT),o(mT,this,new Fs);const t=s(gT,this).annotationService.annotationApp.hooks;t.annotationCreated.on((t=>{const i=t.annotations.reduce(((t,i)=>{if(!s(fT,this).has(i.uid)){const t=i.getConfig(),n=IA(t),o=e(yT,this,vT).call(this,t.type,n);o&&(o.uid=t.uid,o.creationDate=t.comment.creationDate,o.modificationDate=t.comment.modificationDate,s(fT,this).set(t.uid,o));}return t.push(i.uid),t}),[]);e(yT,this,xT).call(this,"annotationsAdded",{annotationUids:i});})),t.annotationDeleted.on((t=>{t.annotations.forEach((t=>{if(s(fT,this).has(t.uid)){this.getAnnotationsByUids([t.uid])[0].modificationDate="",s(fT,this).delete(t.uid);}}));const i=t.annotations.map((t=>t.uid));t.emitEvent&&e(yT,this,xT).call(this,"annotationsDeleted",{annotationUids:i});})),t.annotationUpdated.on((t=>{const i={modifiedAnnotations:t.updateDetails.map((t=>{const e=this.getAnnotationsByUids([t.annotationUid])[0],i=e.type,s=fS.annotationService.annotationApp.getAnnotationByUid(e.uid);return e.modificationDate=s.comment.modificationDate,{uid:t.annotationUid,oldOptions:BA(i,IA(As(t.from),i)),newOptions:BA(i,IA(As(t.to),i))}})),actions:[...t.updateActions]};e(yT,this,xT).call(this,"annotationsModified",i);}));const i=(t,i)=>{e(yT,this,xT).call(this,"annotationLayerChanged",{oldAnnotationUidList:[...t.from],newAnnotationUidList:[...t.to]});};t.bringFroward.on((t=>{i(t);})),t.bringToFront.on((t=>{i(t);})),t.sendBackward.on((t=>{i(t);})),t.sendToBack.on((t=>{i(t);}));}createAnnotation(t,i,n){const o="AnnotationManager.createAnnotation",r="pageUid",a="type",l="annotationOptions";let h=null;try{Hu.makeSureCoreLicenseExist(),Hu.makeSureAnnotationLicenseExist(),DP(t,0,o,r),DP(i,0,o,a),nA(t,0,o,r,!1),function(t,e,i,s){Ls(t)?!!["rectangle","ellipse","polygon","polyline","line","stamp","ink","textBox","textTypewriter"].includes(t)||$c.output(e,i,s,void 0,zc.PARAM_NOT_SUPPORT):$c.output(e,i,s,void 0,zc.PARAM_INVALID);}(i,0,o,a),h=s(gT,this).pageService.getPage(t),h||$c.error(o,r,void 0,zc.PAGE_NOT_EXIST),Ts(n)||(EP(n,0,o,l),PA(n,0,o,l,i));}catch(t){if("stamp"===i)return Promise.reject(t);throw t}const d=As(n||{}),c=()=>{var n,o,r;const a=e(yT,this,vT).call(this,i,d);s(fT,this).set(a.uid,a);const l=s(gT,this).pageService.getPage(t).doc.uid,c=EA(a.getOptions(),i);if("textTypewriter"===i){const t=h.mediaBox.width,e=h.mediaBox.width-c.style.x;c.style.width=e<0?t:e;}const u={uid:a.uid,docUid:l,pageUid:t,type:i,style:c.style,transform:c.transform,flags:c.flags,comment:{annotationUid:a.uid,author:(null===(n=c.comment)||void 0===n?void 0:n.author)||"",subject:(null===(o=c.comment)||void 0===o?void 0:o.subject)||"",contents:(null===(r=c.comment)||void 0===r?void 0:r.contents)||"",creationDate:a.creationDate,modificationDate:a.creationDate,markedStates:[],reviewStates:[],replies:[]}};return s(gT,this).annotationService.createAnnotation(l,u),a};if("stamp"===i&&Es(null==d?void 0:d.stamp)){const t=d;return new Promise((async(e,i)=>{try{await qA(t.stamp,0,o,"stamp",l);}catch(t){return void i(t)}if(!Bs(t.width)||!Bs(t.height)){const e=new Yn,s=await e.readImageInfo({fileSource:t.stamp}).catch((t=>{i(t);}));let n=s.imageWidth,o=s.imageHeight;if(n>400||o>400){const t=Math.max(n/400,o/400);n/=t,o/=t;}t.width=n,t.height=o;}e(c());}))}return c()}deleteAnnotations(t){const e=`${uT}.deleteAnnotations`,i="annotationUids";return !(DP(t,1,e,i)||!oT(t,1,e,i,void 0,!1)||!rT(s(fT,this),t,1,e,i))&&(s(gT,this).annotationService.deleteAnnotations(t),!0)}getAnnotationsByUids(t){const e=`${uT}.getAnnotationsByUids`,i="annotationUids";return !DP(t,1,e,i)&&oT(t,1,e,i,void 0,!1)&&rT(s(fT,this),t,1,e,i)?t.map((t=>s(fT,this).get(t))):[]}getAnnotationsByPage(t){const e=`${uT}.getAnnotationsByPage`,i="pageUid";if(DP(t,1,e,i)||!nA(t,1,e,i,!1))return [];if(!s(gT,this).pageService.getPage(t))return $c.warning(e,i,void 0,zc.PAGE_NOT_EXIST),[];const n=s(gT,this).annotationService.getAnnotationUidsByLayer(t),o=[];return n.forEach((t=>{const e=s(fT,this).get(t);e&&o.push(e);})),o}getAnnotationsByDoc(t){const e=`${uT}.getAnnotationsByDoc`,i="docUid";if(DP(t,1,e,i)||!nA(t,1,e,i,!1))return [];const n=s(gT,this).documentService.getDocument(t);if(!n)return $c.warning(e,i,void 0,zc.DOC_NOT_EXIST),[];return n.pages.reduce(((t,e)=>(s(gT,this).annotationService.getAnnotationUidsByLayer(e).forEach((e=>{const i=s(fT,this).get(e);i&&t.push(i);})),t)),[])}bringAnnotationForward(t){const e=`${uT}.bringAnnotationForward`,i="annotationUid";if(DP(t,1,e,i)||!nA(t,1,e,i,!1)||!aT(s(fT,this),t,1,e,i))return !1;return s(gT,this).annotationService.bringForward(t)}sendAnnotationBackward(t){const e=`${uT}.sendAnnotationBackward`,i="annotationUid";if(DP(t,1,e,i)||!nA(t,1,e,i,!1)||!aT(s(fT,this),t,1,e,i))return !1;return s(gT,this).annotationService.sendBackward(t)}bringAnnotationToFront(t){const e=`${uT}.bringAnnotationToFront`,i="annotationUid";if(DP(t,1,e,i)||!nA(t,1,e,i,!1)||!aT(s(fT,this),t,1,e,i))return !1;return s(gT,this).annotationService.bringToFront(t)}sendAnnotationToBack(t){const e=`${uT}.sendAnnotationToBack`,i="annotationUid";if(DP(t,1,e,i)||!nA(t,1,e,i,!1)||!aT(s(fT,this),t,1,e,i))return !1;return s(gT,this).annotationService.sendToBack(t)}on(t,e){const i="AnnotationManager.on",n="eventName",o="listener";!DP(t,1,i,n)&&!DP(e,1,i,o)&&nA(t,1,i,n,!1)&&sA(e,i,o,1)&&(cT.includes(t)?s(mT,this).on(t,e):zc.warning(zc.PARAM_NOT_SUPPORT,i,n));}off(t,e){const i="AnnotationManager.off",n="eventName";!DP(t,1,i,n)&&nA(t,1,i,n,!1)&&(Ts(e)||sA(e,i,"listener",1))&&(cT.includes(t)?s(mT,this).off(t,e):zc.warning(zc.PARAM_NOT_SUPPORT,i,n));}};function bT(t,e,i,s,n,o){const r=[];let a=!1;if(n)n.forEach(((t,e)=>{const{width:n,height:o}=i.getRealPageSize(t);ik(s,n,o)||r.push(`indices[${t}]: ${zc.RECT_EXCEED_PAGE_BOUND.message}`);})),r.length>0&&(a=!0);else {const{width:t,height:e}=i.getRealPageSize();ik(s,t,e)||(a=!0);}return !!a&&$c.output(o,t,e,r.length?r:void 0,zc.RECT_EXCEED_PAGE_BOUND,!0)}function CT(t,e,i,s){const n=hk.isRectValid(t);return !!n.length&&$c.output(s,e,i,n,void 0,!0)}const ST=["canvasStyle","pageStyle","quadSelectionStyle","currentPageStyle","annotationSelectionStyle"],PT="EditViewer";var AT=new WeakMap,TT=new WeakMap,kT=new WeakMap,DT=new WeakSet;class ET{constructor(t){var i,r;a(this,DT),n(this,AT,void 0),n(this,TT,!0),n(this,kT,new rA),l(this,"uid",void 0),l(this,"groupUid",void 0),l(this,"postfix",void 0),l(this,"thumbnail",void 0);Hu.makeSureCoreLicenseExist(),Ts(t)||hA(t,"editViewer",0,"new EditViewer","option");const h=vn((null==t?void 0:t.viewerConfig)||{},As({...xA,viewerMode:vp.DEFAULT,displayMode:"continuous",enableOptimizePage:!0,enableAnnotationUi:!0}));if(h.minZoom>h.maxZoom){zc.warning(zc.MIN_ZOOM_INVALID);const t=h.maxZoom;h.maxZoom=h.minZoom,h.minZoom=t;}const{maxZoom:d,minZoom:c}=h;h.maxZoom=d>64||d<.01?64:d,h.minZoom=c>64||c<.01?.01:c,Ms()&&(JP.toolbarConfig.style={scale:"0.9"}),o(AT,this,fS.createViewer({uiConfig:As(Ms()?MP:OP),...t,viewerConfig:h,annotationToolBarConfig:{...null==JP?void 0:JP.toolbarConfig,...null==t||null===(i=t.annotationConfig)||void 0===i?void 0:i.toolbarConfig},annotationPaletteConfig:{...JP.paletteConfig,...null==t||null===(r=t.annotationConfig)||void 0===r?void 0:r.paletteConfig}})),this.uid=s(AT,this).uid,this.groupUid=s(AT,this).groupUid,this.postfix=s(AT,this).postfix;const u=vn(As(null==t?void 0:t.annotationConfig)||{},As(JP));s(AT,this).updateAnnotationConfig(function(t){const e=t=>{if("lineEnding"in t&&"object"==typeof t.lineEnding&&null!==t.lineEnding){const e=RA(t.lineEnding,"date");delete t.lineEnding,t.lineEnding=e;}},i=t=>{var e;t.stamp instanceof Blob&&(t.imageData=t.stamp),Ls(t.stamp)&&(ZT(t.stamp)?t.imageData=t.stamp:t.stampIcon=(e=t.stamp,["rejected","accepted","initialHere","signHere","witness","approved","notApproved","draft","final","completed","confidential","void"].includes(e)?MA(t.stamp,"date"):MA(FP.DRAFT,"date"))),delete t.stamp;},s=t=>{"borderWidth"in t&&Bs(null==t?void 0:t.borderWidth)?t.borderWidth=Cn(t.borderWidth,eo.dataResolution,eo.displayResolution):t.borderWidth=1;},n=t=>{if("textContent"in t&&Ps(t.textContent)){var e,i,s,n,o;if(Bs(null==t||null===(e=t.textContent)||void 0===e?void 0:e.fontSize))t.textContent.fontSize=Cn(null==t||null===(o=t.textContent)||void 0===o?void 0:o.fontSize,eo.dataResolution,eo.displayResolution);else t.textContent.fontSize=JP.defaultStyleConfig.textBox.textContent.fontSize;["normal","italic"].includes(null==t||null===(i=t.textContent)||void 0===i?void 0:i.fontStyle)||(t.textContent.fontStyle="normal"),["normal","bold"].includes(null==t||null===(s=t.textContent)||void 0===s?void 0:s.fontWeight)||(t.textContent.fontWeight="normal"),""===(null==t||null===(n=t.textContent)||void 0===n?void 0:n.fontFamily)&&(t.textContent.fontFamily="Helvetica");}},o=t=>{"lineDash"in t&&t.lineDash.length&&(t.lineDash=Cn(t.lineDash,eo.dataResolution,eo.displayResolution));},r=t=>{"textAlign"in t&&!["left","right","center","justify"].includes(null==t?void 0:t.textAlign)&&(t.textAlign="left");},{defaultStyleConfig:a}=t;Object.keys(a).forEach((t=>{const l=a[t];"object"==typeof l&&null!==l&&(e(l),s(l),n(l),o(l),r(l),"stamp"===t&&i(l));}));return {...t,controlsStyle:t.annotationSelectionStyle}}(u)),KT(s(AT,this).getUiConfig()).includes(IP.Filter)&&!s(AT,this).context.core.filterService.enableFilter&&zc.warning(zc.IMG_FILTER_MISS),t&&!1===t.createThumbnail||e(DT,this,RT).call(this,null==t?void 0:t.thumbnailConfig),t&&!Ts(null==t?void 0:t.adaptiveIconSize)&&o(TT,this,t.adaptiveIconSize),s(AT,this).rootDom&&(s(AT,this).rootDom.style.fontSize="20px",qT(this,s(AT,this).rootDom,s(TT,this))),Ik.forEach((t=>{s(AT,this).addFontToUi(t);})),e(DT,this,MT).call(this),e(DT,this,IT).call(this);}get isVisible(){return s(kT,this).getIsVisible(s(AT,this))}get isBoundContainer(){return s(kT,this).getIsBoundContainer(s(AT,this))}get currentDocument(){return s(kT,this).getCurrentDocument(s(AT,this))}get zoom(){return parseFloat(s(AT,this).getViewerConfig().zoom.toFixed(4))}set zoom(t){const{maxZoom:e,minZoom:i}=s(AT,this).getViewerConfig();(function(t,e,i,s,n,o){const r=$c.formatError($c.isNumberAndIsInRange(t));return r?$c.output(e,i,s,void 0,r):(t<n&&$c.output(e,i,s,void 0,zc.ZOOM_TOO_SMALL),t>o&&$c.output(e,i,s,void 0,zc.ZOOM_TOO_LARGE),!0)})(t,1,`${PT}.zoom`,"zoom",i,e)&&s(AT,this).updateViewerConfig({zoom:t});}get zoomOrigin(){return s(AT,this).getViewerConfig().zoomOrigin}set zoomOrigin(t){(function(t,e,i,s){const n=hk.isZoomOriginValid(t);return !n.length||$c.output(s,e,i,n)})(t,`${PT}.zoomOrigin`,"zoomOrigin",1)&&s(AT,this).updateViewerConfig({zoomOrigin:{x:t.x,y:t.y}});}get displayMode(){const{displayMode:t}=s(AT,this).getViewerConfig(),e=s(AT,this).getActiveTab();return e?e.context.displayMode:t}set displayMode(t){const e="displayMode",i=`${PT}.${e}`;nA(t,1,i,e)&&(["single","continuous"].includes(t)?s(AT,this).updateViewerConfig({displayMode:t}):zc.warning(zc.PARAM_NOT_SUPPORT,i,e));}get toolMode(){const{toolMode:t}=s(AT,this).getViewerConfig();return t}set toolMode(t){const e="toolMode",i=`${PT}.${e}`;nA(t,1,i,e)&&function(t,e,i,s){return !!["crop","pan","annotation"].includes(t)||$c.output(e,i,s,void 0,zc.PARAM_NOT_SUPPORT)}(t,1,i,e)&&s(AT,this).updateViewerConfig({toolMode:t});}get annotationMode(){const{annotationMode:t}=s(AT,this).getViewerConfig();return t}set annotationMode(t){const e="annotationMode",i=`${PT}.${e}`;nA(t,1,i,e)&&function(t,e,i,s){return !!["rectangle","ellipse","line","polygon","polyline","ink","textBox","textTypewriter","stamp","erase","select"].includes(t)||$c.output(e,i,s,void 0,zc.PARAM_NOT_SUPPORT)}(t,1,i,e)&&s(AT,this).updateViewerConfig({annotationMode:t});}get fitMode(){const{fitMode:t}=s(AT,this).getViewerConfig(),e=s(AT,this).getActiveTab();return e?e.context.fitMode:t}set fitMode(t){const e=`${PT}.fitMode`,i="fitMode";nA(t,1,e,i)&&function(t,e,i,s){return !!["width","height","window","actualSize"].includes(t)||$c.output(e,i,s,void 0,zc.PARAM_NOT_SUPPORT)}(t,1,e,i)&&s(AT,this).updateViewerConfig({fitMode:t});}bindContainer(t){s(kT,this).bindContainer(s(AT,this),t,`${PT}.bindContainer`);}unbindContainer(){s(kT,this).unbindContainer(s(AT,this));}show(){s(kT,this).show(s(AT,this)),qT(this,s(AT,this).rootDom,s(TT,this));}hide(){s(kT,this).hide(s(AT,this));}getUiConfig(){return s(kT,this).getUiConfig(s(AT,this))}updateUiConfig(t){s(AT,this).selectAnnotations([]);return !!s(kT,this).updateUiConfig(s(AT,this),t,"editViewer",`${PT}.updateUiConfig`)&&(s(AT,this).emit("thumbnailBind",this.thumbnail.uid),qT(this,s(AT,this).rootDom,s(TT,this)),!0)}openDocument(t){s(kT,this).openDocument(t,this.uid,`${PT}.openDocument`);}closeDocument(){return s(kT,this).closeDocument(s(AT,this),`${PT}.closeDocument`)}getStyle(t){return s(kT,this).getStyle(s(AT,this),"edit",t,ST,`${PT}.getStyle`)}updateStyle(t,e){const i=`${PT}.updateStyle`;return s(kT,this).updateStyle(s(AT,this),t,e,ST,i)}setParallelScrollCount(t){const e=`${PT}.setParallelScrollCount`,i="count",{maxColumns:n,maxRows:o}=s(AT,this).getViewerConfig();return !(DP(t,1,e,i)||!KP(t,e,i,1)||eA(t,1,o,1,e,i)||eA(t,1,n,1,e,i))&&("continuous"!==this.displayMode?(zc.warning(zc.ROW_COLUMN_CAN_NOT_CHANGE,e),!1):s(AT,this).setRowAndColumn(t,t))}setCropRect(t){const e=`${PT}.setCropRect`,i="rect";return !(DP(t,1,e,i)||CT(t,e,i,1)||!ZP(s(AT,this),1)||QP(void 0,void 0,s(AT,this),1)||bT(e,i,s(AT,this),t,void 0,1))&&("crop"!==this.toolMode?(zc.warning(zc.TOOL_MODE_NOT_AVAILABLE,e),!1):s(AT,this).setRectBox(t))}getCropRect(){return ZP(s(AT,this),1)?s(AT,this).getRectBox():null}crop(t,e){const i=`${PT}.crop`,n=s(AT,this).getPageCounts(),o="rect";if(DP(t,1,i,o)||CT(t,i,o,1)||!ZP(s(AT,this),1)||QP(void 0,void 0,s(AT,this),1))return !1;if(e&&!oA(e,1,i,"indices",0,n-1))return !1;if(bT(i,o,s(AT,this),t,e,1))return !1;const r=s(AT,this).getCurrentPageIndex();return s(AT,this).cropPages(t,e||[r])}rotate(t,e){const i=`${PT}.rotate`;return s(kT,this).rotate(s(AT,this),t,e,i)}undo(){if(!ZP(s(AT,this),1))return !1;const t=s(AT,this).undo();return t||zc.warning(zc.UNDO_NOOP),t}redo(){if(!ZP(s(AT,this),1))return !1;const t=s(AT,this).redo();return t||zc.warning(zc.REDO_NOOP),t}saveOperations(){return s(kT,this).saveOperation(s(AT,this))}indexToUid(t){const e=`${PT}.indexToUid`;return s(kT,this).indexToUid(s(AT,this),t,e)}uidToIndex(t){const e=`${PT}.uidToIndex`;return s(kT,this).uidToIndex(s(AT,this),t,e)}getCurrentPageUid(){return s(kT,this).getCurrentPageUid(s(AT,this))}getCurrentPageIndex(){return s(kT,this).getCurrentPageIndex(s(AT,this))}getPageCount(){return s(kT,this).getPageCount(s(AT,this))}goToPage(t){const e=`${PT}.goToPage`;return s(kT,this).gotoPage(s(AT,this),t,e)}selectAnnotations(t){const e=`${PT}.selectAnnotations`,i="annotationUids";if(!ZP(s(AT,this),1)||QP(void 0,void 0,s(AT,this),1)||DP(t,1,e,i)||!oT(t,1,e,i,void 0,!1))return !1;if("crop"===this.toolMode)return zc.warning(zc.TOOL_MODE_NOT_AVAILABLE,e),!1;t=[...new Set(t)];const n=[],o=[],r=[],a=this.getCurrentPageUid(),l=t.reduce(((t,e,s)=>{const l=fS.annotationService.getAnnotationByUid(e);return l?l.pageUid!==a?n.push(`${i}[${s}]: The specified annotation is not on the current page.`):"incomplete"===l.type||"unknown"===l.type?o.push(`${i}[${s}]: ${zc.UNSELECTED_UNKNOWN.message}`):l.flags.includes("readOnly")||l.flags.includes("noView")?r.push(`${i}[${s}]: ${zc.UNSELECTED_READONLY.message}`):t.push(e):n.push(`${i}[${s}]: The specified annotation does not exist.`),t}),[]);if(n.length){const t=zc.ANNOTATION_SELECT;return t.details=n,zc.warning(t,e,i),!1}if(o.length){const t=zc.UNSELECTED_UNKNOWN;return t.details=o,zc.warning(t,e,i),!1}if(r.length){const t=zc.UNSELECTED_READONLY;return t.details=r,zc.warning(t,e,i),!1}const h=s(AT,this).getSelectedAnnotations().map((t=>t.uid));return h.length===l.length&&function(t,e){if(t.length!==e.length)return !1;const i=t.slice().sort(),s=e.slice().sort();for(let t=0;t<i.length;t++)if(i[t]!==s[t])return !1;return !0}(h,l)||s(AT,this).selectAnnotations(l),!0}getSelectedAnnotations(){if(!ZP(s(AT,this),1)||QP(void 0,void 0,s(AT,this),1))return [];return s(AT,this).getSelectedAnnotations().length?wT.getAnnotationsByUids(s(AT,this).getSelectedAnnotations().map((t=>t.uid))):[]}on(t,e){s(kT,this).on(s(AT,this),`${PT}.on`,t,e);}off(t,e){s(kT,this).off(s(AT,this),`${PT}.off`,t,e);}destroy(){s(kT,this).destroy(s(AT,this));}}function IT(){s(AT,this).hooks.destroy.on((()=>{var t;null===(t=this.thumbnail)||void 0===t||t.vCommon.destroy(this.thumbnail.v),this.thumbnail=null,o(AT,this,null),Object.setPrototypeOf(this,null);}));}function RT(t){const e=t||{},i=As(vA);Ms()&&(i.size="100%",i.rows=3,i.columns=2,i.canvasStyle.background="#4B4B4B",i.pageNumberStyle.color="white",i.enableOptimizePage=!0),vn(e,i);const{mainAndThbContainer:n,mainContainer:o,thumbnailContainer:r}=s(AT,this).context.viewService,{size:a,position:l,visibility:h}=i,d=As(_P);let c="row",u=a,p="100%",g="left"===l?"-1":"1";"top"!==l&&"bottom"!==l||(c="column",u="100%",p=a,g="top"===l?"-1":"1");const f=`ddv-edit-viewer-thumb-${l}`;d.className=f,Object.assign(r.style,{width:u,height:p,order:g,display:"visible"===h?"block":"none"}),n.style.flexDirection=c,n.insertBefore(r,o),s(AT,this).context.resize();const m=new CA({container:r,viewerConfig:i,groupUid:this.groupUid,uiConfig:d},`${PT}.thumbnail`);this.thumbnail=m,s(AT,this).emit("thumbnailBind",m.uid),m.on("click",(()=>{s(AT,this).emit("ui_hidePopup",null);}));}function MT(){this.on("resized",(t=>{t.newWidth<1200&&t.newWidth>800&&qT(this,s(AT,this).rootDom,s(TT,this));}));}const BT={canvasStyle:{...VP},pageStyle:{...zP},quadSelectionStyle:{...jP},enableSlide:!0};function LT(t,e,i,s){const n=hk.isQuadValid(t);return n.length?$c.output(e,i,s,n):!!sn(t.flat())||$c.output(e,i,s,void 0,zc.PARAM_INVALID)}function UT(t,e,i,s){return !!function(t,e,i){for(let s=0;s<t.length;s++)if(t[s][0]>e||t[s][1]>i)return !0;return !1}(t,i,s)&&($c.output(e,void 0,void 0,void 0,zc.QUAD_EXCEED_PAGE_BOUND),!0)}const OT=["canvasStyle","pageStyle","quadSelectionStyle"],_T="PerspectiveViewer";var NT=new WeakMap,WT=new WeakMap,FT=new WeakSet;class HT{constructor(t){a(this,FT),n(this,NT,void 0),n(this,WT,new rA),l(this,"uid",void 0),l(this,"groupUid",void 0),l(this,"postfix",void 0),Hu.makeSureCoreLicenseExist(),Ts(t)||hA(t,"perspectiveViewer",0,`new ${_T}`,"option");const i=vn((null==t?void 0:t.viewerConfig)||{},As({...BT,viewerMode:vp.PERSPECTIVE,toolMode:"crop"})),r=Ms()?BP:UP;o(NT,this,fS.createViewer({uiConfig:As(r),...t,viewerConfig:i})),this.uid=s(NT,this).uid,this.groupUid=s(NT,this).groupUid,this.postfix=s(NT,this).postfix,e(FT,this,VT).call(this);}get isVisible(){return s(WT,this).getIsVisible(s(NT,this))}get isBoundContainer(){return s(WT,this).getIsBoundContainer(s(NT,this))}get currentDocument(){return s(WT,this).getCurrentDocument(s(NT,this))}bindContainer(t){s(WT,this).bindContainer(s(NT,this),t,`${_T}.bindContainer`);}unbindContainer(){s(WT,this).unbindContainer(s(NT,this));}show(){s(WT,this).show(s(NT,this));}hide(){s(WT,this).hide(s(NT,this));}getUiConfig(){return s(WT,this).getUiConfig(s(NT,this))}updateUiConfig(t){return s(WT,this).updateUiConfig(s(NT,this),t,"perspectiveViewer",`${_T}.updateUiConfig`)}openDocument(t){s(WT,this).openDocument(t,this.uid,`${_T}.openDocument`);}closeDocument(){return s(WT,this).closeDocument(s(NT,this),`${_T}.closeDocument`)}getStyle(t){return s(WT,this).getStyle(s(NT,this),"perspective",t,OT,`${_T}.getStyle`)}updateStyle(t,e){const i=`${_T}.updateStyle`;return s(WT,this).updateStyle(s(NT,this),t,e,OT,i)}setQuadSelection(t){const e=`${_T}.setQuadSelection`,i="quad";if(DP(t,1,e,i)||!LT(t,1,e,i)||!ZP(s(NT,this),1)||QP(e,void 0,s(NT,this),1))return !1;const{width:n,height:o}=s(NT,this).getRealPixelSize();return !UT(t,1,n,o)&&s(NT,this).setQuadBox(t)}getQuadSelection(){const t=`${_T}.getQuadSelection`;return !ZP(s(NT,this),1)||QP(t,void 0,s(NT,this),1)?null:s(NT,this).getQuadBox()}resetQuadSelection(t){const e=`${_T}.resetQuadSelection`;if(!ZP(s(NT,this),1)||QP(e,void 0,s(NT,this),1))return !1;if(!Ts(t)){if(!oA(t,1,e,"indices",0,s(NT,this).getPageCounts()-1))return !1}return s(NT,this).resetQuadBox(t)}applyPerspective(t){const e=`${_T}.applyPerspective`,i="quad";DP(t,0,e,i),LT(t,0,e,i),ZP(s(NT,this),0),QP(e,void 0,s(NT,this),0);const{width:n,height:o}=s(NT,this).getRealPixelSize();return UT(t,0,n,o),s(NT,this).perspectivePage(t)}rotate(t,e){const i=`${_T}.rotate`;return s(WT,this).rotate(s(NT,this),t,e,i)}saveOperations(){return s(WT,this).saveOperation(s(NT,this))}goToPage(t){const e=`${_T}.goToPage`;return s(WT,this).gotoPage(s(NT,this),t,e)}indexToUid(t){const e=`${_T}.indexToUid`;return s(WT,this).indexToUid(s(NT,this),t,e)}uidToIndex(t){const e=`${_T}.uidToIndex`;return s(WT,this).uidToIndex(s(NT,this),t,e)}getCurrentPageUid(){return s(WT,this).getCurrentPageUid(s(NT,this))}getCurrentPageIndex(){return s(WT,this).getCurrentPageIndex(s(NT,this))}getPageCount(){return s(WT,this).getPageCount(s(NT,this))}on(t,e){s(WT,this).on(s(NT,this),`${_T}.on`,t,e);}off(t,e){s(WT,this).off(s(NT,this),`${_T}.off`,t,e);}destroy(){s(WT,this).destroy(s(NT,this));}}function VT(){s(NT,this).hooks.destroy.on((()=>{o(NT,this,null),Object.setPrototypeOf(this,null);}));}class zT extends CA{constructor(t){super(t,"BrowseViewer");}get currentDocument(){return this.vCommon.getCurrentDocument(this.v)}bindContainer(t){this.vCommon.bindContainer(this.v,t,`${this.errorPrefix}.bindContainer`);}unbindContainer(){this.vCommon.unbindContainer(this.v);}openDocument(t){this.vCommon.openDocument(t,this.uid,`${this.errorPrefix}.openDocument`);}closeDocument(){return this.vCommon.closeDocument(this.v,`${this.errorPrefix}.closeDocument`)}rotate(t,e){const i=`${this.errorPrefix}.rotate`;return this.vCommon.rotate(this.v,t,e,i)}indexToUid(t){const e=`${this.errorPrefix}.indexToUid`;return this.vCommon.indexToUid(this.v,t,e)}uidToIndex(t){const e=`${this.errorPrefix}.uidToIndex`;return this.vCommon.uidToIndex(this.v,t,e)}getCurrentPageUid(){return this.vCommon.getCurrentPageUid(this.v)}getCurrentPageIndex(){return this.vCommon.getCurrentPageIndex(this.v)}getPageCount(){return this.vCommon.getPageCount(this.v)}goToPage(t){const e=`${this.errorPrefix}.goToPage`;return this.vCommon.gotoPage(this.v,t,e)}saveOperations(){return this.vCommon.saveOperation(this.v)}destroy(){this.vCommon.destroy(this.v);}}var jT=new WeakMap,$T=new WeakMap,GT=new WeakMap,XT=new WeakSet;class YT{constructor(t){a(this,XT),n(this,jT,void 0),n(this,$T,void 0),n(this,GT,!1),l(this,"uid",void 0),l(this,"isDestroyed",!1),l(this,"postfix",void 0);this.uid=_s(),this.postfix=`-${this.uid}`,o($T,this,new Fs),Ts(t)||hA(t,"customViewer",0,"new CustomViewer","option");let i=null==t?void 0:t.uiConfig;(!i||Ps(i)&&0===Object.keys(i).length)&&(i={type:"Layout"}),e(XT,this,JT).call(this),o(jT,this,new Hy({container:null==t?void 0:t.container,emitter:s($T,this),postfix:this.uid,uiConfig:i,injection:{viewer:{postfix:this.postfix}}})),null!=t&&t.container&&i&&s(jT,this).bindContainer(t.container);}get isBoundContainer(){return s(GT,this)}get isVisible(){return "none"!==s(jT,this).rootDom.style.display}bindContainer(t){const e="CustomViewer.bindContainer";DP(t,0,e,"container");const i=hk.isContainerParamValid(t);i&&$c.error(e,"container",void 0,i);s(jT,this).bindContainer(t)&&o(GT,this,!0);}unbindContainer(){s(jT,this).unbindContainer(),o(GT,this,!1);}hide(){s(jT,this).rootDom.style.display="none";}show(){s(jT,this).rootDom.style.display="flex";}getUiConfig(){return s(jT,this).uiConfig}updateUiConfig(t){const e="CustomViewer.updateUiConfig",i="uiConfig";return !(DP(t,1,e,i)||!tA(t,"customViewer",e,i,1))&&s(jT,this).updateUiConfig(t)}on(t,e){const i="CustomViewer.on";!DP(t,1,i,"eventName")&&!DP(e,1,i,"listener")&&nA(t,1,i,"eventName",!1)&&sA(e,i,"listener",1)&&s($T,this).on(t,e);}off(t,e){const i="CustomViewer.off";!DP(t,1,i,"eventName")&&nA(t,1,i,"eventName",!1)&&(Ts(e)||sA(e,i,"listener",1))&&s($T,this).off(t,e);}destroy(){this.isDestroyed||(s(jT,this).dispose(),s($T,this).destroy(),o(jT,this,null),o($T,this,null)),this.isDestroyed=!0,Object.setPrototypeOf(this,null);}}function JT(){Hy.registerComponent({Root:Gy,Layout:zy,Button:Vy,Blank:kx,SeparatorLine:Xy,Close:Dx,Done:Ix,Back:Ex});}function qT(t,e,i){if(!i||Ms()||!t.isVisible)return;const s=e,n=s.clientWidth;if(t instanceof ET){let t=20;n<1280&&(t=Math.max(13.5,n/1280*20)),s.style.fontSize=`${t}px`;}}function ZT(t){if(t instanceof Blob)return !0;if(Ls(t)){const e=t=>{try{new URL(t);return !0}catch(t){return !1}};return !(!(t=>/^data:image\/([a-zA-Z]*);base64,/.test(t))(t)&&!e(t))}return !1}function QT(t,e){const i=["Load","Download","Print"],s=["Layout","Button","Blank","SeparatorLine","Close","Done","Back"],n=[...s,"MainView"],o=["Pagination","RotateLeft","RotateRight","Delete","DeleteCurrent","DeleteAll"],r=[...n,...o,...i,"PerspectiveAll","FullQuad"],a=[...n,...o,...i],l=[...n,"Capture","Flashlight","CameraConvert","CameraResolution","AutoDetect","AutoCapture","ImagePreview"],h=[...n,...o,...i,"Zoom","ZoomIn","ZoomOut","ZoomByPercentage","ThumbnailSwitch","FitMode","DisplayMode","Crop","Filter","Undo","Redo","Pan","FitWidth","FitHeight","FitWindow","ActualSize","SinglePage","ContinuousPage","AnnotationSet","EllipseAnnotation","EraseAnnotation","InkAnnotation","LineAnnotation","PolygonAnnotation","PolylineAnnotation","RectAnnotation","SelectAnnotation","StampIconAnnotation","StampImageAnnotation","TextBoxAnnotation","TextTypewriterAnnotation","BringForward","BringToFront","SendBackward","SendToBack"];let d;switch(e){case"captureViewer":d=l;break;case"editViewer":d=h;break;case"perspectiveViewer":d=r;break;case"customViewer":d=s;break;case"browseViewer":d=a;}const c=[];return null!=t&&t.type&&!d.includes(null==t?void 0:t.type)&&c.push(t.type),null!=t&&t.children&&t.children.forEach((t=>{Ls(t)&&!d.includes(t)&&c.push(t),Ps(t)&&c.push(...QT(t,e));})),c}function KT(t){const e=[];return null!=t&&t.type&&e.push(t.type),null!=t&&t.children&&t.children.forEach((t=>{Ls(t)&&e.push(t),Ps(t)&&e.push(...KT(t));})),[...new Set(e)]}function tk(t,e){const i=QT(t,e);if(i.length>0){let t="";return i.forEach(((e,s)=>{s===i.length-1?t+=`${e}`:t+=`${e} `;})),t}return !1}function ek(t){if(""===t)return !0;const e=document.createElement("div");e.style.border=t;const i=t=>""===t||"initial"===t,{borderWidth:s,borderColor:n,borderStyle:o}=e.style;return !(i(s)||i(n)||i(o))}function ik(t,e,i){const{left:s,top:n,width:o,height:r}=t;return !(s>e||s+o>e||n>i||n+r>i)}function sk(t,e){return Object.keys(t).filter((i=>t[i]===e))}function nk(t,e){if(t===e)return !0;if(Ps(t)&&Ps(e)&&Object.keys(t).length===Object.keys(e).length)for(const i in t){if(!Object.prototype.hasOwnProperty.call(e,i))return !1;if(!nk(t[i],e[i]))return !1}else {if(!Ss(t)||!Ss(e)||t.length!==e.length)return !1;for(let i=0;i<t.length;i++)if(!nk(t[i],e[i]))return !1}return !0}function ok(t,e){let i;switch(t){case"canvasStyle":i=function(t,e){const i=[];i.push(...ak(t,{border:(null==e?void 0:e.border)||"",background:(null==e?void 0:e.background)||""})),Ts(null==e?void 0:e.cursor)||Ls(e.cursor)||i.push(`${t}.cursor is invalid`);return i}(t,e);break;case"pageNumberStyle":i=function(t,e){const i=[],s=["color","fontSize","fontFamily","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(e).forEach((n=>{-1!==s.indexOf(n)&&(Ls(e[n])||i.push(`${t}.${n} is invalid.`)),"border"===n&&Ls(e[n])&&!ek(e[n])&&i.push(`${t}.border is invalid.`),("onPage"===n&&!Is(e[n])||"opacity"===n&&!Bs(e[n])||"visibility"===n&&-1===["visible","hidden"].indexOf(e[n]))&&i.push(`${t}.${n} is invalid.`);})),i}(t,e);break;case"checkBoxStyle":i=function(t,e){const i=[],s=["checkMarkColor","checkMarkLineWidth","left","top","right","bottom","width","height","background","border","borderRadius","translateX","translateY"];return Object.keys(e).forEach((n=>{-1!==s.indexOf(n)&&(Ls(e[n])||i.push(`${t}.${n} is invalid.`)),"border"===n&&Ls(e[n])&&!ek(e[n])&&i.push(`${t}.border is invalid.`),("opacity"===n&&!Bs(e[n])||"visibility"===n&&-1===["visible","hidden"].indexOf(e[n]))&&i.push(`${t}.${n} is invalid.`);})),i}(t,e);break;case"quadSelectionStyle":i=function(t,e){const i=[],s=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground","invalidCtrlBorderColor","invalidBorderColor"];return Object.keys(e).forEach((n=>{-1!==s.indexOf(n)&&(Ls(e[n])||i.push(`${t}.${n} is invalid`)),"border"!==n&&"ctrlBorder"!==n||!Ls(e[n])||ek(e[n])||i.push(`${t}.${n} is invalid`);})),i}(t,e);break;case"annotationSelectionStyle":i=function(t,e){const i=[],s=["border","background","ctrlBorderRadius","ctrlBorder","ctrlWidth","ctrlHeight","ctrlBackground"];return Object.keys(e).forEach((n=>{-1!==s.indexOf(n)&&(Ls(e[n])||i.push(`${t}.${n} is invalid.`)),"border"!==n&&"ctrlBorder"!==n||!Ls(e[n])||ek(e[n])||i.push(`${t}.${n} is invalid.`);})),i}(t,e);break;default:i=ak(t,e);}return i}function rk(t){return !!Bs(t)&&t>=0}function ak(t,e){const i=[];return Object.keys(e).forEach((s=>{-1!==["background","border"].indexOf(s)&&(Ls(e[s])||i.push(`${t}.${s} is invalid.`),"border"===s&&e[s]&&Ls(e[s])&&!ek(e[s])&&i.push(`${t}.border is invalid.`));})),i}function lk(t,e){const i=t.flat(2),s=e.flat(2);if(i.length!==s.length)return !1;const n=s[0].x-i[0].x,o=s[1].y-i[1].y;for(let t=1;t<i.length;t++){if(s[t].x-i[t].x!==n)return !1;if(s[t].y-i[t].y!==o)return !1}return !0}class hk{static isLicenseValid(t){if(Ls(t)){const e=t.trim();return 0===e.length||e.startsWith("DLS")||(e.startsWith("f")||e.startsWith("t"))&&e.length>50}return !1}static isQuadValid(t,e){const i=[],s=jc("Quad",e);if(Ts(t))return i.push(`${s} is missing.`),i;const n=$c.isArrayAndMeetMinLength(t,4),o=$c.formatDetails(s,n);return o.length?(i.push(...o),i):(t.forEach(((t,s)=>{const n=jc("Quad",e,`[${s}]`,!0),o=$c.isArrayAndMeetMinLength(t,2),r=$c.formatDetails(jc("Array",n),o);r.length?i.push(...r):t.forEach(((t,e)=>{const s=$c.isNumberAndIsInRange(t),o=$c.formatDetails(jc("Array",n,`[${e}]`,!0),s);o.length&&i.push(...o);}));})),i)}static isRectValid(t,e){const i=[],s=jc("Rect",e);if(Ts(t))return i.push(`${s} is missing.`),i;const n=$c.formatDetails(s,Ps(t));return n.length?(i.push(...n),i):(["left","top","width","height"].forEach((s=>{const n=$c.formatDetails(jc("Rect",e,s),$c.isNumberAndIsInRange(t[s]));n.length&&i.push(...n);})),i)}static isSourceValid(t,e,i){const s=[],n="Source",o=$c.formatDetails(jc(n,e),Ps(t));if(o.length)return s.push(...o),s;const r=$c.formatDetails(jc(n,e,"fileData"),Es(t.fileData));if(r.length)return s.push(...r),s;if(!Ts(t.extraPageData)){const o=$c.formatDetails(jc(n,e,"extraPageData"),$c.isArrayAndMeetMinLength(t.extraPageData));if(o.length)return s.push(...o),s;t.extraPageData.forEach(((t,o)=>{const r=this.isExtraPageDataValid(t,jc(n,e,`extraPageData[${o}]`,!0),i);r.length&&s.push(...r);}));}return s}static isExtraPageDataValid(t,e,i){const s=[],n="ExtraPageData",o=$c.formatDetails(jc(n,e),Ps(t));if(o.length)return s.push(...o),s;const r=$c.formatDetails(jc(n,e,"index"),$c.isNumberAndIsInRange(t.index));if(s.push(...r),!Ts(t.rotation)){const i=this.isRotationValid(t.rotation,jc(n,e));s.push(...i);}if(!Ts(t.filter)){const o=this.isFilterTypeValid(t.filter,i,jc(n,e));s.push(...o);}return Ts(t.perspectiveQuad)||s.push(...this.isQuadValid(t.perspectiveQuad,jc(n,e,"perspectiveQuad"))),s}static isSourcesValid(t,e,i){const s=[],n="Source[]",o=$c.formatDetails(jc(n,e),$c.isArrayAndMeetMinLength(t));return o.length?(s.push(...o),s):(t.forEach(((t,o)=>{s.push(...this.isSourceValid(t,jc(n,e,`[${o}]`,!0),i));})),s)}static isLoadSourceOptionsValid(t,e){const i=[],s="LoadSourceOptions",n=$c.formatDetails(jc(s,e),Ps(t));if(n.length)return i.push(...n),i;if(!Ts(t.insertBeforeIndex)){const n=$c.formatDetails(jc(s,e,"insertBeforeIndex"),$c.isNumberAndIsInRange(t.insertBeforeIndex));i.push(...n);}if(!Ts(t.exception)){const n=$c.formatDetails(jc(s,e,"exception"),$c.isStringAndNotEmpty(t.exception,!1));i.push(...n);}return i}static isHandlerTypeValid(t){return {isValid:Ls(t)&&["documentBoundariesDetect","imageFilter"].includes(t)}}static isContainerKeyValid(t,e){const i="container";let s;if(Ws(t)&&(s=t),Ls(t)){const e=document.getElementById(t);Ws(e)&&(s=e);}const n=[];return s||n.push(`${jc(i,e,i)}: ${zc.CONTAINER_NOT_EXIST.message}`),n}static isContainerParamValid(t){return Ls(t)||Ws(t)?this.isContainerKeyValid(t).length>0?zc.CONTAINER_NOT_EXIST:null:zc.PARAM_INVALID}static isUiConfigValid(t,e){const i="UiConfig",s=[],n=$c.formatDetails(jc(i,e),Ps(t));if(n.length)return s.push(...n),s;const o=$c.formatDetails(jc(i,e,"type"),$c.isStringAndNotEmpty(t.type,!1));if(s.push(...o),["id","name","flexDirection","tooltip","className","label"].forEach((n=>{if(!Ts(t[n])){const o=$c.formatDetails(jc(i,e,n),$c.isStringAndNotEmpty(t[n]));s.push(...o);}})),["style","events"].forEach((n=>{if(!Ts(t[n])){const o=$c.formatDetails(jc(i,e,n),Ps(t[n]));s.push(...o);}})),!Ts(t.children)){const n=$c.formatDetails(jc(i,e,"children"),$c.isArrayAndMeetMinLength(t.children));if(n.length)return s.push(...n),s;t.children.forEach(((t,n)=>{if(Ls(t)||Ps(t)||s.push(`${i}.children[${n}] is invalid.`),Ps(t)){const o=this.isUiConfigValid(t,jc(i,e,`children[${n}]`));s.push(...o);}}));}return s}static isDocOptionsValid(t,e){const i=[],s=e||"CreateDocumentOptions",n=$c.formatDetails(jc(s,e),Ps(t));if(n.length)return i.push(...n),i;if(!Ts(t.name)){const n=$c.formatDetails(jc(s,e,"name"),$c.isStringAndNotEmpty(t.name,!1));i.push(...n);}if(!Ts(t.author)){const n=$c.formatDetails(jc(s,e,"author"),$c.isStringAndNotEmpty(t.author,!1));i.push(...n);}if(!Ts(t.creationDate)){const n=$c.formatDetails(jc(s,e,"creationDate"),$c.isPdfDate(t.creationDate));i.push(...n);}if(!Ts(t.deleteOriginal)){const n=$c.formatDetails(jc(s,e,"deleteOriginal"),Is(t.deleteOriginal));i.push(...n);}return i}static isTransferOptionsValid(t,e,i,s){const n=[],o="TransferOptions",r=$c.formatDetails(jc(o,s),Ps(t));if(r.length)return n.push(...r),n;if(!Ts(t.sourceIndices)){const r=this.isNumberArrayValid(t.sourceIndices,e,i,jc(o,s,"sourceIndices"));n.push(...r);}if(!Ts(t.insertBeforeIndex)){const e=$c.formatDetails(jc(o,s,"insertBeforeIndex"),$c.isNumberAndIsInRange(t.insertBeforeIndex,0));n.push(...e);}return n}static isNumberArrayValid(t,e,i,s){return this.isTypeArrayValid("number",t,e,i,s)}static isStringArrayValid(t,e){return this.isTypeArrayValid("string",t,void 0,void 0,e)}static isBlobArrayValid(t,e){return this.isTypeArrayValid("blob",t,void 0,void 0,e)}static isTypeArrayValid(t,e,i,s,n){const o=[],r=$c.formatDetails(jc("Array",n),$c.isArrayAndMeetMinLength(e));return r.length?(o.push(...r),o):(e.forEach(((e,r)=>{let a=null;"blob"===t?a=Es(e):"number"===t?a=$c.isNumberAndIsInRange(e,i,s):"string"===t&&(a=$c.isStringAndNotEmpty(e));const l=$c.formatDetails(jc("Array",n,`[${r}]`,!0),a);o.push(...l);})),o)}static isUpdatePageOptionsValid(t,e,i){const s=[],n="UpdatePageOptions",o=$c.formatDetails(jc(n,i),Ps(t));if(o.length)return s.push(...o),s;if(["fileIndex","width","height","pageWidth","pageHeight","resolutionX","resolutionY","bitDepth"].forEach((e=>{const o=t[e];if(!Ts(o)){const t=$c.formatDetails(jc(n,i,e),$c.isNumberAndIsInRange(o,0));s.push(...t);}})),!Ts(t.rotation)){const e=this.isRotationValid(t.rotation,jc(n,i));s.push(...e);}if(!Ts(t.filter)){const o=this.isFilterTypeValid(t.filter,e,jc(n,i));s.push(...o);}return s}static isRotationValid(t,e){const i=[],s=jc("",e,"rotation"),n=$c.formatDetails(s,$c.isNumberAndIsInRange(t));return n.length?(i.push(...n),i):(i.length||t%90==0||i.push(`'${s}' is not supported.`),i)}static isFilterTypeValid(t,e,i){const s=[],n=jc("",i,"filter"),o=$c.formatDetails(n,$c.isStringAndNotEmpty(t,!1));return o.length?(s.push(...o),s):(!s.length&&"none"!==t&&Ss(e)&&e.length>0&&!e.includes(t)&&s.push(`'${n}' is not supported.`),s)}static isSaveJpegSettingsValid(t,e){const i=[],s="SaveJpegSettings",n=$c.formatDetails(jc(s,e),Ps(t));if(n.length)return i.push(...n),i;if(!Ts(t.quality)){const n=$c.formatDetails(jc(s,e,"quality"),$c.isNumberAndIsInRange(t.quality,0,100));i.push(...n);}if(!Ts(t.saveAnnotation)){const n=$c.formatDetails(jc(s,e,"saveAnnotation"),Is(t.saveAnnotation));i.push(...n);}return i}static isSavePngSettingsValid(t,e){const i=[],s="SavePngSettings",n=$c.formatDetails(jc(s,e),Ps(t));if(n.length)return i.push(...n),i;if(!Ts(t.saveAnnotation)){const n=$c.formatDetails(jc(s,e,"saveAnnotation"),Is(t.saveAnnotation));i.push(...n);}return i}static isSavePdfSettingsValid(t,e){const i=[],s="SavePdfSettings",n=$c.formatDetails(jc(s,e),Ps(t));if(n.length)return i.push(...n),i;if(["author","creator","keyWords","producer","subject","title"].forEach((n=>{const o=t[n];if(!Ts(o)){const t=$c.formatDetails(jc(s,e,n),$c.isStringAndNotEmpty(o,!1));i.push(...t);}})),!Ts(t.compression)){const n=$c.formatDetails(jc(s,e,"compression"),go.has(t.compression));i.push(...n);}if(!Ts(t.creationDate)){const n=$c.formatDetails(jc(s,e,"creationDate"),$c.isPdfDate(t.creationDate));i.push(...n);}if(!Ts(t.modifiedDate)){const n=$c.formatDetails(jc(s,e,"modifiedDate"),$c.isPdfDate(t.modifiedDate));i.push(...n);}if(!Ts(t.pageType)){const n=$c.formatDetails(jc(s,e,"pageType"),po.has(t.pageType));i.push(...n);}if(!Ts(t.version)){const n=$c.formatDetails(jc(s,e,"version"),this.isPdfVersionValid(t.version));i.push(...n);}if(!Ts(t.mimeType)){const n=$c.formatDetails(jc(s,e,"mimeType"),$c.isStringAndNotEmpty(t.mimeType));i.push(...n);}if(!Ts(t.quality)){const n=$c.formatDetails(jc(s,e,"quality"),$c.isNumberAndIsInRange(t.quality,0,100));i.push(...n);}if(!Ts(t.password)){const n=$c.formatDetails(jc(s,e,"password"),$c.isStringAndNotEmpty(t.password));i.push(...n),!n.length&&t.password.length>32&&i.push("The specified password exceeds 32 characters.");}if(!Ts(t.saveAnnotation)){const n=$c.formatDetails(jc(s,e,"saveAnnotation"),["none","image","annotation","flatten"].includes(t.saveAnnotation));i.push(...n);}if(!Ts(t.imageScaleFactor)){const n=$c.formatDetails(jc(s,e,"imageScaleFactor"),$c.isNumberAndIsInRange(t.imageScaleFactor,Number.MIN_VALUE,1));i.push(...n);}return i}static isPdfVersionValid(t){return !!Ls(t)&&["1.1","1.2","1.3","1.4","1.5","1.6","1.7"].includes(t.trim())}static isSaveTiffSettingsValid(t,e){const i=[],s="SaveTiffSettings",n=$c.formatDetails(jc(s,e),Ps(t));if(n.length)return i.push(...n),i;if(!Ts(t.compression)){const n=$c.formatDetails(jc(s,e,"compression"),fo.has(t.compression));i.push(...n);}if(!Ts(t.customTag)){const n=$c.formatDetails(jc(s,e,"customTag"),$c.isArrayAndMeetMinLength(t.customTag));i.push(...n),n.length||t.customTag.forEach(((t,n)=>{const o=this.isTiffCustomTagValid(t,jc(s,e,`customTag[${n}]`));i.push(...o);}));}if(!Ts(t.quality)){const n=$c.formatDetails(jc(s,e,"quality"),$c.isNumberAndIsInRange(t.quality,0,100));i.push(...n);}return i}static isTiffCustomTagValid(t,e){const i=[],s="CustomTag",n=$c.formatDetails(jc(s,e),Ps(t));if(n.length)return i.push(...n),i;if(!Ts(t.content)){const n=$c.formatDetails(jc(s,e,"content"),$c.isStringAndNotEmpty(t.content,!1));i.push(...n);}if(!Ts(t.contentIsBase64)){const n=$c.formatDetails(jc(s,e,"contentIsBase64"),Is(t.contentIsBase64));i.push(...n);}if(!Ts(t.id)){const n=$c.formatDetails(jc(s,e,"id"),$c.isNumberAndIsInRange(t.id));i.push(...n);}return i}static isVideoDeviceInfo(t,e){const i=[],s=$c.formatDetails(e,Ps(t));i.push(...s);const n=$c.formatDetails(jc(e,void 0,"deviceId"),$c.isStringAndNotEmpty(t.deviceId,!1));i.push(...n);const o=$c.formatDetails(jc(e,void 0,"label"),$c.isStringAndNotEmpty(t.label,!1));return i.push(...o),i}static isVideoConfig(t,e){const i=[],s=$c.formatDetails(e,Ps(t));if(s.length)return i.push(...s),i;if(!Ts(t.fill)){const s=$c.formatDetails(jc(e,void 0,"fill"),Is(t.fill));i.push(...s);}if(!Ts(t.resolution)){const s=hk.isNumberArrayValid(t.resolution,0,void 0,jc(e,void 0,"resolution"));i.push(...s);}return i}static isZoomOriginValid(t){const e=[],i=$c.formatDetails("zoomOrigin",Ps(t));return i.length?(e.push(...i),e):(["x","y"].forEach((i=>{const s=t[i];Ts(s)?e.push(`ZoomOrigin.${i} is missing.`):["start","center","end"].includes(s)||e.push(`ZoomOrigin.${i} is valid.`);})),e)}static isAnnotationOptionsValid(t,e,i){const s=[],n=["x","y","rotation"],o=["width","height","borderWidth","opacity","miterLimit","fontSize"],r=["borderColor","background","icon","lineCap","lineJoin","textAlign","content","color","fontFamily","fontWeight","fontStyle"],a=["fontWeight"],l=["fontStyle"],h=["points"],d=["textContents"],c=["startPoint","endPoint"],u=["flags"],p=["underline","lineThrough"],g=["stamp"],f=["lineDash"];if("textTypewriter"===i){const{textContents:i}=t;if(i&&(!Ss(i)||!i.length||i.find((t=>!Ps(t)))||i.every((t=>""===t.content||void 0===t.content||null===t.content))))return s.push(`${e}.textContents is invalid`),s}const m=t=>!!Ps(t)&&(!!Bs(null==t?void 0:t.x)&&!!Bs(null==t?void 0:t.y)),y=t=>{if(!Ss(t))return !1;if(t.length<2)return !1;for(let e=0;e<t.length;e++)if(!m(t[e]))return !1;return !0};return Object.keys(t).forEach((v=>{const x=t[v];let w=!0;var b;(n.includes(v)&&!Bs(x)||o.includes(v)&&!rk(x)||r.includes(v)&&!Ls(x)||d.includes(v)&&!(t=>{if(!Ss(t))return !1;for(let e=0;e<t.length;e++){const i=t[e];if(!Ps(i))return !1;const s=Object.keys(i);for(let t=0;t<s.length;t++){const e=s[t],h=i[e];if(n.includes(e)&&!Bs(h)||o.includes(e)&&!rk(h)||r.includes(e)&&!Ls(h)||p.includes(e)&&!Is(h)||a.includes(e)&&!["normal","bold"].includes(h)||l.includes(e)&&!["normal","italic"].includes(h))return !1}}return !0})(x)||c.includes(v)&&!m(x)||u.includes(v)&&!Ps(x)||g.includes(v)&&(b=x,![FP.REJECTED,FP.ACCEPTED,FP.INITIAL_HERE,FP.SIGN_HERE,FP.WITNESS,FP.APPROVED,FP.NOT_APPROVED,FP.DRAFT,FP.FINAL,FP.COMPLETED,FP.CONFIDENTIAL,FP.VOID].includes(b)&&!Es(b))||f.includes(v)&&!(t=>{if(!Ss(t))return !1;for(let e=0;e<t.length;e++)if(!rk(t[e]))return !1;return !0})(x))&&(w=!1),h.includes(v)&&("ink"===i?(t=>{if(!Ss(t))return !1;if(!t.length)return !1;for(let e=0;e<t.length;e++)if(!y(t[e]))return !1;return !0})(t[v])||(w=!1):y(t[v])||(w=!1)),w||s.push(`${e}.${v} is invalid`);})),s}}var dk=new WeakMap,ck=new WeakMap,uk=new WeakSet;class pk{constructor(t,e){a(this,uk),n(this,dk,void 0),n(this,ck,void 0),o(dk,this,t),o(ck,this,e);}get name(){return s(ck,this).name}get uid(){return s(ck,this).uid}get pages(){return s(ck,this).pages.slice()}get creationDate(){return s(ck,this).creationDate}get author(){return s(ck,this).author}async loadSource(t,e){const i="IDocument.loadSource",n="sources";Hu.makeSureLoadLicenseExist(),DP(t,0,i,n);return function(t,e,i,s,n){let o=[];Ss(t)?o=Es(t[0])?t.reduce(((t,e,i)=>{if(!Es(e)){const e=$c.formatDetails(jc("Array",n,`[${i}]`,!0),!1);t.push(...e);}return t}),[]):hk.isSourcesValid(t,void 0,e):Es(t)||(o=hk.isSourceValid(t,void 0,e)),!o.length||$c.output(i,s,n,o);}(t,s(dk,this).filterService.getSupportedFilters().map((t=>t.type)),0,i,n),Ps(e)?function(t,e,i,s){const n=hk.isLoadSourceOptionsValid(t,void 0);!n.length||$c.output(e,i,s,n);}(e,0,i,"loadSourceOptions"):Ts(e)||lA(e,0,i,"index",0),Ss(t)||(t=[t]),Es(t[0])&&(t=t.map((t=>({fileData:t})))),s(dk,this).loadSource(t,this.uid,e).catch((t=>zc.reject(t,i)))}async getPageData(t){const e="IDocument.getPageData",i="pageUid";DP(t,0,e,i),nA(t,0,e,i,!1),this.pages.includes(t)||$c.error(e,i,void 0,zc.PAGE_NOT_EXIST);const n=await s(dk,this).getPageData(t);if(n.raw){const t={data:n.raw.data,width:n.raw.width,height:n.raw.height};n.raw=t;}if(n.display){const t={data:n.display.data,width:n.display.width,height:n.display.height};n.display=t;}if(n.thumbnail){const t={data:n.thumbnail.data,width:n.thumbnail.width,height:n.thumbnail.height};n.thumbnail=t;}n.rotation&&(n.rotation%=360);const{displayResolution:o,dataResolution:r}=eo;return n.mediaBox=fk(Cn(n.mediaBox,o,r),2),n.cropBox=fk(Cn(n.cropBox,o,r),2),n}async updatePage(t,e,i){const n="IDocument.updatePage",o="pageUid",r="data";if(DP(t,0,n,o),DP(e,0,n,r),nA(t,0,n,o,!1),iA(this.pages,t,0,n),function(t,e,i,s){!!Es(t)||$c.output(e,i,s,void 0,zc.PARAM_INVALID);}(e,0,n,r),!Ts(i)){!function(t,e,i,s){const n=hk.isUpdatePageOptionsValid(t,e,"updatePageOptions");!n.length||$c.output(i,s,"options",n);}(i,s(dk,this).filterService.getSupportedFilters().map((t=>t.type)),0,n);}return s(dk,this).updatePage(t,e,i)}deletePages(t){const e="IDocument.deletePages",i="indices";if(DP(t,1,e,i)||!oA(t,1,e,i,0,r(uk,this,gk)-1))return !1;const n=t.map((t=>s(ck,this).pages[t]));return s(dk,this).deletePages(this.uid,n)}deleteAllPages(){return s(ck,this).pages.slice(),s(dk,this).deleteAllPages(this.uid)}movePages(t,e){const i="IDocument.movePages",n="indices";DP(t,0,i,n),oA(t,0,i,n,0,r(uk,this,gk)-1),Ts(e)||lA(e,0,i,"insertBeforeIndex",0),e=e>r(uk,this,gk)-1?void 0:e,s(dk,this).movePages(this.uid,t,e);}switchPage(t,e){const i="IDocument.switchPage",n="oneIndex",o="anotherIndex";DP(t,0,i,n),DP(e,0,i,o),lA(t,0,i,n,0,r(uk,this,gk)-1),lA(e,0,i,o,0,r(uk,this,gk)-1),s(dk,this).documentService.swapPages(this.uid,t,e);}rename(t){const e="IDocument.rename",i="name";return !DP(t,1,e,i)&&(!!nA(t,1,e,i)&&s(dk,this).documentService.renameDocument(this.uid,t))}setPageCustomData(t,e){const i="IDocument.setPageCustomData",n="pageUid";return DP(t,0,i,n),DP(e,0,i,"data"),nA(t,0,i,n,!1),iA(this.pages,t,0,i),s(dk,this).setCustomData(t,e)}getPageCustomData(t){const e="IDocument.getPageCustomData",i="pageUid";return DP(t,0,e,i),nA(t,0,e,i,!1),iA(this.pages,t,0,e),s(dk,this).getCustomData(t)}async saveToJpeg(t,e){const i="IDocument.saveToJpeg",n="index";DP(t,0,i,n),lA(t,0,i,n,0,r(uk,this,gk)-1),Ts(e)||function(t,e,i){const s=hk.isSaveJpegSettingsValid(t);!s.length||$c.output(e,i,"saveJpegSettings",s);}(e,0,i);const o=this.pages[t];return s(dk,this).fileSaveService.saveToJpeg(o,e).catch((t=>zc.reject(t,i)))}saveToPng(t,e){const i="IDocument.saveToPng",n="index";DP(t,0,i,n),lA(t,0,i,n,0,r(uk,this,gk)-1),Ts(e)||function(t,e,i){const s=hk.isSavePngSettingsValid(t);s.length&&$c.output(e,i,"savePngSettings",s);}(e,0,i);const o=this.pages[t];return s(dk,this).fileSaveService.saveToPng(o,e).catch((t=>zc.reject(t,i)))}saveToPdf(t,e){const i="IDocument.saveToPdf";0===this.pages.length&&zc.throw(zc.DOC_NO_IMAGE),Ss(t)?oA(t,0,i,"indices",0,r(uk,this,gk)-1):(e=t,t=Array.from(Array(this.pages.length).keys())),Ts(e)||function(t,e,i){const s=hk.isSavePdfSettingsValid(t);!s.length||$c.output(e,i,"savePdfSettings",s);}(e,0,i);const n=[];t.forEach((t=>{n.push(this.pages[t]);}));try{!e||"annotation"!==e.saveAnnotation&&"flatten"!==e.saveAnnotation||Hu.makeSureAnnotationLicenseExist();}catch(t){return Promise.reject(t)}return s(dk,this).fileSaveService.saveToPdf(n,e).catch((t=>zc.reject(t,i)))}saveToTiff(t,e){const i="IDocument.saveToTiff";0===this.pages.length&&zc.throw(zc.DOC_NO_IMAGE),Ss(t)?oA(t,0,i,"indices",0,r(uk,this,gk)-1):(e=t,t=Array.from(Array(this.pages.length).keys())),Ts(e)||function(t,e,i){const s=hk.isSaveTiffSettingsValid(t);!s.length||$c.output(e,i,"saveTiffSettings",s);}(e,0,i);const n=[];return t.forEach((t=>{n.push(this.pages[t]);})),s(dk,this).fileSaveService.saveToTiff(n,e).catch((t=>zc.reject(t,i)))}print(t,e){const i="IDocument.print";let n,o=e;var a;(Ss(t)?(oA(t,0,i,"indices",0,r(uk,this,gk)-1),n=t):o=t,Ts(o))||(Ts(null===(a=o)||void 0===a?void 0:a.printAnnotation)||Is(o.printAnnotation)||$c.error(i,"setting.printAnnotation",void 0,zc.PARAM_INVALID));0===this.pages.length&&zc.throw(zc.DOC_NO_IMAGE),s(dk,this).printPages(this.uid,n,o);}insertBlankPage(t,e,i){const n="IDocument.insertBlankPage",o="pageWidth",r="pageHeight";Hu.makeSureLoadLicenseExist(),DP(t,0,n,o),DP(e,0,n,r),lA(t,0,n,o,.72,7200),lA(e,0,n,r,.72,7200),Ts(i)||lA(i,0,n,"insertBeforeIndex",0);return s(dk,this).insertBlankPage(this.uid,Math.floor(Cn(t,eo.dataResolution,72))||1,Math.floor(Cn(e,eo.dataResolution,72))||1,72,72,i)}}function gk(t){return s(ck,t).pages.length}function fk(t,e){let i=!0;const s=Pn(t.left,e),n=Pn(t.top,e),o=Pn(t.width,e),r=Pn(t.height,e),a=1e-7;return (Math.abs(s-t.left)>a||Math.abs(n-t.top)>a||Math.abs(o-t.width)>a||Math.abs(r-t.height)>a)&&(i=!1),i?{left:s,top:n,width:o,height:r}:t}function mk(t,e,i,s,n){if(!Ts(t)){const o="transferOptions",r=hk.isTransferOptionsValid(t,e,i,o);if(r.length)return $c.output(s,n,o,r)}return !0}function yk(t,e,i,s){if(!Ts(t)){const n=hk.isDocOptionsValid(t);if(n.length)return $c.output(e,i,s,n)}return !0}function vk(t,e,i,s,n){const o=e.reduce(((e,i,s)=>(t.has(i)||e.push(`${n}[${s}]:The specified document(s) do not exist.`),e)),[]);return !o.length||$c.output(i,s,n,o,zc.DOC_NOT_EXIST,!0)}const xk=["documentCreated","documentDeleted","pagesAdded","pagesDeleted"];var wk=new WeakMap,bk=new WeakMap,Ck=new WeakMap;const Sk=new class extends Tn{constructor(){super(),n(this,wk,void 0),n(this,bk,void 0),n(this,Ck,void 0),o(Ck,this,new Fs),o(wk,this,fS),o(bk,this,new Map),fS.onUnload.on((()=>{s(bk,this).clear(),s(Ck,this).removeAllEventListeners();}),this);const{documentService:t}=fS;t.onDocumentCreated.on((t=>{const e=s(wk,this).getDocument(t.docUid),i=new pk(s(wk,this),e);s(bk,this).set(i.uid,i),s(Ck,this).emit("documentCreated",t);}),this),t.onDocumentDeleted.on((t=>{s(bk,this).has(t.docUid)&&s(bk,this).delete(t.docUid),s(Ck,this).emit("documentDeleted",t);}),this),t.onPagesAdded.on((t=>{t.indices.length&&t.pageUids.length&&s(Ck,this).emit("pagesAdded",t);}),this),t.onDeletePagesFromDoc.on((t=>{s(Ck,this).emit("pagesDeleted",t);}),this),t.onDeleteAllPagesFromDoc.on((t=>{s(Ck,this).emit("pagesDeleted",t);}),this);}createDocument(t){yk(t,0,"DocumentManager.createDocument","createDocumentOptions");const e=s(wk,this).createDocument(t);return s(bk,this).get(e.uid)}getDocument(t){const e="DocumentManager.getDocument",i="docUid";DP(t,0,e,i),nA(t,0,e,i);const n=s(bk,this).get(t);return n||$c.error(e,i,void 0,zc.DOC_NOT_EXIST),n}getAllDocuments(){return Array.from(s(bk,this).values())}deleteDocuments(t){const e="DocumentManager.deleteDocuments",i="docUids";return !(DP(t,1,e,i)||!oT(t,1,e,i,void 0,!1)||!vk(s(bk,this),t,1,e,i))&&s(wk,this).deleteDocuments([...new Set(t)])}deleteAllDocuments(){const t=s(wk,this).documentService.getAllDocuments();return s(wk,this).deleteDocuments(t.map((t=>t.uid)))}copyPagesToDocument(t,e,i){const n="DocumentManager.copyPagesToDocument",o="sourceDocUid",r="targetDocUid";DP(t,0,n,o),DP(e,0,n,r),nA(t,0,n,o),nA(e,0,n,r);const a=s(bk,this).get(t),l=s(bk,this).get(e);return a&&l||zc.throw(zc.DOC_NOT_EXIST,n),mk(i,0,a.pages.length-1,0,n),s(wk,this).transferDocument(t,e,{...i,copy:!0})}movePagesToDocument(t,e,i){const n="DocumentManager.movePagesToDocument",o="sourceDocUid",r="targetDocUid";DP(t,0,n,o),DP(e,0,n,r),nA(t,0,n,o),nA(e,0,n,r);const a=s(bk,this).get(t),l=s(bk,this).get(e);return a&&l||zc.throw(zc.DOC_NOT_EXIST,n),mk(i,0,a.pages.length-1,0,n),s(wk,this).transferDocument(t,e,i)}mergeDocuments(t,e){const i="DocumentManager.mergeDocuments",n="docUids";DP(t,0,i,n),oT(t,0,i,n,void 0,!1),function(t){return new Set(t).size!==t.length}(t)&&$c.error(void 0,void 0,void 0,zc.DOC_UID_DUPLICATE),vk(s(bk,this),t,0,i,n),yk(e,0,i,"mergeDocumentOptions");const o=s(wk,this).mergeDocuments(t,e);return s(bk,this).get(o.uid)}on(t,e){const i="DocumentManager.on";!DP(t,1,i,"eventName")&&!DP(e,1,i,"listener")&&nA(t,1,i,"eventName",!1)&&sA(e,i,"listener",1)&&(xk.includes(t)?s(Ck,this).on(t,e):zc.warning(zc.PARAM_NOT_SUPPORT,i,"eventName"));}off(t,e){const i="DocumentManager.off";!DP(t,1,i,"eventName")&&nA(t,1,i,"eventName",!1)&&(Ts(e)||sA(e,i,"listener",1))&&(xk.includes(t)?s(Ck,this).off(t,e):zc.warning(zc.PARAM_NOT_SUPPORT,i,"eventName"));}};const Pk=`${(()=>{if(!Ji&&document.currentScript){let{src:t}=document.currentScript;const e=t.indexOf("?");if(-1!==e)t=t.substring(0,e);else {const e=t.indexOf("#");-1!==e&&(t=t.substring(0,e));}return t.substring(0,t.lastIndexOf("/")+1)}return "./"})()}engine`;var Ak=new WeakMap,Tk=new WeakMap,kk=new WeakMap;const Dk=new class{constructor(){n(this,Ak,""),n(this,Tk,""),n(this,kk,Pk);}get versionInfo(){return {viewer:Ju,engine:Mn.version}}set engineResourcePath(t){Ls(t)?o(kk,this,t):zc.throw(zc.PARAM_INVALID,"Core.engineResourcePath","engineResourcePath");}get engineResourcePath(){return s(kk,this)}set license(t){!function(t,e,i,s){const n=$c.formatError({isValid:hk.isLicenseValid(t)});!n||$c.output(e,i,s,void 0,n);}(t,0,"Core.license","license"),o(Tk,this,t);}get license(){return s(Tk,this)}set deviceFriendlyName(t){Ls(t)?o(Ak,this,t):zc.throw(zc.PARAM_INVALID,"Core.deviceFriendlyName","deviceFriendlyName");}get deviceFriendlyName(){return s(Ak,this)}loadWasm(){return async function(t){let e=t.trim();if(e.endsWith("/")||(e=`${e}/`),Mn.resourceDir=e,!await Mn.isResourceDirValid())return zc.reject(zc.RESOURCE_NOT_FOUND,"DDV.Core.loadWasm");await Mn.preloadModule("core");const i=Mn.preloadModule("proc"),s=Mn.preloadModule("pdf");await Promise.all([i,s]);}(s(kk,this))}init(){return gp({license:s(Tk,this),engineResourcePath:s(kk,this),deviceFriendlyName:s(Ak,this)})}};var Ek;!function(t){t.NONE="none",t.BLACK_AND_WHITE="blackAndWhite",t.GRAY="gray",t.REMOVE_SHADOW="removeShadow",t.SAVE_INK="saveInk",t.ENHANCE="enhance",t.INVERT="invert";}(Ek||(Ek={}));const Ik=[],Rk={documentManager:Sk,Core:Dk,Elements:IP,DocumentDetect:Cc,ImageFilter:class{constructor(){a(this,Fc);}get defaultFilterType(){return wc.NONE}async applyFilter(t,i,s,n){const o=new Xn,r=e(Fc,this,Hc).call(this,i,s),a=e(Fc,this,Vc).call(this,{outputType:t.type,...n||{}});let l;try{const e=await o.initImage({source:t.data,isRGBA:t.type===Wn.RGBA,width:t.width,height:t.height,isBGRA:t.type===Wn.BGRA});let s;e.srcBuffer&&(t.data=e.srcBuffer),i===wc.NONE?(s=await o.getImage({jpegQuality:a.jpegQuality,ifDeleteObject:!0,isRGBA:t.type===Wn.RGBA,bitDepth:a.bitDepth,xDpi:a.xdpi,yDpi:a.ydpi,returnBlob:!1,returnType:Kn[a.outputType]}),o.freeReservedData()):s=await o.filter(Nc.get(i),r,a),l=new Blob([s.imageData],{type:s.blobType});}finally{o.terminate();}return l}querySupported(){return [{type:wc.NONE,label:"Original"},{type:wc.BLACK_AND_WHITE,label:"B&W"},{type:wc.GRAY,label:"Grayscale"},{type:wc.SAVE_INK,label:"Save Toner"}]}destroy(){}},BrowseViewer:zT,CaptureViewer:fA,CustomViewer:YT,EditViewer:ET,PerspectiveViewer:HT,get lastError(){return zc.getLastError()},clearLastError(){zc.lastError=void 0;},Experiments:{get(t,e){switch(t){case"WasmEnv":return Mn;case"ImageProcess":return new Xc;case"FileParser.Options":return fS.getFileParserDefaultOptions(e);default:return}},set(t,e){switch(t){case"FileParser.Options":return fS.setFileParserDefaultOptions(e.type,e.options);case"ClearExternalHandler":return fS.clearExternalHandler(e.type);default:return}}},async addFonts(t){const e="DDV.addFonts";if(!DP(t,2,e,"fonts")&&!function(t,e,i,s,n){const o=$c.formatError({isValid:Ss(t)});if(o)return $c.output(e,i,s,void 0,o);const r=[];return t.forEach(((t,e)=>{const i=$c.formatDetails(jc("Array",n,`[${e}]`,!0),Es(t));r.push(...i);})),!!r.length&&$c.output(e,i,s,r)}(t,2,e,"fonts","font"))try{for(let e=0;e<t.length;e++){const i=t[e],s=new Zn,n=await s.getFontInfo(i).catch((t=>{throw s.terminate(),t}));s.terminate();for(let t=0;t<n.fontInfo.length;t++){const e=n.fontInfo[t];if(!Ik.includes(e.family)){new FontFace(e.family,n.srcBuffer,{style:"normal",weight:"normal",display:"swap"}).load().then((t=>{document.fonts.add(t),Ik.push(e.family),fS.getViewers().forEach((t=>{t.addFontToUi(e.family),t.context.render();}));}));}const i=`${e.family}${e.isBold?"Blob":""}${e.isItalic?"Italic":""}`;qn.addPdfFont(i,n.srcBuffer);}}}catch(t){return zc.reject(zc.PARAM_INVALID,e,"fonts")}},getDefaultUiConfig(t,e){const i="DDV.getDefaultUiConfig",s="viewerType";if(DP(t,1,s,i)||!nA(t,1,i,s)||!function(t,e,i,s){return !!["editViewer","perspectiveViewer","captureViewer","browseViewer"].includes(t)||$c.output(s,e,i,void 0,zc.PARAM_NOT_SUPPORT)}(t,i,s,1))return null;let n=null;if(Ms()){n={editViewer:MP,perspectiveViewer:BP,captureViewer:RP,browseViewer:_P}[t],"editViewer"===t&&null!=e&&e.includeAnnotationSet&&(n=NP);}else {n={editViewer:OP,perspectiveViewer:UP,captureViewer:LP,browseViewer:_P}[t],"editViewer"===t&&null!=e&&e.includeAnnotationSet&&(n=WP);}return As(n)},setProcessingHandler(t,e){const i="DDV.setProcessingHandler",s="type",n="handler";switch(DP(t,0,i,s),DP(e,0,i,n),function(t,e,i,s){const n=$c.formatError(hk.isHandlerTypeValid(t));n&&$c.output(e,i,s,void 0,n);}(t,0,i,s),t){case"documentBoundariesDetect":("function"!=typeof(o=e).detect||"function"!=typeof o.destroy)&&$c.error(i,n);break;case"imageFilter":(function(t){return "function"==typeof t.querySupported&&"defaultFilterType"in t&&"function"==typeof t.applyFilter&&"function"==typeof t.destroy})(e)||$c.error(i,n);}var o;try{switch(t){case"documentBoundariesDetect":fS.setDetectHandler(t,e);break;case"imageFilter":fS.setImageFilterHandler(e);}}catch(t){zc.throw(t,i);}},setFileParser(t,e){fS.setFileParser(t,e);},unload(){this.Core.deviceFriendlyName="",this.Core.engineResourcePath=Pk,this.Core.license="",fS.unload(),fS.onUnload.emit(),pT.clear();},on(t,e){const i="DDV.on";if(DP(t,1,i,"eventName")||DP(e,1,i,"listener")||!nA(t,1,i,"eventName",!1)||!sA(e,i,"listener",1))return;const s={error:"error",warning:"warning",verbose:"verbose"}[t];s?zc.on(s,e):zc.throw(zc.PARAM_NOT_SUPPORT,i,"eventName");},off(t,e){const i="DDV.off";if(DP(t,1,i,"eventName")||!nA(t,1,i,"eventName",!1))return;if(!Ts(e)&&!sA(e,i,"listener",1))return;const s={error:"error",warning:"warning",verbose:"verbose"}[t];s?zc.off(s,e):zc.throw(zc.PARAM_NOT_SUPPORT,i,"eventName");},EnumImageDataType:Wn,EnumConvertMode:Uh,EnumDocumentDetectionStatus:xc,EnumImageFilterType:Ek,EnumPDFCompressionType:ho,EnumPDFPageType:co,EnumTIFFCompressionType:lo,EnumStampIcon:FP,EnumLineEnding:HP,EnumAnnotationRenderMode:Oh,annotationManager:wT};window.Dynamsoft||(window.Dynamsoft={}),window.Dynamsoft.DDV=Rk;

export { zT as BrowseViewer, fA as CaptureViewer, YT as CustomViewer, Rk as DDV, ET as EditViewer, Oh as EnumAnnotationRenderMode, Uh as EnumConvertMode, xc as EnumDocumentDetectionStatus, Wn as EnumImageDataType, Ek as EnumImageFilterType, ho as EnumPDFCompressionType, co as EnumPDFPageType, lo as EnumTIFFCompressionType, HT as PerspectiveViewer };
