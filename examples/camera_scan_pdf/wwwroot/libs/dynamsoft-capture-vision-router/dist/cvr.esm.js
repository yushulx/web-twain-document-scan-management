/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Capture Vision Router JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version "2.0.30"
 * @fileoverview Dynamsoft JavaScript Library for Capture Vision
 * More info on cvr JS: https://www.dynamsoft.com/capture-vision-router/sdk-javascript/
 */
import{engineResourcePaths as e,workerAutoResources as t,mapPackageRegister as s,compareVersion as i,innerVersions as a,CoreModule as r,loadWasm as n,getNextTaskID as o,mapTaskCallBack as c,worker as l,EnumCapturedResultItemType as d,EnumImagePixelFormat as u,EnumColourChannelUsageType as _}from"dynamsoft-core";const h=e=>e&&"object"==typeof e&&"function"==typeof e.then;class m extends Promise{constructor(e){let t,s;super(((e,i)=>{t=e,s=i})),this._s="pending",this.resolve=e=>{this.isPending&&(h(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",s(e))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,h(e)?t=e:"function"==typeof e&&(t=new Promise(e)),t&&(async()=>{try{const s=await t;e===this._task&&this.resolve(s)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}}class R{constructor(){this.intermediateResultReceiverSet=new Set}addResultReceiver(e){if("object"!=typeof e)throw new Error("Invalid receiver.");this.intermediateResultReceiverSet.add(e)}removeResultReceiver(e){this.intermediateResultReceiverSet.delete(e)}}var g={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1};const I="undefined"==typeof self,p=(()=>{if(!I&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})();var f;null==e.cvr&&(e.cvr=p),t.cvr={js:!0,wasm:!0},s.cvr={};const v="1.0.0";e.std.version&&i(e.std.version,v)<0&&(e.std.version=v,e.std.path=p+`../../dynamsoft-capture-vision-std@${v}/dist/`);const E="2.0.30";e.dip.version&&i(e.dip.version,E)<0&&(e.dip.version=E,e.dip.path=p+`../../dynamsoft-image-processing@${E}/dist/`);class T{static getVersion(){return this._version}}var S,y,D,w;async function C(e,t){return await new Promise(((s,i)=>{let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType=t,a.send(),a.onloadend=async()=>{s(a.response)},a.onerror=()=>{i(new Error("Network Error: "+a.statusText))}}))}T._version=`2.0.30(Worker: ${null===(f=a.cvr)||void 0===f?void 0:f.worker}, Wasm: loading...`,function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(S||(S={})),function(e){e[e.IRUT_NULL=0]="IRUT_NULL",e[e.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",e[e.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",e[e.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",e[e.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",e[e.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",e[e.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",e[e.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",e[e.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",e[e.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",e[e.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",e[e.IRUT_CONTOURS=1024]="IRUT_CONTOURS",e[e.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",e[e.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",e[e.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",e[e.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",e[e.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",e[e.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",e[e.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",e[e.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",e[e.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",e[e.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",e[e.IRUT_CORNERS=2097152]="IRUT_CORNERS",e[e.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",e[e.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",e[e.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",e[e.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",e[e.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",e[e.IRUT_ALL=134217727]="IRUT_ALL"}(y||(y={})),function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(D||(D={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12"}(w||(w={}));const A=D;function b(e){const t={barcodesResultItems:[],textLinesResultItems:[],quadsResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return e.items.forEach((e=>{e.type===A.CRIT_BARCODE?t.barcodesResultItems.push(e):e.type===A.CRIT_TEXT_LINE?t.textLinesResultItems.push(e):e.type===A.CRIT_DETECTED_QUAD?t.quadsResultItems.push(e):e.type===A.CRIT_NORMALIZED_IMAGE?t.normalizedImageResultItems.push(e):e.type===A.CRIT_PARSED_RESULT&&t.parsedResultItems.push(e)})),t}function O(e){let t,s=e.bytes;if(!(s&&s instanceof Uint8Array))throw Error("Parameter type error");if(Number(e.format)===w.IPF_BGR_888){const e=s.length/3;t=new Uint8ClampedArray(4*e);for(let i=0;i<e;++i)t[4*i]=s[3*i],t[4*i+1]=s[3*i+1],t[4*i+2]=s[3*i+2],t[4*i+3]=255}else if(Number(e.format)===w.IPF_RGB_888){const e=s.length/3;t=new Uint8ClampedArray(4*e);for(let i=0;i<e;++i)t[4*i]=s[3*i+2],t[4*i+1]=s[3*i+1],t[4*i+2]=s[3*i],t[4*i+3]=255}else if(Number(e.format)===w.IPF_GRAYSCALED){const e=s.length;t=new Uint8ClampedArray(4*e);for(let i=0;i<e;i++)t[4*i]=t[4*i+1]=t[4*i+2]=s[i],t[4*i+3]=255}else if(Number(e.format)===w.IPF_BINARY_8){const i=s.length,a=e.width,r=e.height,n=e.stride;t=new Uint8ClampedArray(a*r*4);for(let e=0;e<i;e++){let i=s[e],r=e%n,o=Math.floor(e/n);for(let e=0;e<8;e++){let s=r+e,n=4*(o*a+s);if(s>=a)break;t[n]=t[n+1]=t[n+2]=(128&i)/128*255,t[n+3]=255,i<<=1}}}else if(Number(e.format)===w.IPF_ABGR_8888){const e=s.length/4;t=new Uint8ClampedArray(s.length);for(let i=0;i<e;++i)t[4*i]=s[4*i],t[4*i+1]=s[4*i+1],t[4*i+2]=s[4*i+2],t[4*i+3]=s[4*i+3]}else if(Number(e.format)===w.IPF_ARGB_8888){const e=s.length/4;t=new Uint8ClampedArray(s.length);for(let i=0;i<e;++i)t[4*i]=s[4*i],t[4*i+1]=s[4*i+1],t[4*i+2]=s[4*i+2],t[4*i+3]=s[4*i+3]}return new ImageData(t,e.width,e.height)}function L(e,t){let s=e;s.toCanvas=()=>U(t),s.toImage=e=>function(e,t){const s=U(t);let i=new Image,a=s.toDataURL(e);return i.src=a,i}(e,t),s.toBlob=e=>k(e,t),s.saveToFile=async(e,s)=>{if(!e)return null;if("string"!=typeof e)throw new TypeError("FileName must be of type string.");return async function(e,t,s){return await new Promise((async(i,a)=>{try{const a=t.split(".");let r=a[a.length-1];const n=await k(`image/${r}`,e);a.length<=1&&(r="png");const o=new File([n],t,{type:`image/${r}`});if(s){const e=URL.createObjectURL(o),s=document.createElement("a");s.href=e,s.download=t,s.click()}return i(o)}catch(e){return a()}}))}(t,e,s)}}function U(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;return t.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),t}async function k(e,t){const s=U(t);return new Promise(((t,i)=>{s.toBlob((e=>t(e)),e)}))}const N="function"==typeof BigInt;class F{constructor(){this._maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(r.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._irrRegistryState=g,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._templateName="Default",this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get maxCvsSideLength(){return this._maxCvsSideLength}set maxCvsSideLength(e){this._maxCvsSideLength=e}get isa(){return this._isa}set isa(e){this._isa=e}get disposed(){return this.bDestroyed}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}static async createInstance(){if(!s.license)throw Error("Module `license` is not existed.");await s.license.dynamsoft(),await n(["dip","cvr"]);const e=new F,t=new m;let i=o();return c[i]=async s=>{var i;if(s.success)e._instanceID=s.instanceID,e._currentSettings=await e.outputSettings("*"),T._version=`2.0.30(Worker: ${null===(i=a.cvr)||void 0===i?void 0:i.worker}, Wasm: ${s.version})`,0===r.bSupportDce4Module&&(e._intermediateResultManager=e.getIntermediateResultManager(!0)),t.resolve(e);else{const e=Error(s.message);s.stack&&(e.stack=s.stack),t.reject(e)}},l.postMessage({type:"cvr_createInstance",id:i}),t}async _singleFrameModeCallback(e){this.isa.getCameraView().setScanLaserVisible(!0);for(let t of this._resultReceiverSet)this._bNeedOutputOriginalImage&&t.onOriginalImageResultReceived&&t.onOriginalImageResultReceived({imageData:e});const t={bytes:new Uint8Array(e.bytes),width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.tag},s=await this.capture(t,this._templateName,!0);s.originalImageTag=e.tag;for(let e of this._resultReceiverSet)e.isDce&&e.onCapturedResultReceived(s,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const i={originalImageHashId:s.originalImageHashId,originalImageTag:s.originalImageTag,errorCode:s.errorCode,errorString:s.errorString},a=b(s);for(let t of this._resultReceiverSet)if(t.onDecodedBarcodesReceived&&a.barcodesResultItems.length&&t.onDecodedBarcodesReceived(Object.assign(Object.assign({},i),{barcodesResultItems:a.barcodesResultItems})),t.onRecognizedTextLinesReceived&&a.textLinesResultItems.length&&t.onRecognizedTextLinesReceived(Object.assign(Object.assign({},i),{textLinesResultItems:a.textLinesResultItems})),t.onDetectedQuadsReceived&&a.quadsResultItems.length&&t.onDetectedQuadsReceived(Object.assign(Object.assign({},i),{quadsResultItems:a.quadsResultItems})),t.onNormalizedImagesReceived&&a.normalizedImageResultItems.length&&t.onNormalizedImagesReceived(Object.assign(Object.assign({},i),{normalizedImageResultItems:a.normalizedImageResultItems})),t.onParsedResultsReceived&&a.parsedResultItems.length&&t.onParsedResultsReceived(Object.assign(Object.assign({},i),{parsedResultItems:a.parsedResultItems})),t.onCapturedResultReceived&&!t.isDce){if(this._bNeedOutputOriginalImage){const t=s.items.findIndex((e=>1===e.type));-1!==t&&(s.items[t].imageData=e)}t.onCapturedResultReceived(s)}}setInput(e){if(this._checkIsDisposed(),e){if(this.isa=e,e.isCameraEnhancer){this._intermediateResultManager&&(this.isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this.isa._intermediateResultReceiver));const e=this.isa.getCameraView();if(e){const t=e._capturedResultReceiver;t.isDce=!0,this._resultReceiverSet.add(t)}}}else this.isa=null}getInput(){return this._isa}addImageSourceStateListener(e){if(this._checkIsDisposed(),"object"!=typeof e)return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&this._isaStateListenerSet.add(e)}removeImageSourceStateListener(e){return this._checkIsDisposed(),this._isaStateListenerSet.delete(e)}addResultReceiver(e){if(this._checkIsDisposed(),"object"!=typeof e)throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(this._resultReceiverSet.add(e),this._setCrrRegistry())}removeResultReceiver(e){this._checkIsDisposed(),this._resultReceiverSet.delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let t of this._resultReceiverSet)t.isDce||(e.onCapturedResultReceived=!!t.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!t.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!t.onRecognizedTextLinesReceived,e.onDetectedQuadsReceived=!!t.onDetectedQuadsReceived,e.onNormalizedImagesReceived=!!t.onNormalizedImagesReceived,e.onParsedResultsReceived=!!t.onParsedResultsReceived);const t=new m;let s=o();return c[s]=async e=>{if(e.success)t.resolve();else{let s=new Error(e.message);s.stack=e.stack+"\n"+s.stack,t.reject()}},l.postMessage({type:"cvr_setCrrRegistry",id:s,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}}),t}async addResultFilter(e){if(this._checkIsDisposed(),"object"!=typeof e)return console.warn("Invalid filter.");if(e&&Object.keys(e)){this._resultFilterSet.add(e),this._handleFilterSwitch();for(let e of this._resultFilterSet)await this._enableResultCrossVerification(e.verificationEnabled),await this._enableResultDeduplication(e.duplicateFilterEnabled),await this._setDuplicateForgetTime(e.duplicateForgetTime)}}async removeResultFilter(e){this._checkIsDisposed(),this._resultFilterSet.delete(e),this._handleFilterSwitch();for(let e of this._resultFilterSet)await this._enableResultCrossVerification(e.verificationEnabled),await this._enableResultDeduplication(e.duplicateFilterEnabled),await this._setDuplicateForgetTime(e.duplicateForgetTime)}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let e of this._resultFilterSet)e.isResultCrossVerificationEnabled(d.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),e.isResultCrossVerificationEnabled(d.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),e.isResultCrossVerificationEnabled(d.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),e.isResultCrossVerificationEnabled(d.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}async startCapturing(e="Default"){if(this._checkIsDisposed(),!this._bPauseScan)return;if(!this.isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");const t=await this.containsTask(e);if(await n(t),this.isa.isCameraEnhancer&&(t.includes("ddn")?this.isa.setPixelFormat(u.IPF_ABGR_8888):this.isa.setPixelFormat(u.IPF_GRAYSCALED)),void 0!==this.isa.singleFrameMode&&"disabled"!==this.isa.singleFrameMode)return this._templateName=e,void this.isa.on("singleFrameAcquired",this._singleFrameModeCallbackBind);return this.isa.getColourChannelUsageType()===_.CCUT_AUTO&&this.isa.setColourChannelUsageType(t.includes("ddn")?_.CCUT_FULL_CHANNEL:_.CCUT_Y_CHANNEL_ONLY),this._promiseStartScan&&this._promiseStartScan.isPending?this._promiseStartScan:(this._promiseStartScan=new m(((t,s)=>{if(this.disposed)return;let i=o();c[i]=async i=>{if(this._promiseStartScan&&!this._promiseStartScan.isFulfilled){if(!i.success){let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,s(e)}["ReadBarcodes_ReadRateFirst","ReadBarcodes_Balance","ReadDenseBarcodes"].includes(e.toLowerCase())&&(this.maxCvsSideLength=4096);for(let e of this._resultFilterSet)await this.addResultFilter(e);this._bPauseScan=!1,this._bNeedOutputOriginalImage=i.bNeedOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((async()=>{-1!==this._minImageCaptureInterval&&this.isa.startFetching(),this._loopReadVideo(e),t()}),0),this.isa.isCameraEnhancer&&this.isa.getCameraView().setScanLaserVisible(!0)}},l.postMessage({type:"cvr_startCapturing",id:i,instanceID:this._instanceID,body:{templateName:e}})})),await this._promiseStartScan)}stopCapturing(){this._checkIsDisposed(),this.isa&&(this.isa.isCameraEnhancer&&(this.isa.getCameraView().setScanLaserVisible(!1),void 0!==this.isa.singleFrameMode&&"disabled"!==this.isa.singleFrameMode)?this.isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this.isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this.isa.setColourChannelUsageType(_.CCUT_AUTO),this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(r.browserInfo.OS)?2048:4096))}async _clearVerifyList(){let e=o();const t=new m;return c[e]=async e=>{if(e.success)return t.resolve();{let s=new Error(e.message);return s.stack=e.stack+"\n"+s.stack,t.reject(s)}},l.postMessage({type:"cvr_clearVerifyList",id:e,instanceID:this._instanceID}),t}async _getIntermediateResult(){this._checkIsDisposed();let e=o();const t=new m;return c[e]=async e=>{if(e.success)t.resolve(e.result);else{let s=new Error(e.message);s.stack=e.stack+"\n"+s.stack,t.reject(s)}},l.postMessage({type:"cvr_getIntermediateResult",id:e,instanceID:this._instanceID}),t}async containsTask(e){return this._checkIsDisposed(),await new Promise(((t,s)=>{let i=o();c[i]=async e=>{if(e.success)return t(JSON.parse(e.tasks));{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},l.postMessage({type:"cvr_containsTask",id:i,instanceID:this._instanceID,body:{templateName:e}})}))}async _loopReadVideo(e){if(this.disposed||this._bPauseScan)return;if(this.isa.isBufferEmpty())if(this.isa.hasNextImageToFetch())for(let e of this._isaStateListenerSet)e.onImageSourceStateListener&&e.onImageSourceStateListener(S.ISS_BUFFER_EMPTY);else if(!this.isa.hasNextImageToFetch())for(let e of this._isaStateListenerSet)e.onImageSourceStateListener&&e.onImageSourceStateListener(S.ISS_EXHAUSTED);if(-1===this._minImageCaptureInterval||this.isa.isBufferEmpty())try{this.isa.isBufferEmpty()&&F._onLog&&F._onLog("buffer is empty so fetch image"),F._onLog&&F._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=this.isa.fetchImage(),F._onLog&&F._onLog(`DCE: finish fetching a frame: ${Date.now()}`),this.isa.setImageFetchInterval(this._averageTime)}catch(t){return void this._reRunCurrnetFunc(e)}else if(this.isa.setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=this.isa.getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!this._dsImage)return void this._reRunCurrnetFunc(e);for(let e of this._resultReceiverSet)this._bNeedOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived({imageData:this._dsImage});const t=Date.now();let s=null;this._captureDsimage(this._dsImage,e,!0).then((async i=>{if(F._onLog&&F._onLog("no js handle time: "+(Date.now()-t)),s=i,this._bPauseScan)return void this._reRunCurrnetFunc(e);const a=Date.now(),r=s.intermediateResult;if(r){if(r.taskSet)for(let e of r.taskSet.intermediateResultUnits)e.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let e of this._intermediateResultReceiverSet){if(r.taskSet&&e.onTaskResultsReceived&&e.onTaskResultsReceived({intermediateResultUnits:r.taskSet.intermediateResultUnits},r.taskSet.info),r.sectionSet)for(let t in r.sectionSet){for(let s of r.sectionSet[t].asStage)e[t]&&e[t](s.result,s.info);for(let s of r.sectionSet[t].asSection)e[t]&&e[t](s.result,s.info)}if(r.stageSet)for(let t in r.stageSet)for(let s of r.stageSet[t])e[t]&&e[t](s.result,s.info)}}s.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let e of this._resultReceiverSet)if(e.isDce){const t=Date.now();if(e.onCapturedResultReceived(s,{isDetectVerifyOpen:this._bOpenDetectVerify,isNormalizeVerifyOpen:this._bOpenNormalizeVerify,isBarcodeVerifyOpen:this._bOpenBarcodeVerify,isLabelVerifyOpen:this._bOpenLabelVerify}),F._onLog){const e=Date.now()-t;e>10&&F._onLog(`draw result time: ${e}`)}}for(let e of this._resultFilterSet)e.onDecodedBarcodesReceived(s.items),e.onRecognizedTextLinesReceived(s.items),e.onDetectedQuadsReceived(s.items),e.onNormalizedImagesReceived(s.items);const n=b(s),o={originalImageHashId:s.originalImageHashId,originalImageTag:s.originalImageTag,errorCode:s.errorCode,errorString:s.errorString};for(let e of this._resultReceiverSet)e.onDecodedBarcodesReceived&&n.barcodesResultItems.length&&e.onDecodedBarcodesReceived(Object.assign(Object.assign({},o),{barcodesResultItems:n.barcodesResultItems.filter((e=>!e.isFilter))})),e.onRecognizedTextLinesReceived&&n.textLinesResultItems.length&&e.onRecognizedTextLinesReceived(Object.assign(Object.assign({},o),{textLinesResultItems:n.textLinesResultItems.filter((e=>!e.isFilter))})),e.onDetectedQuadsReceived&&n.quadsResultItems.length&&e.onDetectedQuadsReceived(Object.assign(Object.assign({},o),{quadsResultItems:n.quadsResultItems.filter((e=>!e.isFilter))})),e.onNormalizedImagesReceived&&n.normalizedImageResultItems.length&&e.onNormalizedImagesReceived(Object.assign(Object.assign({},o),{normalizedImageResultItems:n.normalizedImageResultItems.filter((e=>!e.isFilter))})),e.onParsedResultsReceived&&n.parsedResultItems.length&&e.onParsedResultsReceived(Object.assign(Object.assign({},o),{parsedResultItems:n.parsedResultItems.filter((e=>!e.isFilter))})),e.onCapturedResultReceived&&!e.isDce&&(s.items=s.items.filter((e=>!e.isFilter)),e.onCapturedResultReceived(s));if(F._onLog){const e=Date.now()-a;e>10&&F._onLog(`callback dispatch time: ${e}`)}const c=Date.now();if(this._minImageCaptureInterval>-1&&(5===this._averageProcessintTimeArray.length&&this._averageProcessintTimeArray.shift(),5===this._averageFetchImageTimeArray.length&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-t),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,F._onLog&&(F._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),F._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),F._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),F._onLog(`averageTime: ${this._averageTime}`))),F._onLog){const e=Date.now()-c;e>10&&F._onLog(`fetch image calculate time: ${e}`)}F._onLog&&F._onLog(`time finish decode: ${Date.now()}`),F._onLog&&F._onLog("main time: "+(Date.now()-t)),F._onLog&&F._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),Math.max(this._minImageCaptureInterval,0))})).catch((t=>{this.isa.stopFetching(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this.isa.startFetching(),this._loopReadVideo(e)}),Math.max(this._minImageCaptureInterval,1e3)),"platform error"!==t.message&&console.error(t.message)})).finally((()=>{s&&s.intermediateResult&&delete s.intermediateResult}))}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),0)}async capture(e,t="Default",s=!1){if(this._checkIsDisposed(),!e)return null;["ReadBarcodes_ReadRateFirst","ReadBarcodes_Balance","ReadDenseBarcodes"].includes(t.toLowerCase())&&(this.maxCvsSideLength=4096);const i=await this.containsTask(t);let a;if(await n(i),(r=e)&&"object"==typeof r&&!Array.isArray(r)&&"bytes"in r&&"width"in r&&"height"in r&&"stride"in r&&"format"in r)a=await this._captureDsimage(e,t,s);else if("string"==typeof e)a="data:image/"==e.substring(0,11)?await this._captureBase64(e,t,s):await this._captureUrl(e,t,s);else if(e instanceof Blob)a=await this._captureBlob(e,t,s);else if(e instanceof HTMLImageElement)a=await this._captureImage(e,t,s);else if(e instanceof HTMLCanvasElement)a=await this._captureCanvas(e,t,s);else if(e instanceof HTMLVideoElement)a=await this._captureVideo(e,t,s);else{if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof Uint8ClampedArray))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'Uint8Array', 'ArrayBuffer', 'Uint8ClampedArray', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");a=await this._captureBlob(new Blob([new Uint8Array(e)],{type:"image/png"}),t,s)}var r;const o=await this._getIntermediateResult();if(o)for(let e of this._intermediateResultReceiverSet){if(o.taskSet&&e.onTaskResultsReceived&&e.onTaskResultsReceived({intermediateResultUnits:o.taskSet.intermediateResultUnits},o.taskSet.info),o.sectionSet)for(let t in o.sectionSet){for(let s of o.sectionSet[t].asStage)e[t]&&e[t](s.result,s.info);for(let s of o.sectionSet[t].asSection)e[t]&&e[t](s.result,s.info)}if(o.stageSet)for(let t in o.stageSet)for(let s of o.stageSet[t])e[t]&&e[t](s.result,s.info)}return a}async _captureDsimage(e,t,s=!1){return await this._captureInWorker(e,t,s)}async _captureUrl(e,t,s=!1){let i=await C(e,"blob");return await this._captureBlob(i,t,s)}async _captureBase64(e,t,s=!1){e=e.substring(e.indexOf(",")+1);let i=atob(e),a=i.length,r=new Uint8Array(a);for(;a--;)r[a]=i.charCodeAt(a);return await this._captureBlob(new Blob([r]),t,s)}async _captureBlob(e,t,s=!1){let i=null,a=null;if("undefined"!=typeof createImageBitmap)try{i=await createImageBitmap(e)}catch(e){}i||(a=await async function(e){return await new Promise(((t,s)=>{let i=URL.createObjectURL(e),a=new Image;a.src=i,a.onload=()=>{URL.revokeObjectURL(a.dbrObjUrl),t(a)},a.onerror=e=>{s(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let r=await this._captureImage(i||a,t,s);return i&&i.close(),r}async _captureImage(e,t,s=!1){let i,a,r=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,o=Math.max(r,n);if(o>this.maxCvsSideLength){let e=this.maxCvsSideLength/o;i=Math.round(r*e),a=Math.round(n*e)}else i=r,a=n;this._canvas||(this._canvas=document.createElement("canvas"));const c=this._canvas;c.width===i&&c.height===a||(c.width=i,c.height=a),c.ctx2d||(c.ctx2d=c.getContext("2d",{willReadFrequently:!0}));return c.ctx2d.drawImage(e,0,0,r,n,0,0,i,a),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(c,t,s)}async _captureCanvas(e,t,s=!1){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),a={bytes:Uint8Array.from(i.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:10};return await this._captureInWorker(a,t,s)}async _captureVideo(e,t,s=!1){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let i,a,r=e.videoWidth,n=e.videoHeight,o=Math.max(r,n);if(o>this._maxCvsSideLength){let e=this._maxCvsSideLength/o;i=Math.round(r*e),a=Math.round(n*e)}else i=r,a=n;this._canvas||(this._canvas=document.createElement("canvas"));const c=this._canvas;c.width===i&&c.height===a||(c.width=i,c.height=a),c.ctx2d||(c.ctx2d=c.getContext("2d",{willReadFrequently:!0}));return c.ctx2d.drawImage(e,0,0,r,n,0,0,i,a),await this._captureCanvas(c,t,s)}async _captureInWorker(e,t,i=!1){const{bytes:a,width:n,height:u,stride:_,format:h}=e;i||(this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(r.browserInfo.OS)?2048:4096);let R=o();const g=new m;return c[R]=async t=>{var i;if(!t.success){let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,g.reject(e)}{const a=Date.now();F._onLog&&(F._onLog(`get result time from worker: ${a}`),F._onLog("worker to main time consume: "+(a-t.workerReturnMsgTime)));try{const a=t.captureResult;e.bytes=t.bytes;for(let t=0;t<a.items.length;t++)if(a.items[t].type===d.CRIT_NORMALIZED_IMAGE){const e=O(a.items[t].imageData);L(a.items[t],e)}else a.items[t].type===d.CRIT_ORIGINAL_IMAGE?a.items[t].imageData=e:a.items[t].type===d.CRIT_PARSED_RESULT&&(null===(i=s.dcp)||void 0===i||i.handleParsedResultItem(a.items[t]));return g.resolve(a)}catch(e){return g.reject(e)}}},F._onLog&&F._onLog(`send buffer to worker: ${Date.now()}`),l.postMessage({type:"cvr_capture",id:R,instanceID:this._instanceID,body:{bytes:a,width:n,height:u,stride:_,format:h,templateName:t||"",bScanner:i}},[a.buffer]),g}async initSettings(e){return this._checkIsDisposed(),e&&["string","object"].includes(typeof e)?("string"==typeof e&&(/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(e)&&(e=await C(e,"text")),this._currentSettings=JSON.parse(e)),"object"==typeof e&&(this._currentSettings=e,e=JSON.stringify(e)),await new Promise(((t,s)=>{let i=o();c[i]=async i=>{if(i.success){const a=JSON.parse(i.response);if(0!==a.exception){let e=new Error(a.description?a.description:"Init Settings Failed.");return e.errorCode=a.exception,s(e)}let r=[],o=JSON.parse(e).CaptureVisionTemplates;for(let e=0;e<o.length;e++){let t=await this.containsTask(o[e].Name);r=r.concat(t)}return await n([...new Set(r)]),this._bNeedOutputOriginalImage=1===this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,t(a)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,s(e)}},l.postMessage({type:"cvr_initSettings",id:i,instanceID:this._instanceID,body:{settings:e}})}))):console.error("Invalid template.")}async outputSettings(e){return this._checkIsDisposed(),await new Promise(((t,s)=>{let i=o();c[i]=async e=>{if(e.success){const i=JSON.parse(e.settings);if(0!==i.errorCode){let e=new Error(i.errorString);return e.errorCode=i.errorCode,s(e)}return delete i.errorCode,delete i.errorString,t(i)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},l.postMessage({type:"cvr_outputSettings",id:i,instanceID:this._instanceID,body:{templateName:e||"Default"}})}))}async outputSettingsToFile(e,t,s){const i=await this.outputSettings(e),a=new Blob([JSON.stringify(i,null,2,(function(e,t){return t instanceof Array?JSON.stringify(t):t}),2)],{type:"application/json"});if(s){const e=document.createElement("a");e.href=URL.createObjectURL(a),t.endsWith(".json")&&(t=t.replace(".json","")),e.download=`${t}.json`,e.onclick=()=>{setTimeout((()=>{URL.revokeObjectURL(e.href)}),500)},e.click()}return a}async getSimplifiedSettings(e="Default"){this._checkIsDisposed();const t=await this.containsTask(e);return await n(t),await new Promise(((t,s)=>{let i=o();c[i]=async e=>{if(e.success){const i=JSON.parse(e.settings,((e,t)=>N&&"barcodeFormatIds"===e?BigInt(t):t));if(i.minImageCaptureInterval=this._minImageCaptureInterval,0!==i.code){let e=new Error(i.codeString);return e.errorCode=i.errorCode,s(e)}return delete i.code,delete i.codeString,t(i)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},l.postMessage({type:"cvr_getSimplifiedSettings",id:i,instanceID:this._instanceID,body:{templateName:e}})}))}async updateSettings(e,t){this._checkIsDisposed();const s=await this.containsTask(e);return await n(s),await new Promise(((s,i)=>{let a=o();c[a]=async e=>{if(e.success){const a=JSON.parse(e.response);if(t.minImageCaptureInterval&&t.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=t.minImageCaptureInterval),this._bNeedOutputOriginalImage=e.bNeedOutputOriginalImage,0!==a.exception){let e=new Error(a.description?a.description:"Update Settings Failed.");return e.errorCode=a.exception,i(e)}return this._currentSettings=await this.outputSettings("*"),s(a)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},l.postMessage({type:"cvr_updateSettings",id:a,instanceID:this._instanceID,body:{settings:t,templateName:e}})}))}async resetSettings(){return this._checkIsDisposed(),await new Promise(((e,t)=>{let s=o();c[s]=async s=>{if(s.success){const i=JSON.parse(s.response);if(0!==i.exception){let e=new Error(i.description?i.description:"Reset Settings Failed.");return e.errorCode=i.exception,t(e)}return this._currentSettings=await this.outputSettings("*"),e(i)}{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}},l.postMessage({type:"cvr_resetSettings",id:s,instanceID:this._instanceID})}))}getIntermediateResultManager(e){if(this._checkIsDisposed(),!e&&0!==r.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new R,this._intermediateResultManager.addResultReceiver=async e=>{if("object"!=typeof e)throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(e),this._handleIntermediateResultReceiver();return await(async()=>await new Promise(((e,t)=>{let s=o();c[s]=async s=>{if(s.success)return e();{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}},l.postMessage({type:"cvr_setIrrRegistry",id:s,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})})))()},this._intermediateResultManager.removeResultReceiver=async e=>(this._intermediateResultReceiverSet.delete(e),this._handleIntermediateResultReceiver(),await new Promise(((e,t)=>{let s=o();c[s]=async s=>{if(s.success)return e();{let e=new Error(s.message);return e.stack=s.stack+"\n"+e.stack,t(e)}},l.postMessage({type:"cvr_setIrrRegistry",id:s,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})}))),this._intermediateResultManager.getOriginalImage=async e=>this._dsImage),this._intermediateResultManager}_handleIntermediateResultReceiver(){for(let e in this._irrRegistryState)this._irrRegistryState[e]=!1;for(let e of this._intermediateResultReceiverSet)if(e.isDce)this._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let t in e)this._irrRegistryState[t]||(this._irrRegistryState[t]=!!e[t])}async _enableResultCrossVerification(e){return this._checkIsDisposed(),await new Promise(((t,s)=>{let i=o();c[i]=async e=>{if(e.success)return t(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},l.postMessage({type:"cvr_enableResultCrossVerification",id:i,instanceID:this._instanceID,body:{verificationEnabled:e}})}))}async _enableResultDeduplication(e){return this._checkIsDisposed(),await new Promise(((t,s)=>{let i=o();c[i]=async e=>{if(e.success)return t(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},l.postMessage({type:"cvr_enableResultDeduplication",id:i,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})}))}async _setDuplicateForgetTime(e){return this._checkIsDisposed(),await new Promise(((t,s)=>{let i=o();c[i]=async e=>{if(e.success)return t(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},l.postMessage({type:"cvr_setDuplicateForgetTime",id:i,instanceID:this._instanceID,body:{duplicateForgetTime:e}})}))}async _getDuplicateForgetTime(e){return this._checkIsDisposed(),await new Promise(((t,s)=>{let i=o();c[i]=async e=>{if(e.success)return t(e.time);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},l.postMessage({type:"cvr_getDuplicateForgetTime",id:i,instanceID:this._instanceID,body:{type:e}})}))}async parseRequiredResources(e){return this._checkIsDisposed(),await new Promise(((t,s)=>{let i=o();c[i]=async e=>{if(e.success)return t(JSON.parse(e.resources));{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},l.postMessage({type:"cvr_parseRequiredResources",id:i,instanceID:this._instanceID,body:{templateName:e}})}))}async _setThresholdValue(e,t,s){return await new Promise(((i,a)=>{let r=o();c[r]=async e=>{if(e.success)return i();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,a(t)}},l.postMessage({type:"cvr_setThresholdValue",id:r,instanceID:this._instanceID,body:{threshold:e,leftLimit:t,rightLimit:s}})}))}contains(e,t){return function(e,t){let s=t.x,i=t.y,a=e[0].x,r=e[0].y,n=e[1].x,o=e[1].y,c=e[2].x,l=e[2].y,d=e[3].x,u=e[3].y,_=g(s,i,a,r,n,o),h=g(s,i,n,o,c,l),m=g(s,i,c,l,d,u),R=g(s,i,d,u,a,r);function g(e,t,s,i,a,r){return(e-s)*(r-i)-(t-i)*(a-s)}return _>=0&&h>=0&&m>=0&&R>=0||_<=0&&h<=0&&m<=0&&R<=0}(e,t)}async dispose(){this._checkIsDisposed(),this._promiseStartScan&&this.stopCapturing(),this.isa=null,this._resultReceiverSet.clear(),this._isaStateListenerSet.clear(),this._resultFilterSet.clear(),this.bDestroyed=!0;let e=o();c[e]=e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}},l.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}}class M{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}class B{constructor(){this.onTaskResultsReceived=null,this.onPredetectedRegionsReceived=null,this.onColourImageUnitReceived=null,this.onScaledDownColourImageUnitReceived=null,this.onGrayscaleImageUnitReceived=null,this.onTransformedGrayscaleImageUnitReceived=null,this.onEnhancedGrayscaleImageUnitReceived=null,this.onBinaryImageUnitReceived=null,this.onTextureDetectionResultUnitReceived=null,this.onTextureRemovedGrayscaleImageUnitReceived=null,this.onTextureRemovedBinaryImageUnitReceived=null,this.onContoursUnitReceived=null,this.onLineSegmentsUnitReceived=null,this.onTextZonesUnitReceived=null,this.onTextRemovedBinaryImageUnitReceived=null}}export{F as CaptureVisionRouter,T as CaptureVisionRouterModule,M as CapturedResultReceiver,S as EnumImageSourceState,R as IntermediateResultManager,B as IntermediateResultReceiver};
